import{$ as e,$i as t,$n as n,$r as r,$t as i,A as a,Ai as o,An as s,Ar as c,At as l,B as u,Bi as d,Bn as f,Br as p,Bt as m,C as h,Ci as g,Cn as _,Cr as v,Ct as y,D as b,Di as x,Dn as S,Dr as C,Dt as w,E as T,Ei as E,En as D,Er as O,Et as ee,F as k,Fi as te,Fn as A,Fr as ne,Ft as re,G as ie,Gi as ae,Gn as oe,Gr as se,Gt as ce,H as le,Hi as ue,Hn as de,Hr as fe,Ht as pe,I as me,Ii as he,In as ge,Ir as _e,It as ve,J as ye,Ji as be,Jn as xe,Jr as Se,Jt as Ce,K as we,Ki as Te,Kn as Ee,Kr as De,Kt as Oe,L as ke,Li as Ae,Ln as je,Lr as Me,Lt as Ne,M as Pe,Mi as Fe,Mn as Ie,Mr as Le,Mt as Re,N as ze,Ni as j,Nn as Be,Nr as Ve,Nt as He,O as Ue,Oi as We,On as Ge,Or as Ke,Ot as M,P as qe,Pi as Je,Pn as Ye,Pr as Xe,Pt as Ze,Q as Qe,Qi as $e,Qn as et,Qr as tt,Qt as nt,R as rt,Ri as it,Rn as at,Rr as ot,Rt as st,S as ct,Si as lt,Sn as ut,Sr as dt,St as ft,T as pt,Ti as mt,Tn as ht,Tr as gt,Tt as _t,U as vt,Ui as yt,Un as bt,Ur as xt,Ut as St,V as Ct,Vi as wt,Vn as Tt,Vr as Et,Vt as Dt,W as Ot,Wi as N,Wn as kt,Wr as At,Wt as jt,X as Mt,Xi as Nt,Xn as Pt,Xr as Ft,Xt as It,Y as Lt,Yi as Rt,Yn as zt,Yr as Bt,Yt as Vt,Z as Ht,Zi as Ut,Zn as Wt,Zr as Gt,Zt as Kt,_ as qt,_i as Jt,_n as Yt,_r as Xt,_t as Zt,a as Qt,ai as $t,an as en,ar as tn,at as nn,b as rn,bi as an,bn as on,br as sn,bt as cn,c as ln,ci as un,cn as dn,cr as fn,ct as pn,d as mn,di as hn,dn as gn,dr as _n,dt as vn,ei as yn,en as bn,er as xn,et as Sn,f as Cn,fi as wn,fn as Tn,fr as En,ft as Dn,g as On,gi as kn,gn as An,gr as jn,gt as Mn,h as Nn,hi as Pn,hn as Fn,hr as In,ht as Ln,i as Rn,ii as zn,in as Bn,ir as Vn,it as Hn,j as Un,ji as Wn,jn as Gn,jr as Kn,jt as qn,k as Jn,ki as Yn,kn as Xn,kr as Zn,kt as Qn,l as $n,li as er,ln as tr,lr as nr,lt as rr,m as ir,mi as ar,mn as or,mr as sr,mt as cr,n as lr,ni as ur,nn as dr,nr as fr,nt as pr,o as mr,oi as hr,on as gr,or as _r,ot as vr,p as yr,pi as br,pn as xr,pr as Sr,pt as Cr,q as wr,qi as P,qn as Tr,qr as Er,qt as Dr,r as Or,ri as kr,rn as Ar,rr as jr,rt as Mr,s as Nr,si as Pr,sn as F,sr as Fr,st as Ir,t as Lr,ti as Rr,tn as zr,tr as Br,tt as Vr,u as Hr,ui as Ur,un as Wr,ur as Gr,ut as I,v as L,vi as Kr,vn as qr,vr as Jr,vt as Yr,w as Xr,wi as Zr,wn as Qr,wr as $r,wt as ei,x as ti,xi as ni,xn as ri,xr as ii,xt as ai,y as oi,yi as si,yn as ci,yr as li,yt as ui,z as di,zi as fi,zn as pi,zr as mi,zt as hi}from"./index-CcMpoKPo.js";function gi(){return gi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},gi.apply(null,arguments)}var _i=Object.defineProperty,vi=(e,t,n)=>t in e?_i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,yi=(e,t,n)=>(vi(e,typeof t==`symbol`?t:t+``,n),n),bi=class{constructor(){yi(this,`_listeners`)}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let n=this._listeners[e];if(n!==void 0){let e=n.indexOf(t);e!==-1&&n.splice(e,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}},xi=Object.defineProperty,Si=(e,t,n)=>t in e?xi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ci=(e,t,n)=>(Si(e,typeof t==`symbol`?t:t+``,n),n),wi=new ne,Ti=new Tr,Ei=Math.cos(70*(Math.PI/180)),Di=(e,t)=>(e%t+t)%t,Oi=class extends bi{constructor(e,t){super(),Ci(this,`object`),Ci(this,`domElement`),Ci(this,`enabled`,!0),Ci(this,`target`,new j),Ci(this,`minDistance`,0),Ci(this,`maxDistance`,1/0),Ci(this,`minZoom`,0),Ci(this,`maxZoom`,1/0),Ci(this,`minPolarAngle`,0),Ci(this,`maxPolarAngle`,Math.PI),Ci(this,`minAzimuthAngle`,-1/0),Ci(this,`maxAzimuthAngle`,1/0),Ci(this,`enableDamping`,!1),Ci(this,`dampingFactor`,.05),Ci(this,`enableZoom`,!0),Ci(this,`zoomSpeed`,1),Ci(this,`enableRotate`,!0),Ci(this,`rotateSpeed`,1),Ci(this,`enablePan`,!0),Ci(this,`panSpeed`,1),Ci(this,`screenSpacePanning`,!0),Ci(this,`keyPanSpeed`,7),Ci(this,`zoomToCursor`,!1),Ci(this,`autoRotate`,!1),Ci(this,`autoRotateSpeed`,2),Ci(this,`reverseOrbit`,!1),Ci(this,`reverseHorizontalOrbit`,!1),Ci(this,`reverseVerticalOrbit`,!1),Ci(this,`keys`,{LEFT:`ArrowLeft`,UP:`ArrowUp`,RIGHT:`ArrowRight`,BOTTOM:`ArrowDown`}),Ci(this,`mouseButtons`,{LEFT:dr.ROTATE,MIDDLE:dr.DOLLY,RIGHT:dr.PAN}),Ci(this,`touches`,{ONE:Ur.ROTATE,TWO:Ur.DOLLY_PAN}),Ci(this,`target0`),Ci(this,`position0`),Ci(this,`zoom0`),Ci(this,`_domElementKeyEvents`,null),Ci(this,`getPolarAngle`),Ci(this,`getAzimuthalAngle`),Ci(this,`setPolarAngle`),Ci(this,`setAzimuthalAngle`),Ci(this,`getDistance`),Ci(this,`getZoomScale`),Ci(this,`listenToKeyEvents`),Ci(this,`stopListenToKeyEvents`),Ci(this,`saveState`),Ci(this,`reset`),Ci(this,`update`),Ci(this,`connect`),Ci(this,`dispose`),Ci(this,`dollyIn`),Ci(this,`dollyOut`),Ci(this,`getScale`),Ci(this,`setScale`),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>l.phi,this.getAzimuthalAngle=()=>l.theta,this.setPolarAngle=e=>{let t=Di(e,2*Math.PI),r=l.phi;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-r);2*Math.PI-i<i&&(t<r?t+=2*Math.PI:r+=2*Math.PI),u.phi=t-r,n.update()},this.setAzimuthalAngle=e=>{let t=Di(e,2*Math.PI),r=l.theta;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-r);2*Math.PI-i<i&&(t<r?t+=2*Math.PI:r+=2*Math.PI),u.theta=t-r,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=e=>{e.addEventListener(`keydown`,Ne),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener(`keydown`,Ne),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),s=o.NONE},this.update=(()=>{let t=new j,i=new j(0,1,0),a=new et().setFromUnitVectors(e.up,i),p=a.clone().invert(),m=new j,h=new et,g=2*Math.PI;return function(){let _=n.object.position;a.setFromUnitVectors(e.up,i),p.copy(a).invert(),t.copy(_).sub(n.target),t.applyQuaternion(a),l.setFromVector3(t),n.autoRotate&&s===o.NONE&&ee(D()),n.enableDamping?(l.theta+=u.theta*n.dampingFactor,l.phi+=u.phi*n.dampingFactor):(l.theta+=u.theta,l.phi+=u.phi);let v=n.minAzimuthAngle,y=n.maxAzimuthAngle;isFinite(v)&&isFinite(y)&&(v<-Math.PI?v+=g:v>Math.PI&&(v-=g),y<-Math.PI?y+=g:y>Math.PI&&(y-=g),v<=y?l.theta=Math.max(v,Math.min(y,l.theta)):l.theta=l.theta>(v+y)/2?Math.max(v,l.theta):Math.min(y,l.theta)),l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(f,n.dampingFactor):n.target.add(f),n.zoomToCursor&&w||n.object.isOrthographicCamera?l.radius=se(l.radius):l.radius=se(l.radius*d),t.setFromSpherical(l),t.applyQuaternion(p),_.copy(n.target).add(t),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,f.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),f.set(0,0,0));let b=!1;if(n.zoomToCursor&&w){let r=null;if(n.object instanceof Ee&&n.object.isPerspectiveCamera){let e=t.length();r=se(e*d);let i=e-r;n.object.position.addScaledVector(S,i),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){let e=new j(C.x,C.y,0);e.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/d)),n.object.updateProjectionMatrix(),b=!0;let i=new j(C.x,C.y,0);i.unproject(n.object),n.object.position.sub(i).add(e),n.object.updateMatrixWorld(),r=t.length()}else console.warn(`WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled.`),n.zoomToCursor=!1;r!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(r).add(n.object.position):(wi.origin.copy(n.object.position),wi.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(wi.direction))<Ei?e.lookAt(n.target):(Ti.setFromNormalAndCoplanarPoint(n.object.up,n.target),wi.intersectPlane(Ti,n.target))))}else n.object instanceof kt&&n.object.isOrthographicCamera&&(b=d!==1,b&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/d)),n.object.updateProjectionMatrix()));return d=1,w=!1,b||m.distanceToSquared(n.object.position)>c||8*(1-h.dot(n.object.quaternion))>c?(n.dispatchEvent(r),m.copy(n.object.position),h.copy(n.object.quaternion),b=!1,!0):!1}})(),this.connect=e=>{n.domElement=e,n.domElement.style.touchAction=`none`,n.domElement.addEventListener(`contextmenu`,Le),n.domElement.addEventListener(`pointerdown`,De),n.domElement.addEventListener(`pointercancel`,ke),n.domElement.addEventListener(`wheel`,Me)},this.dispose=()=>{var e,t,r,i,a,o;n.domElement&&(n.domElement.style.touchAction=`auto`),(e=n.domElement)==null||e.removeEventListener(`contextmenu`,Le),(t=n.domElement)==null||t.removeEventListener(`pointerdown`,De),(r=n.domElement)==null||r.removeEventListener(`pointercancel`,ke),(i=n.domElement)==null||i.removeEventListener(`wheel`,Me),(a=n.domElement)==null||a.ownerDocument.removeEventListener(`pointermove`,Oe),(o=n.domElement)==null||o.ownerDocument.removeEventListener(`pointerup`,ke),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener(`keydown`,Ne)};let n=this,r={type:`change`},i={type:`start`},a={type:`end`},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},s=o.NONE,c=1e-6,l=new Rr,u=new Rr,d=1,f=new j,p=new Fe,m=new Fe,h=new Fe,g=new Fe,_=new Fe,v=new Fe,y=new Fe,b=new Fe,x=new Fe,S=new j,C=new Fe,w=!1,T=[],E={};function D(){return 2*Math.PI/60/60*n.autoRotateSpeed}function O(){return .95**n.zoomSpeed}function ee(e){n.reverseOrbit||n.reverseHorizontalOrbit?u.theta+=e:u.theta-=e}function k(e){n.reverseOrbit||n.reverseVerticalOrbit?u.phi+=e:u.phi-=e}let te=(()=>{let e=new j;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),f.add(e)}})(),A=(()=>{let e=new j;return function(t,r){n.screenSpacePanning===!0?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),f.add(e)}})(),ne=(()=>{let e=new j;return function(t,r){let i=n.domElement;if(i&&n.object instanceof Ee&&n.object.isPerspectiveCamera){let a=n.object.position;e.copy(a).sub(n.target);let o=e.length();o*=Math.tan(n.object.fov/2*Math.PI/180),te(2*t*o/i.clientHeight,n.object.matrix),A(2*r*o/i.clientHeight,n.object.matrix)}else i&&n.object instanceof kt&&n.object.isOrthographicCamera?(te(t*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),A(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn(`WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.`),n.enablePan=!1)}})();function re(e){n.object instanceof Ee&&n.object.isPerspectiveCamera||n.object instanceof kt&&n.object.isOrthographicCamera?d=e:(console.warn(`WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.`),n.enableZoom=!1)}function ie(e){re(d/e)}function ae(e){re(d*e)}function oe(e){if(!n.zoomToCursor||!n.domElement)return;w=!0;let t=n.domElement.getBoundingClientRect(),r=e.clientX-t.left,i=e.clientY-t.top,a=t.width,o=t.height;C.x=r/a*2-1,C.y=-(i/o)*2+1,S.set(C.x,C.y,1).unproject(n.object).sub(n.object.position).normalize()}function se(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function ce(e){p.set(e.clientX,e.clientY)}function le(e){oe(e),y.set(e.clientX,e.clientY)}function ue(e){g.set(e.clientX,e.clientY)}function de(e){m.set(e.clientX,e.clientY),h.subVectors(m,p).multiplyScalar(n.rotateSpeed);let t=n.domElement;t&&(ee(2*Math.PI*h.x/t.clientHeight),k(2*Math.PI*h.y/t.clientHeight)),p.copy(m),n.update()}function fe(e){b.set(e.clientX,e.clientY),x.subVectors(b,y),x.y>0?ie(O()):x.y<0&&ae(O()),y.copy(b),n.update()}function pe(e){_.set(e.clientX,e.clientY),v.subVectors(_,g).multiplyScalar(n.panSpeed),ne(v.x,v.y),g.copy(_),n.update()}function me(e){oe(e),e.deltaY<0?ae(O()):e.deltaY>0&&ie(O()),n.update()}function he(e){let t=!1;switch(e.code){case n.keys.UP:ne(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:ne(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:ne(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:ne(-n.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),n.update())}function ge(){if(T.length==1)p.set(T[0].pageX,T[0].pageY);else{let e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);p.set(e,t)}}function _e(){if(T.length==1)g.set(T[0].pageX,T[0].pageY);else{let e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);g.set(e,t)}}function ve(){let e=T[0].pageX-T[1].pageX,t=T[0].pageY-T[1].pageY,n=Math.sqrt(e*e+t*t);y.set(0,n)}function ye(){n.enableZoom&&ve(),n.enablePan&&_e()}function be(){n.enableZoom&&ve(),n.enableRotate&&ge()}function xe(e){if(T.length==1)m.set(e.pageX,e.pageY);else{let t=Ve(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);m.set(n,r)}h.subVectors(m,p).multiplyScalar(n.rotateSpeed);let t=n.domElement;t&&(ee(2*Math.PI*h.x/t.clientHeight),k(2*Math.PI*h.y/t.clientHeight)),p.copy(m)}function Se(e){if(T.length==1)_.set(e.pageX,e.pageY);else{let t=Ve(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);_.set(n,r)}v.subVectors(_,g).multiplyScalar(n.panSpeed),ne(v.x,v.y),g.copy(_)}function Ce(e){let t=Ve(e),r=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(r*r+i*i);b.set(0,a),x.set(0,(b.y/y.y)**+n.zoomSpeed),ie(x.y),y.copy(b)}function we(e){n.enableZoom&&Ce(e),n.enablePan&&Se(e)}function Te(e){n.enableZoom&&Ce(e),n.enableRotate&&xe(e)}function De(e){var t,r;n.enabled!==!1&&(T.length===0&&((t=n.domElement)==null||t.ownerDocument.addEventListener(`pointermove`,Oe),(r=n.domElement)==null||r.ownerDocument.addEventListener(`pointerup`,ke)),Re(e),e.pointerType===`touch`?Pe(e):Ae(e))}function Oe(e){n.enabled!==!1&&(e.pointerType===`touch`?Ie(e):je(e))}function ke(e){var t,r,i;ze(e),T.length===0&&((t=n.domElement)==null||t.releasePointerCapture(e.pointerId),(r=n.domElement)==null||r.ownerDocument.removeEventListener(`pointermove`,Oe),(i=n.domElement)==null||i.ownerDocument.removeEventListener(`pointerup`,ke)),n.dispatchEvent(a),s=o.NONE}function Ae(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case dr.DOLLY:if(n.enableZoom===!1)return;le(e),s=o.DOLLY;break;case dr.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(n.enablePan===!1)return;ue(e),s=o.PAN}else{if(n.enableRotate===!1)return;ce(e),s=o.ROTATE}break;case dr.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(n.enableRotate===!1)return;ce(e),s=o.ROTATE}else{if(n.enablePan===!1)return;ue(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(i)}function je(e){if(n.enabled!==!1)switch(s){case o.ROTATE:if(n.enableRotate===!1)return;de(e);break;case o.DOLLY:if(n.enableZoom===!1)return;fe(e);break;case o.PAN:if(n.enablePan===!1)return;pe(e);break}}function Me(e){n.enabled===!1||n.enableZoom===!1||s!==o.NONE&&s!==o.ROTATE||(e.preventDefault(),n.dispatchEvent(i),me(e),n.dispatchEvent(a))}function Ne(e){n.enabled===!1||n.enablePan===!1||he(e)}function Pe(e){switch(Be(e),T.length){case 1:switch(n.touches.ONE){case Ur.ROTATE:if(n.enableRotate===!1)return;ge(),s=o.TOUCH_ROTATE;break;case Ur.PAN:if(n.enablePan===!1)return;_e(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(n.touches.TWO){case Ur.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;ye(),s=o.TOUCH_DOLLY_PAN;break;case Ur.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;be(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(i)}function Ie(e){switch(Be(e),s){case o.TOUCH_ROTATE:if(n.enableRotate===!1)return;xe(e),n.update();break;case o.TOUCH_PAN:if(n.enablePan===!1)return;Se(e),n.update();break;case o.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;we(e),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Te(e),n.update();break;default:s=o.NONE}}function Le(e){n.enabled!==!1&&e.preventDefault()}function Re(e){T.push(e)}function ze(e){delete E[e.pointerId];for(let t=0;t<T.length;t++)if(T[t].pointerId==e.pointerId){T.splice(t,1);return}}function Be(e){let t=E[e.pointerId];t===void 0&&(t=new Fe,E[e.pointerId]=t),t.set(e.pageX,e.pageY)}function Ve(e){return E[(e.pointerId===T[0].pointerId?T[1]:T[0]).pointerId]}this.dollyIn=(e=O())=>{ae(e),n.update()},this.dollyOut=(e=O())=>{ie(e),n.update()},this.getScale=()=>d,this.setScale=e=>{re(e),n.update()},this.getZoomScale=()=>O(),t!==void 0&&this.connect(t),this.update()}},ki=t(Nt()),Ai=ki.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:r,enableDamping:i=!0,keyEvents:a=!1,onChange:o,onStart:s,onEnd:c,...l},u)=>{let d=Rn(e=>e.invalidate),f=Rn(e=>e.camera),p=Rn(e=>e.gl),m=Rn(e=>e.events),h=Rn(e=>e.setEvents),g=Rn(e=>e.set),_=Rn(e=>e.get),v=Rn(e=>e.performance),y=t||f,b=r||m.connected||p.domElement,x=ki.useMemo(()=>new Oi(y),[y]);return Or(()=>{x.enabled&&x.update()},-1),ki.useEffect(()=>(a&&x.connect(a===!0?b:a),x.connect(b),()=>void x.dispose()),[a,b,n,x,d]),ki.useEffect(()=>{let e=e=>{d(),n&&v.regress(),o&&o(e)},t=e=>{s&&s(e)},r=e=>{c&&c(e)};return x.addEventListener(`change`,e),x.addEventListener(`start`,t),x.addEventListener(`end`,r),()=>{x.removeEventListener(`start`,t),x.removeEventListener(`end`,r),x.removeEventListener(`change`,e)}},[o,s,c,x,d,h]),ki.useEffect(()=>{if(e){let e=_().controls;return g({controls:x}),()=>g({controls:e})}},[e,x]),ki.createElement(`primitive`,gi({ref:u,object:x,enableDamping:i},l))});function ji(e){var t=typeof e;return e!=null&&(t==`object`||t==`function`)}var Mi=ji,Ni=typeof global==`object`&&global&&global.Object===Object&&global,Pi=typeof self==`object`&&self&&self.Object===Object&&self,Fi=Ni||Pi||Function(`return this`)(),Ii=function(){return Fi.Date.now()},Li=/\s/;function Ri(e){for(var t=e.length;t--&&Li.test(e.charAt(t)););return t}var zi=Ri,Bi=/^\s+/;function Vi(e){return e&&e.slice(0,zi(e)+1).replace(Bi,``)}var Hi=Vi,Ui=Fi.Symbol,Wi=Object.prototype,Gi=Wi.hasOwnProperty,Ki=Wi.toString,qi=Ui?Ui.toStringTag:void 0;function Ji(e){var t=Gi.call(e,qi),n=e[qi];try{e[qi]=void 0;var r=!0}catch{}var i=Ki.call(e);return r&&(t?e[qi]=n:delete e[qi]),i}var Yi=Ji,Xi=Object.prototype.toString;function Zi(e){return Xi.call(e)}var Qi=Zi,$i=`[object Null]`,ea=`[object Undefined]`,ta=Ui?Ui.toStringTag:void 0;function na(e){return e==null?e===void 0?ea:$i:ta&&ta in Object(e)?Yi(e):Qi(e)}var ra=na;function ia(e){return typeof e==`object`&&!!e}var aa=ia,oa=`[object Symbol]`;function sa(e){return typeof e==`symbol`||aa(e)&&ra(e)==oa}var ca=sa,la=NaN,ua=/^[-+]0x[0-9a-f]+$/i,da=/^0b[01]+$/i,fa=/^0o[0-7]+$/i,pa=parseInt;function ma(e){if(typeof e==`number`)return e;if(ca(e))return la;if(Mi(e)){var t=typeof e.valueOf==`function`?e.valueOf():e;e=Mi(t)?t+``:t}if(typeof e!=`string`)return e===0?e:+e;e=Hi(e);var n=da.test(e);return n||fa.test(e)?pa(e.slice(2),n?2:8):ua.test(e)?la:+e}var ha=ma,ga=`Expected a function`,_a=Math.max,va=Math.min;function ya(e,t,n){var r,i,a,o,s,c,l=0,u=!1,d=!1,f=!0;if(typeof e!=`function`)throw TypeError(ga);t=ha(t)||0,Mi(n)&&(u=!!n.leading,d=`maxWait`in n,a=d?_a(ha(n.maxWait)||0,t):a,f=`trailing`in n?!!n.trailing:f);function p(t){var n=r,a=i;return r=i=void 0,l=t,o=e.apply(a,n),o}function m(e){return l=e,s=setTimeout(_,t),u?p(e):o}function h(e){var n=e-c,r=e-l,i=t-n;return d?va(i,a-r):i}function g(e){var n=e-c,r=e-l;return c===void 0||n>=t||n<0||d&&r>=a}function _(){var e=Ii();if(g(e))return v(e);s=setTimeout(_,h(e))}function v(e){return s=void 0,f&&r?p(e):(r=i=void 0,o)}function y(){s!==void 0&&clearTimeout(s),l=0,r=c=i=s=void 0}function b(){return s===void 0?o:v(Ii())}function x(){var e=Ii(),n=g(e);if(r=arguments,i=this,c=e,n){if(s===void 0)return m(c);if(d)return clearTimeout(s),s=setTimeout(_,t),p(c)}return s===void 0&&(s=setTimeout(_,t)),o}return x.cancel=y,x.flush=b,x}var ba=ya;function xa(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Sa(e){if(Array.isArray(e))return e}function Ca(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function wa(e,t,n){return Object.defineProperty(e,`prototype`,{writable:!1}),e}function Ta(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t!==0)for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function Ea(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Da(e,t){return Sa(e)||Ta(e,t)||Oa(e,t)||Ea()}function Oa(e,t){if(e){if(typeof e==`string`)return xa(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xa(e,t):void 0}}var ka=wa(function e(t,n){var r=n.default,i=r===void 0?null:r,a=n.triggerUpdate,o=a===void 0?!0:a,s=n.onChange,c=s===void 0?function(e,t){}:s;Ca(this,e),this.name=t,this.defaultVal=i,this.triggerUpdate=o,this.onChange=c});function Aa(e){var t=e.stateInit,n=t===void 0?function(){return{}}:t,r=e.props,i=r===void 0?{}:r,a=e.methods,o=a===void 0?{}:a,s=e.aliases,c=s===void 0?{}:s,l=e.init,u=l===void 0?function(){}:l,d=e.update,f=d===void 0?function(){}:d,p=Object.keys(i).map(function(e){return new ka(e,i[e])});return function e(){var t=[...arguments],r=!!(this instanceof e&&this.constructor),i=r?t.shift():void 0,a=t[0],s=a===void 0?{}:a,l=Object.assign({},n instanceof Function?n(s):n,{initialised:!1}),d={};function m(e){return h(e,s),g(),m}var h=function(e,t){u.call(m,e,l,t),l.initialised=!0},g=ba(function(){l.initialised&&(f.call(m,l,d),d={})},1);return p.forEach(function(e){m[e.name]=t(e);function t(e){var t=e.name,n=e.triggerUpdate,r=n===void 0?!1:n,i=e.onChange,a=i===void 0?function(e,t){}:i,o=e.defaultVal,s=o===void 0?null:o;return function(e){var n=l[t];if(!arguments.length)return n;var i=e===void 0?s:e;return l[t]=i,a.call(m,i,l,n),!d.hasOwnProperty(t)&&(d[t]=n),r&&g(),m}}}),Object.keys(o).forEach(function(e){m[e]=function(){var t,n=[...arguments];return(t=o[e]).call.apply(t,[m,l].concat(n))}}),Object.entries(c).forEach(function(e){var t=Da(e,2),n=t[0];return m[n]=m[t[1]]}),m.resetProps=function(){return p.forEach(function(e){m[e.name](e.defaultVal)}),m},m.resetProps(),l._rerender=g,r&&i&&m(i),m}}var ja=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return e===0?0:1024**(e-1)},Out:function(e){return e===1?1:1-2**(-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*1024**(e-1):.5*(-(2**(-10*(e-1)))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return e===0?0:e===1?1:-(2**(10*(e-1)))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:2**(-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*2**(10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*2**(-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(e){var t=1.70158;return e===1?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return e===0?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=1.70158*1.525;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-ja.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?ja.Bounce.In(e*2)*.5:ja.Bounce.Out(e*2-1)*.5+.5}}),generatePow:function(e){return e===void 0&&(e=4),e=e<2**-52?2**-52:e,e=e>1e4?1e4:e,{In:function(t){return t**+e},Out:function(t){return 1-(1-t)**e},InOut:function(t){return t<.5?(t*2)**e/2:(1-(2-t*2)**e)/2+.5}}}}),Ma=function(){return performance.now()},Na=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){e===void 0&&(e=Ma()),t===void 0&&(t=!1);var n=Object.keys(this._tweens);if(n.length===0)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]],a=!t;i&&i.update(e,a)===!1&&!t&&delete this._tweens[n[r]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),Pa={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=Pa.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){for(var n=0,r=e.length-1,i=Math.pow,a=Pa.Utils.Bernstein,o=0;o<=r;o++)n+=i(1-t,r-o)*i(t,o)*e[o]*a(r,o);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=Pa.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),a(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=Pa.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var r=t;r>1;r--)n*=r;return e[t]=n,n}})(),CatmullRom:function(e,t,n,r,i){var a=(n-e)*.5,o=(r-t)*.5,s=i*i,c=i*s;return(2*t-2*n+a+o)*c+(-3*t+3*n-2*a-o)*s+a*i+t}}},Fa=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),Ia=new Na,La=function(){function e(e,t){t===void 0&&(t=Ia),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=ja.Linear.None,this._interpolationFunction=Pa.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Fa.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw Error(`Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.`);return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},e.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},e.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},e.prototype.start=function(e,t){if(e===void 0&&(e=Ma()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var n in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var i in this._valuesEnd)r[i]=this._valuesEnd[i];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},e.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},e.prototype._setupProperties=function(e,t,n,r,i){for(var a in n){var o=e[a],s=Array.isArray(o),c=s?`array`:typeof o,l=!s&&Array.isArray(n[a]);if(!(c===`undefined`||c===`function`)){if(l){var u=n[a];if(u.length===0)continue;for(var d=[o],f=0,p=u.length;f<p;f+=1){var m=this._handleRelativeValue(o,u[f]);if(isNaN(m)){l=!1,console.warn(`Found invalid interpolation list. Skipping.`);break}d.push(m)}l&&(n[a]=d)}if((c===`object`||s)&&o&&!l){t[a]=s?[]:{};var h=o;for(var g in h)t[a][g]=h[g];r[a]=s?[]:{};var u=n[a];if(!this._isDynamic){var _={};for(var g in u)_[g]=u[g];n[a]=u=_}this._setupProperties(h,t[a],u,r[a],i)}else (t[a]===void 0||i)&&(t[a]=o),s||(t[a]*=1),l?r[a]=n[a].slice().reverse():r[a]=t[a]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return e===void 0&&(e=Ma()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},e.prototype.resume=function(e){return e===void 0&&(e=Ma()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return e===void 0&&(e=Ia),this._group=e,this},e.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},e.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},e.prototype.easing=function(e){return e===void 0&&(e=ja.Linear.None),this._easingFunction=e,this},e.prototype.interpolation=function(e){return e===void 0&&(e=Pa.Linear),this._interpolationFunction=e,this},e.prototype.chain=function(){return this._chainedTweens=[...arguments],this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){var n=this;if(e===void 0&&(e=Ma()),t===void 0&&(t=!0),this._isPaused)return!0;var r,i=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>i)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,o=this._duration+(this._repeatDelayTime??this._delayTime),s=this._duration+this._repeat*o,c=function(){if(n._duration===0||a>s)return 1;var e=a-Math.trunc(a/o)*o,t=Math.min(e/n._duration,1);return t===0&&a===n._duration?1:t}(),l=this._easingFunction(c);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,l),this._onUpdateCallback&&this._onUpdateCallback(this._object,c),this._duration===0||a>=this._duration)if(this._repeat>0){var u=Math.min(Math.trunc((a-this._duration)/o)+1,this._repeat);for(r in isFinite(this._repeat)&&(this._repeat-=u),this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[r]==`string`&&(this._valuesStartRepeat[r]=this._valuesStartRepeat[r]+parseFloat(this._valuesEnd[r])),this._yoyo&&this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=o*u,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var d=0,f=this._chainedTweens.length;d<f;d++)this._chainedTweens[d].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,n,r){for(var i in n)if(t[i]!==void 0){var a=t[i]||0,o=n[i];!Array.isArray(e[i])&&Array.isArray(o)?e[i]=this._interpolationFunction(o,r):typeof o==`object`&&o?this._updateProperties(e[i],a,o,r):(o=this._handleRelativeValue(a,o),typeof o==`number`&&(e[i]=a+(o-a)*r))}},e.prototype._handleRelativeValue=function(e,t){return typeof t==`string`?t.charAt(0)===`+`||t.charAt(0)===`-`?e+parseFloat(t):parseFloat(t):t},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];typeof n==`string`?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},e}();Fa.nextId;var Ra=Ia;Ra.getAll.bind(Ra),Ra.removeAll.bind(Ra),Ra.add.bind(Ra),Ra.remove.bind(Ra),Ra.update.bind(Ra);function za(e){let t=+this._x.call(null,e),n=+this._y.call(null,e),r=+this._z.call(null,e);return Ba(this.cover(t,n,r),t,n,r,e)}function Ba(e,t,n,r,i){if(isNaN(t)||isNaN(n)||isNaN(r))return e;var a,o=e._root,s={data:i},c=e._x0,l=e._y0,u=e._z0,d=e._x1,f=e._y1,p=e._z1,m,h,g,_,v,y,b,x,S,C,w;if(!o)return e._root=s,e;for(;o.length;)if((b=t>=(m=(c+d)/2))?c=m:d=m,(x=n>=(h=(l+f)/2))?l=h:f=h,(S=r>=(g=(u+p)/2))?u=g:p=g,a=o,!(o=o[C=S<<2|x<<1|b]))return a[C]=s,e;if(_=+e._x.call(null,o.data),v=+e._y.call(null,o.data),y=+e._z.call(null,o.data),t===_&&n===v&&r===y)return s.next=o,a?a[C]=s:e._root=s,e;do a=a?a[C]=Array(8):e._root=Array(8),(b=t>=(m=(c+d)/2))?c=m:d=m,(x=n>=(h=(l+f)/2))?l=h:f=h,(S=r>=(g=(u+p)/2))?u=g:p=g;while((C=S<<2|x<<1|b)==(w=(y>=g)<<2|(v>=h)<<1|_>=m));return a[w]=o,a[C]=s,e}function Va(e){Array.isArray(e)||(e=Array.from(e));let t=e.length,n=new Float64Array(t),r=new Float64Array(t),i=new Float64Array(t),a=1/0,o=1/0,s=1/0,c=-1/0,l=-1/0,u=-1/0;for(let d=0,f,p,m,h;d<t;++d)isNaN(p=+this._x.call(null,f=e[d]))||isNaN(m=+this._y.call(null,f))||isNaN(h=+this._z.call(null,f))||(n[d]=p,r[d]=m,i[d]=h,p<a&&(a=p),p>c&&(c=p),m<o&&(o=m),m>l&&(l=m),h<s&&(s=h),h>u&&(u=h));if(a>c||o>l||s>u)return this;this.cover(a,o,s).cover(c,l,u);for(let a=0;a<t;++a)Ba(this,n[a],r[a],i[a],e[a]);return this}function Ha(e,t,n){if(isNaN(e=+e)||isNaN(t=+t)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,a=this._z0,o=this._x1,s=this._y1,c=this._z1;if(isNaN(r))o=(r=Math.floor(e))+1,s=(i=Math.floor(t))+1,c=(a=Math.floor(n))+1;else{for(var l=o-r||1,u=this._root,d,f;r>e||e>=o||i>t||t>=s||a>n||n>=c;)switch(f=(n<a)<<2|(t<i)<<1|e<r,d=Array(8),d[f]=u,u=d,l*=2,f){case 0:o=r+l,s=i+l,c=a+l;break;case 1:r=o-l,s=i+l,c=a+l;break;case 2:o=r+l,i=s-l,c=a+l;break;case 3:r=o-l,i=s-l,c=a+l;break;case 4:o=r+l,s=i+l,a=c-l;break;case 5:r=o-l,s=i+l,a=c-l;break;case 6:o=r+l,i=s-l,a=c-l;break;case 7:r=o-l,i=s-l,a=c-l;break}this._root&&this._root.length&&(this._root=u)}return this._x0=r,this._y0=i,this._z0=a,this._x1=o,this._y1=s,this._z1=c,this}function Ua(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function Wa(e){return arguments.length?this.cover(+e[0][0],+e[0][1],+e[0][2]).cover(+e[1][0],+e[1][1],+e[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function Ga(e,t,n,r,i,a,o){this.node=e,this.x0=t,this.y0=n,this.z0=r,this.x1=i,this.y1=a,this.z1=o}function Ka(e,t,n,r){var i,a=this._x0,o=this._y0,s=this._z0,c,l,u,d,f,p,m=this._x1,h=this._y1,g=this._z1,_=[],v=this._root,y,b;for(v&&_.push(new Ga(v,a,o,s,m,h,g)),r==null?r=1/0:(a=e-r,o=t-r,s=n-r,m=e+r,h=t+r,g=n+r,r*=r);y=_.pop();)if(!(!(v=y.node)||(c=y.x0)>m||(l=y.y0)>h||(u=y.z0)>g||(d=y.x1)<a||(f=y.y1)<o||(p=y.z1)<s))if(v.length){var x=(c+d)/2,S=(l+f)/2,C=(u+p)/2;_.push(new Ga(v[7],x,S,C,d,f,p),new Ga(v[6],c,S,C,x,f,p),new Ga(v[5],x,l,C,d,S,p),new Ga(v[4],c,l,C,x,S,p),new Ga(v[3],x,S,u,d,f,C),new Ga(v[2],c,S,u,x,f,C),new Ga(v[1],x,l,u,d,S,C),new Ga(v[0],c,l,u,x,S,C)),(b=(n>=C)<<2|(t>=S)<<1|e>=x)&&(y=_[_.length-1],_[_.length-1]=_[_.length-1-b],_[_.length-1-b]=y)}else{var w=e-+this._x.call(null,v.data),T=t-+this._y.call(null,v.data),E=n-+this._z.call(null,v.data),D=w*w+T*T+E*E;if(D<r){var O=Math.sqrt(r=D);a=e-O,o=t-O,s=n-O,m=e+O,h=t+O,g=n+O,i=v.data}}return i}var qa=(e,t,n,r,i,a)=>Math.sqrt((e-r)**2+(t-i)**2+(n-a)**2);function Ja(e,t,n,r){let i=[],a=e-r,o=t-r,s=n-r,c=e+r,l=t+r,u=n+r;return this.visit((d,f,p,m,h,g,_)=>{if(!d.length)do{let a=d.data;qa(e,t,n,this._x(a),this._y(a),this._z(a))<=r&&i.push(a)}while(d=d.next);return f>c||p>l||m>u||h<a||g<o||_<s}),i}function Ya(e){if(isNaN(f=+this._x.call(null,e))||isNaN(p=+this._y.call(null,e))||isNaN(m=+this._z.call(null,e)))return this;var t,n=this._root,r,i,a,o=this._x0,s=this._y0,c=this._z0,l=this._x1,u=this._y1,d=this._z1,f,p,m,h,g,_,v,y,b,x,S;if(!n)return this;if(n.length)for(;;){if((v=f>=(h=(o+l)/2))?o=h:l=h,(y=p>=(g=(s+u)/2))?s=g:u=g,(b=m>=(_=(c+d)/2))?c=_:d=_,t=n,!(n=n[x=b<<2|y<<1|v]))return this;if(!n.length)break;(t[x+1&7]||t[x+2&7]||t[x+3&7]||t[x+4&7]||t[x+5&7]||t[x+6&7]||t[x+7&7])&&(r=t,S=x)}for(;n.data!==e;)if(i=n,!(n=n.next))return this;return(a=n.next)&&delete n.next,i?(a?i.next=a:delete i.next,this):t?(a?t[x]=a:delete t[x],(n=t[0]||t[1]||t[2]||t[3]||t[4]||t[5]||t[6]||t[7])&&n===(t[7]||t[6]||t[5]||t[4]||t[3]||t[2]||t[1]||t[0])&&!n.length&&(r?r[S]=n:this._root=n),this):(this._root=a,this)}function Xa(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function Za(){return this._root}function Qa(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function $a(e){var t=[],n,r=this._root,i,a,o,s,c,l,u;for(r&&t.push(new Ga(r,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=t.pop();)if(!e(r=n.node,a=n.x0,o=n.y0,s=n.z0,c=n.x1,l=n.y1,u=n.z1)&&r.length){var d=(a+c)/2,f=(o+l)/2,p=(s+u)/2;(i=r[7])&&t.push(new Ga(i,d,f,p,c,l,u)),(i=r[6])&&t.push(new Ga(i,a,f,p,d,l,u)),(i=r[5])&&t.push(new Ga(i,d,o,p,c,f,u)),(i=r[4])&&t.push(new Ga(i,a,o,p,d,f,u)),(i=r[3])&&t.push(new Ga(i,d,f,s,c,l,p)),(i=r[2])&&t.push(new Ga(i,a,f,s,d,l,p)),(i=r[1])&&t.push(new Ga(i,d,o,s,c,f,p)),(i=r[0])&&t.push(new Ga(i,a,o,s,d,f,p))}return this}function eo(e){var t=[],n=[],r;for(this._root&&t.push(new Ga(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));r=t.pop();){var i=r.node;if(i.length){var a,o=r.x0,s=r.y0,c=r.z0,l=r.x1,u=r.y1,d=r.z1,f=(o+l)/2,p=(s+u)/2,m=(c+d)/2;(a=i[0])&&t.push(new Ga(a,o,s,c,f,p,m)),(a=i[1])&&t.push(new Ga(a,f,s,c,l,p,m)),(a=i[2])&&t.push(new Ga(a,o,p,c,f,u,m)),(a=i[3])&&t.push(new Ga(a,f,p,c,l,u,m)),(a=i[4])&&t.push(new Ga(a,o,s,m,f,p,d)),(a=i[5])&&t.push(new Ga(a,f,s,m,l,p,d)),(a=i[6])&&t.push(new Ga(a,o,p,m,f,u,d)),(a=i[7])&&t.push(new Ga(a,f,p,m,l,u,d))}n.push(r)}for(;r=n.pop();)e(r.node,r.x0,r.y0,r.z0,r.x1,r.y1,r.z1);return this}function to(e){return e[0]}function no(e){return arguments.length?(this._x=e,this):this._x}function ro(e){return e[1]}function io(e){return arguments.length?(this._y=e,this):this._y}function ao(e){return e[2]}function oo(e){return arguments.length?(this._z=e,this):this._z}function so(e,t,n,r){var i=new co(t??to,n??ro,r??ao,NaN,NaN,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function co(e,t,n,r,i,a,o,s,c){this._x=e,this._y=t,this._z=n,this._x0=r,this._y0=i,this._z0=a,this._x1=o,this._y1=s,this._z1=c,this._root=void 0}function lo(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var uo=so.prototype=co.prototype;uo.copy=function(){var e=new co(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),t=this._root,n,r;if(!t)return e;if(!t.length)return e._root=lo(t),e;for(n=[{source:t,target:e._root=Array(8)}];t=n.pop();)for(var i=0;i<8;++i)(r=t.source[i])&&(r.length?n.push({source:r,target:t.target[i]=Array(8)}):t.target[i]=lo(r));return e},uo.add=za,uo.addAll=Va,uo.cover=Ha,uo.data=Ua,uo.extent=Wa,uo.find=Ka,uo.findAllWithinRadius=Ja,uo.remove=Ya,uo.removeAll=Xa,uo.root=Za,uo.size=Qa,uo.visit=$a,uo.visitAfter=eo,uo.x=no,uo.y=io,uo.z=oo;function fo(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function po(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function mo(e){let t,n,r;e.length===2?(t=e===fo||e===po?e:ho,n=e,r=e):(t=fo,n=(t,n)=>fo(e(t),n),r=(t,n)=>e(t)-n);function i(e,r,i=0,a=e.length){if(i<a){if(t(r,r)!==0)return a;do{let t=i+a>>>1;n(e[t],r)<0?i=t+1:a=t}while(i<a)}return i}function a(e,r,i=0,a=e.length){if(i<a){if(t(r,r)!==0)return a;do{let t=i+a>>>1;n(e[t],r)<=0?i=t+1:a=t}while(i<a)}return i}function o(e,t,n=0,a=e.length){let o=i(e,t,n,a-1);return o>n&&r(e[o-1],t)>-r(e[o],t)?o-1:o}return{left:i,center:o,right:a}}function ho(){return 0}function go(e){return e===null?NaN:+e}var _o=mo(fo);const vo=_o.right;_o.left,mo(go).center;var yo=vo;function bo(e,t){let n,r;if(t===void 0)for(let t of e)t!=null&&(n===void 0?t>=t&&(n=r=t):(n>t&&(n=t),r<t&&(r=t)));else{let i=-1;for(let a of e)(a=t(a,++i,e))!=null&&(n===void 0?a>=a&&(n=r=a):(n>a&&(n=a),r<a&&(r=a)))}return[n,r]}var xo=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){let t=this._partials,n=0;for(let r=0;r<this._n&&r<32;r++){let i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){let e=this._partials,t=this._n,n,r,i,a=0;if(t>0){for(a=e[--t];t>0&&(n=a,r=e[--t],a=n+r,i=r-(a-n),!i););t>0&&(i<0&&e[t-1]<0||i>0&&e[t-1]>0)&&(r=i*2,n=a+r,r==n-a&&(a=n))}return a}},So=Math.sqrt(50),Co=Math.sqrt(10),wo=Math.sqrt(2);function To(e,t,n){let r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/10**i,o=a>=So?10:a>=Co?5:a>=wo?2:1,s,c,l;return i<0?(l=10**-i/o,s=Math.round(e*l),c=Math.round(t*l),s/l<e&&++s,c/l>t&&--c,l=-l):(l=10**i*o,s=Math.round(e/l),c=Math.round(t/l),s*l<e&&++s,c*l>t&&--c),c<s&&.5<=n&&n<2?To(e,t,n*2):[s,c,l]}function Eo(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];let r=t<e,[i,a,o]=r?To(t,e,n):To(e,t,n);if(!(a>=i))return[];let s=a-i+1,c=Array(s);if(r)if(o<0)for(let e=0;e<s;++e)c[e]=(a-e)/-o;else for(let e=0;e<s;++e)c[e]=(a-e)*o;else if(o<0)for(let e=0;e<s;++e)c[e]=(i+e)/-o;else for(let e=0;e<s;++e)c[e]=(i+e)*o;return c}function Do(e,t,n){return t=+t,e=+e,n=+n,To(e,t,n)[2]}function Oo(e,t,n){t=+t,e=+e,n=+n;let r=t<e,i=r?Do(t,e,n):Do(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function ko(e,t){let n;if(t===void 0)for(let t of e)t!=null&&(n<t||n===void 0&&t>=t)&&(n=t);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function Ao(e,t){let n=0,r=0;if(t===void 0)for(let t of e)t!=null&&(t=+t)>=t&&(++n,r+=t);else{let i=-1;for(let a of e)(a=t(a,++i,e))!=null&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n}function*jo(e){for(let t of e)yield*t}function Mo(e){return Array.from(jo(e))}function No(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,a=Array(i);++r<i;)a[r]=e+r*n;return a}function Po(e,t){let n=0;if(t===void 0)for(let t of e)(t=+t)&&(n+=t);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function Fo(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Io(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Lo(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ro(){}var zo=.7,Bo=1/zo,Vo=`\\s*([+-]?\\d+)\\s*`,Ho=`\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*`,Uo=`\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*`,Wo=/^#([0-9a-f]{3,8})$/,Go=RegExp(`^rgb\\(${Vo},${Vo},${Vo}\\)$`),Ko=RegExp(`^rgb\\(${Uo},${Uo},${Uo}\\)$`),qo=RegExp(`^rgba\\(${Vo},${Vo},${Vo},${Ho}\\)$`),Jo=RegExp(`^rgba\\(${Uo},${Uo},${Uo},${Ho}\\)$`),Yo=RegExp(`^hsl\\(${Ho},${Uo},${Uo}\\)$`),Xo=RegExp(`^hsla\\(${Ho},${Uo},${Uo},${Ho}\\)$`),Zo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Io(Ro,ns,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Qo,formatHex:Qo,formatHex8:$o,formatHsl:es,formatRgb:ts,toString:ts});function Qo(){return this.rgb().formatHex()}function $o(){return this.rgb().formatHex8()}function es(){return hs(this).formatHsl()}function ts(){return this.rgb().formatRgb()}function ns(e){var t,n;return e=(e+``).trim().toLowerCase(),(t=Wo.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?rs(t):n===3?new ss(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?is(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?is(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Go.exec(e))?new ss(t[1],t[2],t[3],1):(t=Ko.exec(e))?new ss(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=qo.exec(e))?is(t[1],t[2],t[3],t[4]):(t=Jo.exec(e))?is(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Yo.exec(e))?ms(t[1],t[2]/100,t[3]/100,1):(t=Xo.exec(e))?ms(t[1],t[2]/100,t[3]/100,t[4]):Zo.hasOwnProperty(e)?rs(Zo[e]):e===`transparent`?new ss(NaN,NaN,NaN,0):null}function rs(e){return new ss(e>>16&255,e>>8&255,e&255,1)}function is(e,t,n,r){return r<=0&&(e=t=n=NaN),new ss(e,t,n,r)}function as(e){return e instanceof Ro||(e=ns(e)),e?(e=e.rgb(),new ss(e.r,e.g,e.b,e.opacity)):new ss}function os(e,t,n,r){return arguments.length===1?as(e):new ss(e,t,n,r??1)}function ss(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}Io(ss,os,Lo(Ro,{brighter(e){return e=e==null?Bo:Bo**+e,new ss(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?zo:zo**+e,new ss(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ss(fs(this.r),fs(this.g),fs(this.b),ds(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:cs,formatHex:cs,formatHex8:ls,formatRgb:us,toString:us}));function cs(){return`#${ps(this.r)}${ps(this.g)}${ps(this.b)}`}function ls(){return`#${ps(this.r)}${ps(this.g)}${ps(this.b)}${ps((isNaN(this.opacity)?1:this.opacity)*255)}`}function us(){let e=ds(this.opacity);return`${e===1?`rgb(`:`rgba(`}${fs(this.r)}, ${fs(this.g)}, ${fs(this.b)}${e===1?`)`:`, ${e})`}`}function ds(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function fs(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ps(e){return e=fs(e),(e<16?`0`:``)+e.toString(16)}function ms(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new _s(e,t,n,r)}function hs(e){if(e instanceof _s)return new _s(e.h,e.s,e.l,e.opacity);if(e instanceof Ro||(e=ns(e)),!e)return new _s;if(e instanceof _s)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,c=(a+i)/2;return s?(o=t===a?(n-r)/s+(n<r)*6:n===a?(r-t)/s+2:(t-n)/s+4,s/=c<.5?a+i:2-a-i,o*=60):s=c>0&&c<1?0:o,new _s(o,s,c,e.opacity)}function gs(e,t,n,r){return arguments.length===1?hs(e):new _s(e,t,n,r??1)}function _s(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Io(_s,gs,Lo(Ro,{brighter(e){return e=e==null?Bo:Bo**+e,new _s(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?zo:zo**+e,new _s(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new ss(bs(e>=240?e-240:e+120,i,r),bs(e,i,r),bs(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new _s(vs(this.h),ys(this.s),ys(this.l),ds(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=ds(this.opacity);return`${e===1?`hsl(`:`hsla(`}${vs(this.h)}, ${ys(this.s)*100}%, ${ys(this.l)*100}%${e===1?`)`:`, ${e})`}`}}));function vs(e){return e=(e||0)%360,e<0?e+360:e}function ys(e){return Math.max(0,Math.min(1,e||0))}function bs(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var xs=e=>()=>e;function Ss(e,t){return function(n){return e+n*t}}function Cs(e,t,n){return e**=+n,t=t**+n-e,n=1/n,function(r){return(e+r*t)**+n}}function ws(e){return(e=+e)==1?Ts:function(t,n){return n-t?Cs(t,n,e):xs(isNaN(t)?n:t)}}function Ts(e,t){var n=t-e;return n?Ss(e,n):xs(isNaN(e)?t:e)}var Es=(function e(t){var n=ws(t);function r(e,t){var r=n((e=os(e)).r,(t=os(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=Ts(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+``}}return r.gamma=e,r})(1);function Ds(e,t){t||=[];var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=e[i]*(1-a)+t[i]*a;return r}}function Os(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ks(e,t){return(Os(t)?Ds:As)(e,t)}function As(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=Array(r),a=Array(n),o;for(o=0;o<r;++o)i[o]=zs(e[o],t[o]);for(;o<n;++o)a[o]=t[o];return function(e){for(o=0;o<r;++o)a[o]=i[o](e);return a}}function js(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Ms(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Ns(e,t){var n={},r={},i;for(i in(typeof e!=`object`||!e)&&(e={}),(typeof t!=`object`||!t)&&(t={}),t)i in e?n[i]=zs(e[i],t[i]):r[i]=t[i];return function(e){for(i in n)r[i]=n[i](e);return r}}var Ps=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Fs=new RegExp(Ps.source,`g`);function Is(e){return function(){return e}}function Ls(e){return function(t){return e(t)+``}}function Rs(e,t){var n=Ps.lastIndex=Fs.lastIndex=0,r,i,a,o=-1,s=[],c=[];for(e+=``,t+=``;(r=Ps.exec(e))&&(i=Fs.exec(t));)(a=i.index)>n&&(a=t.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,c.push({i:o,x:Ms(r,i)})),n=Fs.lastIndex;return n<t.length&&(a=t.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?c[0]?Ls(c[0].x):Is(t):(t=c.length,function(e){for(var n=0,r;n<t;++n)s[(r=c[n]).i]=r.x(e);return s.join(``)})}function zs(e,t){var n=typeof t,r;return t==null||n===`boolean`?xs(t):(n===`number`?Ms:n===`string`?(r=ns(t))?(t=r,Es):Rs:t instanceof ns?Es:t instanceof Date?js:Os(t)?Ds:Array.isArray(t)?As:typeof t.valueOf!=`function`&&typeof t.toString!=`function`||isNaN(t)?Ns:Ms)(e,t)}function Bs(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Vs(e){return function(){return e}}function Hs(e){return+e}var Us=[0,1];function Ws(e){return e}function Gs(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Vs(isNaN(t)?NaN:.5)}function Ks(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}function qs(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=Gs(i,r),a=n(o,a)):(r=Gs(r,i),a=n(a,o)),function(e){return a(r(e))}}function Js(e,t,n){var r=Math.min(e.length,t.length)-1,i=Array(r),a=Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=Gs(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=yo(e,t,1,r)-1;return a[n](i[n](t))}}function Ys(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Xs(){var e=Us,t=Us,n=zs,r,i,a,o=Ws,s,c,l;function u(){var n=Math.min(e.length,t.length);return o!==Ws&&(o=Ks(e[0],e[n-1])),s=n>2?Js:qs,c=l=null,d}function d(i){return i==null||isNaN(i=+i)?a:(c||=s(e.map(r),t,n))(r(o(i)))}return d.invert=function(n){return o(i((l||=s(t,e.map(r),Ms))(n)))},d.domain=function(t){return arguments.length?(e=Array.from(t,Hs),u()):e.slice()},d.range=function(e){return arguments.length?(t=Array.from(e),u()):t.slice()},d.rangeRound=function(e){return t=Array.from(e),n=Bs,u()},d.clamp=function(e){return arguments.length?(o=e?!0:Ws,u()):o!==Ws},d.interpolate=function(e){return arguments.length?(n=e,u()):n},d.unknown=function(e){return arguments.length?(a=e,d):a},function(e,t){return r=e,i=t,u()}}function Zs(){return Xs()(Ws,Ws)}function Qs(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString(`en`).replace(/,/g,``):e.toString(10)}function $s(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf(`e`))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function ec(e){return e=$s(Math.abs(e)),e?e[1]:NaN}function tc(e,t){return function(n,r){for(var i=n.length,a=[],o=0,s=e[0],c=0;i>0&&s>0&&(c+s+1>r&&(s=Math.max(1,r-c)),a.push(n.substring(i-=s,i+s)),!((c+=s+1)>r));)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function nc(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}var rc=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ic(e){if(!(t=rc.exec(e)))throw Error(`invalid format: `+e);var t;return new ac({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}ic.prototype=ac.prototype;function ac(e){this.fill=e.fill===void 0?` `:e.fill+``,this.align=e.align===void 0?`>`:e.align+``,this.sign=e.sign===void 0?`-`:e.sign+``,this.symbol=e.symbol===void 0?``:e.symbol+``,this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?``:e.type+``}ac.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?`0`:``)+(this.width===void 0?``:Math.max(1,this.width|0))+(this.comma?`,`:``)+(this.precision===void 0?``:`.`+Math.max(0,this.precision|0))+(this.trim?`~`:``)+this.type};function oc(e){out:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case`.`:r=i=n;break;case`0`:r===0&&(r=n),i=n;break;default:if(!+e[n])break out;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var sc;function cc(e,t){var n=$s(e,t);if(!n)return e+``;var r=n[0],i=n[1],a=i-(sc=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+Array(a-o+1).join(`0`):a>0?r.slice(0,a)+`.`+r.slice(a):`0.`+Array(1-a).join(`0`)+$s(e,Math.max(0,t+a-1))[0]}function lc(e,t){var n=$s(e,t);if(!n)return e+``;var r=n[0],i=n[1];return i<0?`0.`+Array(-i).join(`0`)+r:r.length>i+1?r.slice(0,i+1)+`.`+r.slice(i+1):r+Array(i-r.length+2).join(`0`)}var uc={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+``,d:Qs,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>lc(e*100,t),r:lc,s:cc,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function dc(e){return e}var fc=Array.prototype.map,pc=[`y`,`z`,`a`,`f`,`p`,`n`,``,`m`,``,`k`,`M`,`G`,`T`,`P`,`E`,`Z`,`Y`];function mc(e){var t=e.grouping===void 0||e.thousands===void 0?dc:tc(fc.call(e.grouping,Number),e.thousands+``),n=e.currency===void 0?``:e.currency[0]+``,r=e.currency===void 0?``:e.currency[1]+``,i=e.decimal===void 0?`.`:e.decimal+``,a=e.numerals===void 0?dc:nc(fc.call(e.numerals,String)),o=e.percent===void 0?`%`:e.percent+``,s=e.minus===void 0?``:e.minus+``,c=e.nan===void 0?`NaN`:e.nan+``;function l(e){e=ic(e);var l=e.fill,u=e.align,d=e.sign,f=e.symbol,p=e.zero,m=e.width,h=e.comma,g=e.precision,_=e.trim,v=e.type;v===`n`?(h=!0,v=`g`):uc[v]||(g===void 0&&(g=12),_=!0,v=`g`),(p||l===`0`&&u===`=`)&&(p=!0,l=`0`,u=`=`);var y=f===`$`?n:f===`#`&&/[boxX]/.test(v)?`0`+v.toLowerCase():``,b=f===`$`?r:/[%p]/.test(v)?o:``,x=uc[v],S=/[defgprs%]/.test(v);g=g===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g));function C(e){var n=y,r=b,o,f,C;if(v===`c`)r=x(e)+r,e=``;else{e=+e;var w=e<0||1/e<0;if(e=isNaN(e)?c:x(Math.abs(e),g),_&&(e=oc(e)),w&&+e==0&&d!==`+`&&(w=!1),n=(w?d===`(`?d:s:d===`-`||d===`(`?``:d)+n,r=(v===`s`?pc[8+sc/3]:``)+r+(w&&d===`(`?`)`:``),S){for(o=-1,f=e.length;++o<f;)if(C=e.charCodeAt(o),48>C||C>57){r=(C===46?i+e.slice(o+1):e.slice(o))+r,e=e.slice(0,o);break}}}h&&!p&&(e=t(e,1/0));var T=n.length+e.length+r.length,E=T<m?Array(m-T+1).join(l):``;switch(h&&p&&(e=t(E+e,E.length?m-r.length:1/0),E=``),u){case`<`:e=n+e+r+E;break;case`=`:e=n+E+e+r;break;case`^`:e=E.slice(0,T=E.length>>1)+n+e+r+E.slice(T);break;default:e=E+n+e+r;break}return a(e)}return C.toString=function(){return e+``},C}function u(e,t){var n=l((e=ic(e),e.type=`f`,e)),r=Math.max(-8,Math.min(8,Math.floor(ec(t)/3)))*3,i=10**-r,a=pc[8+r/3];return function(e){return n(i*e)+a}}return{format:l,formatPrefix:u}}var hc,gc,_c;vc({thousands:`,`,grouping:[3],currency:[`$`,``]});function vc(e){return hc=mc(e),gc=hc.format,_c=hc.formatPrefix,hc}function yc(e){return Math.max(0,-ec(Math.abs(e)))}function bc(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ec(t)/3)))*3-ec(Math.abs(e)))}function xc(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,ec(t)-ec(e))+1}function Sc(e,t,n,r){var i=Oo(e,t,n),a;switch(r=ic(r??`,f`),r.type){case`s`:var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(a=bc(i,o))&&(r.precision=a),_c(r,o);case``:case`e`:case`g`:case`p`:case`r`:r.precision==null&&!isNaN(a=xc(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=a-(r.type===`e`));break;case`f`:case`%`:r.precision==null&&!isNaN(a=yc(i))&&(r.precision=a-(r.type===`%`)*2);break}return gc(r)}function Cc(e){var t=e.domain;return e.ticks=function(e){var n=t();return Eo(n[0],n[n.length-1],e??10)},e.tickFormat=function(e,n){var r=t();return Sc(r[0],r[r.length-1],e??10,n)},e.nice=function(n){n??=10;var r=t(),i=0,a=r.length-1,o=r[i],s=r[a],c,l,u=10;for(s<o&&(l=o,o=s,s=l,l=i,i=a,a=l);u-- >0;){if(l=Do(o,s,n),l===c)return r[i]=o,r[a]=s,t(r);if(l>0)o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l;else if(l<0)o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l;else break;c=l}return e},e}function wc(){var e=Zs();return e.copy=function(){return Ys(e,wc())},Fo.apply(e,arguments),Cc(e)}function Tc(){var e=0,t=1,n=1,r=[.5],i=[0,1],a;function o(e){return e!=null&&e<=e?i[yo(r,e,0,n)]:a}function s(){var i=-1;for(r=Array(n);++i<n;)r[i]=((i+1)*t-(i-n)*e)/(n+1);return o}return o.domain=function(n){return arguments.length?([e,t]=n,e=+e,t=+t,s()):[e,t]},o.range=function(e){return arguments.length?(n=(i=Array.from(e)).length-1,s()):i.slice()},o.invertExtent=function(a){var o=i.indexOf(a);return o<0?[NaN,NaN]:o<1?[e,r[0]]:o>=n?[r[n-1],t]:[r[o-1],r[o]]},o.unknown=function(e){return arguments.length&&(a=e),o},o.thresholds=function(){return r.slice()},o.copy=function(){return Tc().domain([e,t]).range(i).unknown(a)},Fo.apply(Cc(o),arguments)}var Ec=1e-6,Dc=Math.PI,Oc=Dc/2,kc=Dc/4,Ac=Dc*2,jc=180/Dc,Mc=Dc/180,Nc=Math.abs,Pc=Math.atan,Fc=Math.atan2,Ic=Math.cos,Lc=Math.ceil,Rc=Math.exp,zc=Math.hypot,Bc=Math.log,Vc=Math.sin,Hc=Math.sign||function(e){return e>0?1:e<0?-1:0},Uc=Math.sqrt,Wc=Math.tan;function Gc(e){return e>1?0:e<-1?Dc:Math.acos(e)}function Kc(e){return e>1?Oc:e<-1?-Oc:Math.asin(e)}function qc(e){return(e=Vc(e/2))*e}function Jc(){}function Yc(e,t){e&&Zc.hasOwnProperty(e.type)&&Zc[e.type](e,t)}var Xc={Feature:function(e,t){Yc(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Yc(n[r].geometry,t)}},Zc={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Qc(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Qc(n[r],t,0)},Polygon:function(e,t){$c(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)$c(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Yc(n[r],t)}};function Qc(e,t,n){var r=-1,i=e.length-n,a;for(t.lineStart();++r<i;)a=e[r],t.point(a[0],a[1],a[2]);t.lineEnd()}function $c(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Qc(e[n],t,1);t.polygonEnd()}function el(e,t){e&&Xc.hasOwnProperty(e.type)?Xc[e.type](e,t):Yc(e,t)}var tl=new xo,nl=new xo,rl,il,al,ol,sl,cl={point:Jc,lineStart:Jc,lineEnd:Jc,polygonStart:function(){tl=new xo,cl.lineStart=ll,cl.lineEnd=ul},polygonEnd:function(){var e=+tl;nl.add(e<0?Ac+e:e),this.lineStart=this.lineEnd=this.point=Jc},sphere:function(){nl.add(Ac)}};function ll(){cl.point=dl}function ul(){fl(rl,il)}function dl(e,t){cl.point=fl,rl=e,il=t,e*=Mc,t*=Mc,al=e,ol=Ic(t=t/2+kc),sl=Vc(t)}function fl(e,t){e*=Mc,t*=Mc,t=t/2+kc;var n=e-al,r=n>=0?1:-1,i=r*n,a=Ic(t),o=Vc(t),s=sl*o,c=ol*a+s*Ic(i),l=s*r*Vc(i);tl.add(Fc(l,c)),al=e,ol=a,sl=o}function pl(e){return[Fc(e[1],e[0]),Kc(e[2])]}function ml(e){var t=e[0],n=e[1],r=Ic(n);return[r*Ic(t),r*Vc(t),Vc(n)]}function hl(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function gl(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function _l(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function vl(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function yl(e){var t=Uc(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var bl,xl,Sl,Cl,wl,Tl,El,Dl,Ol,kl,Al,jl={point:Ml,lineStart:Pl,lineEnd:Fl,polygonStart:function(){jl.point=Il,jl.lineStart=Ll,jl.lineEnd=Rl,Ol=new xo,cl.polygonStart()},polygonEnd:function(){cl.polygonEnd(),jl.point=Ml,jl.lineStart=Pl,jl.lineEnd=Fl,tl<0?(bl=-(Sl=180),xl=-(Cl=90)):Ol>1e-6?Cl=90:Ol<-1e-6&&(xl=-90),Al[0]=bl,Al[1]=Sl},sphere:function(){bl=-(Sl=180),xl=-(Cl=90)}};function Ml(e,t){kl.push(Al=[bl=e,Sl=e]),t<xl&&(xl=t),t>Cl&&(Cl=t)}function Nl(e,t){var n=ml([e*Mc,t*Mc]);if(Dl){var r=gl(Dl,n),i=gl([r[1],-r[0],0],r);yl(i),i=pl(i);var a=e-wl,o=a>0?1:-1,s=i[0]*jc*o,c,l=Nc(a)>180;l^(o*wl<s&&s<o*e)?(c=i[1]*jc,c>Cl&&(Cl=c)):(s=(s+360)%360-180,l^(o*wl<s&&s<o*e)?(c=-i[1]*jc,c<xl&&(xl=c)):(t<xl&&(xl=t),t>Cl&&(Cl=t))),l?e<wl?zl(bl,e)>zl(bl,Sl)&&(Sl=e):zl(e,Sl)>zl(bl,Sl)&&(bl=e):Sl>=bl?(e<bl&&(bl=e),e>Sl&&(Sl=e)):e>wl?zl(bl,e)>zl(bl,Sl)&&(Sl=e):zl(e,Sl)>zl(bl,Sl)&&(bl=e)}else kl.push(Al=[bl=e,Sl=e]);t<xl&&(xl=t),t>Cl&&(Cl=t),Dl=n,wl=e}function Pl(){jl.point=Nl}function Fl(){Al[0]=bl,Al[1]=Sl,jl.point=Ml,Dl=null}function Il(e,t){if(Dl){var n=e-wl;Ol.add(Nc(n)>180?n+(n>0?360:-360):n)}else Tl=e,El=t;cl.point(e,t),Nl(e,t)}function Ll(){cl.lineStart()}function Rl(){Il(Tl,El),cl.lineEnd(),Nc(Ol)>1e-6&&(bl=-(Sl=180)),Al[0]=bl,Al[1]=Sl,Dl=null}function zl(e,t){return(t-=e)<0?t+360:t}function Bl(e,t){return e[0]-t[0]}function Vl(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function Hl(e){var t,n,r,i,a,o,s;if(Cl=Sl=-(bl=xl=1/0),kl=[],el(e,jl),n=kl.length){for(kl.sort(Bl),t=1,r=kl[0],a=[r];t<n;++t)i=kl[t],Vl(r,i[0])||Vl(r,i[1])?(zl(r[0],i[1])>zl(r[0],r[1])&&(r[1]=i[1]),zl(i[0],r[1])>zl(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,n=a.length-1,t=0,r=a[n];t<=n;r=i,++t)i=a[t],(s=zl(r[1],i[0]))>o&&(o=s,bl=i[0],Sl=r[1])}return kl=Al=null,bl===1/0||xl===1/0?[[NaN,NaN],[NaN,NaN]]:[[bl,xl],[Sl,Cl]]}var Ul,Wl,Gl,Kl,ql,Jl,Yl,Xl,Zl,Ql,$l,eu,tu,nu,ru,iu,au={sphere:Jc,point:ou,lineStart:cu,lineEnd:du,polygonStart:function(){au.lineStart=fu,au.lineEnd=pu},polygonEnd:function(){au.lineStart=cu,au.lineEnd=du}};function ou(e,t){e*=Mc,t*=Mc;var n=Ic(t);su(n*Ic(e),n*Vc(e),Vc(t))}function su(e,t,n){++Ul,Gl+=(e-Gl)/Ul,Kl+=(t-Kl)/Ul,ql+=(n-ql)/Ul}function cu(){au.point=lu}function lu(e,t){e*=Mc,t*=Mc;var n=Ic(t);nu=n*Ic(e),ru=n*Vc(e),iu=Vc(t),au.point=uu,su(nu,ru,iu)}function uu(e,t){e*=Mc,t*=Mc;var n=Ic(t),r=n*Ic(e),i=n*Vc(e),a=Vc(t),o=Fc(Uc((o=ru*a-iu*i)*o+(o=iu*r-nu*a)*o+(o=nu*i-ru*r)*o),nu*r+ru*i+iu*a);Wl+=o,Jl+=o*(nu+(nu=r)),Yl+=o*(ru+(ru=i)),Xl+=o*(iu+(iu=a)),su(nu,ru,iu)}function du(){au.point=ou}function fu(){au.point=mu}function pu(){hu(eu,tu),au.point=ou}function mu(e,t){eu=e,tu=t,e*=Mc,t*=Mc,au.point=hu;var n=Ic(t);nu=n*Ic(e),ru=n*Vc(e),iu=Vc(t),su(nu,ru,iu)}function hu(e,t){e*=Mc,t*=Mc;var n=Ic(t),r=n*Ic(e),i=n*Vc(e),a=Vc(t),o=ru*a-iu*i,s=iu*r-nu*a,c=nu*i-ru*r,l=zc(o,s,c),u=Kc(l),d=l&&-u/l;Zl.add(d*o),Ql.add(d*s),$l.add(d*c),Wl+=u,Jl+=u*(nu+(nu=r)),Yl+=u*(ru+(ru=i)),Xl+=u*(iu+(iu=a)),su(nu,ru,iu)}function gu(e){Ul=Wl=Gl=Kl=ql=Jl=Yl=Xl=0,Zl=new xo,Ql=new xo,$l=new xo,el(e,au);var t=+Zl,n=+Ql,r=+$l,i=zc(t,n,r);return i<1e-12&&(t=Jl,n=Yl,r=Xl,Wl<1e-6&&(t=Gl,n=Kl,r=ql),i=zc(t,n,r),i<1e-12)?[NaN,NaN]:[Fc(n,t)*jc,Kc(r/i)*jc]}function _u(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return n=t.invert(n,r),n&&e.invert(n[0],n[1])}),n}function vu(e,t){return Nc(e)>Dc&&(e-=Math.round(e/Ac)*Ac),[e,t]}vu.invert=vu;function yu(e,t,n){return(e%=Ac)?t||n?_u(xu(e),Su(t,n)):xu(e):t||n?Su(t,n):vu}function bu(e){return function(t,n){return t+=e,Nc(t)>Dc&&(t-=Math.round(t/Ac)*Ac),[t,n]}}function xu(e){var t=bu(e);return t.invert=bu(-e),t}function Su(e,t){var n=Ic(e),r=Vc(e),i=Ic(t),a=Vc(t);function o(e,t){var o=Ic(t),s=Ic(e)*o,c=Vc(e)*o,l=Vc(t),u=l*n+s*r;return[Fc(c*i-u*a,s*n-l*r),Kc(u*i+c*a)]}return o.invert=function(e,t){var o=Ic(t),s=Ic(e)*o,c=Vc(e)*o,l=Vc(t),u=l*i-c*a;return[Fc(c*i+l*a,s*n+u*r),Kc(u*n-s*r)]},o}function Cu(e){e=yu(e[0]*Mc,e[1]*Mc,e.length>2?e[2]*Mc:0);function t(t){return t=e(t[0]*Mc,t[1]*Mc),t[0]*=jc,t[1]*=jc,t}return t.invert=function(t){return t=e.invert(t[0]*Mc,t[1]*Mc),t[0]*=jc,t[1]*=jc,t},t}function wu(e,t,n,r,i,a){if(n){var o=Ic(t),s=Vc(t),c=r*n;i==null?(i=t+r*Ac,a=t-c/2):(i=Tu(o,i),a=Tu(o,a),(r>0?i<a:i>a)&&(i+=r*Ac));for(var l,u=i;r>0?u>a:u<a;u-=c)l=pl([o,-s*Ic(u),-s*Vc(u)]),e.point(l[0],l[1])}}function Tu(e,t){t=ml(t),t[0]-=e,yl(t);var n=Gc(-t[1]);return((-t[2]<0?-n:n)+Ac-Ec)%Ac}function Eu(){var e=[],t;return{point:function(e,n,r){t.push([e,n,r])},lineStart:function(){e.push(t=[])},lineEnd:Jc,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Du(e,t){return Nc(e[0]-t[0])<1e-6&&Nc(e[1]-t[1])<1e-6}function Ou(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function ku(e,t,n,r,i){var a=[],o=[],s,c;if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n=e[0],r=e[t],c;if(Du(n,r)){if(!n[2]&&!r[2]){for(i.lineStart(),s=0;s<t;++s)i.point((n=e[s])[0],n[1]);i.lineEnd();return}r[0]+=2*Ec}a.push(c=new Ou(n,e,null,!0)),o.push(c.o=new Ou(n,null,c,!1)),a.push(c=new Ou(r,e,null,!1)),o.push(c.o=new Ou(r,null,c,!0))}}),a.length){for(o.sort(t),Au(a),Au(o),s=0,c=o.length;s<c;++s)o[s].e=n=!n;for(var l=a[0],u,d;;){for(var f=l,p=!0;f.v;)if((f=f.n)===l)return;u=f.z,i.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(s=0,c=u.length;s<c;++s)i.point((d=u[s])[0],d[1]);else r(f.x,f.n.x,1,i);f=f.n}else{if(p)for(u=f.p.z,s=u.length-1;s>=0;--s)i.point((d=u[s])[0],d[1]);else r(f.x,f.p.x,-1,i);f=f.p}f=f.o,u=f.z,p=!p}while(!f.v);i.lineEnd()}}}function Au(e){if(t=e.length){for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}}function ju(e){return Nc(e[0])<=Dc?e[0]:Hc(e[0])*((Nc(e[0])+Dc)%Ac-Dc)}function Mu(e,t){var n=ju(t),r=t[1],i=Vc(r),a=[Vc(n),-Ic(n),0],o=0,s=0,c=new xo;i===1?r=Oc+Ec:i===-1&&(r=-Oc-Ec);for(var l=0,u=e.length;l<u;++l)if(f=(d=e[l]).length)for(var d,f,p=d[f-1],m=ju(p),h=p[1]/2+kc,g=Vc(h),_=Ic(h),v=0;v<f;++v,m=b,g=S,_=C,p=y){var y=d[v],b=ju(y),x=y[1]/2+kc,S=Vc(x),C=Ic(x),w=b-m,T=w>=0?1:-1,E=T*w,D=E>Dc,O=g*S;if(c.add(Fc(O*T*Vc(E),_*C+O*Ic(E))),o+=D?w+T*Ac:w,D^m>=n^b>=n){var ee=gl(ml(p),ml(y));yl(ee);var k=gl(a,ee);yl(k);var te=(D^w>=0?-1:1)*Kc(k[2]);(r>te||r===te&&(ee[0]||ee[1]))&&(s+=D^w>=0?1:-1)}}return(o<-1e-6||o<1e-6&&c<-1e-12)^s&1}function Nu(e,t,n,r){return function(i){var a=t(i),o=Eu(),s=t(o),c=!1,l,u,d,f={point:p,lineStart:h,lineEnd:g,polygonStart:function(){f.point=_,f.lineStart=v,f.lineEnd=y,u=[],l=[]},polygonEnd:function(){f.point=p,f.lineStart=h,f.lineEnd=g,u=Mo(u);var e=Mu(l,r);u.length?(c||=(i.polygonStart(),!0),ku(u,Fu,e,n,i)):e&&(c||=(i.polygonStart(),!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),c&&=(i.polygonEnd(),!1),u=l=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function p(t,n){e(t,n)&&i.point(t,n)}function m(e,t){a.point(e,t)}function h(){f.point=m,a.lineStart()}function g(){f.point=p,a.lineEnd()}function _(e,t){d.push([e,t]),s.point(e,t)}function v(){s.lineStart(),d=[]}function y(){_(d[0][0],d[0][1]),s.lineEnd();var e=s.clean(),t=o.result(),n,r=t.length,a,f,p;if(d.pop(),l.push(d),d=null,r){if(e&1){if(f=t[0],(a=f.length-1)>0){for(c||=(i.polygonStart(),!0),i.lineStart(),n=0;n<a;++n)i.point((p=f[n])[0],p[1]);i.lineEnd()}return}r>1&&e&2&&t.push(t.pop().concat(t.shift())),u.push(t.filter(Pu))}}return f}}function Pu(e){return e.length>1}function Fu(e,t){return((e=e.x)[0]<0?e[1]-Oc-Ec:Oc-e[1])-((t=t.x)[0]<0?t[1]-Oc-Ec:Oc-t[1])}var Iu=Nu(function(){return!0},Lu,zu,[-Dc,-Oc]);function Lu(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(a,o){var s=a>0?Dc:-Dc,c=Nc(a-t);Nc(c-Dc)<1e-6?(e.point(t,n=(n+o)/2>0?Oc:-Oc),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(s,n),e.point(a,n),i=0):r!==s&&c>=Dc&&(Nc(t-r)<1e-6&&(t-=r*Ec),Nc(a-s)<1e-6&&(a-=s*Ec),n=Ru(t,n,a,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(s,n),i=0),e.point(t=a,n=o),r=s},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function Ru(e,t,n,r){var i,a,o=Vc(e-n);return Nc(o)>1e-6?Pc((Vc(t)*(a=Ic(r))*Vc(n)-Vc(r)*(i=Ic(t))*Vc(e))/(i*a*o)):(t+r)/2}function zu(e,t,n,r){var i;if(e==null)i=n*Oc,r.point(-Dc,i),r.point(0,i),r.point(Dc,i),r.point(Dc,0),r.point(Dc,-i),r.point(0,-i),r.point(-Dc,-i),r.point(-Dc,0),r.point(-Dc,i);else if(Nc(e[0]-t[0])>1e-6){var a=e[0]<t[0]?Dc:-Dc;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}function Bu(e){var t=Ic(e),n=2*Mc,r=t>0,i=Nc(t)>Ec;function a(t,r,i,a){wu(a,e,n,i,t,r)}function o(e,n){return Ic(e)*Ic(n)>t}function s(e){var t,n,a,s,u;return{lineStart:function(){s=a=!1,u=1},point:function(d,f){var p=[d,f],m,h=o(d,f),g=r?h?0:l(d,f):h?l(d+(d<0?Dc:-Dc),f):0;if(!t&&(s=a=h)&&e.lineStart(),h!==a&&(m=c(t,p),(!m||Du(t,m)||Du(p,m))&&(p[2]=1)),h!==a)u=0,h?(e.lineStart(),m=c(p,t),e.point(m[0],m[1])):(m=c(t,p),e.point(m[0],m[1],2),e.lineEnd()),t=m;else if(i&&t&&r^h){var _;!(g&n)&&(_=c(p,t,!0))&&(u=0,r?(e.lineStart(),e.point(_[0][0],_[0][1]),e.point(_[1][0],_[1][1]),e.lineEnd()):(e.point(_[1][0],_[1][1]),e.lineEnd(),e.lineStart(),e.point(_[0][0],_[0][1],3)))}h&&(!t||!Du(t,p))&&e.point(p[0],p[1]),t=p,a=h,n=g},lineEnd:function(){a&&e.lineEnd(),t=null},clean:function(){return u|(s&&a)<<1}}}function c(e,n,r){var i=ml(e),a=ml(n),o=[1,0,0],s=gl(i,a),c=hl(s,s),l=s[0],u=c-l*l;if(!u)return!r&&e;var d=t*c/u,f=-t*l/u,p=gl(o,s),m=vl(o,d);_l(m,vl(s,f));var h=p,g=hl(m,h),_=hl(h,h),v=g*g-_*(hl(m,m)-1);if(!(v<0)){var y=Uc(v),b=vl(h,(-g-y)/_);if(_l(b,m),b=pl(b),!r)return b;var x=e[0],S=n[0],C=e[1],w=n[1],T;S<x&&(T=x,x=S,S=T);var E=S-x,D=Nc(E-Dc)<Ec,O=D||E<1e-6;if(!D&&w<C&&(T=C,C=w,w=T),O?D?C+w>0^b[1]<(Nc(b[0]-x)<1e-6?C:w):C<=b[1]&&b[1]<=w:E>Dc^(x<=b[0]&&b[0]<=S)){var ee=vl(h,(-g+y)/_);return _l(ee,m),[b,pl(ee)]}}}function l(t,n){var i=r?e:Dc-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return Nu(o,s,a,r?[0,-e]:[-Dc,e-Dc])}function Vu(e,t,n,r,i,a){var o=e[0],s=e[1],c=t[0],l=t[1],u=0,d=1,f=c-o,p=l-s,m=n-o;if(!(!f&&m>0)){if(m/=f,f<0){if(m<u)return;m<d&&(d=m)}else if(f>0){if(m>d)return;m>u&&(u=m)}if(m=i-o,!(!f&&m<0)){if(m/=f,f<0){if(m>d)return;m>u&&(u=m)}else if(f>0){if(m<u)return;m<d&&(d=m)}if(m=r-s,!(!p&&m>0)){if(m/=p,p<0){if(m<u)return;m<d&&(d=m)}else if(p>0){if(m>d)return;m>u&&(u=m)}if(m=a-s,!(!p&&m<0)){if(m/=p,p<0){if(m>d)return;m>u&&(u=m)}else if(p>0){if(m<u)return;m<d&&(d=m)}return u>0&&(e[0]=o+u*f,e[1]=s+u*p),d<1&&(t[0]=o+d*f,t[1]=s+d*p),!0}}}}}var Hu=1e9,Uu=-Hu;function Wu(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,l){var u=0,d=0;if(i==null||(u=o(i,s))!==(d=o(a,s))||c(i,a)<0^s>0)do l.point(u===0||u===3?e:n,u>1?r:t);while((u=(u+s+4)%4)!==d);else l.point(a[0],a[1])}function o(r,i){return Nc(r[0]-e)<1e-6?i>0?0:3:Nc(r[0]-n)<1e-6?i>0?2:1:Nc(r[1]-t)<1e-6?i>0?1:0:i>0?3:2}function s(e,t){return c(e.x,t.x)}function c(e,t){var n=o(e,1),r=o(t,1);return n===r?n===0?t[1]-e[1]:n===1?e[0]-t[0]:n===2?e[1]-t[1]:t[0]-e[0]:n-r}return function(o){var c=o,l=Eu(),u,d,f,p,m,h,g,_,v,y,b,x={point:S,lineStart:E,lineEnd:D,polygonStart:w,polygonEnd:T};function S(e,t){i(e,t)&&c.point(e,t)}function C(){for(var t=0,n=0,i=d.length;n<i;++n)for(var a=d[n],o=1,s=a.length,c=a[0],l,u,f=c[0],p=c[1];o<s;++o)l=f,u=p,c=a[o],f=c[0],p=c[1],u<=r?p>r&&(f-l)*(r-u)>(p-u)*(e-l)&&++t:p<=r&&(f-l)*(r-u)<(p-u)*(e-l)&&--t;return t}function w(){c=l,u=[],d=[],b=!0}function T(){var e=C(),t=b&&e,n=(u=Mo(u)).length;(t||n)&&(o.polygonStart(),t&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),n&&ku(u,s,e,a,o),o.polygonEnd()),c=o,u=d=f=null}function E(){x.point=O,d&&d.push(f=[]),y=!0,v=!1,g=_=NaN}function D(){u&&(O(p,m),h&&v&&l.rejoin(),u.push(l.result())),x.point=S,v&&c.lineEnd()}function O(a,o){var s=i(a,o);if(d&&f.push([a,o]),y)p=a,m=o,h=s,y=!1,s&&(c.lineStart(),c.point(a,o));else if(s&&v)c.point(a,o);else{var l=[g=Math.max(Uu,Math.min(Hu,g)),_=Math.max(Uu,Math.min(Hu,_))],u=[a=Math.max(Uu,Math.min(Hu,a)),o=Math.max(Uu,Math.min(Hu,o))];Vu(l,u,e,t,n,r)?(v||(c.lineStart(),c.point(l[0],l[1])),c.point(u[0],u[1]),s||c.lineEnd(),b=!1):s&&(c.lineStart(),c.point(a,o),b=!1)}g=a,_=o,v=s}return x}}var Gu,Ku,qu,Ju,Yu={sphere:Jc,point:Jc,lineStart:Xu,lineEnd:Jc,polygonStart:Jc,polygonEnd:Jc};function Xu(){Yu.point=Qu,Yu.lineEnd=Zu}function Zu(){Yu.point=Yu.lineEnd=Jc}function Qu(e,t){e*=Mc,t*=Mc,Ku=e,qu=Vc(t),Ju=Ic(t),Yu.point=$u}function $u(e,t){e*=Mc,t*=Mc;var n=Vc(t),r=Ic(t),i=Nc(e-Ku),a=Ic(i),o=r*Vc(i),s=Ju*n-qu*r*a,c=qu*n+Ju*r*a;Gu.add(Fc(Uc(o*o+s*s),c)),Ku=e,qu=n,Ju=r}function ed(e){return Gu=new xo,el(e,Yu),+Gu}var td=[null,null],nd={type:`LineString`,coordinates:td};function rd(e,t){return td[0]=e,td[1]=t,ed(nd)}var id={Feature:function(e,t){return od(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)if(od(n[r].geometry,t))return!0;return!1}},ad={Sphere:function(){return!0},Point:function(e,t){return sd(e.coordinates,t)},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)if(sd(n[r],t))return!0;return!1},LineString:function(e,t){return cd(e.coordinates,t)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)if(cd(n[r],t))return!0;return!1},Polygon:function(e,t){return ld(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)if(ld(n[r],t))return!0;return!1},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)if(od(n[r],t))return!0;return!1}};function od(e,t){return e&&ad.hasOwnProperty(e.type)?ad[e.type](e,t):!1}function sd(e,t){return rd(e,t)===0}function cd(e,t){for(var n,r,i,a=0,o=e.length;a<o;a++){if(r=rd(e[a],t),r===0||a>0&&(i=rd(e[a],e[a-1]),i>0&&n<=i&&r<=i&&(n+r-i)*(1-((n-r)/i)**2)<1e-12*i))return!0;n=r}return!1}function ld(e,t){return!!Mu(e.map(ud),dd(t))}function ud(e){return e=e.map(dd),e.pop(),e}function dd(e){return[e[0]*Mc,e[1]*Mc]}function fd(e,t){return(e&&id.hasOwnProperty(e.type)?id[e.type]:od)(e,t)}function pd(e,t,n){var r=No(e,t-Ec,n).concat(t);return function(e){return r.map(function(t){return[e,t]})}}function md(e,t,n){var r=No(e,t-Ec,n).concat(t);return function(e){return r.map(function(t){return[t,e]})}}function hd(){var e,t,n,r,i,a,o,s,c=10,l=c,u=90,d=360,f,p,m,h,g=2.5;function _(){return{type:`MultiLineString`,coordinates:v()}}function v(){return No(Lc(r/u)*u,n,u).map(m).concat(No(Lc(s/d)*d,o,d).map(h)).concat(No(Lc(t/c)*c,e,c).filter(function(e){return Nc(e%u)>Ec}).map(f)).concat(No(Lc(a/l)*l,i,l).filter(function(e){return Nc(e%d)>Ec}).map(p))}return _.lines=function(){return v().map(function(e){return{type:`LineString`,coordinates:e}})},_.outline=function(){return{type:`Polygon`,coordinates:[m(r).concat(h(o).slice(1),m(n).reverse().slice(1),h(s).reverse().slice(1))]}},_.extent=function(e){return arguments.length?_.extentMajor(e).extentMinor(e):_.extentMinor()},_.extentMajor=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],r>n&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),_.precision(g)):[[r,s],[n,o]]},_.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],i=+n[1][1],t>e&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),_.precision(g)):[[t,a],[e,i]]},_.step=function(e){return arguments.length?_.stepMajor(e).stepMinor(e):_.stepMinor()},_.stepMajor=function(e){return arguments.length?(u=+e[0],d=+e[1],_):[u,d]},_.stepMinor=function(e){return arguments.length?(c=+e[0],l=+e[1],_):[c,l]},_.precision=function(c){return arguments.length?(g=+c,f=pd(a,i,90),p=md(t,e,g),m=pd(s,o,90),h=md(r,n,g),_):g},_.extentMajor([[-180,-90+Ec],[180,90-Ec]]).extentMinor([[-180,-80-Ec],[180,80+Ec]])}function gd(){return hd()()}function _d(e,t){var n=e[0]*Mc,r=e[1]*Mc,i=t[0]*Mc,a=t[1]*Mc,o=Ic(r),s=Vc(r),c=Ic(a),l=Vc(a),u=o*Ic(n),d=o*Vc(n),f=c*Ic(i),p=c*Vc(i),m=2*Kc(Uc(qc(a-r)+o*c*qc(i-n))),h=Vc(m),g=m?function(e){var t=Vc(e*=m)/h,n=Vc(m-e)/h,r=n*u+t*f,i=n*d+t*p,a=n*s+t*l;return[Fc(i,r)*jc,Fc(a,Uc(r*r+i*i))*jc]}:function(){return[n*jc,r*jc]};return g.distance=m,g}var vd=e=>e,yd=1/0,bd=yd,xd=-yd,Sd=xd,Cd={point:wd,lineStart:Jc,lineEnd:Jc,polygonStart:Jc,polygonEnd:Jc,result:function(){var e=[[yd,bd],[xd,Sd]];return xd=Sd=-(bd=yd=1/0),e}};function wd(e,t){e<yd&&(yd=e),e>xd&&(xd=e),t<bd&&(bd=t),t>Sd&&(Sd=t)}var Td=Cd;function Ed(e){return function(t){var n=new Dd;for(var r in e)n[r]=e[r];return n.stream=t,n}}function Dd(){}Dd.prototype={constructor:Dd,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Od(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),el(n,e.stream(Td)),t(Td.result()),r!=null&&e.clipExtent(r),e}function kd(e,t,n){return Od(e,function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])},n)}function Ad(e,t,n){return kd(e,[[0,0],t],n)}function jd(e,t,n){return Od(e,function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])},n)}function Md(e,t,n){return Od(e,function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])},n)}var Nd=16,Pd=Ic(30*Mc);function Fd(e,t){return+t?Ld(e,t):Id(e)}function Id(e){return Ed({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function Ld(e,t){function n(r,i,a,o,s,c,l,u,d,f,p,m,h,g){var _=l-r,v=u-i,y=_*_+v*v;if(y>4*t&&h--){var b=o+f,x=s+p,S=c+m,C=Uc(b*b+x*x+S*S),w=Kc(S/=C),T=Nc(Nc(S)-1)<1e-6||Nc(a-d)<1e-6?(a+d)/2:Fc(x,b),E=e(T,w),D=E[0],O=E[1],ee=D-r,k=O-i,te=v*ee-_*k;(te*te/y>t||Nc((_*ee+v*k)/y-.5)>.3||o*f+s*p+c*m<Pd)&&(n(r,i,a,o,s,c,D,O,T,b/=C,x/=C,S,h,g),g.point(D,O),n(D,O,T,b,x,S,l,u,d,f,p,m,h,g))}}return function(t){var r,i,a,o,s,c,l,u,d,f,p,m,h={point:g,lineStart:_,lineEnd:y,polygonStart:function(){t.polygonStart(),h.lineStart=b},polygonEnd:function(){t.polygonEnd(),h.lineStart=_}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function _(){u=NaN,h.point=v,t.lineStart()}function v(r,i){var a=ml([r,i]),o=e(r,i);n(u,d,l,f,p,m,u=o[0],d=o[1],l=r,f=a[0],p=a[1],m=a[2],Nd,t),t.point(u,d)}function y(){h.point=g,t.lineEnd()}function b(){_(),h.point=x,h.lineEnd=S}function x(e,t){v(r=e,t),i=u,a=d,o=f,s=p,c=m,h.point=v}function S(){n(u,d,l,f,p,m,i,a,r,o,s,c,Nd,t),h.lineEnd=y,y()}return h}}var Rd=Ed({point:function(e,t){this.stream.point(e*Mc,t*Mc)}});function zd(e){return Ed({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function Bd(e,t,n,r,i){function a(a,o){return a*=r,o*=i,[t+e*a,n-e*o]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}function Vd(e,t,n,r,i,a){if(!a)return Bd(e,t,n,r,i);var o=Ic(a),s=Vc(a),c=o*e,l=s*e,u=o/e,d=s/e,f=(s*n-o*t)/e,p=(s*t+o*n)/e;function m(e,a){return e*=r,a*=i,[c*e-l*a+t,n-l*e-c*a]}return m.invert=function(e,t){return[r*(u*e-d*t+f),i*(p-d*e-u*t)]},m}function Hd(e){return Ud(function(){return e})()}function Ud(e){var t,n=150,r=480,i=250,a=0,o=0,s=0,c=0,l=0,u,d=0,f=1,p=1,m=null,h=Iu,g=null,_,v,y,b=vd,x=.5,S,C,w,T,E;function D(e){return w(e[0]*Mc,e[1]*Mc)}function O(e){return e=w.invert(e[0],e[1]),e&&[e[0]*jc,e[1]*jc]}D.stream=function(e){return T&&E===e?T:T=Rd(zd(u)(h(S(b(E=e)))))},D.preclip=function(e){return arguments.length?(h=e,m=void 0,k()):h},D.postclip=function(e){return arguments.length?(b=e,g=_=v=y=null,k()):b},D.clipAngle=function(e){return arguments.length?(h=+e?Bu(m=e*Mc):(m=null,Iu),k()):m*jc},D.clipExtent=function(e){return arguments.length?(b=e==null?(g=_=v=y=null,vd):Wu(g=+e[0][0],_=+e[0][1],v=+e[1][0],y=+e[1][1]),k()):g==null?null:[[g,_],[v,y]]},D.scale=function(e){return arguments.length?(n=+e,ee()):n},D.translate=function(e){return arguments.length?(r=+e[0],i=+e[1],ee()):[r,i]},D.center=function(e){return arguments.length?(a=e[0]%360*Mc,o=e[1]%360*Mc,ee()):[a*jc,o*jc]},D.rotate=function(e){return arguments.length?(s=e[0]%360*Mc,c=e[1]%360*Mc,l=e.length>2?e[2]%360*Mc:0,ee()):[s*jc,c*jc,l*jc]},D.angle=function(e){return arguments.length?(d=e%360*Mc,ee()):d*jc},D.reflectX=function(e){return arguments.length?(f=e?-1:1,ee()):f<0},D.reflectY=function(e){return arguments.length?(p=e?-1:1,ee()):p<0},D.precision=function(e){return arguments.length?(S=Fd(C,x=e*e),k()):Uc(x)},D.fitExtent=function(e,t){return kd(D,e,t)},D.fitSize=function(e,t){return Ad(D,e,t)},D.fitWidth=function(e,t){return jd(D,e,t)},D.fitHeight=function(e,t){return Md(D,e,t)};function ee(){var e=Vd(n,0,0,f,p,d).apply(null,t(a,o)),m=Vd(n,r-e[0],i-e[1],f,p,d);return u=yu(s,c,l),C=_u(t,m),w=_u(u,C),S=Fd(C,x),k()}function k(){return T=E=null,D}return function(){return t=e.apply(this,arguments),D.invert=t.invert&&O,ee()}}function Wd(e){return function(t,n){var r=Uc(t*t+n*n),i=e(r),a=Vc(i),o=Ic(i);return[Fc(t*a,r*o),Kc(r&&n*a/r)]}}function Gd(e,t){return[e,Bc(Wc((Oc+t)/2))]}Gd.invert=function(e,t){return[e,2*Pc(Rc(t))-Oc]};function Kd(e,t){var n=Ic(t),r=1+Ic(e)*n;return[n*Vc(e)/r,Vc(t)/r]}Kd.invert=Wd(function(e){return 2*Pc(e)});function qd(){return Hd(Kd).scale(250).clipAngle(142)}function Jd(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Yd(e){if(Array.isArray(e))return e}function Xd(e){if(Array.isArray(e))return Jd(e)}function Zd(e,t,n){if(typeof e==`function`?e===t:e.has(t))return arguments.length<3?t:n;throw TypeError(`Private element is not present on this object`)}function Qd(e){if(e===void 0)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return e}function $d(e,t,n){return t=uf(t),_f(e,ff()?Reflect.construct(t,[],uf(e).constructor):t.apply(e,n))}function ef(e,t){if(t.has(e))throw TypeError(`Cannot initialize the same private elements twice on an object`)}function tf(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function nf(e,t){return e.get(Zd(e,t))}function rf(e,t,n){ef(e,t),t.set(e,n)}function af(e,t,n){return e.set(Zd(e,t),n),n}function of(e,t){ef(e,t),t.add(e)}function sf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,Sf(r.key),r)}}function cf(e,t,n){return t&&sf(e.prototype,t),Object.defineProperty(e,`prototype`,{writable:!1}),e}function lf(e,t,n){return(t=Sf(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uf(e){return uf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},uf(e)}function df(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function`);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,`prototype`,{writable:!1}),t&&vf(e,t)}function ff(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ff=function(){return!!e})()}function pf(e){if(typeof Symbol<`u`&&e[Symbol.iterator]!=null||e[`@@iterator`]!=null)return Array.from(e)}function mf(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t!==0)for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function hf(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gf(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _f(e,t){if(t&&(typeof t==`object`||typeof t==`function`))return t;if(t!==void 0)throw TypeError(`Derived constructors may only return object or undefined`);return Qd(e)}function vf(e,t){return vf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vf(e,t)}function yf(e,t){return Yd(e)||mf(e,t)||Cf(e,t)||hf()}function bf(e){return Xd(e)||pf(e)||Cf(e)||gf()}function xf(e,t){if(typeof e!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return String(e)}function Sf(e){var t=xf(e,`string`);return typeof t==`symbol`?t:t+``}function Cf(e,t){if(e){if(typeof e==`string`)return Jd(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jd(e,t):void 0}}var wf=function(e){e instanceof Array?e.forEach(wf):(e.map&&e.map.dispose(),e.dispose())},Tf=function(e){e.geometry&&e.geometry.dispose(),e.material&&wf(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(Tf)},Ef=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),Tf(t)}};function Df(e,t,n){var r=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180;return{x:n*Math.sin(r)*Math.cos(i),y:n*Math.cos(r),z:n*Math.sin(r)*Math.sin(i)}}function Of(e){var t=e.x,n=e.y,r=e.z,i=Math.sqrt(t*t+n*n+r*r),a=Math.acos(n/i),o=Math.atan2(r,t);return{lat:90-a*180/Math.PI,lng:90-o*180/Math.PI-(o<-Math.PI/2?360:0),r:i}}function kf(e){return e*Math.PI/180}var Af=function(e){return 1-(Gd(0,(.5-e)*Math.PI)[1]/Math.PI+1)/2},jf=function(e){return Math.max(0,Math.min(1,Af(e)))},Mf=function(e){return .5-Gd.invert(0,(2*(1-e)-1)*Math.PI)[1]/Math.PI},Nf=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=wc().domain([1,0]).range([t,n]).clamp(!0),i=wc().domain([jf(t),jf(n)]).range([1,0]).clamp(!0),a=function(e){return i(jf(r(e)))},o=e.array,s=0,c=o.length;s<c;s+=2)o[s+1]=a(o[s+1]);e.needsUpdate=!0},Pf=function(e,t,n,r){var i=2**e,a=Math.max(0,Math.min(i-1,Math.floor((n+180)*i/360))),o=(90-r)/180;return t&&(o=Math.max(0,Math.min(1,Af(o)))),[a,Math.floor(o*i)]},Ff=function(e,t){for(var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=[],s=2**e,c=360/s,l=180/s,u=i===void 0?s-1:i,d=a===void 0?s-1:a,f=n,p=Math.min(s-1,u);f<=p;f++)for(var m=r,h=Math.min(s-1,d);m<=h;m++){var g=m,_=l;t&&(g=m===0?m:Mf(m/s)*s,_=((m+1===s?m+1:Mf((m+1)/s)*s)-g)*180/s);var v=-180+(f+.5)*c,y=90-(g*180/s+_/2),b=_;o.push({x:f,y:m,lng:v,lat:y,latLen:b})}return o},If=6,Lf=7,Rf=3,zf=90,Bf=new WeakMap,Vf=new WeakMap,Hf=new WeakMap,Uf=new WeakMap,Wf=new WeakMap,Gf=new WeakMap,Kf=new WeakMap,qf=new WeakMap,Jf=new WeakSet,Yf=function(e){function t(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.tileUrl,a=r.minLevel,o=a===void 0?0:a,s=r.maxLevel,c=s===void 0?17:s,l=r.mercatorProjection,u=l===void 0?!0:l;return tf(this,t),n=$d(this,t),of(n,Jf),rf(n,Bf,void 0),rf(n,Vf,void 0),rf(n,Hf,void 0),rf(n,Uf,void 0),rf(n,Wf,{}),rf(n,Gf,void 0),rf(n,Kf,void 0),rf(n,qf,void 0),lf(n,`minLevel`,void 0),lf(n,`maxLevel`,void 0),lf(n,`thresholds`,bf(Array(30)).map(function(e,t){return 8/2**t})),lf(n,`curvatureResolution`,5),lf(n,`tileMargin`,0),lf(n,`clearTiles`,function(){Object.values(nf(Wf,n)).forEach(function(e){e.forEach(function(e){e.obj&&(n.remove(e.obj),Ef(e.obj),delete e.obj)})}),af(Wf,n,{})}),af(Bf,n,e),n.tileUrl=i,af(Vf,n,u),n.minLevel=o,n.maxLevel=c,n.level=0,n.add(af(qf,n,new tr(new yn(nf(Bf,n)*.99,180,90),new Wr({color:0})))),nf(qf,n).visible=!1,nf(qf,n).material.polygonOffset=!0,nf(qf,n).material.polygonOffsetUnits=3,nf(qf,n).material.polygonOffsetFactor=1,n}return df(t,e),cf(t,[{key:`tileUrl`,get:function(){return nf(Hf,this)},set:function(e){af(Hf,this,e),this.updatePov(nf(Kf,this))}},{key:`level`,get:function(){return nf(Uf,this)},set:function(e){var t,n=this;nf(Wf,this)[e]||Zd(Jf,this,Xf).call(this,e);var r=nf(Uf,this);if(af(Uf,this,e),!(e===r||r===void 0)){if(nf(qf,this).visible=e>0,nf(Wf,this)[e].forEach(function(e){return e.obj&&(e.obj.material.depthWrite=!0)}),r<e&&((t=nf(Wf,this)[r])==null||t.forEach(function(e){return e.obj&&(e.obj.material.depthWrite=!1)})),r>e)for(var i=e+1;i<=r;i++)nf(Wf,this)[i]&&nf(Wf,this)[i].forEach(function(e){e.obj&&(n.remove(e.obj),Ef(e.obj),delete e.obj)});Zd(Jf,this,Zf).call(this)}}},{key:`updatePov`,value:function(e){var t=this;if(!(!e||!(e instanceof T))){af(Kf,this,e);var n;if(af(Gf,this,function(r){if(!r.hullPnts){var i=360/2**t.level,a=r.lng,o=r.lat,s=r.latLen,c=a-i/2,l=a+i/2,u=o-s/2,d=o+s/2;r.hullPnts=[[o,a],[u,c],[d,c],[u,l],[d,l]].map(function(e){var n=yf(e,2),r=n[0],i=n[1];return Df(r,i,nf(Bf,t))}).map(function(e){var t=e.x,n=e.y,r=e.z;return new j(t,n,r)})}return n||(n=new Mn,e.updateMatrix(),e.updateMatrixWorld(),n.setFromProjectionMatrix(new F().multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))),r.hullPnts.some(function(e){return n.containsPoint(e.clone().applyMatrix4(t.matrixWorld))})}),this.tileUrl){var r=(e.position.clone().distanceTo(this.getWorldPosition(new j))-nf(Bf,this))/nf(Bf,this),i=this.thresholds.findIndex(function(e){return e&&e<=r});this.level=Math.min(this.maxLevel,Math.max(this.minLevel,i<0?this.thresholds.length:i)),Zd(Jf,this,Zf).call(this)}}}}])}(ei);function Xf(e){var t=this;if(e>Lf){nf(Wf,this)[e]=[];return}var n=nf(Wf,this)[e]=Ff(e,nf(Vf,this));n.forEach(function(e){return e.centroid=Df(e.lat,e.lng,nf(Bf,t))}),n.octree=so().x(function(e){return e.centroid.x}).y(function(e){return e.centroid.y}).z(function(e){return e.centroid.z}).addAll(n)}function Zf(){var e=this;if(!(!this.tileUrl||this.level===void 0||!nf(Wf,this).hasOwnProperty(this.level))&&!(!nf(Gf,this)&&this.level>If)){var t=nf(Wf,this)[this.level];if(nf(Kf,this)){var n=this.worldToLocal(nf(Kf,this).position.clone());if(t.octree){var r,i=this.worldToLocal(nf(Kf,this).position.clone()),a=(i.length()-nf(Bf,this))*Rf;t=(r=t.octree).findAllWithinRadius.apply(r,bf(i).concat([a]))}else{var o=Of(n),s=(o.r/nf(Bf,this)-1)*zf,c=s/Math.cos(kf(o.lat)),l=[o.lng-c,o.lng+c],u=[o.lat+s,o.lat-s],d=yf(Pf(this.level,nf(Vf,this),l[0],u[0]),2),f=d[0],p=d[1],m=yf(Pf(this.level,nf(Vf,this),l[1],u[1]),2),h=m[0],g=m[1];!t.record&&(t.record={});var _=t.record;if(!_.hasOwnProperty(`${Math.round((f+h)/2)}_${Math.round((p+g)/2)}`))t=Ff(this.level,nf(Vf,this),f,p,h,g).map(function(e){var n=`${e.x}_${e.y}`;return _.hasOwnProperty(n)?_[n]:(_[n]=e,t.push(e),e)});else{for(var v=[],y=f;y<=h;y++)for(var b=p;b<=g;b++){var x=`${y}_${b}`;_.hasOwnProperty(x)||(_[x]=Ff(this.level,nf(Vf,this),y,b,y,b)[0],t.push(_[x])),v.push(_[x])}t=v}}}t.filter(function(e){return!e.obj}).filter(nf(Gf,this)||function(){return!0}).forEach(function(t){var n=t.x,r=t.y,i=t.lng,a=t.lat,o=t.latLen,s=360/2**e.level;if(!t.obj){var c=s*(1-e.tileMargin),l=o*(1-e.tileMargin),u=kf(i),d=kf(-a),f=new tr(new yn(nf(Bf,e),Math.ceil(c/e.curvatureResolution),Math.ceil(l/e.curvatureResolution),kf(90-c/2)+u,kf(c),kf(90-l/2)+d,kf(l)),new gn);if(nf(Vf,e)){var p=yf([a+o/2,a-o/2].map(function(e){return .5-e/180}),2),m=p[0],h=p[1];Nf(f.geometry.attributes.uv,m,h)}t.obj=f}t.loading||(t.loading=!0,new br().load(e.tileUrl(n,r,e.level),function(n){var r=t.obj;r&&(n.colorSpace=De,r.material.map=n,r.material.color=null,r.material.needsUpdate=!0,e.add(r)),t.loading=!1}))})}}function Qf(e,t,n=2){let r=t&&t.length,i=r?t[0]*n:e.length,a=$f(e,0,i,n,!0),o=[];if(!a||a.next===a.prev)return o;let s,c,l;if(r&&(a=op(e,t,a,n)),e.length>80*n){s=e[0],c=e[1];let t=s,r=c;for(let a=n;a<i;a+=n){let n=e[a],i=e[a+1];n<s&&(s=n),i<c&&(c=i),n>t&&(t=n),i>r&&(r=i)}l=Math.max(t-s,r-c),l=l===0?0:32767/l}return tp(a,o,n,s,c,l,0),o}function $f(e,t,n,r,i){let a;if(i===Ap(e,t,n,r)>0)for(let i=t;i<n;i+=r)a=Dp(i/r|0,e[i],e[i+1],a);else for(let i=n-r;i>=t;i-=r)a=Dp(i/r|0,e[i],e[i+1],a);return a&&yp(a,a.next)&&(Op(a),a=a.next),a}function ep(e,t){if(!e)return e;t||=e;let n=e,r;do if(r=!1,!n.steiner&&(yp(n,n.next)||vp(n.prev,n,n.next)===0)){if(Op(n),n=t=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==t);return t}function tp(e,t,n,r,i,a,o){if(!e)return;!o&&a&&dp(e,r,i,a);let s=e;for(;e.prev!==e.next;){let c=e.prev,l=e.next;if(a?rp(e,r,i,a):np(e)){t.push(c.i,e.i,l.i),Op(e),e=l.next,s=l.next;continue}if(e=l,e===s){o?o===1?(e=ip(ep(e),t),tp(e,t,n,r,i,a,2)):o===2&&ap(e,t,n,r,i,a):tp(ep(e),t,n,r,i,a,1);break}}}function np(e){let t=e.prev,n=e,r=e.next;if(vp(t,n,r)>=0)return!1;let i=t.x,a=n.x,o=r.x,s=t.y,c=n.y,l=r.y,u=Math.min(i,a,o),d=Math.min(s,c,l),f=Math.max(i,a,o),p=Math.max(s,c,l),m=r.next;for(;m!==t;){if(m.x>=u&&m.x<=f&&m.y>=d&&m.y<=p&&gp(i,s,a,c,o,l,m.x,m.y)&&vp(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function rp(e,t,n,r){let i=e.prev,a=e,o=e.next;if(vp(i,a,o)>=0)return!1;let s=i.x,c=a.x,l=o.x,u=i.y,d=a.y,f=o.y,p=Math.min(s,c,l),m=Math.min(u,d,f),h=Math.max(s,c,l),g=Math.max(u,d,f),_=pp(p,m,t,n,r),v=pp(h,g,t,n,r),y=e.prevZ,b=e.nextZ;for(;y&&y.z>=_&&b&&b.z<=v;){if(y.x>=p&&y.x<=h&&y.y>=m&&y.y<=g&&y!==i&&y!==o&&gp(s,u,c,d,l,f,y.x,y.y)&&vp(y.prev,y,y.next)>=0||(y=y.prevZ,b.x>=p&&b.x<=h&&b.y>=m&&b.y<=g&&b!==i&&b!==o&&gp(s,u,c,d,l,f,b.x,b.y)&&vp(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;y&&y.z>=_;){if(y.x>=p&&y.x<=h&&y.y>=m&&y.y<=g&&y!==i&&y!==o&&gp(s,u,c,d,l,f,y.x,y.y)&&vp(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=v;){if(b.x>=p&&b.x<=h&&b.y>=m&&b.y<=g&&b!==i&&b!==o&&gp(s,u,c,d,l,f,b.x,b.y)&&vp(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function ip(e,t){let n=e;do{let r=n.prev,i=n.next.next;!yp(r,i)&&bp(r,n,n.next,i)&&wp(r,i)&&wp(i,r)&&(t.push(r.i,n.i,i.i),Op(n),Op(n.next),n=e=i),n=n.next}while(n!==e);return ep(n)}function ap(e,t,n,r,i,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&_p(o,e)){let s=Ep(o,e);o=ep(o,o.next),s=ep(s,s.next),tp(o,t,n,r,i,a,0),tp(s,t,n,r,i,a,0);return}e=e.next}o=o.next}while(o!==e)}function op(e,t,n,r){let i=[];for(let n=0,a=t.length;n<a;n++){let o=$f(e,t[n]*r,n<a-1?t[n+1]*r:e.length,r,!1);o===o.next&&(o.steiner=!0),i.push(mp(o))}i.sort(sp);for(let e=0;e<i.length;e++)n=cp(i[e],n);return n}function sp(e,t){let n=e.x-t.x;return n===0&&(n=e.y-t.y,n===0&&(n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x))),n}function cp(e,t){let n=lp(e,t);if(!n)return t;let r=Ep(n,e);return ep(r,r.next),ep(n,n.next)}function lp(e,t){let n=t,r=e.x,i=e.y,a=-1/0,o;if(yp(e,n))return n;do{if(yp(e,n.next))return n.next;if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){let e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>a&&(a=e,o=n.x<n.next.x?n:n.next,e===r))return o}n=n.next}while(n!==t);if(!o)return null;let s=o,c=o.x,l=o.y,u=1/0;n=o;do{if(r>=n.x&&n.x>=c&&r!==n.x&&hp(i<l?r:a,i,c,l,i<l?a:r,i,n.x,n.y)){let t=Math.abs(i-n.y)/(r-n.x);wp(n,e)&&(t<u||t===u&&(n.x>o.x||n.x===o.x&&up(o,n)))&&(o=n,u=t)}n=n.next}while(n!==s);return o}function up(e,t){return vp(e.prev,e,t.prev)<0&&vp(t.next,e,e.next)<0}function dp(e,t,n,r){let i=e;do i.z===0&&(i.z=pp(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,fp(i)}function fp(e){let t,n=1;do{let r=e,i;e=null;let a=null;for(t=0;r;){t++;let o=r,s=0;for(let e=0;e<n&&(s++,o=o.nextZ,o);e++);let c=n;for(;s>0||c>0&&o;)s!==0&&(c===0||!o||r.z<=o.z)?(i=r,r=r.nextZ,s--):(i=o,o=o.nextZ,c--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=o}a.nextZ=null,n*=2}while(t>1);return e}function pp(e,t,n,r,i){return e=(e-n)*i|0,t=(t-r)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function mp(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function hp(e,t,n,r,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(r-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(i-o)*(r-s)}function gp(e,t,n,r,i,a,o,s){return!(e===o&&t===s)&&hp(e,t,n,r,i,a,o,s)}function _p(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Cp(e,t)&&(wp(e,t)&&wp(t,e)&&Tp(e,t)&&(vp(e.prev,e,t.prev)||vp(e,t.prev,t))||yp(e,t)&&vp(e.prev,e,e.next)>0&&vp(t.prev,t,t.next)>0)}function vp(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function yp(e,t){return e.x===t.x&&e.y===t.y}function bp(e,t,n,r){let i=Sp(vp(e,t,n)),a=Sp(vp(e,t,r)),o=Sp(vp(n,r,e)),s=Sp(vp(n,r,t));return!!(i!==a&&o!==s||i===0&&xp(e,n,t)||a===0&&xp(e,r,t)||o===0&&xp(n,e,r)||s===0&&xp(n,t,r))}function xp(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Sp(e){return e>0?1:e<0?-1:0}function Cp(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&bp(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function wp(e,t){return vp(e.prev,e,e.next)<0?vp(e,t,e.next)>=0&&vp(e,e.prev,t)>=0:vp(e,t,e.prev)<0||vp(e,e.next,t)<0}function Tp(e,t){let n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}function Ep(e,t){let n=kp(e.i,e.x,e.y),r=kp(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Dp(e,t,n,r){let i=kp(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Op(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function kp(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ap(e,t,n,r){let i=0;for(let a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}function jp(e){let t=[],n=[],r=e[0][0].length,i=0,a=0;for(let o of e){for(let e of o)for(let n=0;n<r;n++)t.push(e[n]);a&&(i+=a,n.push(i)),a=o.length}return{vertices:t,holes:n,dimensions:r}}function Mp(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Np(e){if(Array.isArray(e))return e}function Pp(e){if(Array.isArray(e))return Mp(e)}function Fp(e){if(e===void 0)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return e}function Ip(e,t,n){return t=Bp(t),qp(e,Hp()?Reflect.construct(t,[],Bp(e).constructor):t.apply(e,n))}function Lp(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function Rp(e,t,n){return Object.defineProperty(e,`prototype`,{writable:!1}),e}function zp(e,t){var n=typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(!n){if(Array.isArray(e)||(n=Zp(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||n.return==null||n.return()}finally{if(s)throw a}}}}function Bp(e){return Bp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Bp(e)}function Vp(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function`);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,`prototype`,{writable:!1}),t&&Jp(e,t)}function Hp(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Hp=function(){return!!e})()}function Up(e){if(typeof Symbol<`u`&&e[Symbol.iterator]!=null||e[`@@iterator`]!=null)return Array.from(e)}function Wp(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function Gp(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kp(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qp(e,t){if(t&&(typeof t==`object`||typeof t==`function`))return t;if(t!==void 0)throw TypeError(`Derived constructors may only return object or undefined`);return Fp(e)}function Jp(e,t){return Jp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Jp(e,t)}function Yp(e,t){return Np(e)||Wp(e,t)||Zp(e,t)||Gp()}function Xp(e){return Pp(e)||Up(e)||Zp(e)||Kp()}function Zp(e,t){if(e){if(typeof e==`string`)return Mp(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mp(e,t):void 0}}var Qp=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=[],r=null;return e.forEach(function(e){if(r){var i=rd(e,r)*180/Math.PI;if(i>t)for(var a=_d(r,e),o=r.length>2||e.length>2?Ms(r[2]||0,e[2]||0):null,s=o?function(e){return[].concat(Xp(a(e)),[o(e)])}:a,c=1/Math.ceil(i/t),l=c;l<1;)n.push(s(l)),l+=c}n.push(r=e)}),n},$p=typeof window<`u`&&window.THREE?window.THREE:{BufferGeometry:Xr,Float32BufferAttribute:vn},em=new $p.BufferGeometry().setAttribute?`setAttribute`:`addAttribute`,tm=function(e){function t(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:5;Lp(this,t),n=Ip(this,t),n.type=`GeoJsonGeometry`,n.parameters={geoJson:e,radius:r,resolution:i};var a=({Point:l,MultiPoint:u,LineString:d,MultiLineString:f,Polygon:p,MultiPolygon:m}[e.type]||function(){return[]})(e.coordinates,r),o=[],s=[],c=0;a.forEach(function(e){var t=o.length;nm({indices:o,vertices:s},e),n.addGroup(t,o.length-t,c++)}),o.length&&n.setIndex(o),s.length&&n[em](`position`,new $p.Float32BufferAttribute(s,3));function l(e,t){return[{vertices:im(e[1],e[0],t+(e[2]||0)),indices:[]}]}function u(e,t){var n={vertices:[],indices:[]};return e.map(function(e){return l(e,t)}).forEach(function(e){var t=Yp(e,1)[0];nm(n,t)}),[n]}function d(e,t){for(var n=jp([Qp(e,i).map(function(e){var n=Yp(e,3),r=n[0],i=n[1],a=n[2];return im(i,r,t+(a===void 0?0:a))})]).vertices,r=Math.round(n.length/3),a=[],o=1;o<r;o++)a.push(o-1,o);return[{vertices:n,indices:a}]}function f(e,t){var n={vertices:[],indices:[]};return e.map(function(e){return d(e,t)}).forEach(function(e){var t=Yp(e,1)[0];nm(n,t)}),[n]}function p(e,t){for(var n=jp(e.map(function(e){return Qp(e,i).map(function(e){var n=Yp(e,3),r=n[0],i=n[1],a=n[2];return im(i,r,t+(a===void 0?0:a))})})),r=n.vertices,a=n.holes,o=a[0]||1/0,s=r.slice(0,o*3),c=r.slice(o*3),l=new Set(a),u=Math.round(r.length/3),d=[],f=[],p=1;p<u;p++)l.has(p)||(p<o?d.push(p-1,p):f.push(p-1-o,p-o));var m=[{indices:d,vertices:s}];return a.length&&m.push({indices:f,vertices:c}),m}function m(e,t){var n={vertices:[],indices:[]},r={vertices:[],indices:[]};e.map(function(e){return p(e,t)}).forEach(function(e){var t=Yp(e,2),i=t[0],a=t[1];nm(n,i),a&&nm(r,a)});var i=[n];return r.vertices.length&&i.push(r),i}return n}return Vp(t,e),Rp(t)}($p.BufferGeometry);function nm(e,t){var n=Math.round(e.vertices.length/3);rm(e.vertices,t.vertices),rm(e.indices,t.indices.map(function(e){return e+n}))}function rm(e,t){var n=zp(t),r;try{for(n.s();!(r=n.n()).done;){var i=r.value;e.push(i)}}catch(e){n.e(e)}finally{n.f()}}function im(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180;return[n*Math.sin(r)*Math.cos(i),n*Math.cos(r),n*Math.sin(r)*Math.sin(i)]}var am=$e({computeMikkTSpaceTangents:()=>om,computeMorphedAttributes:()=>gm,deepCloneAttribute:()=>lm,deinterleaveAttribute:()=>dm,deinterleaveGeometry:()=>fm,estimateBytesUsed:()=>pm,interleaveAttributes:()=>um,mergeAttributes:()=>cm,mergeGeometries:()=>sm,mergeGroups:()=>_m,mergeVertices:()=>mm,toCreasedNormals:()=>vm,toTrianglesDrawMode:()=>hm});function om(e,t,n=!0){if(!t||!t.isReady)throw Error(`BufferGeometryUtils: Initialized MikkTSpace library required.`);if(!e.hasAttribute(`position`)||!e.hasAttribute(`normal`)||!e.hasAttribute(`uv`))throw Error(`BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.`);function r(e){if(e.normalized||e.isInterleavedBufferAttribute){let t=new Float32Array(e.count*e.itemSize);for(let n=0,r=0;n<e.count;n++)t[r++]=e.getX(n),t[r++]=e.getY(n),e.itemSize>2&&(t[r++]=e.getZ(n));return t}return e.array instanceof Float32Array?e.array:new Float32Array(e.array)}let i=e.index?e.toNonIndexed():e,a=t.generateTangents(r(i.attributes.position),r(i.attributes.normal),r(i.attributes.uv));if(n)for(let e=3;e<a.length;e+=4)a[e]*=-1;return i.setAttribute(`tangent`,new h(a,4)),e!==i&&e.copy(i),e}function sm(e,t=!1){let n=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=e[0].morphTargetsRelative,c=new Xr,l=0;for(let u=0;u<e.length;++u){let d=e[u],f=0;if(n!==(d.index!==null))return console.error(`THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index `+u+`. All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.`),null;for(let e in d.attributes){if(!r.has(e))return console.error(`THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index `+u+`. All geometries must have compatible attributes; make sure "`+e+`" attribute exists among all geometries, or in none of them.`),null;a[e]===void 0&&(a[e]=[]),a[e].push(d.attributes[e]),f++}if(f!==r.size)return console.error(`THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index `+u+`. Make sure all geometries have the same number of attributes.`),null;if(s!==d.morphTargetsRelative)return console.error(`THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index `+u+`. .morphTargetsRelative must be consistent throughout all geometries.`),null;for(let e in d.morphAttributes){if(!i.has(e))return console.error(`THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index `+u+`.  .morphAttributes must be consistent throughout all geometries.`),null;o[e]===void 0&&(o[e]=[]),o[e].push(d.morphAttributes[e])}if(t){let e;if(n)e=d.index.count;else if(d.attributes.position!==void 0)e=d.attributes.position.count;else return console.error(`THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index `+u+`. The geometry must have either an index or a position attribute`),null;c.addGroup(l,e,u),l+=e}}if(n){let t=0,n=[];for(let r=0;r<e.length;++r){let i=e[r].index;for(let e=0;e<i.count;++e)n.push(i.getX(e)+t);t+=e[r].attributes.position.count}c.setIndex(n)}for(let e in a){let t=cm(a[e]);if(!t)return console.error(`THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the `+e+` attribute.`),null;c.setAttribute(e,t)}for(let e in o){let t=o[e][0].length;if(t===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[e]=[];for(let n=0;n<t;++n){let t=[];for(let r=0;r<o[e].length;++r)t.push(o[e][r][n]);let r=cm(t);if(!r)return console.error(`THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the `+e+` morphAttribute.`),null;c.morphAttributes[e].push(r)}}return c}function cm(e){let t,n,r,i=-1,a=0;for(let o=0;o<e.length;++o){let s=e[o];if(t===void 0&&(t=s.array.constructor),t!==s.array.constructor)return console.error(`THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes.`),null;if(n===void 0&&(n=s.itemSize),n!==s.itemSize)return console.error(`THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes.`),null;if(r===void 0&&(r=s.normalized),r!==s.normalized)return console.error(`THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes.`),null;if(i===-1&&(i=s.gpuType),i!==s.gpuType)return console.error(`THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes.`),null;a+=s.count*n}let o=new t(a),s=new h(o,n,r),c=0;for(let t=0;t<e.length;++t){let r=e[t];if(r.isInterleavedBufferAttribute){let e=c/n;for(let t=0,i=r.count;t<i;t++)for(let i=0;i<n;i++){let n=r.getComponent(t,i);s.setComponent(t+e,i,n)}}else o.set(r.array,c);c+=r.count*n}return i!==void 0&&(s.gpuType=i),s}function lm(e){return e.isInstancedInterleavedBufferAttribute||e.isInterleavedBufferAttribute?dm(e):e.isInstancedBufferAttribute?new Qn().copy(e):new h().copy(e)}function um(e){let t,n=0,r=0;for(let i=0,a=e.length;i<a;++i){let a=e[i];if(t===void 0&&(t=a.array.constructor),t!==a.array.constructor)return console.error(`AttributeBuffers of different types cannot be interleaved`),null;n+=a.array.length,r+=a.itemSize}let i=new He(new t(n),r),a=0,o=[],s=[`getX`,`getY`,`getZ`,`getW`],c=[`setX`,`setY`,`setZ`,`setW`];for(let t=0,n=e.length;t<n;t++){let n=e[t],r=n.itemSize,l=n.count,u=new Ze(i,r,a,n.normalized);o.push(u),a+=r;for(let e=0;e<l;e++)for(let t=0;t<r;t++)u[c[t]](e,n[s[t]](e))}return o}function dm(e){let t=e.data.array.constructor,n=e.count,r=e.itemSize,i=e.normalized,a=new t(n*r),o;o=e.isInstancedInterleavedBufferAttribute?new Qn(a,r,i,e.meshPerAttribute):new h(a,r,i);for(let t=0;t<n;t++)o.setX(t,e.getX(t)),r>=2&&o.setY(t,e.getY(t)),r>=3&&o.setZ(t,e.getZ(t)),r>=4&&o.setW(t,e.getW(t));return o}function fm(e){let t=e.attributes,n=e.morphTargets,r=new Map;for(let e in t){let n=t[e];n.isInterleavedBufferAttribute&&(r.has(n)||r.set(n,dm(n)),t[e]=r.get(n))}for(let e in n){let t=n[e];t.isInterleavedBufferAttribute&&(r.has(t)||r.set(t,dm(t)),n[e]=r.get(t))}}function pm(e){let t=0;for(let n in e.attributes){let r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}let n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}function mm(e,t=1e-4){t=Math.max(t,2**-52);let n={},r=e.getIndex(),i=e.getAttribute(`position`),a=r?r.count:i.count,o=0,s=Object.keys(e.attributes),c={},l={},u=[],d=[`getX`,`getY`,`getZ`,`getW`],f=[`setX`,`setY`,`setZ`,`setW`];for(let t=0,n=s.length;t<n;t++){let n=s[t],r=e.attributes[n];c[n]=new r.constructor(new r.array.constructor(r.count*r.itemSize),r.itemSize,r.normalized);let i=e.morphAttributes[n];i&&(l[n]||(l[n]=[]),i.forEach((e,t)=>{let r=new e.array.constructor(e.count*e.itemSize);l[n][t]=new e.constructor(r,e.itemSize,e.normalized)}))}let p=t*.5,m=10**Math.log10(1/t),h=p*m;for(let t=0;t<a;t++){let i=r?r.getX(t):t,a=``;for(let t=0,n=s.length;t<n;t++){let n=s[t],r=e.getAttribute(n),o=r.itemSize;for(let e=0;e<o;e++)a+=`${~~(r[d[e]](i)*m+h)},`}if(a in n)u.push(n[a]);else{for(let t=0,n=s.length;t<n;t++){let n=s[t],r=e.getAttribute(n),a=e.morphAttributes[n],u=r.itemSize,p=c[n],m=l[n];for(let e=0;e<u;e++){let t=d[e],n=f[e];if(p[n](o,r[t](i)),a)for(let e=0,r=a.length;e<r;e++)m[e][n](o,a[e][t](i))}}n[a]=o,u.push(o),o++}}let g=e.clone();for(let t in e.attributes){let e=c[t];if(g.setAttribute(t,new e.constructor(e.array.slice(0,o*e.itemSize),e.itemSize,e.normalized)),t in l)for(let e=0;e<l[t].length;e++){let n=l[t][e];g.morphAttributes[t][e]=new n.constructor(n.array.slice(0,o*n.itemSize),n.itemSize,n.normalized)}}return g.setIndex(u),g}function hm(e,t){if(t===0)return console.warn(`THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles.`),e;if(t===2||t===1){let n=e.getIndex();if(n===null){let t=[],r=e.getAttribute(`position`);if(r!==void 0){for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}else return console.error(`THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.`),e}let r=n.count-2,i=[];if(t===2)for(let e=1;e<=r;e++)i.push(n.getX(0)),i.push(n.getX(e)),i.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(i.push(n.getX(e)),i.push(n.getX(e+1)),i.push(n.getX(e+2))):(i.push(n.getX(e+2)),i.push(n.getX(e+1)),i.push(n.getX(e)));i.length/3!==r&&console.error(`THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.`);let a=e.clone();return a.setIndex(i),a.clearGroups(),a}else return console.error(`THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:`,t),e}function gm(e){let t=new j,n=new j,r=new j,i=new j,a=new j,o=new j,s=new j,c=new j,l=new j;function u(e,u,d,f,p,m,h,g){t.fromBufferAttribute(u,p),n.fromBufferAttribute(u,m),r.fromBufferAttribute(u,h);let _=e.morphTargetInfluences;if(d&&_){s.set(0,0,0),c.set(0,0,0),l.set(0,0,0);for(let e=0,u=d.length;e<u;e++){let u=_[e],g=d[e];u!==0&&(i.fromBufferAttribute(g,p),a.fromBufferAttribute(g,m),o.fromBufferAttribute(g,h),f?(s.addScaledVector(i,u),c.addScaledVector(a,u),l.addScaledVector(o,u)):(s.addScaledVector(i.sub(t),u),c.addScaledVector(a.sub(n),u),l.addScaledVector(o.sub(r),u)))}t.add(s),n.add(c),r.add(l)}e.isSkinnedMesh&&(e.applyBoneTransform(p,t),e.applyBoneTransform(m,n),e.applyBoneTransform(h,r)),g[p*3+0]=t.x,g[p*3+1]=t.y,g[p*3+2]=t.z,g[m*3+0]=n.x,g[m*3+1]=n.y,g[m*3+2]=n.z,g[h*3+0]=r.x,g[h*3+1]=r.y,g[h*3+2]=r.z}let d=e.geometry,f=e.material,p,m,h,g=d.index,_=d.attributes.position,v=d.morphAttributes.position,y=d.morphTargetsRelative,b=d.attributes.normal,x=d.morphAttributes.position,S=d.groups,C=d.drawRange,w,T,E,D,O,ee,k,te=new Float32Array(_.count*_.itemSize),A=new Float32Array(b.count*b.itemSize);if(g!==null)if(Array.isArray(f))for(w=0,E=S.length;w<E;w++)for(O=S[w],ee=Math.max(O.start,C.start),k=Math.min(O.start+O.count,C.start+C.count),T=ee,D=k;T<D;T+=3)p=g.getX(T),m=g.getX(T+1),h=g.getX(T+2),u(e,_,v,y,p,m,h,te),u(e,b,x,y,p,m,h,A);else for(ee=Math.max(0,C.start),k=Math.min(g.count,C.start+C.count),w=ee,E=k;w<E;w+=3)p=g.getX(w),m=g.getX(w+1),h=g.getX(w+2),u(e,_,v,y,p,m,h,te),u(e,b,x,y,p,m,h,A);else if(Array.isArray(f))for(w=0,E=S.length;w<E;w++)for(O=S[w],ee=Math.max(O.start,C.start),k=Math.min(O.start+O.count,C.start+C.count),T=ee,D=k;T<D;T+=3)p=T,m=T+1,h=T+2,u(e,_,v,y,p,m,h,te),u(e,b,x,y,p,m,h,A);else for(ee=Math.max(0,C.start),k=Math.min(_.count,C.start+C.count),w=ee,E=k;w<E;w+=3)p=w,m=w+1,h=w+2,u(e,_,v,y,p,m,h,te),u(e,b,x,y,p,m,h,A);return{positionAttribute:_,normalAttribute:b,morphedPositionAttribute:new vn(te,3),morphedNormalAttribute:new vn(A,3)}}function _m(e){if(e.groups.length===0)return console.warn(`THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge.`),e;let t=e.groups;if(t=t.sort((e,t)=>e.materialIndex===t.materialIndex?e.start-t.start:e.materialIndex-t.materialIndex),e.getIndex()===null){let t=e.getAttribute(`position`),n=[];for(let e=0;e<t.count;e+=3)n.push(e,e+1,e+2);e.setIndex(n)}let n=e.getIndex(),r=[];for(let e=0;e<t.length;e++){let i=t[e],a=i.start,o=a+i.count;for(let e=a;e<o;e++)r.push(n.getX(e))}e.dispose(),e.setIndex(r);let i=0;for(let e=0;e<t.length;e++){let n=t[e];n.start=i,i+=n.count}let a=t[0];e.groups=[a];for(let n=1;n<t.length;n++){let r=t[n];a.materialIndex===r.materialIndex?a.count+=r.count:(a=r,e.groups.push(a))}return e}function vm(e,t=Math.PI/3){let n=Math.cos(t),r=1.0000000001*100,i=[new j,new j,new j],a=new j,o=new j,s=new j,c=new j;function l(e){return`${~~(e.x*r)},${~~(e.y*r)},${~~(e.z*r)}`}let u=e.index?e.toNonIndexed():e,d=u.attributes.position,f={};for(let e=0,t=d.count/3;e<t;e++){let t=3*e,n=i[0].fromBufferAttribute(d,t+0),r=i[1].fromBufferAttribute(d,t+1),s=i[2].fromBufferAttribute(d,t+2);a.subVectors(s,r),o.subVectors(n,r);let c=new j().crossVectors(a,o).normalize();for(let e=0;e<3;e++){let t=i[e],n=l(t);n in f||(f[n]=[]),f[n].push(c)}}let p=new h(new Float32Array(d.count*3),3,!1);for(let e=0,t=d.count/3;e<t;e++){let t=3*e,r=i[0].fromBufferAttribute(d,t+0),u=i[1].fromBufferAttribute(d,t+1),m=i[2].fromBufferAttribute(d,t+2);a.subVectors(m,u),o.subVectors(r,u),s.crossVectors(a,o).normalize();for(let e=0;e<3;e++){let r=i[e],a=f[l(r)];c.set(0,0,0);for(let e=0,t=a.length;e<t;e++){let t=a[e];s.dot(t)>n&&c.add(t)}c.normalize(),p.setXYZ(t+e,c.x,c.y,c.z)}}return u.setAttribute(`normal`,p),u}var R=(function(e){return typeof e==`function`?e:typeof e==`string`?function(t){return t[e]}:function(t){return e}});function ym(e){"@babel/helpers - typeof";return ym=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},ym(e)}var bm=/^\s+/,xm=/\s+$/;function Sm(e,t){if(e||=``,t||={},e instanceof Sm)return e;if(!(this instanceof Sm))return new Sm(e,t);var n=Cm(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}Sm.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t=e.r/255,n=e.g/255,r=e.b/255,i=t<=.03928?t/12.92:((t+.055)/1.055)**2.4,a=n<=.03928?n/12.92:((n+.055)/1.055)**2.4,o=r<=.03928?r/12.92:((r+.055)/1.055)**2.4;return .2126*i+.7152*a+.0722*o},setAlpha:function(e){return this._a=qm(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=Dm(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=Dm(this._r,this._g,this._b),t=Math.round(e.h*360),n=Math.round(e.s*100),r=Math.round(e.v*100);return this._a==1?`hsv(`+t+`, `+n+`%, `+r+`%)`:`hsva(`+t+`, `+n+`%, `+r+`%, `+this._roundA+`)`},toHsl:function(){var e=Tm(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=Tm(this._r,this._g,this._b),t=Math.round(e.h*360),n=Math.round(e.s*100),r=Math.round(e.l*100);return this._a==1?`hsl(`+t+`, `+n+`%, `+r+`%)`:`hsla(`+t+`, `+n+`%, `+r+`%, `+this._roundA+`)`},toHex:function(e){return km(this._r,this._g,this._b,e)},toHexString:function(e){return`#`+this.toHex(e)},toHex8:function(e){return Am(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return`#`+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?`rgb(`+Math.round(this._r)+`, `+Math.round(this._g)+`, `+Math.round(this._b)+`)`:`rgba(`+Math.round(this._r)+`, `+Math.round(this._g)+`, `+Math.round(this._b)+`, `+this._roundA+`)`},toPercentageRgb:function(){return{r:Math.round(Jm(this._r,255)*100)+`%`,g:Math.round(Jm(this._g,255)*100)+`%`,b:Math.round(Jm(this._b,255)*100)+`%`,a:this._a}},toPercentageRgbString:function(){return this._a==1?`rgb(`+Math.round(Jm(this._r,255)*100)+`%, `+Math.round(Jm(this._g,255)*100)+`%, `+Math.round(Jm(this._b,255)*100)+`%)`:`rgba(`+Math.round(Jm(this._r,255)*100)+`%, `+Math.round(Jm(this._g,255)*100)+`%, `+Math.round(Jm(this._b,255)*100)+`%, `+this._roundA+`)`},toName:function(){return this._a===0?`transparent`:this._a<1?!1:Gm[km(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t=`#`+jm(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?`GradientType = 1, `:``;if(e){var i=Sm(e);n=`#`+jm(i._r,i._g,i._b,i._a)}return`progid:DXImageTransform.Microsoft.gradient(`+r+`startColorstr=`+t+`,endColorstr=`+n+`)`},toString:function(e){var t=!!e;e||=this._format;var n=!1,r=this._a<1&&this._a>=0;return!t&&r&&(e===`hex`||e===`hex6`||e===`hex3`||e===`hex4`||e===`hex8`||e===`name`)?e===`name`&&this._a===0?this.toName():this.toRgbString():(e===`rgb`&&(n=this.toRgbString()),e===`prgb`&&(n=this.toPercentageRgbString()),(e===`hex`||e===`hex6`)&&(n=this.toHexString()),e===`hex3`&&(n=this.toHexString(!0)),e===`hex4`&&(n=this.toHex8String(!0)),e===`hex8`&&(n=this.toHex8String()),e===`name`&&(n=this.toName()),e===`hsl`&&(n=this.toHslString()),e===`hsv`&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return Sm(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(Fm,arguments)},brighten:function(){return this._applyModification(Im,arguments)},darken:function(){return this._applyModification(Lm,arguments)},desaturate:function(){return this._applyModification(Mm,arguments)},saturate:function(){return this._applyModification(Nm,arguments)},greyscale:function(){return this._applyModification(Pm,arguments)},spin:function(){return this._applyModification(Rm,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(Hm,arguments)},complement:function(){return this._applyCombination(zm,arguments)},monochromatic:function(){return this._applyCombination(Um,arguments)},splitcomplement:function(){return this._applyCombination(Vm,arguments)},triad:function(){return this._applyCombination(Bm,[3])},tetrad:function(){return this._applyCombination(Bm,[4])}},Sm.fromRatio=function(e,t){if(ym(e)==`object`){var n={};for(var r in e)e.hasOwnProperty(r)&&(r===`a`?n[r]=e[r]:n[r]=eh(e[r]));e=n}return Sm(e,t)};function Cm(e){var t={r:0,g:0,b:0},n=1,r=null,i=null,a=null,o=!1,s=!1;return typeof e==`string`&&(e=ah(e)),ym(e)==`object`&&(ih(e.r)&&ih(e.g)&&ih(e.b)?(t=wm(e.r,e.g,e.b),o=!0,s=String(e.r).substr(-1)===`%`?`prgb`:`rgb`):ih(e.h)&&ih(e.s)&&ih(e.v)?(r=eh(e.s),i=eh(e.v),t=Om(e.h,r,i),o=!0,s=`hsv`):ih(e.h)&&ih(e.s)&&ih(e.l)&&(r=eh(e.s),a=eh(e.l),t=Em(e.h,r,a),o=!0,s=`hsl`),e.hasOwnProperty(`a`)&&(n=e.a)),n=qm(n),{ok:o,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}function wm(e,t,n){return{r:Jm(e,255)*255,g:Jm(t,255)*255,b:Jm(n,255)*255}}function Tm(e,t,n){e=Jm(e,255),t=Jm(t,255),n=Jm(n,255);var r=Math.max(e,t,n),i=Math.min(e,t,n),a,o,s=(r+i)/2;if(r==i)a=o=0;else{var c=r-i;switch(o=s>.5?c/(2-r-i):c/(r+i),r){case e:a=(t-n)/c+(t<n?6:0);break;case t:a=(n-e)/c+2;break;case n:a=(e-t)/c+4;break}a/=6}return{h:a,s:o,l:s}}function Em(e,t,n){var r,i,a;e=Jm(e,360),t=Jm(t,100),n=Jm(n,100);function o(e,t,n){return n<0&&(n+=1),n>1&&--n,n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(t===0)r=i=a=n;else{var s=n<.5?n*(1+t):n+t-n*t,c=2*n-s;r=o(c,s,e+1/3),i=o(c,s,e),a=o(c,s,e-1/3)}return{r:r*255,g:i*255,b:a*255}}function Dm(e,t,n){e=Jm(e,255),t=Jm(t,255),n=Jm(n,255);var r=Math.max(e,t,n),i=Math.min(e,t,n),a,o,s=r,c=r-i;if(o=r===0?0:c/r,r==i)a=0;else{switch(r){case e:a=(t-n)/c+(t<n?6:0);break;case t:a=(n-e)/c+2;break;case n:a=(e-t)/c+4;break}a/=6}return{h:a,s:o,v:s}}function Om(e,t,n){e=Jm(e,360)*6,t=Jm(t,100),n=Jm(n,100);var r=Math.floor(e),i=e-r,a=n*(1-t),o=n*(1-i*t),s=n*(1-(1-i)*t),c=r%6,l=[n,o,a,a,s,n][c],u=[s,n,n,o,a,a][c],d=[a,a,s,n,n,o][c];return{r:l*255,g:u*255,b:d*255}}function km(e,t,n,r){var i=[$m(Math.round(e).toString(16)),$m(Math.round(t).toString(16)),$m(Math.round(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join(``)}function Am(e,t,n,r,i){var a=[$m(Math.round(e).toString(16)),$m(Math.round(t).toString(16)),$m(Math.round(n).toString(16)),$m(th(r))];return i&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join(``)}function jm(e,t,n,r){return[$m(th(r)),$m(Math.round(e).toString(16)),$m(Math.round(t).toString(16)),$m(Math.round(n).toString(16))].join(``)}Sm.equals=function(e,t){return!e||!t?!1:Sm(e).toRgbString()==Sm(t).toRgbString()},Sm.random=function(){return Sm.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function Mm(e,t){t=t===0?0:t||10;var n=Sm(e).toHsl();return n.s-=t/100,n.s=Ym(n.s),Sm(n)}function Nm(e,t){t=t===0?0:t||10;var n=Sm(e).toHsl();return n.s+=t/100,n.s=Ym(n.s),Sm(n)}function Pm(e){return Sm(e).desaturate(100)}function Fm(e,t){t=t===0?0:t||10;var n=Sm(e).toHsl();return n.l+=t/100,n.l=Ym(n.l),Sm(n)}function Im(e,t){t=t===0?0:t||10;var n=Sm(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(t/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(t/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(t/100)))),Sm(n)}function Lm(e,t){t=t===0?0:t||10;var n=Sm(e).toHsl();return n.l-=t/100,n.l=Ym(n.l),Sm(n)}function Rm(e,t){var n=Sm(e).toHsl(),r=(n.h+t)%360;return n.h=r<0?360+r:r,Sm(n)}function zm(e){var t=Sm(e).toHsl();return t.h=(t.h+180)%360,Sm(t)}function Bm(e,t){if(isNaN(t)||t<=0)throw Error(`Argument to polyad must be a positive number`);for(var n=Sm(e).toHsl(),r=[Sm(e)],i=360/t,a=1;a<t;a++)r.push(Sm({h:(n.h+a*i)%360,s:n.s,l:n.l}));return r}function Vm(e){var t=Sm(e).toHsl(),n=t.h;return[Sm(e),Sm({h:(n+72)%360,s:t.s,l:t.l}),Sm({h:(n+216)%360,s:t.s,l:t.l})]}function Hm(e,t,n){t||=6,n||=30;var r=Sm(e).toHsl(),i=360/n,a=[Sm(e)];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,a.push(Sm(r));return a}function Um(e,t){t||=6;for(var n=Sm(e).toHsv(),r=n.h,i=n.s,a=n.v,o=[],s=1/t;t--;)o.push(Sm({h:r,s:i,v:a})),a=(a+s)%1;return o}Sm.mix=function(e,t,n){n=n===0?0:n||50;var r=Sm(e).toRgb(),i=Sm(t).toRgb(),a=n/100;return Sm({r:(i.r-r.r)*a+r.r,g:(i.g-r.g)*a+r.g,b:(i.b-r.b)*a+r.b,a:(i.a-r.a)*a+r.a})},Sm.readability=function(e,t){var n=Sm(e),r=Sm(t);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},Sm.isReadable=function(e,t,n){var r=Sm.readability(e,t),i,a=!1;switch(i=oh(n),i.level+i.size){case`AAsmall`:case`AAAlarge`:a=r>=4.5;break;case`AAlarge`:a=r>=3;break;case`AAAsmall`:a=r>=7;break}return a},Sm.mostReadable=function(e,t,n){var r=null,i=0,a,o,s,c;n||={},o=n.includeFallbackColors,s=n.level,c=n.size;for(var l=0;l<t.length;l++)a=Sm.readability(e,t[l]),a>i&&(i=a,r=Sm(t[l]));return Sm.isReadable(e,r,{level:s,size:c})||!o?r:(n.includeFallbackColors=!1,Sm.mostReadable(e,[`#fff`,`#000`],n))};var Wm=Sm.names={aliceblue:`f0f8ff`,antiquewhite:`faebd7`,aqua:`0ff`,aquamarine:`7fffd4`,azure:`f0ffff`,beige:`f5f5dc`,bisque:`ffe4c4`,black:`000`,blanchedalmond:`ffebcd`,blue:`00f`,blueviolet:`8a2be2`,brown:`a52a2a`,burlywood:`deb887`,burntsienna:`ea7e5d`,cadetblue:`5f9ea0`,chartreuse:`7fff00`,chocolate:`d2691e`,coral:`ff7f50`,cornflowerblue:`6495ed`,cornsilk:`fff8dc`,crimson:`dc143c`,cyan:`0ff`,darkblue:`00008b`,darkcyan:`008b8b`,darkgoldenrod:`b8860b`,darkgray:`a9a9a9`,darkgreen:`006400`,darkgrey:`a9a9a9`,darkkhaki:`bdb76b`,darkmagenta:`8b008b`,darkolivegreen:`556b2f`,darkorange:`ff8c00`,darkorchid:`9932cc`,darkred:`8b0000`,darksalmon:`e9967a`,darkseagreen:`8fbc8f`,darkslateblue:`483d8b`,darkslategray:`2f4f4f`,darkslategrey:`2f4f4f`,darkturquoise:`00ced1`,darkviolet:`9400d3`,deeppink:`ff1493`,deepskyblue:`00bfff`,dimgray:`696969`,dimgrey:`696969`,dodgerblue:`1e90ff`,firebrick:`b22222`,floralwhite:`fffaf0`,forestgreen:`228b22`,fuchsia:`f0f`,gainsboro:`dcdcdc`,ghostwhite:`f8f8ff`,gold:`ffd700`,goldenrod:`daa520`,gray:`808080`,green:`008000`,greenyellow:`adff2f`,grey:`808080`,honeydew:`f0fff0`,hotpink:`ff69b4`,indianred:`cd5c5c`,indigo:`4b0082`,ivory:`fffff0`,khaki:`f0e68c`,lavender:`e6e6fa`,lavenderblush:`fff0f5`,lawngreen:`7cfc00`,lemonchiffon:`fffacd`,lightblue:`add8e6`,lightcoral:`f08080`,lightcyan:`e0ffff`,lightgoldenrodyellow:`fafad2`,lightgray:`d3d3d3`,lightgreen:`90ee90`,lightgrey:`d3d3d3`,lightpink:`ffb6c1`,lightsalmon:`ffa07a`,lightseagreen:`20b2aa`,lightskyblue:`87cefa`,lightslategray:`789`,lightslategrey:`789`,lightsteelblue:`b0c4de`,lightyellow:`ffffe0`,lime:`0f0`,limegreen:`32cd32`,linen:`faf0e6`,magenta:`f0f`,maroon:`800000`,mediumaquamarine:`66cdaa`,mediumblue:`0000cd`,mediumorchid:`ba55d3`,mediumpurple:`9370db`,mediumseagreen:`3cb371`,mediumslateblue:`7b68ee`,mediumspringgreen:`00fa9a`,mediumturquoise:`48d1cc`,mediumvioletred:`c71585`,midnightblue:`191970`,mintcream:`f5fffa`,mistyrose:`ffe4e1`,moccasin:`ffe4b5`,navajowhite:`ffdead`,navy:`000080`,oldlace:`fdf5e6`,olive:`808000`,olivedrab:`6b8e23`,orange:`ffa500`,orangered:`ff4500`,orchid:`da70d6`,palegoldenrod:`eee8aa`,palegreen:`98fb98`,paleturquoise:`afeeee`,palevioletred:`db7093`,papayawhip:`ffefd5`,peachpuff:`ffdab9`,peru:`cd853f`,pink:`ffc0cb`,plum:`dda0dd`,powderblue:`b0e0e6`,purple:`800080`,rebeccapurple:`663399`,red:`f00`,rosybrown:`bc8f8f`,royalblue:`4169e1`,saddlebrown:`8b4513`,salmon:`fa8072`,sandybrown:`f4a460`,seagreen:`2e8b57`,seashell:`fff5ee`,sienna:`a0522d`,silver:`c0c0c0`,skyblue:`87ceeb`,slateblue:`6a5acd`,slategray:`708090`,slategrey:`708090`,snow:`fffafa`,springgreen:`00ff7f`,steelblue:`4682b4`,tan:`d2b48c`,teal:`008080`,thistle:`d8bfd8`,tomato:`ff6347`,turquoise:`40e0d0`,violet:`ee82ee`,wheat:`f5deb3`,white:`fff`,whitesmoke:`f5f5f5`,yellow:`ff0`,yellowgreen:`9acd32`},Gm=Sm.hexNames=Km(Wm);function Km(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function qm(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function Jm(e,t){Zm(e)&&(e=`100%`);var n=Qm(e);return e=Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function Ym(e){return Math.min(1,Math.max(0,e))}function Xm(e){return parseInt(e,16)}function Zm(e){return typeof e==`string`&&e.indexOf(`.`)!=-1&&parseFloat(e)===1}function Qm(e){return typeof e==`string`&&e.indexOf(`%`)!=-1}function $m(e){return e.length==1?`0`+e:``+e}function eh(e){return e<=1&&(e=e*100+`%`),e}function th(e){return Math.round(parseFloat(e)*255).toString(16)}function nh(e){return Xm(e)/255}var rh=function(){var e=`(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)`,t=`[\\s|\\(]+(`+e+`)[,|\\s]+(`+e+`)[,|\\s]+(`+e+`)\\s*\\)?`,n=`[\\s|\\(]+(`+e+`)[,|\\s]+(`+e+`)[,|\\s]+(`+e+`)[,|\\s]+(`+e+`)\\s*\\)?`;return{CSS_UNIT:new RegExp(e),rgb:RegExp(`rgb`+t),rgba:RegExp(`rgba`+n),hsl:RegExp(`hsl`+t),hsla:RegExp(`hsla`+n),hsv:RegExp(`hsv`+t),hsva:RegExp(`hsva`+n),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function ih(e){return!!rh.CSS_UNIT.exec(e)}function ah(e){e=e.replace(bm,``).replace(xm,``).toLowerCase();var t=!1;if(Wm[e])e=Wm[e],t=!0;else if(e==`transparent`)return{r:0,g:0,b:0,a:0,format:`name`};var n;return(n=rh.rgb.exec(e))?{r:n[1],g:n[2],b:n[3]}:(n=rh.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=rh.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=rh.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=rh.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=rh.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=rh.hex8.exec(e))?{r:Xm(n[1]),g:Xm(n[2]),b:Xm(n[3]),a:nh(n[4]),format:t?`name`:`hex8`}:(n=rh.hex6.exec(e))?{r:Xm(n[1]),g:Xm(n[2]),b:Xm(n[3]),format:t?`name`:`hex`}:(n=rh.hex4.exec(e))?{r:Xm(n[1]+``+n[1]),g:Xm(n[2]+``+n[2]),b:Xm(n[3]+``+n[3]),a:nh(n[4]+``+n[4]),format:t?`name`:`hex8`}:(n=rh.hex3.exec(e))?{r:Xm(n[1]+``+n[1]),g:Xm(n[2]+``+n[2]),b:Xm(n[3]+``+n[3]),format:t?`name`:`hex`}:!1}function oh(e){var t,n;return e||={level:`AA`,size:`small`},t=(e.level||`AA`).toUpperCase(),n=(e.size||`small`).toLowerCase(),t!==`AA`&&t!==`AAA`&&(t=`AA`),n!==`small`&&n!==`large`&&(n=`small`),{level:t,size:n}}function sh(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ch(e){if(Array.isArray(e))return e}function lh(e){if(Array.isArray(e))return sh(e)}function uh(e,t,n){if(typeof e==`function`?e===t:e.has(t))return arguments.length<3?t:n;throw TypeError(`Private element is not present on this object`)}function dh(e,t){if(t.has(e))throw TypeError(`Cannot initialize the same private elements twice on an object`)}function fh(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function ph(e,t){return e.get(uh(e,t))}function mh(e,t,n){dh(e,t),t.set(e,n)}function hh(e,t,n){return e.set(uh(e,t),n),n}function gh(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,Th(r.key),r)}}function _h(e,t,n){return t&&gh(e.prototype,t),Object.defineProperty(e,`prototype`,{writable:!1}),e}function vh(e){if(typeof Symbol<`u`&&e[Symbol.iterator]!=null||e[`@@iterator`]!=null)return Array.from(e)}function yh(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t!==0)for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function bh(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xh(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sh(e,t){return ch(e)||yh(e,t)||Eh(e,t)||bh()}function Ch(e){return lh(e)||vh(e)||Eh(e)||xh()}function wh(e,t){if(typeof e!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return String(e)}function Th(e){var t=wh(e,`string`);return typeof t==`symbol`?t:t+``}function Eh(e,t){if(e){if(typeof e==`string`)return sh(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?sh(e,t):void 0}}var Dh=new WeakMap,Oh=new WeakMap,kh=new WeakMap,Ah=new WeakMap,jh=new WeakMap,Mh=new WeakMap,Nh=function(){function e(){fh(this,e),mh(this,Dh,new Map),mh(this,Oh,new Map),mh(this,kh,function(e){return e}),mh(this,Ah,function(){return{}}),mh(this,jh,function(){}),mh(this,Mh,function(){})}return _h(e,[{key:`getObj`,value:function(e){return ph(Dh,this).get(ph(kh,this).call(this,e))}},{key:`getData`,value:function(e){return ph(Oh,this).get(e)}},{key:`entries`,value:function(){return Ch(ph(Oh,this).entries()).map(function(e){var t=Sh(e,2),n=t[0];return[t[1],n]})}},{key:`id`,value:function(e){return hh(kh,this,R(e)),this}},{key:`onCreateObj`,value:function(e){return hh(Ah,this,e),this}},{key:`onUpdateObj`,value:function(e){return hh(jh,this,e),this}},{key:`onRemoveObj`,value:function(e){return hh(Mh,this,e),this}},{key:`digest`,value:function(e){var t=this;e.filter(function(e){return!ph(Dh,t).has(ph(kh,t).call(t,e))}).forEach(function(e){var n=ph(Ah,t).call(t,e);ph(Dh,t).set(ph(kh,t).call(t,e),n),ph(Oh,t).set(n,e)});var n=new Map(e.map(function(e){return[ph(kh,t).call(t,e),e]}));return ph(Dh,this).forEach(function(e,r){n.has(r)?ph(jh,t).call(t,e,n.get(r)):(ph(Mh,t).call(t,e,r),ph(Dh,t).delete(r),ph(Oh,t).delete(e))}),this}},{key:`clear`,value:function(){return this.digest([]),this}}])}(),Ph=t(Ut(((e,t)=>{(function(n,r){typeof e==`object`&&typeof t==`object`?t.exports=r():typeof define==`function`&&define.amd?define(`FrameTicker`,[],r):typeof e==`object`?e.FrameTicker=r():n.FrameTicker=r()})(e,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p=``,t(0)}([function(e,t,n){var r=n(1),i=function(){function e(e,t,n){e===void 0&&(e=NaN),t===void 0&&(t=NaN),n===void 0&&(n=!1),this._minFPS=t,this._maxFPS=e,this._timeScale=1,this._currentTick=0,this._currentTime=0,this._tickDeltaTime=0,this._isRunning=!1,this._maxInterval=isNaN(this._minFPS)?NaN:1e3/this._minFPS,this._minInterval=isNaN(this._maxFPS)?NaN:1e3/this._maxFPS,this._onResume=new r.default,this._onPause=new r.default,this._onTick=new r.default,this._onTickOncePerFrame=new r.default,n||this.resume()}return e.prototype.updateOnce=function(e){e(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},e.prototype.resume=function(){this._isRunning||(this._isRunning=!0,this._lastTimeUpdated=this.getTimer(),this._onResume.dispatch(),this.animateOnce())},e.prototype.pause=function(){this._isRunning&&(this._isRunning=!1,this._onPause.dispatch(),window.cancelAnimationFrame(this._animationFrameHandle))},e.prototype.dispose=function(){this.pause(),this._onResume.removeAll(),this._onPause.removeAll(),this._onTick.removeAll()},Object.defineProperty(e.prototype,`currentTick`,{get:function(){return this._currentTick},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,`currentTimeSeconds`,{get:function(){return this._currentTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,`tickDeltaTimeSeconds`,{get:function(){return this._tickDeltaTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,`timeScale`,{get:function(){return this._timeScale},set:function(e){this._timeScale!==e&&(this._timeScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,`onResume`,{get:function(){return this._onResume},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,`onPause`,{get:function(){return this._onPause},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,`onTick`,{get:function(){return this._onTick},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,`onTickOncePerFrame`,{get:function(){return this._onTickOncePerFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,`isRunning`,{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),e.prototype.animateOnce=function(){var e=this;this._animationFrameHandle=window.requestAnimationFrame(function(){return e.onFrame()})},e.prototype.onFrame=function(){if(this._now=this.getTimer(),this._frameDeltaTime=this._now-this._lastTimeUpdated,isNaN(this._minInterval)||this._frameDeltaTime>=this._minInterval)if(isNaN(this._maxInterval))this.update(this._frameDeltaTime*this._timeScale,!0),this._lastTimeUpdated=this._now;else for(this._interval=Math.min(this._frameDeltaTime,this._maxInterval);this._now>=this._lastTimeUpdated+this._interval;)this.update(this._interval*this._timeScale,this._now<=this._lastTimeUpdated+2*this._maxInterval),this._lastTimeUpdated+=this._interval;this._isRunning&&this.animateOnce()},e.prototype.update=function(e,t){t===void 0&&(t=!0),this._currentTick++,this._currentTime+=e,this._tickDeltaTime=e,this._onTick.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick),t&&this._onTickOncePerFrame.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},e.prototype.getTimer=function(){return Date.now()},e}();Object.defineProperty(t,`__esModule`,{value:!0}),t.default=i},function(e,t,n){(function(t,n){e.exports=n()})(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p=``,t(0)}([function(e,t){var n=function(){function e(){this.functions=[]}return e.prototype.add=function(e){return this.functions.indexOf(e)===-1&&(this.functions.push(e),!0)},e.prototype.remove=function(e){var t=this.functions.indexOf(e);return t>-1&&(this.functions.splice(t,1),!0)},e.prototype.removeAll=function(){return this.functions.length>0&&(this.functions.length=0,!0)},e.prototype.dispatch=function(){var e=[...arguments];this.functions.concat().forEach(function(t){t.apply(void 0,e)})},Object.defineProperty(e.prototype,`numItems`,{get:function(){return this.functions.length},enumerable:!0,configurable:!0}),e}();Object.defineProperty(t,`__esModule`,{value:!0}),t.default=n}])})}])})}))(),1);const Fh=11102230246251565e-32,Ih=134217729;(3+8*Fh)*Fh;function Lh(e,t,n,r,i){let a,o,s,c,l=t[0],u=r[0],d=0,f=0;u>l==u>-l?(a=l,l=t[++d]):(a=u,u=r[++f]);let p=0;if(d<e&&f<n)for(u>l==u>-l?(o=l+a,s=a-(o-l),l=t[++d]):(o=u+a,s=a-(o-u),u=r[++f]),a=o,s!==0&&(i[p++]=s);d<e&&f<n;)u>l==u>-l?(o=a+l,c=o-a,s=a-(o-c)+(l-c),l=t[++d]):(o=a+u,c=o-a,s=a-(o-c)+(u-c),u=r[++f]),a=o,s!==0&&(i[p++]=s);for(;d<e;)o=a+l,c=o-a,s=a-(o-c)+(l-c),l=t[++d],a=o,s!==0&&(i[p++]=s);for(;f<n;)o=a+u,c=o-a,s=a-(o-c)+(u-c),u=r[++f],a=o,s!==0&&(i[p++]=s);return(a!==0||p===0)&&(i[p++]=a),p}function Rh(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}function z(e){return new Float64Array(e)}var zh=(3+16*Fh)*Fh,Bh=(2+12*Fh)*Fh,Vh=(9+64*Fh)*Fh*Fh,Hh=z(4),Uh=z(8),Wh=z(12),Gh=z(16),Kh=z(4);function qh(e,t,n,r,i,a,o){let s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,T=e-i,E=n-i,D=t-a,O=r-a;b=T*O,f=Ih*T,p=f-(f-T),m=T-p,f=Ih*O,h=f-(f-O),g=O-h,x=m*g-(b-p*h-m*h-p*g),S=D*E,f=Ih*D,p=f-(f-D),m=D-p,f=Ih*E,h=f-(f-E),g=E-h,C=m*g-(S-p*h-m*h-p*g),_=x-C,d=x-_,Hh[0]=x-(_+d)+(d-C),v=b+_,d=v-b,y=b-(v-d)+(_-d),_=y-S,d=y-_,Hh[1]=y-(_+d)+(d-S),w=v+_,d=w-v,Hh[2]=v-(w-d)+(_-d),Hh[3]=w;let ee=Rh(4,Hh),k=Bh*o;if(ee>=k||-ee>=k||(d=e-T,s=e-(T+d)+(d-i),d=n-E,l=n-(E+d)+(d-i),d=t-D,c=t-(D+d)+(d-a),d=r-O,u=r-(O+d)+(d-a),s===0&&c===0&&l===0&&u===0)||(k=Vh*o+33306690738754706e-32*Math.abs(ee),ee+=T*u+O*s-(D*l+E*c),ee>=k||-ee>=k))return ee;b=s*O,f=Ih*s,p=f-(f-s),m=s-p,f=Ih*O,h=f-(f-O),g=O-h,x=m*g-(b-p*h-m*h-p*g),S=c*E,f=Ih*c,p=f-(f-c),m=c-p,f=Ih*E,h=f-(f-E),g=E-h,C=m*g-(S-p*h-m*h-p*g),_=x-C,d=x-_,Kh[0]=x-(_+d)+(d-C),v=b+_,d=v-b,y=b-(v-d)+(_-d),_=y-S,d=y-_,Kh[1]=y-(_+d)+(d-S),w=v+_,d=w-v,Kh[2]=v-(w-d)+(_-d),Kh[3]=w;let te=Lh(4,Hh,4,Kh,Uh);b=T*u,f=Ih*T,p=f-(f-T),m=T-p,f=Ih*u,h=f-(f-u),g=u-h,x=m*g-(b-p*h-m*h-p*g),S=D*l,f=Ih*D,p=f-(f-D),m=D-p,f=Ih*l,h=f-(f-l),g=l-h,C=m*g-(S-p*h-m*h-p*g),_=x-C,d=x-_,Kh[0]=x-(_+d)+(d-C),v=b+_,d=v-b,y=b-(v-d)+(_-d),_=y-S,d=y-_,Kh[1]=y-(_+d)+(d-S),w=v+_,d=w-v,Kh[2]=v-(w-d)+(_-d),Kh[3]=w;let A=Lh(te,Uh,4,Kh,Wh);return b=s*u,f=Ih*s,p=f-(f-s),m=s-p,f=Ih*u,h=f-(f-u),g=u-h,x=m*g-(b-p*h-m*h-p*g),S=c*l,f=Ih*c,p=f-(f-c),m=c-p,f=Ih*l,h=f-(f-l),g=l-h,C=m*g-(S-p*h-m*h-p*g),_=x-C,d=x-_,Kh[0]=x-(_+d)+(d-C),v=b+_,d=v-b,y=b-(v-d)+(_-d),_=y-S,d=y-_,Kh[1]=y-(_+d)+(d-S),w=v+_,d=w-v,Kh[2]=v-(w-d)+(_-d),Kh[3]=w,Gh[Lh(A,Wh,4,Kh,Gh)-1]}function Jh(e,t,n,r,i,a){let o=(t-a)*(n-i),s=(e-i)*(r-a),c=o-s,l=Math.abs(o+s);return Math.abs(c)>=zh*l?c:-qh(e,t,n,r,i,a,l)}(7+56*Fh)*Fh,(3+28*Fh)*Fh,(26+288*Fh)*Fh*Fh,z(4),z(4),z(4),z(4),z(4),z(4),z(4),z(4),z(4),z(8),z(8),z(8),z(4),z(8),z(8),z(8),z(12),z(192),z(192),(10+96*Fh)*Fh,(4+48*Fh)*Fh,(44+576*Fh)*Fh*Fh,z(4),z(4),z(4),z(4),z(4),z(4),z(4),z(4),z(8),z(8),z(8),z(8),z(8),z(8),z(8),z(8),z(8),z(4),z(4),z(4),z(8),z(16),z(16),z(16),z(32),z(32),z(48),z(64),z(1152),z(1152),(16+224*Fh)*Fh,(5+72*Fh)*Fh,(71+1408*Fh)*Fh*Fh,z(4),z(4),z(4),z(4),z(4),z(4),z(4),z(4),z(4),z(4),z(24),z(24),z(24),z(24),z(24),z(24),z(24),z(24),z(24),z(24),z(1152),z(1152),z(1152),z(1152),z(1152),z(2304),z(2304),z(3456),z(5760),z(8),z(8),z(8),z(16),z(24),z(48),z(48),z(96),z(192),z(384),z(384),z(384),z(768),z(96),z(96),z(96),z(1152);var Yh=2**-52,Xh=new Uint32Array(512),Zh=class e{static from(t,n=ag,r=og){let i=t.length,a=new Float64Array(i*2);for(let e=0;e<i;e++){let i=t[e];a[2*e]=n(i),a[2*e+1]=r(i)}return new e(a)}constructor(e){let t=e.length>>1;if(t>0&&typeof e[0]!=`number`)throw Error(`Expected coords to contain numbers.`);this.coords=e;let n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){let{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1,o=1/0,s=1/0,c=-1/0,l=-1/0;for(let t=0;t<a;t++){let n=e[2*t],r=e[2*t+1];n<o&&(o=n),r<s&&(s=r),n>c&&(c=n),r>l&&(l=r),this._ids[t]=t}let u=(o+c)/2,d=(s+l)/2,f,p,m;for(let t=0,n=1/0;t<a;t++){let r=$h(u,d,e[2*t],e[2*t+1]);r<n&&(f=t,n=r)}let h=e[2*f],g=e[2*f+1];for(let t=0,n=1/0;t<a;t++){if(t===f)continue;let r=$h(h,g,e[2*t],e[2*t+1]);r<n&&r>0&&(p=t,n=r)}let _=e[2*p],v=e[2*p+1],y=1/0;for(let t=0;t<a;t++){if(t===f||t===p)continue;let n=tg(h,g,_,v,e[2*t],e[2*t+1]);n<y&&(m=t,y=n)}let b=e[2*m],x=e[2*m+1];if(y===1/0){for(let t=0;t<a;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];rg(this._ids,this._dists,0,a-1);let t=new Uint32Array(a),n=0;for(let e=0,r=-1/0;e<a;e++){let i=this._ids[e],a=this._dists[i];a>r&&(t[n++]=i,r=a)}this.hull=t.subarray(0,n),this.triangles=new Uint32Array,this.halfedges=new Uint32Array;return}if(Jh(h,g,_,v,b,x)<0){let e=p,t=_,n=v;p=m,_=b,v=x,m=e,b=t,x=n}let S=ng(h,g,_,v,b,x);this._cx=S.x,this._cy=S.y;for(let t=0;t<a;t++)this._dists[t]=$h(e[2*t],e[2*t+1],S.x,S.y);rg(this._ids,this._dists,0,a-1),this._hullStart=f;let C=3;n[f]=t[m]=p,n[p]=t[f]=m,n[m]=t[p]=f,r[f]=0,r[p]=1,r[m]=2,i.fill(-1),i[this._hashKey(h,g)]=f,i[this._hashKey(_,v)]=p,i[this._hashKey(b,x)]=m,this.trianglesLen=0,this._addTriangle(f,p,m,-1,-1,-1);for(let a=0,o,s;a<this._ids.length;a++){let c=this._ids[a],l=e[2*c],u=e[2*c+1];if(a>0&&Math.abs(l-o)<=Yh&&Math.abs(u-s)<=Yh||(o=l,s=u,c===f||c===p||c===m))continue;let d=0;for(let e=0,t=this._hashKey(l,u);e<this._hashSize&&(d=i[(t+e)%this._hashSize],!(d!==-1&&d!==n[d]));e++);d=t[d];let h=d,g;for(;g=n[h],Jh(l,u,e[2*h],e[2*h+1],e[2*g],e[2*g+1])>=0;)if(h=g,h===d){h=-1;break}if(h===-1)continue;let _=this._addTriangle(h,c,n[h],-1,-1,r[h]);r[c]=this._legalize(_+2),r[h]=_,C++;let v=n[h];for(;g=n[v],Jh(l,u,e[2*v],e[2*v+1],e[2*g],e[2*g+1])<0;)_=this._addTriangle(v,c,g,r[c],-1,r[v]),r[c]=this._legalize(_+2),n[v]=v,C--,v=g;if(h===d)for(;g=t[h],Jh(l,u,e[2*g],e[2*g+1],e[2*h],e[2*h+1])<0;)_=this._addTriangle(g,c,h,-1,r[h],r[g]),this._legalize(_+2),r[g]=_,n[h]=h,C--,h=g;this._hullStart=t[c]=h,n[h]=t[v]=c,n[c]=v,i[this._hashKey(l,u)]=c,i[this._hashKey(e[2*h],e[2*h+1])]=h}this.hull=new Uint32Array(C);for(let e=0,t=this._hullStart;e<C;e++)this.hull[e]=t,t=n[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(Qh(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){let{_triangles:t,_halfedges:n,coords:r}=this,i=0,a=0;for(;;){let o=n[e],s=e-e%3;if(a=s+(e+2)%3,o===-1){if(i===0)break;e=Xh[--i];continue}let c=o-o%3,l=s+(e+1)%3,u=c+(o+2)%3,d=t[a],f=t[e],p=t[l],m=t[u];if(eg(r[2*d],r[2*d+1],r[2*f],r[2*f+1],r[2*p],r[2*p+1],r[2*m],r[2*m+1])){t[e]=m,t[o]=d;let r=n[u];if(r===-1){let t=this._hullStart;do{if(this._hullTri[t]===u){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[a]),this._link(a,u);let s=c+(o+1)%3;i<Xh.length&&(Xh[i++]=s)}else{if(i===0)break;e=Xh[--i]}}return a}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){let o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}};function Qh(e,t){let n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function $h(e,t,n,r){let i=e-n,a=t-r;return i*i+a*a}function eg(e,t,n,r,i,a,o,s){let c=e-o,l=t-s,u=n-o,d=r-s,f=i-o,p=a-s,m=c*c+l*l,h=u*u+d*d,g=f*f+p*p;return c*(d*g-h*p)-l*(u*g-h*f)+m*(u*p-d*f)<0}function tg(e,t,n,r,i,a){let o=n-e,s=r-t,c=i-e,l=a-t,u=o*o+s*s,d=c*c+l*l,f=.5/(o*l-s*c),p=(l*u-s*d)*f,m=(o*d-c*u)*f;return p*p+m*m}function ng(e,t,n,r,i,a){let o=n-e,s=r-t,c=i-e,l=a-t,u=o*o+s*s,d=c*c+l*l,f=.5/(o*l-s*c);return{x:e+(l*u-s*d)*f,y:t+(o*d-c*u)*f}}function rg(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){let r=e[i],a=t[r],o=i-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+r>>1,a=n+1,o=r;ig(e,i,a),t[e[n]]>t[e[r]]&&ig(e,n,r),t[e[a]]>t[e[r]]&&ig(e,a,r),t[e[n]]>t[e[a]]&&ig(e,n,a);let s=e[a],c=t[s];for(;;){do a++;while(t[e[a]]<c);do o--;while(t[e[o]]>c);if(o<a)break;ig(e,a,o)}e[n+1]=e[o],e[o]=s,r-a+1>=o-n?(rg(e,t,a,r),rg(e,t,n,o-1)):(rg(e,t,n,o-1),rg(e,t,a,r))}}function ig(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function ag(e){return e[0]}function og(e){return e[1]}function sg(e,t){var n,r,i=0,a,o,s,c,l,u,d,f=e[0],p=e[1],m=t.length;for(n=0;n<m;n++){r=0;var h=t[n],g=h.length-1;if(u=h[0],u[0]!==h[g][0]&&u[1]!==h[g][1])throw Error(`First and last coordinates in a ring must be the same`);for(o=u[0]-f,s=u[1]-p;r<g;r++){if(d=h[r+1],c=d[0]-f,l=d[1]-p,s===0&&l===0){if(c<=0&&o>=0||o<=0&&c>=0)return 0}else if(l>=0&&s<=0||l<=0&&s>=0){if(a=Jh(o,c,s,l,0,0),a===0)return 0;(a>0&&l>0&&s<=0||a<0&&l<=0&&s>0)&&i++}u=d,s=l,o=c}}return i%2!=0}function cg(e){if(!e)throw Error(`coord is required`);if(!Array.isArray(e)){if(e.type===`Feature`&&e.geometry!==null&&e.geometry.type===`Point`)return[...e.geometry.coordinates];if(e.type===`Point`)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw Error(`coord must be GeoJSON Point or an Array of numbers`)}function lg(e){return e.type===`Feature`?e.geometry:e}function ug(e,t,n={}){if(!e)throw Error(`point is required`);if(!t)throw Error(`polygon is required`);let r=cg(e),i=lg(t),a=i.type,o=t.bbox,s=i.coordinates;if(o&&dg(r,o)===!1)return!1;a===`Polygon`&&(s=[s]);let c=!1;for(var l=0;l<s.length;++l){let e=sg(r,s[l]);if(e===0)return!n.ignoreBoundary;e&&(c=!0)}return c}function dg(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}var fg=ug,pg=1e-6,mg=class{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=``}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+=`Z`)}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){e=+e,t=+t,n=+n;let r=e+n,i=t;if(n<0)throw Error(`negative radius`);this._x1===null?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>pg||Math.abs(this._y1-i)>pg)&&(this._+=`L`+r+`,`+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}},hg=class{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}},gg=class{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t))||!((i=+i)>=(n=+n)))throw Error(`invalid bounds`);this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){let{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this,i,a,o=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let r=0,s=0,c=n.length,l,u;r<c;r+=3,s+=2){let c=n[r]*2,d=n[r+1]*2,f=n[r+2]*2,p=e[c],m=e[c+1],h=e[d],g=e[d+1],_=e[f],v=e[f+1],y=h-p,b=g-m,x=_-p,S=v-m,C=(y*S-b*x)*2;if(Math.abs(C)<1e-9){if(i===void 0){i=a=0;for(let n of t)i+=e[n*2],a+=e[n*2+1];i/=t.length,a/=t.length}let n=1e9*Math.sign((i-p)*S-(a-m)*x);l=(p+_)/2-n*S,u=(m+v)/2+n*x}else{let e=1/C,t=y*y+b*b,n=x*x+S*S;l=p+(S*t-b*n)*e,u=m+(y*n-x*t)*e}o[s]=l,o[s+1]=u}let s=t[t.length-1],c,l=s*4,u,d=e[2*s],f,p=e[2*s+1];r.fill(0);for(let n=0;n<t.length;++n)s=t[n],c=l,u=d,f=p,l=s*4,d=e[2*s],p=e[2*s+1],r[c+2]=r[l]=f-p,r[c+3]=r[l+1]=d-u}render(e){let t=e==null?e=new mg:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let t=0,r=n.length;t<r;++t){let r=n[t];if(r<t)continue;let i=Math.floor(t/3)*2,o=Math.floor(r/3)*2,s=a[i],c=a[i+1],l=a[o],u=a[o+1];this._renderSegment(s,c,l,u,e)}let s,c=i[i.length-1];for(let t=0;t<i.length;++t){s=c,c=i[t];let n=Math.floor(r[c]/3)*2,l=a[n],u=a[n+1],d=s*4,f=this._project(l,u,o[d+2],o[d+3]);f&&this._renderSegment(l,u,f[0],f[1],e)}return t&&t.value()}renderBounds(e){let t=e==null?e=new mg:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){let n=t==null?t=new mg:void 0,r=this._clip(e);if(r===null||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let e=2;e<i;e+=2)(r[e]!==r[e-2]||r[e+1]!==r[e-1])&&t.lineTo(r[e],r[e+1]);return t.closePath(),n&&n.value()}*cellPolygons(){let{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){let e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){let t=new hg;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a,o=this._regioncode(e,t),s=this._regioncode(n,r);o===0&&s===0?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t,t!==t)||(n=+n,n!==n)?!1:this.delaunay._step(e,t,n)===e}*neighbors(e){let t=this._clip(e);if(t)for(let n of this.delaunay.neighbors(e)){let e=this._clip(n);if(e){loop:for(let r=0,i=t.length;r<i;r+=2)for(let a=0,o=e.length;a<o;a+=2)if(t[r]===e[a]&&t[r+1]===e[a+1]&&t[(r+2)%i]===e[(a+o-2)%o]&&t[(r+3)%i]===e[(a+o-1)%o]){yield n;break loop}}}}_cell(e){let{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(a===-1)return null;let o=[],s=a;do{let n=Math.floor(s/3);if(o.push(t[n*2],t[n*2+1]),s=s%3==2?s-2:s+1,i[s]!==e)break;s=r[s]}while(s!==a&&s!==-1);return o}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];let t=this._cell(e);if(t===null)return null;let{vectors:n}=this,r=e*4;return this._simplify(n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t))}_clipFinite(e,t){let n=t.length,r=null,i,a,o=t[n-2],s=t[n-1],c,l=this._regioncode(o,s),u,d=0;for(let f=0;f<n;f+=2)if(i=o,a=s,o=t[f],s=t[f+1],c=l,l=this._regioncode(o,s),c===0&&l===0)u=d,d=0,r?r.push(o,s):r=[o,s];else{let t,n,f,p,m;if(c===0){if((t=this._clipSegment(i,a,o,s,c,l))===null)continue;[n,f,p,m]=t}else{if((t=this._clipSegment(o,s,i,a,l,c))===null)continue;[p,m,n,f]=t,u=d,d=this._edgecode(n,f),u&&d&&this._edge(e,u,d,r,r.length),r?r.push(n,f):r=[n,f]}u=d,d=this._edgecode(p,m),u&&d&&this._edge(e,u,d,r,r.length),r?r.push(p,m):r=[p,m]}if(r)u=d,d=this._edgecode(r[0],r[1]),u&&d&&this._edge(e,u,d,r,r.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(e,t,n,r,i,a){let o=i<a;for(o&&([e,t,n,r,i,a]=[n,r,e,t,a,i]);;){if(i===0&&a===0)return o?[n,r,e,t]:[e,t,n,r];if(i&a)return null;let s,c,l=i||a;l&8?(s=e+(n-e)*(this.ymax-t)/(r-t),c=this.ymax):l&4?(s=e+(n-e)*(this.ymin-t)/(r-t),c=this.ymin):l&2?(c=t+(r-t)*(this.xmax-e)/(n-e),s=this.xmax):(c=t+(r-t)*(this.xmin-e)/(n-e),s=this.xmin),i?(e=s,t=c,i=this._regioncode(e,t)):(n=s,r=c,a=this._regioncode(n,r))}}_clipInfinite(e,t,n,r,i,a){let o=Array.from(t),s;if((s=this._project(o[0],o[1],n,r))&&o.unshift(s[0],s[1]),(s=this._project(o[o.length-2],o[o.length-1],i,a))&&o.push(s[0],s[1]),o=this._clipFinite(e,o))for(let t=0,n=o.length,r,i=this._edgecode(o[n-2],o[n-1]);t<n;t+=2)r=i,i=this._edgecode(o[t],o[t+1]),r&&i&&(t=this._edge(e,r,i,o,t),n=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,n,r,i){for(;t!==n;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin;break}(r[i]!==n||r[i+1]!==a)&&this.contains(e,n,a)&&(r.splice(i,0,n,a),i+=2)}return i}_project(e,t,n,r){let i=1/0,a,o,s;if(r<0){if(t<=this.ymin)return null;(a=(this.ymin-t)/r)<i&&(s=this.ymin,o=e+(i=a)*n)}else if(r>0){if(t>=this.ymax)return null;(a=(this.ymax-t)/r)<i&&(s=this.ymax,o=e+(i=a)*n)}if(n>0){if(e>=this.xmax)return null;(a=(this.xmax-e)/n)<i&&(o=this.xmax,s=t+(i=a)*r)}else if(n<0){if(e<=this.xmin)return null;(a=(this.xmin-e)/n)<i&&(o=this.xmin,s=t+(i=a)*r)}return[o,s]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){let n=(t+2)%e.length,r=(t+4)%e.length;(e[t]===e[n]&&e[n]===e[r]||e[t+1]===e[n+1]&&e[n+1]===e[r+1])&&(e.splice(n,2),t-=2)}e.length||(e=null)}return e}},_g=2*Math.PI,vg=Math.pow;function yg(e){return e[0]}function bg(e){return e[1]}function xg(e){let{triangles:t,coords:n}=e;for(let e=0;e<t.length;e+=3){let r=2*t[e],i=2*t[e+1],a=2*t[e+2];if((n[a]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[a+1]-n[r+1])>1e-10)return!1}return!0}function Sg(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}var Cg=class e{static from(t,n=yg,r=bg,i){return new e(`length`in t?wg(t,n,r,i):Float64Array.from(Tg(t,n,r,i)))}constructor(e){this._delaunator=new Zh(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){let e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&xg(e)){this.collinear=Int32Array.from({length:t.length/2},(e,t)=>t).sort((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]);let e=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let e=0,n=t.length/2;e<n;++e){let n=Sg(t[2*e],t[2*e+1],i);t[2*e]=n[0],t[2*e+1]=n[1]}this._delaunator=new Zh(t)}else delete this.collinear;let n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let e=0,t=n.length;e<t;++e){let t=i[e%3==2?e-2:e+1];(n[e]===-1||a[t]===-1)&&(a[t]=e)}for(let e=0,t=r.length;e<t;++e)o[r[e]]=e;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],a[r[0]]=1,r.length===2&&(a[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(e){return new gg(this,e)}*neighbors(e){let{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){let t=o.indexOf(e);t>0&&(yield o[t-1]),t<o.length-1&&(yield o[t+1]);return}let s=t[e];if(s===-1)return;let c=s,l=-1;do{if(yield l=a[c],c=c%3==2?c-2:c+1,a[c]!==e)return;if(c=i[c],c===-1){let t=n[(r[e]+1)%n.length];t!==l&&(yield t);return}}while(c!==s)}find(e,t,n=0){if((e=+e,e!==e)||(t=+t,t!==t))return-1;let r=n,i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){let{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:s,points:c}=this;if(r[e]===-1||!c.length)return(e+1)%(c.length>>1);let l=e,u=vg(t-c[e*2],2)+vg(n-c[e*2+1],2),d=r[e],f=d;do{let r=s[f],d=vg(t-c[r*2],2)+vg(n-c[r*2+1],2);if(d<u&&(u=d,l=r),f=f%3==2?f-2:f+1,s[f]!==e)break;if(f=o[f],f===-1){if(f=i[(a[e]+1)%i.length],f!==r&&vg(t-c[f*2],2)+vg(n-c[f*2+1],2)<u)return f;break}}while(f!==d);return l}render(e){let t=e==null?e=new mg:void 0,{points:n,halfedges:r,triangles:i}=this;for(let t=0,a=r.length;t<a;++t){let a=r[t];if(a<t)continue;let o=i[t]*2,s=i[a]*2;e.moveTo(n[o],n[o+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){t===void 0&&(!e||typeof e.moveTo!=`function`)&&(t=e,e=null),t=t==null?2:+t;let n=e==null?e=new mg:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){let i=r[n],a=r[n+1];e.moveTo(i+t,a),e.arc(i,a,t,0,_g)}return n&&n.value()}renderHull(e){let t=e==null?e=new mg:void 0,{hull:n,points:r}=this,i=n[0]*2,a=n.length;e.moveTo(r[i],r[i+1]);for(let t=1;t<a;++t){let i=2*n[t];e.lineTo(r[i],r[i+1])}return e.closePath(),t&&t.value()}hullPolygon(){let e=new hg;return this.renderHull(e),e.value()}renderTriangle(e,t){let n=t==null?t=new mg:void 0,{points:r,triangles:i}=this,a=i[e*=3]*2,o=i[e+1]*2,s=i[e+2]*2;return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){let{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){let t=new hg;return this.renderTriangle(e,t),t.value()}};function wg(e,t,n,r){let i=e.length,a=new Float64Array(i*2);for(let o=0;o<i;++o){let i=e[o];a[o*2]=t.call(r,i,o,e),a[o*2+1]=n.call(r,i,o,e)}return a}function*Tg(e,t,n,r){let i=0;for(let a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}const Eg=Math.PI,Dg=Eg/2;Eg/4,Eg*2;const Og=180/Eg,kg=Eg/180,Ag=Math.atan2,jg=Math.cos,Mg=Math.max,Ng=Math.min,Pg=Math.sin,Fg=Math.sign||function(e){return e>0?1:e<0?-1:0},Ig=Math.sqrt;function Lg(e){return e>1?Dg:e<-1?-Dg:Math.asin(e)}function Rg(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function zg(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Bg(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function Vg(e){var t=Ig(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}function Hg(e){return[Ag(e[1],e[0])*Og,Lg(Mg(-1,Ng(1,e[2])))*Og]}function Ug(e){let t=e[0]*kg,n=e[1]*kg,r=jg(n);return[r*jg(t),r*Pg(t),Pg(n)]}function Wg(e){return e=e.map(e=>Ug(e)),Rg(e[0],zg(e[2],e[1]))}function Gg(e){let t=qg(e),n=Yg(t),r=Jg(n,e),i=Zg(n,e.length),a=Kg(i,e),{polygons:o,centers:s}=Qg(Xg(n,e),n,e);return{delaunay:t,edges:r,triangles:n,centers:s,neighbors:i,polygons:o,mesh:e_(o),hull:n_(n,e),urquhart:t_(r,n),find:a}}function Kg(e,t){function n(e,t){let n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}return function(r,i,a){a===void 0&&(a=0);let o,s,c=a,l=Ug([r,i]);do o=a,a=null,s=n(l,Ug(t[o])),e[o].forEach(e=>{let r=n(l,Ug(t[e]));if(r<s){s=r,a=e,c=e;return}});while(a!==null);return c}}function qg(e){if(e.length<2)return{};let t=0;for(;isNaN(e[t][0]+e[t][1])&&t++<e.length;);let n=Cu(e[t]),r=qd().translate([0,0]).scale(1).rotate(n.invert([180,0]));e=e.map(r);let i=[],a=1;for(let t=0,n=e.length;t<n;t++){let n=e[t][0]**2+e[t][1]**2;!isFinite(n)||n>1e32?i.push(t):n>a&&(a=n)}let o=1e6*Ig(a);i.forEach(t=>e[t]=[o,0]),e.push([0,o]),e.push([-o,0]),e.push([0,-o]);let s=Cg.from(e);s.projection=r;let{triangles:c,halfedges:l,inedges:u}=s,d=[];for(let n=0,r=l.length;n<r;n++)if(l[n]<0){let e=n%3==2?n-2:n+1,r=n%3==0?n+2:n-1,i=l[e],a=l[r];l[i]=a,l[a]=i,l[e]=l[r]=-1,c[n]=c[e]=c[r]=t,u[c[i]]=i%3==0?i+2:i-1,u[c[a]]=a%3==0?a+2:a-1,d.push(Math.min(n,e,r)),n+=2-n%3}else c[n]>e.length-3-1&&(c[n]=t);return s}function Jg(e,t){let n=new Set;return t.length===2?[[0,1]]:(e.forEach(e=>{if(e[0]!==e[1]&&!(Wg(e.map(e=>t[e]))<0))for(let t=0,r;t<3;t++)r=(t+1)%3,n.add(bo([e[t],e[r]]).join(`-`))}),Array.from(n,e=>e.split(`-`).map(Number)))}function Yg(e){let{triangles:t}=e;if(!t)return[];let n=[];for(let e=0,r=t.length/3;e<r;e++){let r=t[3*e],i=t[3*e+1],a=t[3*e+2];r!==i&&i!==a&&n.push([r,a,i])}return n}function Xg(e,t){return e.map(e=>{let n=e.map(e=>t[e]).map(Ug);return Hg(Vg(Bg(Bg(zg(n[1],n[0]),zg(n[2],n[1])),zg(n[0],n[2]))))})}function Zg(e,t){let n=[];return e.forEach(e=>{for(let t=0;t<3;t++){let r=e[t],i=e[(t+1)%3];n[r]=n[r]||[],n[r].push(i)}}),e.length===0&&(t===2?(n[0]=[1],n[1]=[0]):t===1&&(n[0]=[])),n}function Qg(e,t,n){let r=[],i=e.slice();if(t.length===0){if(n.length<2)return{polygons:r,centers:i};if(n.length===2){let e=Ug(n[0]),t=Ug(n[1]),a=Vg(Bg(e,t)),s=zg(a,Vg(zg(e,t))),c=[a,zg(a,s),zg(zg(a,s),s),zg(zg(zg(a,s),s),s)].map(Hg).map(o);return r.push(c),r.push(c.slice().reverse()),{polygons:r,centers:i}}}t.forEach((e,t)=>{for(let n=0;n<3;n++){let i=e[n],a=e[(n+1)%3],o=e[(n+2)%3];r[i]=r[i]||[],r[i].push([a,o,t,[i,a,o]])}});let a=r.map(e=>{let t=[e[0][2]],r=e[0][1];for(let n=1;n<e.length;n++)for(let n=0;n<e.length;n++)if(e[n][0]==r){r=e[n][1],t.push(e[n][2]);break}if(t.length>2)return t;if(t.length==2){let r=$g(n[e[0][3][0]],n[e[0][3][1]],i[t[0]]),a=$g(n[e[0][3][2]],n[e[0][3][0]],i[t[0]]),s=o(r),c=o(a);return[t[0],c,t[1],s]}});function o(e){let n=-1;return i.slice(t.length,1/0).forEach((r,i)=>{r[0]===e[0]&&r[1]===e[1]&&(n=i+t.length)}),n<0&&(n=i.length,i.push(e)),n}return{polygons:a,centers:i}}function $g(e,t,n){e=Ug(e),t=Ug(t),n=Ug(n);let r=Fg(Rg(zg(t,e),n));return Hg(Vg(Bg(e,t)).map(e=>r*e))}function e_(e){let t=[];return e.forEach(e=>{if(!e)return;let n=e[e.length-1];for(let r of e)r>n&&t.push([n,r]),n=r}),t}function t_(e,t){return function(n){let r=new Map,i=new Map;return e.forEach((e,t)=>{let a=e.join(`-`);r.set(a,n[t]),i.set(a,!0)}),t.forEach(e=>{let t=0,n=-1;for(let i=0;i<3;i++){let a=bo([e[i],e[(i+1)%3]]).join(`-`);r.get(a)>t&&(t=r.get(a),n=a)}i.set(n,!1)}),e.map(e=>i.get(e.join(`-`)))}}function n_(e,t){let n=new Set,r=[];e.map(e=>{if(!(Wg(e.map(e=>t[e>t.length?0:e]))>1e-12))for(let t=0;t<3;t++){let r=[e[t],e[(t+1)%3]],i=`${r[0]}-${r[1]}`;n.has(i)?n.delete(i):n.add(`${r[1]}-${r[0]}`)}});let i=new Map,a;if(n.forEach(e=>{e=e.split(`-`).map(Number),i.set(e[0],e[1]),a=e[0]}),a===void 0)return r;let o=a;do{r.push(o);let e=i.get(o);i.set(o,-1),o=e}while(o>-1&&o!==a);return r}function r_(e){let t=function(e){if(t.delaunay=null,t._data=e,typeof t._data==`object`&&t._data.type===`FeatureCollection`&&(t._data=t._data.features),typeof t._data==`object`){let e=t._data.map(e=>[t._vx(e),t._vy(e),e]).filter(e=>isFinite(e[0]+e[1]));t.points=e.map(e=>[e[0],e[1]]),t.valid=e.map(e=>e[2]),t.delaunay=Gg(t.points)}return t};return t._vx=function(e){if(typeof e==`object`&&`type`in e)return gu(e)[0];if(0 in e)return e[0]},t._vy=function(e){if(typeof e==`object`&&`type`in e)return gu(e)[1];if(1 in e)return e[1]},t.x=function(e){return e?(t._vx=e,t):t._vx},t.y=function(e){return e?(t._vy=e,t):t._vy},t.polygons=function(e){if(e!==void 0&&t(e),!t.delaunay)return!1;let n={type:`FeatureCollection`,features:[]};return t.valid.length===0?n:(t.delaunay.polygons.forEach((e,r)=>n.features.push({type:`Feature`,geometry:e?{type:`Polygon`,coordinates:[[...e,e[0]].map(e=>t.delaunay.centers[e])]}:null,properties:{site:t.valid[r],sitecoordinates:t.points[r],neighbours:t.delaunay.neighbors[r]}})),t.valid.length===1&&n.features.push({type:`Feature`,geometry:{type:`Sphere`},properties:{site:t.valid[0],sitecoordinates:t.points[0],neighbours:[]}}),n)},t.triangles=function(e){return e!==void 0&&t(e),t.delaunay?{type:`FeatureCollection`,features:t.delaunay.triangles.map((e,n)=>(e=e.map(e=>t.points[e]),e.center=t.delaunay.centers[n],e)).filter(e=>Wg(e)>0).map(e=>({type:`Feature`,properties:{circumcenter:e.center},geometry:{type:`Polygon`,coordinates:[[...e,e[0]]]}}))}:!1},t.links=function(e){if(e!==void 0&&t(e),!t.delaunay)return!1;let n=t.delaunay.edges.map(e=>rd(t.points[e[0]],t.points[e[1]])),r=t.delaunay.urquhart(n);return{type:`FeatureCollection`,features:t.delaunay.edges.map((e,i)=>({type:`Feature`,properties:{source:t.valid[e[0]],target:t.valid[e[1]],length:n[i],urquhart:!!r[i]},geometry:{type:`LineString`,coordinates:[t.points[e[0]],t.points[e[1]]]}}))}},t.mesh=function(e){return e!==void 0&&t(e),t.delaunay?{type:`MultiLineString`,coordinates:t.delaunay.edges.map(e=>[t.points[e[0]],t.points[e[1]]])}:!1},t.cellMesh=function(e){if(e!==void 0&&t(e),!t.delaunay)return!1;let{centers:n,polygons:r}=t.delaunay,i=[];for(let e of r)if(e)for(let t=e.length,r=e[t-1],a=e[0],o=0;o<t;r=a,a=e[++o])a>r&&i.push([n[r],n[a]]);return{type:`MultiLineString`,coordinates:i}},t._found=void 0,t.find=function(e,n,r){if(t._found=t.delaunay.find(e,n,t._found),!r||rd([e,n],t.points[t._found])<r)return t._found},t.hull=function(e){e!==void 0&&t(e);let n=t.delaunay.hull,r=t.points;return n.length===0?null:{type:`Polygon`,coordinates:[[...n.map(e=>r[e]),r[n[0]]]]}},e?t(e):t}function i_(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function a_(e){if(Array.isArray(e))return e}function o_(e){if(Array.isArray(e))return i_(e)}function s_(e){if(e===void 0)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return e}function c_(e,t,n){return t=d_(t),v_(e,p_()?Reflect.construct(t,[],d_(e).constructor):t.apply(e,n))}function l_(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function u_(e,t,n){return Object.defineProperty(e,`prototype`,{writable:!1}),e}function d_(e){return d_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d_(e)}function f_(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function`);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,`prototype`,{writable:!1}),t&&y_(e,t)}function p_(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(p_=function(){return!!e})()}function m_(e){if(typeof Symbol<`u`&&e[Symbol.iterator]!=null||e[`@@iterator`]!=null)return Array.from(e)}function h_(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t!==0)for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function g_(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function __(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function v_(e,t){if(t&&(typeof t==`object`||typeof t==`function`))return t;if(t!==void 0)throw TypeError(`Derived constructors may only return object or undefined`);return s_(e)}function y_(e,t){return y_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y_(e,t)}function b_(e,t){return a_(e)||h_(e,t)||S_(e,t)||g_()}function x_(e){return o_(e)||m_(e)||S_(e)||__()}function S_(e,t){if(e){if(typeof e==`string`)return i_(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i_(e,t):void 0}}function C_(e){var t=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).resolution,n=t===void 0?1/0:t,r=w_(e,n),i=Mo(r),a=T_(e,n),o=[].concat(x_(i),x_(a)),s={type:`Polygon`,coordinates:e},c=b_(Hl(s),2),l=b_(c[0],2),u=l[0],d=l[1],f=b_(c[1],2),p=f[0],m=f[1],h=u>p||m>=89||d<=-89,g=[];if(h){var _=r_(o).triangles(),v=new Map(o.map(function(e,t){var n=b_(e,2);return[`${n[0]}-${n[1]}`,t]}));_.features.forEach(function(e){var t,n=e.geometry.coordinates[0].slice(0,3).reverse(),r=[];if(n.forEach(function(e){var t=b_(e,2),n=`${t[0]}-${t[1]}`;v.has(n)&&r.push(v.get(n))}),r.length===3){if(r.some(function(e){return e<i.length})){var a=e.properties.circumcenter;if(!D_(a,s,h))return}(t=g).push.apply(t,r)}})}else if(a.length){for(var y=Zh.from(o),b=function(e){var t,n=[2,1,0].map(function(t){return y.triangles[e+t]}),r=n.map(function(e){return o[e]});if(n.some(function(e){return e<i.length})&&!D_([0,1].map(function(e){return Ao(r,function(t){return t[e]})}),s,h))return 1;(t=g).push.apply(t,x_(n))},x=0,S=y.triangles.length;x<S;x+=3)if(b(x))continue}else{var C=jp(r),w=C.vertices,T=C.holes;g=Qf(w,T===void 0?[]:T,2)}var E=wc(bo(o,function(e){return e[0]}),[0,1]),D=wc(bo(o,function(e){return e[1]}),[0,1]),O=o.map(function(e){var t=b_(e,2),n=t[0],r=t[1];return[E(n),D(r)]});return{contour:r,triangles:{points:o,indices:g,uvs:O}}}function w_(e,t){return e.map(function(e){var n=[],r;return e.forEach(function(e){if(r){var i=rd(e,r)*180/Math.PI;if(i>t)for(var a=_d(r,e),o=1/Math.ceil(i/t),s=o;s<1;)n.push(a(s)),s+=o}n.push(r=e)}),n})}function T_(e,t){var n={type:`Polygon`,coordinates:e},r=b_(Hl(n),2),i=b_(r[0],2),a=i[0],o=i[1],s=b_(r[1],2),c=s[0],l=s[1];if(Math.min(Math.abs(c-a),Math.abs(l-o))<t)return[];var u=a>c||l>=89||o<=-89;return E_(t,{minLng:a,maxLng:c,minLat:o,maxLat:l}).filter(function(e){return D_(e,n,u)})}function E_(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.minLng,r=t.maxLng,i=t.minLat,a=t.maxLat,o=Math.round((360/e)**2/Math.PI),s=(1+Math.sqrt(5))/2,c=function(e){return e/s*360%360-180},l=function(e){return Math.acos(2*e/o-1)/Math.PI*180-90},u=function(e){return o*(Math.cos((e+90)*Math.PI/180)+1)/2},d=[a===void 0?0:Math.ceil(u(a)),i===void 0?o-1:Math.floor(u(i))],f=n===void 0&&r===void 0?function(){return!0}:n===void 0?function(e){return e<=r}:r===void 0?function(e){return e>=n}:r>=n?function(e){return e>=n&&e<=r}:function(e){return e>=n||e<=r},p=[],m=d[0];m<=d[1];m++){var h=c(m);f(h)&&p.push([h,l(m)])}return p}function D_(e,t){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?fd(t,e):fg(e,t)}var O_=window.THREE?window.THREE:{BufferGeometry:Xr,Float32BufferAttribute:vn},k_=new O_.BufferGeometry().setAttribute?`setAttribute`:`addAttribute`,A_=function(e){function t(e,n,r,i,a,o,s){var c;l_(this,t),c=c_(this,t),c.type=`ConicPolygonGeometry`,c.parameters={polygonGeoJson:e,bottomHeight:n,topHeight:r,closedBottom:i,closedTop:a,includeSides:o,curvatureResolution:s},n||=0,r||=1,i=i===void 0?!0:i,a=a===void 0?!0:a,o=o===void 0?!0:o,s||=5;var l=C_(e,{resolution:s}),u=l.contour,d=l.triangles,f=Mo(d.uvs),p=[],m=[],h=[],g=0,_=function(e){var t=Math.round(p.length/3),n=h.length;p=p.concat(e.vertices),m=m.concat(e.uvs),h=h.concat(t?e.indices.map(function(e){return e+t}):e.indices),c.addGroup(n,h.length-n,g++)};o&&_(y()),i&&_(b(n,!1)),a&&_(b(r,!0)),c.setIndex(h),c[k_](`position`,new O_.Float32BufferAttribute(p,3)),c[k_](`uv`,new O_.Float32BufferAttribute(m,2)),c.computeVertexNormals();function v(e,t){var n=typeof t==`function`?t:function(){return t};return jp(e.map(function(e){return e.map(function(e){var t=b_(e,2),r=t[0],i=t[1];return j_(i,r,n(r,i))})}))}function y(){for(var e=v(u,n),t=e.vertices,i=e.holes,a=v(u,r).vertices,o=Mo([a,t]),s=Math.round(a.length/3),c=new Set(i),l=0,d=[],f=0;f<s;f++){var p=f+1;if(p===s)p=l;else if(c.has(p)){var m=p;p=l,l=m}d.push(f,f+s,p+s),d.push(p+s,p,f)}for(var h=[],g=1;g>=0;g--)for(var _=0;_<s;_+=1)h.push(_/(s-1),g);return{indices:d,vertices:o,uvs:h}}function b(e){return{indices:!(arguments.length>1&&arguments[1]!==void 0)||arguments[1]?d.indices:d.indices.slice().reverse(),vertices:v([d.points],e).vertices,uvs:f}}return c}return f_(t,e),u_(t)}(O_.BufferGeometry);function j_(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180;return[n*Math.sin(r)*Math.cos(i),n*Math.cos(r),n*Math.sin(r)*Math.sin(i)]}function M_(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function N_(e){if(Array.isArray(e))return e}function P_(e){if(Array.isArray(e))return M_(e)}function F_(e){if(typeof Symbol<`u`&&e[Symbol.iterator]!=null||e[`@@iterator`]!=null)return Array.from(e)}function I_(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t!==0)for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function L_(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function R_(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function z_(e,t){if(e==null)return{};var n,r,i=B_(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function B_(e,t){if(e==null)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}function V_(e,t){return N_(e)||I_(e,t)||G_(e,t)||L_()}function H_(e){return P_(e)||F_(e)||G_(e)||R_()}function U_(e,t){if(typeof e!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return String(e)}function W_(e){var t=U_(e,`string`);return typeof t==`symbol`?t:t+``}function G_(e,t){if(e){if(typeof e==`string`)return M_(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M_(e,t):void 0}}var K_=(function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=(t instanceof Array?t.length?t:[void 0]:[t]).map(function(e){return{keyAccessor:e,isProp:!(e instanceof Function)}}),a=e.reduce(function(e,t){var r=e,a=t;return i.forEach(function(e,t){var o=e.keyAccessor,s=e.isProp,c;if(s){var l=a,u=l[o],d=z_(l,[o].map(W_));c=u,a=d}else c=o(a,t);t+1<i.length?(r.hasOwnProperty(c)||(r[c]={}),r=r[c]):n?(r.hasOwnProperty(c)||(r[c]=[]),r[c].push(a)):r[c]=a}),e},{});n instanceof Function&&(function e(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;r===i.length?Object.keys(t).forEach(function(e){return t[e]=n(t[e])}):Object.values(t).forEach(function(t){return e(t,r+1)})})(a);var o=a;return r&&(o=[],(function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];n.length===i.length?o.push({keys:n,vals:t}):Object.entries(t).forEach(function(t){var r=V_(t,2),i=r[0],a=r[1];return e(a,[].concat(H_(n),[i]))})})(a),t instanceof Array&&t.length===0&&o.length===1&&(o[0].keys=[])),o}),q_=function(e){e||={};var t=e===void 0?{}:e,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);var i=[],a=``;function o(e){return t.locateFile?t.locateFile(e,a):a+e}var s;typeof document<`u`&&document.currentScript&&(a=document.currentScript.src),a=a.indexOf(`blob:`)===0?``:a.substr(0,a.lastIndexOf(`/`)+1),s=function(e,t,n){var r=new XMLHttpRequest;r.open(`GET`,e,!0),r.responseType=`arraybuffer`,r.onload=function(){if(r.status==200||r.status==0&&r.response){t(r.response);return}var i=Ke(e);if(i){t(i.buffer);return}n()},r.onerror=n,r.send(null)};var c=t.print||console.log.bind(console),l=t.printErr||console.warn.bind(console);for(r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);n=null,t.arguments&&(i=t.arguments);var u=0,d=function(e){u=e},f=function(){return u},p=8;function m(e,t,n,r){switch(n||=`i8`,n.charAt(n.length-1)===`*`&&(n=`i32`),n){case`i1`:ee[e>>0]=t;break;case`i8`:ee[e>>0]=t;break;case`i16`:te[e>>1]=t;break;case`i32`:A[e>>2]=t;break;case`i64`:Me=[t>>>0,(je=t,+ye(je)>=1?je>0?(Se(+xe(je/4294967296),4294967295)|0)>>>0:~~+be((je-+(~~je>>>0))/4294967296)>>>0:0)],A[e>>2]=Me[0],A[e+4>>2]=Me[1];break;case`float`:ne[e>>2]=t;break;case`double`:re[e>>3]=t;break;default:rt(`invalid type for setValue: `+n)}}function h(e,t,n){switch(t||=`i8`,t.charAt(t.length-1)===`*`&&(t=`i32`),t){case`i1`:return ee[e>>0];case`i8`:return ee[e>>0];case`i16`:return te[e>>1];case`i32`:return A[e>>2];case`i64`:return A[e>>2];case`float`:return ne[e>>2];case`double`:return re[e>>3];default:rt(`invalid type for getValue: `+t)}return null}var g=!1;function _(e,t){e||rt(`Assertion failed: `+t)}function v(e){var n=t[`_`+e];return _(n,`Cannot call unknown function `+e+`, make sure it is exported`),n}function y(e,t,n,r,i){var a={string:function(e){var t=0;if(e!=null&&e!==0){var n=(e.length<<2)+1;t=Je(n),T(e,t,n)}return t},array:function(e){var t=Je(e.length);return E(e,t),t}};function o(e){return t===`string`?C(e):t===`boolean`?!!e:e}var s=v(e),c=[],l=0;if(r)for(var u=0;u<r.length;u++){var d=a[n[u]];d?(l===0&&(l=Xe()),c[u]=d(r[u])):c[u]=r[u]}var f=s.apply(null,c);return f=o(f),l!==0&&Ye(l),f}function b(e,t,n,r){n||=[];var i=n.every(function(e){return e===`number`});return t!==`string`&&i&&!r?v(e):function(){return y(e,t,n,arguments,r)}}var x=typeof TextDecoder<`u`?new TextDecoder(`utf8`):void 0;function S(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.subarray&&x)return x.decode(e.subarray(t,i));for(var a=``;t<i;){var o=e[t++];if(!(o&128)){a+=String.fromCharCode(o);continue}var s=e[t++]&63;if((o&224)==192){a+=String.fromCharCode((o&31)<<6|s);continue}var c=e[t++]&63;if(o=(o&240)==224?(o&15)<<12|s<<6|c:(o&7)<<18|s<<12|c<<6|e[t++]&63,o<65536)a+=String.fromCharCode(o);else{var l=o-65536;a+=String.fromCharCode(55296|l>>10,56320|l&1023)}}return a}function C(e,t){return e?S(k,e,t):``}function w(e,t,n,r){if(!(r>0))return 0;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343){var c=e.charCodeAt(++o);s=65536+((s&1023)<<10)|c&1023}if(s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|s&63}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|s&63}else{if(n+3>=a)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|s&63}}return t[n]=0,n-i}function T(e,t,n){return w(e,k,t,n)}typeof TextDecoder<`u`&&new TextDecoder(`utf-16le`);function E(e,t){ee.set(e,t)}function D(e,t){return e%t>0&&(e+=t-e%t),e}var O,ee,k,te,A,ne,re;function ie(e){O=e,t.HEAP8=ee=new Int8Array(e),t.HEAP16=te=new Int16Array(e),t.HEAP32=A=new Int32Array(e),t.HEAPU8=k=new Uint8Array(e),t.HEAPU16=new Uint16Array(e),t.HEAPU32=new Uint32Array(e),t.HEAPF32=ne=new Float32Array(e),t.HEAPF64=re=new Float64Array(e)}var ae=5271520,oe=28608,se=t.TOTAL_MEMORY||33554432;O=t.buffer?t.buffer:new ArrayBuffer(se),se=O.byteLength,ie(O),A[oe>>2]=ae;function ce(e){for(;e.length>0;){var n=e.shift();if(typeof n==`function`){n();continue}var r=n.func;typeof r==`number`?n.arg===void 0?t.dynCall_v(r):t.dynCall_vi(r,n.arg):r(n.arg===void 0?null:n.arg)}}var le=[],ue=[],de=[],fe=[];function pe(){if(t.preRun)for(typeof t.preRun==`function`&&(t.preRun=[t.preRun]);t.preRun.length;)_e(t.preRun.shift());ce(le)}function me(){ce(ue)}function he(){ce(de)}function ge(){if(t.postRun)for(typeof t.postRun==`function`&&(t.postRun=[t.postRun]);t.postRun.length;)ve(t.postRun.shift());ce(fe)}function _e(e){le.unshift(e)}function ve(e){fe.unshift(e)}var ye=Math.abs,be=Math.ceil,xe=Math.floor,Se=Math.min,Ce=0,we=null,Te=null;function Ee(e){Ce++,t.monitorRunDependencies&&t.monitorRunDependencies(Ce)}function De(e){if(Ce--,t.monitorRunDependencies&&t.monitorRunDependencies(Ce),Ce==0&&(we!==null&&(clearInterval(we),we=null),Te)){var n=Te;Te=null,n()}}t.preloadedImages={},t.preloadedAudios={};var Oe=null,ke=`data:application/octet-stream;base64,`;function Ae(e){return String.prototype.startsWith?e.startsWith(ke):e.indexOf(ke)===0}var je,Me;Oe=`data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=`;var Ne=28624;function Pe(e){return e}function Fe(e){return e.replace(/\b__Z[\w\d_]+/g,function(e){var t=Pe(e);return e===t?e:t+` [`+e+`]`})}function Ie(){var e=Error();if(!e.stack){try{throw Error(0)}catch(t){e=t}if(!e.stack)return`(no stack trace available)`}return e.stack.toString()}function Le(){var e=Ie();return t.extraStackTrace&&(e+=`
`+t.extraStackTrace()),Fe(e)}function Re(e,t,n,r){rt(`Assertion failed: `+C(e)+`, at: `+[t?C(t):`unknown filename`,n,r?C(r):`unknown function`])}function ze(){return ee.length}function j(e,t,n){k.set(k.subarray(t,t+n),e)}function Be(e){return t.___errno_location&&(A[t.___errno_location()>>2]=e),e}function Ve(e){rt(`OOM`)}function He(e){try{var t=new ArrayBuffer(e);return t.byteLength==e?(new Int8Array(t).set(ee),qe(t),ie(t),1):void 0}catch{}}function Ue(e){var t=ze(),n=16777216,r=2147483648-n;if(e>r)return!1;for(var i=Math.max(t,16777216);i<e;)i=i<=536870912?D(2*i,n):Math.min(D((3*i+2147483648)/4,n),r);return!!He(i)}var We=typeof atob==`function`?atob:function(e){var t=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=`,n=``,r,i,a,o,s,c,l,u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,``);do o=t.indexOf(e.charAt(u++)),s=t.indexOf(e.charAt(u++)),c=t.indexOf(e.charAt(u++)),l=t.indexOf(e.charAt(u++)),r=o<<2|s>>4,i=(s&15)<<4|c>>2,a=(c&3)<<6|l,n+=String.fromCharCode(r),c!==64&&(n+=String.fromCharCode(i)),l!==64&&(n+=String.fromCharCode(a));while(u<e.length);return n};function Ge(e){try{for(var t=We(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}catch{throw Error(`Converting base64 string to bytes failed.`)}}function Ke(e){if(Ae(e))return Ge(e.slice(ke.length))}var M=(function(e,t,n){"almost asm";var r=new e.Int8Array(n),i=new e.Int32Array(n);new e.Uint8Array(n),new e.Float32Array(n);var a=new e.Float64Array(n),o=t.o|0,s=t.p|0,c=e.Math.floor,l=e.Math.abs,u=e.Math.sqrt,d=e.Math.pow,f=e.Math.cos,p=e.Math.sin,m=e.Math.tan,h=e.Math.acos,g=e.Math.asin,_=e.Math.atan,v=e.Math.atan2,y=e.Math.ceil,b=e.Math.imul,x=e.Math.min,S=e.Math.max,C=e.Math.clz32,w=t.b,T=t.c,E=t.d,D=t.e,O=t.f,ee=t.g,k=t.h,te=t.i,A=28640;function ne(e){return r=new Int8Array(e),new Uint8Array(e),i=new Int32Array(e),new Float32Array(e),a=new Float64Array(e),n=e,!0}function re(e){e|=0;var t=0;return t=A,A=A+e|0,A=A+15&-16,t|0}function ie(){return A|0}function ae(e){e|=0,A=e}function oe(e,t){e|=0,t|=0,A=e}function se(e,t){e|=0,t|=0;var n=0,r=0,a=0;return(e|0)<0?(t=2,t|0):(e|0)>13780509?(t=En(15,t)|0,t|0):(n=((e|0)<0)<<31>>31,a=Hr(e|0,n|0,3,0)|0,r=T()|0,n=Ir(e|0,n|0,1,0)|0,n=Hr(a|0,r|0,n|0,T()|0)|0,n=Ir(n|0,T()|0,1,0)|0,e=T()|0,i[t>>2]=n,i[t+4>>2]=e,t=0,t|0)}function ce(e,t,n,r){return e|=0,t|=0,n|=0,r|=0,le(e,t,n,r,0)|0}function le(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o=0,s=0,c=0,l=0,u=0;if(l=A,A=A+16|0,s=l,!(ue(e,t,n,r,a)|0))return r=0,A=l,r|0;do if((n|0)>=0){if((n|0)>13780509){if(o=En(15,s)|0,o|0)break;c=s,s=i[c>>2]|0,c=i[c+4>>2]|0}else o=((n|0)<0)<<31>>31,u=Hr(n|0,o|0,3,0)|0,c=T()|0,o=Ir(n|0,o|0,1,0)|0,o=Hr(u|0,c|0,o|0,T()|0)|0,o=Ir(o|0,T()|0,1,0)|0,c=T()|0,i[s>>2]=o,i[s+4>>2]=c,s=o;if(Zr(r|0,0,s<<3|0)|0,a|0){Zr(a|0,0,s<<2|0)|0,o=de(e,t,n,r,a,s,c,0)|0;break}o=Fr(s,4)|0,o?(u=de(e,t,n,r,o,s,c,0)|0,F(o),o=u):o=13}else o=2;while(0);return u=o,A=l,u|0}function ue(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0;if(g=A,A=A+16|0,m=g,h=g+8|0,p=m,i[p>>2]=e,i[p+4>>2]=t,(n|0)<0)return h=2,A=g,h|0;if(o=r,i[o>>2]=e,i[o+4>>2]=t,o=(a|0)!=0,o&&(i[a>>2]=0),Rt(e,t)|0)return h=9,A=g,h|0;i[h>>2]=0;a:do if((n|0)>=1)if(o)for(d=1,u=0,f=0,p=1,o=e;;){if(!(u|f)){if(o=fe(o,t,4,h,m)|0,o|0)break a;if(t=m,o=i[t>>2]|0,t=i[t+4>>2]|0,Rt(o,t)|0){o=9;break a}}if(o=fe(o,t,i[26800+(f<<2)>>2]|0,h,m)|0,o|0)break a;if(t=m,o=i[t>>2]|0,t=i[t+4>>2]|0,e=r+(d<<3)|0,i[e>>2]=o,i[e+4>>2]=t,i[a+(d<<2)>>2]=p,e=u+1|0,s=(e|0)==(p|0),c=f+1|0,l=(c|0)==6,Rt(o,t)|0){o=9;break a}if(p=p+(l&s&1)|0,(p|0)>(n|0)){o=0;break}else d=d+1|0,u=s?0:e,f=s?l?0:c:f}else for(d=1,u=0,f=0,p=1,o=e;;){if(!(u|f)){if(o=fe(o,t,4,h,m)|0,o|0)break a;if(t=m,o=i[t>>2]|0,t=i[t+4>>2]|0,Rt(o,t)|0){o=9;break a}}if(o=fe(o,t,i[26800+(f<<2)>>2]|0,h,m)|0,o|0)break a;if(t=m,o=i[t>>2]|0,t=i[t+4>>2]|0,e=r+(d<<3)|0,i[e>>2]=o,i[e+4>>2]=t,e=u+1|0,s=(e|0)==(p|0),c=f+1|0,l=(c|0)==6,Rt(o,t)|0){o=9;break a}if(p=p+(l&s&1)|0,(p|0)>(n|0)){o=0;break}else d=d+1|0,u=s?0:e,f=s?l?0:c:f}else o=0;while(0);return h=o,A=g,h|0}function de(e,t,n,r,a,o,s,c){e|=0,t|=0,n|=0,r|=0,a|=0,o|=0,s|=0,c|=0;var l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0;if(g=A,A=A+16|0,m=g+8|0,h=g,l=Wr(e|0,t|0,o|0,s|0)|0,d=T()|0,f=r+(l<<3)|0,_=f,v=i[_>>2]|0,_=i[_+4>>2]|0,u=(v|0)==(e|0)&(_|0)==(t|0),!((v|0)==0&(_|0)==0|u))do l=Ir(l|0,d|0,1,0)|0,l=Ur(l|0,T()|0,o|0,s|0)|0,d=T()|0,f=r+(l<<3)|0,v=f,_=i[v>>2]|0,v=i[v+4>>2]|0,u=(_|0)==(e|0)&(v|0)==(t|0);while(!((_|0)==0&(v|0)==0|u));if(l=a+(l<<2)|0,u&&(i[l>>2]|0)<=(c|0)||(v=f,i[v>>2]=e,i[v+4>>2]=t,i[l>>2]=c,(c|0)>=(n|0)))return v=0,A=g,v|0;switch(u=c+1|0,i[m>>2]=0,l=fe(e,t,2,m,h)|0,l|0){case 9:p=9;break;case 0:l=h,l=de(i[l>>2]|0,i[l+4>>2]|0,n,r,a,o,s,u)|0,l||(p=9);break;default:}a:do if((p|0)==9){switch(i[m>>2]=0,l=fe(e,t,3,m,h)|0,l|0){case 9:break;case 0:if(l=h,l=de(i[l>>2]|0,i[l+4>>2]|0,n,r,a,o,s,u)|0,l|0)break a;break;default:break a}switch(i[m>>2]=0,l=fe(e,t,1,m,h)|0,l|0){case 9:break;case 0:if(l=h,l=de(i[l>>2]|0,i[l+4>>2]|0,n,r,a,o,s,u)|0,l|0)break a;break;default:break a}switch(i[m>>2]=0,l=fe(e,t,5,m,h)|0,l|0){case 9:break;case 0:if(l=h,l=de(i[l>>2]|0,i[l+4>>2]|0,n,r,a,o,s,u)|0,l|0)break a;break;default:break a}switch(i[m>>2]=0,l=fe(e,t,4,m,h)|0,l|0){case 9:break;case 0:if(l=h,l=de(i[l>>2]|0,i[l+4>>2]|0,n,r,a,o,s,u)|0,l|0)break a;break;default:break a}switch(i[m>>2]=0,l=fe(e,t,6,m,h)|0,l|0){case 9:break;case 0:if(l=h,l=de(i[l>>2]|0,i[l+4>>2]|0,n,r,a,o,s,u)|0,l|0)break a;break;default:break a}return v=0,A=g,v|0}while(0);return v=l,A=g,v|0}function fe(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0;if(n>>>0>6)return a=1,a|0;if(f=(i[r>>2]|0)%6|0,i[r>>2]=f,(f|0)>0){o=0;do n=at(n)|0,o=o+1|0;while((o|0)<(i[r>>2]|0))}if(f=I(e|0,t|0,45)|0,T()|0,d=f&127,d>>>0>121)return a=5,a|0;l=Kt(e,t)|0,o=I(e|0,t|0,52)|0,T()|0,o&=15;a:do if(!o)u=8;else{for(;;){if(s=(15-o|0)*3|0,c=I(e|0,t|0,s|0)|0,T()|0,c&=7,(c|0)==7){t=5;break}if(h=(Qt(o)|0)==0,o=o+-1|0,p=L(7,0,s|0)|0,t&=~(T()|0),m=L(i[(h?432:16)+(c*28|0)+(n<<2)>>2]|0,0,s|0)|0,s=T()|0,n=i[(h?640:224)+(c*28|0)+(n<<2)>>2]|0,e=m|e&~p,t=s|t,!n){n=0;break a}if(!o){u=8;break a}}return t|0}while(0);(u|0)==8&&(h=i[848+(d*28|0)+(n<<2)>>2]|0,m=L(h|0,0,45)|0,e=m|e,t=T()|0|t&-1040385,n=i[4272+(d*28|0)+(n<<2)>>2]|0,(h&127|0)==127&&(h=L(i[848+(d*28|0)+20>>2]|0,0,45)|0,t=T()|0|t&-1040385,n=i[4272+(d*28|0)+20>>2]|0,e=Jt(h|e,t)|0,t=T()|0,i[r>>2]=(i[r>>2]|0)+1)),c=I(e|0,t|0,45)|0,T()|0,c&=127;b:do if(Se(c)|0){c:do if((Kt(e,t)|0)==1){if((d|0)!=(c|0))if(Oe(c,i[7696+(d*28|0)>>2]|0)|0){e=Xt(e,t)|0,s=1,t=T()|0;break}else E(27795,26864,533,26872);switch(l|0){case 3:e=Jt(e,t)|0,t=T()|0,i[r>>2]=(i[r>>2]|0)+1,s=0;break c;case 5:e=Xt(e,t)|0,t=T()|0,i[r>>2]=(i[r>>2]|0)+5,s=0;break c;case 0:return h=9,h|0;default:return h=1,h|0}}else s=0;while(0);if((n|0)>0){o=0;do e=qt(e,t)|0,t=T()|0,o=o+1|0;while((o|0)!=(n|0))}if((d|0)!=(c|0)){if(!(Ce(c)|0)){if((s|0)!=0|(Kt(e,t)|0)!=5)break;i[r>>2]=(i[r>>2]|0)+1;break}switch(f&127){case 8:case 118:break b;default:}(Kt(e,t)|0)!=3&&(i[r>>2]=(i[r>>2]|0)+1)}}else if((n|0)>0){o=0;do e=Jt(e,t)|0,t=T()|0,o=o+1|0;while((o|0)!=(n|0))}while(0);return i[r>>2]=((i[r>>2]|0)+n|0)%6|0,h=a,i[h>>2]=e,i[h+4>>2]=t,h=0,h|0}function pe(e,t,n,r){return e|=0,t|=0,n|=0,r|=0,me(e,t,n,r)|0?(Zr(r|0,0,n*48|0)|0,r=he(e,t,n,r)|0,r|0):(r=0,r|0)}function me(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0;if(h=A,A=A+16|0,p=h,m=h+8|0,f=p,i[f>>2]=e,i[f+4>>2]=t,(n|0)<0)return m=2,A=h,m|0;if(!n)return m=r,i[m>>2]=e,i[m+4>>2]=t,m=0,A=h,m|0;i[m>>2]=0;a:do if(Rt(e,t)|0)e=9;else{a=0,f=e;do{if(e=fe(f,t,4,m,p)|0,e|0)break a;if(t=p,f=i[t>>2]|0,t=i[t+4>>2]|0,a=a+1|0,Rt(f,t)|0){e=9;break a}}while((a|0)<(n|0));d=r,i[d>>2]=f,i[d+4>>2]=t,d=n+-1|0,u=0,e=1;do{if(a=26800+(u<<2)|0,(u|0)==5)for(s=i[a>>2]|0,o=0,a=e;;){if(e=p,e=fe(i[e>>2]|0,i[e+4>>2]|0,s,m,p)|0,e|0)break a;if((o|0)!=(d|0))if(l=p,c=i[l>>2]|0,l=i[l+4>>2]|0,e=r+(a<<3)|0,i[e>>2]=c,i[e+4>>2]=l,!(Rt(c,l)|0))e=a+1|0;else{e=9;break a}else e=a;if(o=o+1|0,(o|0)>=(n|0))break;a=e}else for(s=p,l=i[a>>2]|0,c=0,a=e,o=i[s>>2]|0,s=i[s+4>>2]|0;;){if(e=fe(o,s,l,m,p)|0,e|0)break a;if(s=p,o=i[s>>2]|0,s=i[s+4>>2]|0,e=r+(a<<3)|0,i[e>>2]=o,i[e+4>>2]=s,e=a+1|0,Rt(o,s)|0){e=9;break a}if(c=c+1|0,(c|0)>=(n|0))break;a=e}u=u+1|0}while(u>>>0<6);e=p,e=(f|0)==(i[e>>2]|0)&&(t|0)==(i[e+4>>2]|0)?0:9}while(0);return m=e,A=h,m|0}function he(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0;if(f=A,A=A+16|0,s=f,!n)return i[r>>2]=e,i[r+4>>2]=t,r=0,A=f,r|0;do if((n|0)>=0){if((n|0)>13780509){if(a=En(15,s)|0,a|0)break;o=s,a=i[o>>2]|0,o=i[o+4>>2]|0}else a=((n|0)<0)<<31>>31,d=Hr(n|0,a|0,3,0)|0,o=T()|0,a=Ir(n|0,a|0,1,0)|0,a=Hr(d|0,o|0,a|0,T()|0)|0,a=Ir(a|0,T()|0,1,0)|0,o=T()|0,d=s,i[d>>2]=a,i[d+4>>2]=o;if(u=Fr(a,8)|0,!u)a=13;else{if(d=Fr(a,4)|0,!d){F(u),a=13;break}if(a=de(e,t,n,u,d,a,o,0)|0,a|0){F(u),F(d);break}if(t=i[s>>2]|0,s=i[s+4>>2]|0,(s|0)>0|(s|0)==0&t>>>0>0){a=0,c=0,l=0;do e=u+(c<<3)|0,o=i[e>>2]|0,e=i[e+4>>2]|0,!((o|0)==0&(e|0)==0)&&(i[d+(c<<2)>>2]|0)==(n|0)&&(p=r+(a<<3)|0,i[p>>2]=o,i[p+4>>2]=e,a=a+1|0),c=Ir(c|0,l|0,1,0)|0,l=T()|0;while((l|0)<(s|0)|(l|0)==(s|0)&c>>>0<t>>>0)}F(u),F(d),a=0}}else a=2;while(0);return p=a,A=f,p|0}function ge(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0;for(c=A,A=A+16|0,o=c,s=c+8|0,a=(Rt(e,t)|0)==0,a=a?1:2;;){if(i[s>>2]=0,u=(fe(e,t,a,s,o)|0)==0,l=o,u&((i[l>>2]|0)==(n|0)?(i[l+4>>2]|0)==(r|0):0)){e=4;break}if(a=a+1|0,a>>>0>=7){a=7,e=4;break}}return(e|0)==4?(A=c,a|0):0}function _e(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0;if(c=A,A=A+48|0,a=c+16|0,o=c+8|0,s=c,n=tr(n)|0,n|0)return s=n,A=c,s|0;if(u=e,l=i[u+4>>2]|0,n=o,i[n>>2]=i[u>>2],i[n+4>>2]=l,er(o,a),n=Be(a,t,s)|0,!n){if(t=i[o>>2]|0,o=i[e+8>>2]|0,(o|0)>0){a=i[e+12>>2]|0,n=0;do t=(i[a+(n<<3)>>2]|0)+t|0,n=n+1|0;while((n|0)<(o|0))}n=s,a=i[n>>2]|0,n=i[n+4>>2]|0,o=((t|0)<0)<<31>>31,(n|0)<(o|0)|(n|0)==(o|0)&a>>>0<t>>>0?(n=s,i[n>>2]=t,i[n+4>>2]=o,n=o):t=a,l=Ir(t|0,n|0,12,0)|0,u=T()|0,n=s,i[n>>2]=l,i[n+4>>2]=u,n=r,i[n>>2]=l,i[n+4>>2]=u,n=0}return u=n,A=c,u|0}function ve(e,t,n,r,o,s,c){e|=0,t|=0,n|=0,r|=0,o|=0,s|=0,c|=0;var l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,E=0,D=0,O=0,ee=0,k=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0,se=0,ce=0;if(ie=A,A=A+64|0,k=ie+48|0,te=ie+32|0,ne=ie+24|0,C=ie+8|0,w=ie,u=i[e>>2]|0,(u|0)<=0)return re=0,A=ie,re|0;for(E=e+4|0,D=k+8|0,O=te+8|0,ee=C+8|0,l=0,x=0;;){d=i[E>>2]|0,b=d+(x<<4)|0,i[k>>2]=i[b>>2],i[k+4>>2]=i[b+4>>2],i[k+8>>2]=i[b+8>>2],i[k+12>>2]=i[b+12>>2],(x|0)==(u+-1|0)?(i[te>>2]=i[d>>2],i[te+4>>2]=i[d+4>>2],i[te+8>>2]=i[d+8>>2],i[te+12>>2]=i[d+12>>2]):(b=d+(x+1<<4)|0,i[te>>2]=i[b>>2],i[te+4>>2]=i[b+4>>2],i[te+8>>2]=i[b+8>>2],i[te+12>>2]=i[b+12>>2]),u=Ve(k,te,r,ne)|0;a:do if(u)d=0,l=u;else if(u=ne,d=i[u>>2]|0,u=i[u+4>>2]|0,(u|0)>0|(u|0)==0&d>>>0>0){y=0,b=0;b:for(;;){if(oe=1/(+(d>>>0)+4294967296*(u|0)),ce=+a[k>>3],u=Lr(d|0,u|0,y|0,b|0)|0,se=+(u>>>0)+4294967296*(T()|0),ae=+(y>>>0)+4294967296*(b|0),a[C>>3]=oe*(ce*se)+oe*(+a[te>>3]*ae),a[ee>>3]=oe*(+a[D>>3]*se)+oe*(+a[O>>3]*ae),u=$t(C,r,w)|0,u|0){l=u;break}v=w,_=i[v>>2]|0,v=i[v+4>>2]|0,m=Wr(_|0,v|0,t|0,n|0)|0,f=T()|0,u=c+(m<<3)|0,p=u,d=i[p>>2]|0,p=i[p+4>>2]|0;c:do if((d|0)==0&(p|0)==0)S=u,re=16;else for(h=0,g=0;;){if((h|0)>(n|0)|(h|0)==(n|0)&g>>>0>t>>>0){l=1;break b}if((d|0)==(_|0)&(p|0)==(v|0))break c;if(u=Ir(m|0,f|0,1,0)|0,m=Ur(u|0,T()|0,t|0,n|0)|0,f=T()|0,g=Ir(g|0,h|0,1,0)|0,h=T()|0,u=c+(m<<3)|0,p=u,d=i[p>>2]|0,p=i[p+4>>2]|0,(d|0)==0&(p|0)==0){S=u,re=16;break}}while(0);if((re|0)==16&&(re=0,!((_|0)==0&(v|0)==0))&&(g=S,i[g>>2]=_,i[g+4>>2]=v,g=s+(i[o>>2]<<3)|0,i[g>>2]=_,i[g+4>>2]=v,g=o,g=Ir(i[g>>2]|0,i[g+4>>2]|0,1,0)|0,_=T()|0,v=o,i[v>>2]=g,i[v+4>>2]=_),y=Ir(y|0,b|0,1,0)|0,b=T()|0,u=ne,d=i[u>>2]|0,u=i[u+4>>2]|0,!((u|0)>(b|0)|(u|0)==(b|0)&d>>>0>y>>>0)){d=1;break a}}d=0}else d=1;while(0);if(x=x+1|0,!d){re=21;break}if(u=i[e>>2]|0,(x|0)>=(u|0)){l=0,re=21;break}}return(re|0)==21?(A=ie,l|0):0}function ye(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,E=0,D=0,O=0,ee=0,k=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0;if(oe=A,A=A+112|0,ne=oe+80|0,l=oe+72|0,re=oe,ie=oe+56|0,a=tr(n)|0,a|0)return ae=a,A=oe,ae|0;if(u=e+8|0,ae=Pr((i[u>>2]<<5)+32|0)|0,!ae)return ae=13,A=oe,ae|0;if(nr(e,ae),a=tr(n)|0,!a){if(k=e,te=i[k+4>>2]|0,a=l,i[a>>2]=i[k>>2],i[a+4>>2]=te,er(l,ne),a=Be(ne,t,re)|0,a)k=0,te=0;else{if(a=i[l>>2]|0,o=i[u>>2]|0,(o|0)>0){s=i[e+12>>2]|0,n=0;do a=(i[s+(n<<3)>>2]|0)+a|0,n=n+1|0;while((n|0)!=(o|0));n=a}else n=a;a=re,o=i[a>>2]|0,a=i[a+4>>2]|0,s=((n|0)<0)<<31>>31,(a|0)<(s|0)|(a|0)==(s|0)&o>>>0<n>>>0?(a=re,i[a>>2]=n,i[a+4>>2]=s,a=s):n=o,k=Ir(n|0,a|0,12,0)|0,te=T()|0,a=re,i[a>>2]=k,i[a+4>>2]=te,a=0}if(!a){if(n=Fr(k,8)|0,!n)return F(ae),ae=13,A=oe,ae|0;if(c=Fr(k,8)|0,!c)return F(ae),F(n),ae=13,A=oe,ae|0;O=ne,i[O>>2]=0,i[O+4>>2]=0,O=e,ee=i[O+4>>2]|0,a=l,i[a>>2]=i[O>>2],i[a+4>>2]=ee,a=ve(l,k,te,t,ne,n,c)|0;a:do if(a)F(n),F(c),F(ae);else{b:do if((i[u>>2]|0)>0){for(s=e+12|0,o=0;a=ve((i[s>>2]|0)+(o<<3)|0,k,te,t,ne,n,c)|0,o=o+1|0,!(a|0);)if((o|0)>=(i[u>>2]|0))break b;F(n),F(c),F(ae);break a}while(0);(te|0)>0|(te|0)==0&k>>>0>0&&Zr(c|0,0,k<<3|0)|0,ee=ne,O=i[ee+4>>2]|0;c:do if((O|0)>0|(O|0)==0&(i[ee>>2]|0)>>>0>0){w=n,E=c,D=n,O=c,ee=n,a=n,x=n,S=c,C=c,n=c;d:for(;;){for(_=0,v=0,y=0,b=0,o=0,s=0;;){c=re,l=c+56|0;do i[c>>2]=0,c=c+4|0;while((c|0)<(l|0));if(t=w+(_<<3)|0,u=i[t>>2]|0,t=i[t+4>>2]|0,ue(u,t,1,re,0)|0){c=re,l=c+56|0;do i[c>>2]=0,c=c+4|0;while((c|0)<(l|0));c=Fr(7,4)|0,c|0&&(de(u,t,1,re,c,7,0,0)|0,F(c))}for(g=0;;){h=re+(g<<3)|0,m=i[h>>2]|0,h=i[h+4>>2]|0;e:do if((m|0)==0&(h|0)==0)c=o,l=s;else{if(d=Wr(m|0,h|0,k|0,te|0)|0,u=T()|0,c=r+(d<<3)|0,t=c,l=i[t>>2]|0,t=i[t+4>>2]|0,!((l|0)==0&(t|0)==0)){f=0,p=0;do{if((f|0)>(te|0)|(f|0)==(te|0)&p>>>0>k>>>0)break d;if((l|0)==(m|0)&(t|0)==(h|0)){c=o,l=s;break e}c=Ir(d|0,u|0,1,0)|0,d=Ur(c|0,T()|0,k|0,te|0)|0,u=T()|0,p=Ir(p|0,f|0,1,0)|0,f=T()|0,c=r+(d<<3)|0,t=c,l=i[t>>2]|0,t=i[t+4>>2]|0}while(!((l|0)==0&(t|0)==0))}if((m|0)==0&(h|0)==0){c=o,l=s;break}nn(m,h,ie)|0,rr(e,ae,ie)|0&&(p=Ir(o|0,s|0,1,0)|0,s=T()|0,f=c,i[f>>2]=m,i[f+4>>2]=h,o=E+(o<<3)|0,i[o>>2]=m,i[o+4>>2]=h,o=p),c=o,l=s}while(0);if(g=g+1|0,g>>>0>=7)break;o=c,s=l}if(_=Ir(_|0,v|0,1,0)|0,v=T()|0,y=Ir(y|0,b|0,1,0)|0,b=T()|0,s=ne,o=i[s>>2]|0,s=i[s+4>>2]|0,(b|0)<(s|0)|(b|0)==(s|0)&y>>>0<o>>>0)o=c,s=l;else break}if((s|0)>0|(s|0)==0&o>>>0>0){o=0,s=0;do b=w+(o<<3)|0,i[b>>2]=0,i[b+4>>2]=0,o=Ir(o|0,s|0,1,0)|0,s=T()|0,b=ne,y=i[b+4>>2]|0;while((s|0)<(y|0)|((s|0)==(y|0)?o>>>0<(i[b>>2]|0)>>>0:0))}if(b=ne,i[b>>2]=c,i[b+4>>2]=l,(l|0)>0|(l|0)==0&c>>>0>0)g=n,_=C,v=ee,y=S,b=E,n=x,C=a,S=D,x=g,a=_,ee=O,O=v,D=y,E=w,w=b;else break c}F(D),F(O),F(ae),a=1;break a}else a=c;while(0);F(ae),F(n),F(a),a=0}while(0);return ae=a,A=oe,ae|0}}return F(ae),ae=a,A=oe,ae|0}function be(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0,c=0,l=0,u=0,d=0;if(d=A,A=A+176|0,l=d,(t|0)<1)return Tr(n,0,0),u=0,A=d,u|0;for(c=e,c=I(i[c>>2]|0,i[c+4>>2]|0,52)|0,T()|0,Tr(n,(t|0)>6?t:6,c&15),c=0;r=e+(c<<3)|0,r=rn(i[r>>2]|0,i[r+4>>2]|0,l)|0,!(r|0);){if(r=i[l>>2]|0,(r|0)>0){s=0;do o=l+8+(s<<4)|0,s=s+1|0,r=l+8+(((s|0)%(r|0)|0)<<4)|0,a=Ar(n,r,o)|0,a?Or(n,a)|0:kr(n,o,r)|0,r=i[l>>2]|0;while((s|0)<(r|0))}if(c=c+1|0,(c|0)>=(t|0)){r=0,u=13;break}}return(u|0)==13?(A=d,r|0):(Er(n),u=r,A=d,u|0)}function xe(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0;if(o=A,A=A+32|0,r=o,a=o+16|0,e=be(e,t,a)|0,e|0)return n=e,A=o,n|0;if(i[n>>2]=0,i[n+4>>2]=0,i[n+8>>2]=0,e=Dr(a)|0,e|0)do{t=Pn(n)|0;do Fn(t,e)|0,s=e+16|0,i[r>>2]=i[s>>2],i[r+4>>2]=i[s+4>>2],i[r+8>>2]=i[s+8>>2],i[r+12>>2]=i[s+12>>2],Or(a,e)|0,e=jr(a,r)|0;while(e|0);e=Dr(a)|0}while(e|0);return Er(a),e=Ln(n)|0,e?(In(n),s=e,A=o,s|0):(s=0,A=o,s|0)}function Se(e){return e|=0,e>>>0>121?(e=0,e|0):(e=i[7696+(e*28|0)+16>>2]|0,e|0)}function Ce(e){return e|=0,(e|0)==4|(e|0)==117|0}function we(e){return e|=0,i[11120+((i[e>>2]|0)*216|0)+((i[e+4>>2]|0)*72|0)+((i[e+8>>2]|0)*24|0)+(i[e+12>>2]<<3)>>2]|0}function Te(e){return e|=0,i[11120+((i[e>>2]|0)*216|0)+((i[e+4>>2]|0)*72|0)+((i[e+8>>2]|0)*24|0)+(i[e+12>>2]<<3)+4>>2]|0}function Ee(e,t){e|=0,t|=0,e=7696+(e*28|0)|0,i[t>>2]=i[e>>2],i[t+4>>2]=i[e+4>>2],i[t+8>>2]=i[e+8>>2],i[t+12>>2]=i[e+12>>2]}function De(e,t){e|=0,t|=0;var n=0,r=0;if(t>>>0>20)return t=-1,t|0;do if((i[11120+(t*216|0)>>2]|0)!=(e|0))if((i[11120+(t*216|0)+8>>2]|0)!=(e|0))if((i[11120+(t*216|0)+16>>2]|0)!=(e|0))if((i[11120+(t*216|0)+24>>2]|0)!=(e|0))if((i[11120+(t*216|0)+32>>2]|0)!=(e|0))if((i[11120+(t*216|0)+40>>2]|0)!=(e|0))if((i[11120+(t*216|0)+48>>2]|0)!=(e|0))if((i[11120+(t*216|0)+56>>2]|0)!=(e|0))if((i[11120+(t*216|0)+64>>2]|0)!=(e|0))if((i[11120+(t*216|0)+72>>2]|0)!=(e|0))if((i[11120+(t*216|0)+80>>2]|0)!=(e|0))if((i[11120+(t*216|0)+88>>2]|0)!=(e|0))if((i[11120+(t*216|0)+96>>2]|0)!=(e|0))if((i[11120+(t*216|0)+104>>2]|0)!=(e|0))if((i[11120+(t*216|0)+112>>2]|0)!=(e|0))if((i[11120+(t*216|0)+120>>2]|0)!=(e|0))if((i[11120+(t*216|0)+128>>2]|0)!=(e|0))if((i[11120+(t*216|0)+136>>2]|0)==(e|0))e=2,n=1,r=2;else{if((i[11120+(t*216|0)+144>>2]|0)==(e|0)){e=0,n=2,r=0;break}if((i[11120+(t*216|0)+152>>2]|0)==(e|0)){e=0,n=2,r=1;break}if((i[11120+(t*216|0)+160>>2]|0)==(e|0)){e=0,n=2,r=2;break}if((i[11120+(t*216|0)+168>>2]|0)==(e|0)){e=1,n=2,r=0;break}if((i[11120+(t*216|0)+176>>2]|0)==(e|0)){e=1,n=2,r=1;break}if((i[11120+(t*216|0)+184>>2]|0)==(e|0)){e=1,n=2,r=2;break}if((i[11120+(t*216|0)+192>>2]|0)==(e|0)){e=2,n=2,r=0;break}if((i[11120+(t*216|0)+200>>2]|0)==(e|0)){e=2,n=2,r=1;break}if((i[11120+(t*216|0)+208>>2]|0)==(e|0)){e=2,n=2,r=2;break}else e=-1;return e|0}else e=2,n=1,r=1;else e=2,n=1,r=0;else e=1,n=1,r=2;else e=1,n=1,r=1;else e=1,n=1,r=0;else e=0,n=1,r=2;else e=0,n=1,r=1;else e=0,n=1,r=0;else e=2,n=0,r=2;else e=2,n=0,r=1;else e=2,n=0,r=0;else e=1,n=0,r=2;else e=1,n=0,r=1;else e=1,n=0,r=0;else e=0,n=0,r=2;else e=0,n=0,r=1;else e=0,n=0,r=0;while(0);return t=i[11120+(t*216|0)+(n*72|0)+(e*24|0)+(r<<3)+4>>2]|0,t|0}function Oe(e,t){return e|=0,t|=0,(i[7696+(e*28|0)+20>>2]|0)==(t|0)?(t=1,t|0):(t=(i[7696+(e*28|0)+24>>2]|0)==(t|0),t|0)}function ke(e,t){return e|=0,t|=0,i[848+(e*28|0)+(t<<2)>>2]|0}function Ae(e,t){return e|=0,t|=0,(i[848+(e*28|0)>>2]|0)==(t|0)?(t=0,t|0):(i[848+(e*28|0)+4>>2]|0)==(t|0)?(t=1,t|0):(i[848+(e*28|0)+8>>2]|0)==(t|0)?(t=2,t|0):(i[848+(e*28|0)+12>>2]|0)==(t|0)?(t=3,t|0):(i[848+(e*28|0)+16>>2]|0)==(t|0)?(t=4,t|0):(i[848+(e*28|0)+20>>2]|0)==(t|0)?(t=5,t|0):((i[848+(e*28|0)+24>>2]|0)==(t|0)?6:7)|0}function je(){return 122}function Me(e){e|=0;var t=0,n=0,r=0;t=0;do L(t|0,0,45)|0,r=T()|134225919,n=e+(t<<3)|0,i[n>>2]=-1,i[n+4>>2]=r,t=t+1|0;while((t|0)!=122);return 0}function Ne(e){e|=0;var t=0,n=0,r=0;return r=+a[e+16>>3],n=+a[e+24>>3],t=r-n,+(r<n?t+6.283185307179586:t)}function Pe(e){return e|=0,+a[e+16>>3]<+a[e+24>>3]|0}function Fe(e){return e|=0,+(a[e>>3]-+a[e+8>>3])}function Ie(e,t){e|=0,t|=0;var n=0,r=0,i=0;return n=+a[t>>3],!(n>=+a[e+8>>3])||!(n<=+a[e>>3])?(t=0,t|0):(r=+a[e+16>>3],n=+a[e+24>>3],i=+a[t+8>>3],t=i>=n,e=i<=r&1,r<n?t&&(e=1):t||(e=0),t=(e|0)!=0,t|0)}function Le(e,t){e|=0,t|=0;var n=0,r=0,i=0,o=0,s=0,c=0,l=0,u=0,d=0;return+a[e>>3]<+a[t+8>>3]||+a[e+8>>3]>+a[t>>3]?(r=0,r|0):(o=+a[e+16>>3],n=e+24|0,d=+a[n>>3],s=o<d,r=t+16|0,u=+a[r>>3],i=t+24|0,l=+a[i>>3],c=u<l,t=d-u<l-o,e=s?c|t?1:2:0,t=c?s?1:t?2:1:0,o=+gn(o,e),o<+gn(+a[i>>3],t)||(d=+gn(+a[n>>3],e),d>+gn(+a[r>>3],t))?(c=0,c|0):(c=1,c|0))}function Re(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var o=0,s=0,c=0,l=0,u=0;s=+a[e+16>>3],u=+a[e+24>>3],e=s<u,l=+a[t+16>>3],c=+a[t+24>>3],o=l<c,t=u-l<c-s,i[n>>2]=e?o|t?1:2:0,i[r>>2]=o?e?1:t?2:1:0}function ze(e,t){e|=0,t|=0;var n=0,r=0,i=0,o=0,s=0,c=0,l=0,u=0,d=0;return+a[e>>3]<+a[t>>3]||+a[e+8>>3]>+a[t+8>>3]?(r=0,r|0):(r=e+16|0,l=+a[r>>3],o=+a[e+24>>3],s=l<o,n=t+16|0,d=+a[n>>3],i=t+24|0,u=+a[i>>3],c=d<u,t=o-d<u-l,e=s?c|t?1:2:0,t=c?s?1:t?2:1:0,o=+gn(o,e),o<=+gn(+a[i>>3],t)?(d=+gn(+a[r>>3],e),c=d>=+gn(+a[n>>3],t),c|0):(c=0,c|0))}function j(e,t){e|=0,t|=0;var n=0,r=0,o=0,s=0,c=0,l=0;o=A,A=A+176|0,r=o,i[r>>2]=4,l=+a[t>>3],a[r+8>>3]=l,s=+a[t+16>>3],a[r+16>>3]=s,a[r+24>>3]=l,l=+a[t+24>>3],a[r+32>>3]=l,c=+a[t+8>>3],a[r+40>>3]=c,a[r+48>>3]=l,a[r+56>>3]=c,a[r+64>>3]=s,t=r+72|0,n=t+96|0;do i[t>>2]=0,t=t+4|0;while((t|0)<(n|0));Xr(e|0,r|0,168)|0,A=o}function Be(e,t,n){e|=0,t|=0,n|=0;var r=0,s=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,b=0,S=0,C=0;b=A,A=A+288|0,h=b+264|0,g=b+96|0,m=b,f=m,p=f+96|0;do i[f>>2]=0,f=f+4|0;while((f|0)<(p|0));return t=cn(t,m)|0,t|0?(v=t,A=b,v|0):(p=m,m=i[p>>2]|0,p=i[p+4>>2]|0,nn(m,p,h)|0,rn(m,p,g)|0,d=+vn(h,g+8|0),a[h>>3]=+a[e>>3],p=h+8|0,a[p>>3]=+a[e+16>>3],a[g>>3]=+a[e+8>>3],m=g+8|0,a[m>>3]=+a[e+24>>3],s=+vn(h,g),C=a[p>>3]-+a[m>>3],u=+l(+C),S=a[h>>3]-+a[g>>3],r=+l(+S),!(C==0|S==0)&&(C=+qr(+u,+r),C=+y(+(s*s/+Jr(+(C/+Jr(+u,+r)),3)/(d*(d*2.59807621135)*.8))),a[o>>3]=C,_=~~C>>>0,v=+l(C)>=1?C>0?~~+x(+c(C/4294967296),4294967295)>>>0:~~+y((C-+(~~C>>>0))/4294967296)>>>0:0,(i[o+4>>2]&2146435072|0)!=2146435072)?(g=(_|0)==0&(v|0)==0,t=n,i[t>>2]=g?1:_,i[t+4>>2]=g?0:v,t=0):t=1,v=t,A=b,v|0)}function Ve(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var s=0,u=0,d=0,f=0,p=0,m=0,h=0;m=A,A=A+288|0,d=m+264|0,f=m+96|0,p=m,s=p,u=s+96|0;do i[s>>2]=0,s=s+4|0;while((s|0)<(u|0));return n=cn(n,p)|0,n|0?(r=n,A=m,r|0):(n=p,s=i[n>>2]|0,n=i[n+4>>2]|0,nn(s,n,d)|0,rn(s,n,f)|0,h=+vn(d,f+8|0),h=+y(+(vn(e,t)/(h*2))),a[o>>3]=h,n=~~h>>>0,s=+l(h)>=1?h>0?~~+x(+c(h/4294967296),4294967295)>>>0:~~+y((h-+(~~h>>>0))/4294967296)>>>0:0,(i[o+4>>2]&2146435072|0)==2146435072?(r=1,A=m,r|0):(p=(n|0)==0&(s|0)==0,i[r>>2]=p?1:n,i[r+4>>2]=p?0:s,r=0,A=m,r|0))}function He(e,t){e|=0,t=+t;var n=0,r=0,i=0,o=0,s=0,c=0,l=0,u=0,d=0;o=e+16|0,s=+a[o>>3],n=e+24|0,i=+a[n>>3],r=s-i,r=s<i?r+6.283185307179586:r,u=+a[e>>3],c=e+8|0,l=+a[c>>3],d=u-l,r=(r*t-r)*.5,t=(d*t-d)*.5,u+=t,a[e>>3]=u>1.5707963267948966?1.5707963267948966:u,t=l-t,a[c>>3]=t<-1.5707963267948966?-1.5707963267948966:t,t=s+r,t=t>3.141592653589793?t+-6.283185307179586:t,a[o>>3]=t<-3.141592653589793?t+6.283185307179586:t,t=i-r,t=t>3.141592653589793?t+-6.283185307179586:t,a[n>>3]=t<-3.141592653589793?t+6.283185307179586:t}function Ue(e,t,n,r){e|=0,t|=0,n|=0,r|=0,i[e>>2]=t,i[e+4>>2]=n,i[e+8>>2]=r}function We(e,t){e|=0,t|=0;var n=0,r=0,o=0,s=0,c=0,u=0,d=0,f=0,p=0,m=0,h=0;m=t+8|0,i[m>>2]=0,d=+a[e>>3],c=+l(+d),f=+a[e+8>>3],u=l(+f)*1.1547005383792515,c+=u*.5,n=~~c,e=~~u,c-=+(n|0),u-=+(e|0);do if(c<.5)if(c<.3333333333333333)if(i[t>>2]=n,u<(c+1)*.5){i[t+4>>2]=e;break}else{e=e+1|0,i[t+4>>2]=e;break}else if(h=1-c,e=(!(u<h)&1)+e|0,i[t+4>>2]=e,h<=u&u<c*2){n=n+1|0,i[t>>2]=n;break}else{i[t>>2]=n;break}else{if(!(c<.6666666666666666))if(n=n+1|0,i[t>>2]=n,u<c*.5){i[t+4>>2]=e;break}else{e=e+1|0,i[t+4>>2]=e;break}if(u<1-c){if(i[t+4>>2]=e,c*2+-1<u){i[t>>2]=n;break}}else e=e+1|0,i[t+4>>2]=e;n=n+1|0,i[t>>2]=n}while(0);do if(d<0)if(e&1){p=(e+1|0)/2|0,p=Lr(n|0,((n|0)<0)<<31>>31|0,p|0,((p|0)<0)<<31>>31|0)|0,n=~~((n|0)-((+(p>>>0)+4294967296*(T()|0))*2+1)),i[t>>2]=n;break}else{p=(e|0)/2|0,p=Lr(n|0,((n|0)<0)<<31>>31|0,p|0,((p|0)<0)<<31>>31|0)|0,n=~~((n|0)-(+(p>>>0)+4294967296*(T()|0))*2),i[t>>2]=n;break}while(0);p=t+4|0,f<0&&(n=n-((e<<1|1)/2|0)|0,i[t>>2]=n,e=0-e|0,i[p>>2]=e),r=e-n|0,(n|0)<0?(o=0-n|0,i[p>>2]=r,i[m>>2]=o,i[t>>2]=0,e=r,n=0):o=0,(e|0)<0&&(n=n-e|0,i[t>>2]=n,o=o-e|0,i[m>>2]=o,i[p>>2]=0,e=0),s=n-o|0,r=e-o|0,(o|0)<0&&(i[t>>2]=s,i[p>>2]=r,i[m>>2]=0,e=r,n=s,o=0),r=(e|0)<(n|0)?e:n,r=(o|0)<(r|0)?o:r,!((r|0)<=0)&&(i[t>>2]=n-r,i[p>>2]=e-r,i[m>>2]=o-r)}function Ge(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0;t=i[e>>2]|0,s=e+4|0,n=i[s>>2]|0,(t|0)<0&&(n=n-t|0,i[s>>2]=n,o=e+8|0,i[o>>2]=(i[o>>2]|0)-t,i[e>>2]=0,t=0),(n|0)<0?(t=t-n|0,i[e>>2]=t,o=e+8|0,a=(i[o>>2]|0)-n|0,i[o>>2]=a,i[s>>2]=0,n=0):(a=e+8|0,o=a,a=i[a>>2]|0),(a|0)<0&&(t=t-a|0,i[e>>2]=t,n=n-a|0,i[s>>2]=n,i[o>>2]=0,a=0),r=(n|0)<(t|0)?n:t,r=(a|0)<(r|0)?a:r,!((r|0)<=0)&&(i[e>>2]=t-r,i[s>>2]=n-r,i[o>>2]=a-r)}function Ke(e,t){e|=0,t|=0;var n=0,r=0;r=i[e+8>>2]|0,n=+((i[e+4>>2]|0)-r|0),a[t>>3]=((i[e>>2]|0)-r|0)-n*.5,a[t+8>>3]=n*.8660254037844386}function M(e,t,n){e|=0,t|=0,n|=0,i[n>>2]=(i[t>>2]|0)+(i[e>>2]|0),i[n+4>>2]=(i[t+4>>2]|0)+(i[e+4>>2]|0),i[n+8>>2]=(i[t+8>>2]|0)+(i[e+8>>2]|0)}function qe(e,t,n){e|=0,t|=0,n|=0,i[n>>2]=(i[e>>2]|0)-(i[t>>2]|0),i[n+4>>2]=(i[e+4>>2]|0)-(i[t+4>>2]|0),i[n+8>>2]=(i[e+8>>2]|0)-(i[t+8>>2]|0)}function Je(e,t){e|=0,t|=0;var n=0,r=0;n=b(i[e>>2]|0,t)|0,i[e>>2]=n,n=e+4|0,r=b(i[n>>2]|0,t)|0,i[n>>2]=r,e=e+8|0,t=b(i[e>>2]|0,t)|0,i[e>>2]=t}function Ye(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0;s=i[e>>2]|0,c=(s|0)<0,r=(i[e+4>>2]|0)-(c?s:0)|0,o=(r|0)<0,a=(o?0-r|0:0)+((i[e+8>>2]|0)-(c?s:0))|0,n=(a|0)<0,e=n?0:a,t=(o?0:r)-(n?a:0)|0,a=(c?0:s)-(o?r:0)-(n?a:0)|0,n=(t|0)<(a|0)?t:a,n=(e|0)<(n|0)?e:n,r=(n|0)>0,e=e-(r?n:0)|0,t=t-(r?n:0)|0;a:do switch(a-(r?n:0)|0){case 0:switch(t|0){case 0:return c=e|0?(e|0)==1?1:7:0,c|0;case 1:return c=e|0?(e|0)==1?3:7:2,c|0;default:break a}case 1:switch(t|0){case 0:return c=e|0?(e|0)==1?5:7:4,c|0;case 1:if(!e)e=6;else break a;return e|0;default:break a}default:}while(0);return c=7,c|0}function Xe(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0,l=0,u=0;if(l=e+8|0,s=i[l>>2]|0,c=(i[e>>2]|0)-s|0,u=e+4|0,s=(i[u>>2]|0)-s|0,c>>>0>715827881|s>>>0>715827881){if(r=(c|0)>0,a=2147483647-c|0,o=-2147483648-c|0,(r?(a|0)<(c|0):(o|0)>(c|0))||(n=c<<1,r?(2147483647-n|0)<(c|0):(-2147483648-n|0)>(c|0))||((s|0)>0?(2147483647-s|0)<(s|0):(-2147483648-s|0)>(s|0))||(t=c*3|0,n=s<<1,(r?(a|0)<(n|0):(o|0)>(n|0))||((c|0)>-1?(t|-2147483648)>=(s|0):(t^-2147483648|0)<(s|0))))return u=1,u|0}else n=s<<1,t=c*3|0;return r=Nr((t-s|0)*.14285714285714285)|0,i[e>>2]=r,a=Nr((n+c|0)*.14285714285714285)|0,i[u>>2]=a,i[l>>2]=0,n=(a|0)<(r|0),t=n?r:a,n=n?a:r,(n|0)<0&&(((n|0)==-2147483648||((t|0)>0?(2147483647-t|0)<(n|0):(-2147483648-t|0)>(n|0)))&&E(27795,26892,354,26903),((t|0)>-1?(t|-2147483648)>=(n|0):(t^-2147483648|0)<(n|0))&&E(27795,26892,354,26903)),t=a-r|0,(r|0)<0?(n=0-r|0,i[u>>2]=t,i[l>>2]=n,i[e>>2]=0,r=0):(t=a,n=0),(t|0)<0&&(r=r-t|0,i[e>>2]=r,n=n-t|0,i[l>>2]=n,i[u>>2]=0,t=0),o=r-n|0,a=t-n|0,(n|0)<0?(i[e>>2]=o,i[u>>2]=a,i[l>>2]=0,t=a,a=o,n=0):a=r,r=(t|0)<(a|0)?t:a,r=(n|0)<(r|0)?n:r,(r|0)<=0?(u=0,u|0):(i[e>>2]=a-r,i[u>>2]=t-r,i[l>>2]=n-r,u=0,u|0)}function Ze(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0,l=0;if(s=e+8|0,a=i[s>>2]|0,o=(i[e>>2]|0)-a|0,c=e+4|0,a=(i[c>>2]|0)-a|0,o>>>0>715827881|a>>>0>715827881){if(n=(o|0)>0,(n?(2147483647-o|0)<(o|0):(-2147483648-o|0)>(o|0))||(t=o<<1,r=(a|0)>0,r?(2147483647-a|0)<(a|0):(-2147483648-a|0)>(a|0)))return c=1,c|0;if(l=a<<1,(r?(2147483647-l|0)<(a|0):(-2147483648-l|0)>(a|0))||(n?(2147483647-t|0)<(a|0):(-2147483648-t|0)>(a|0))||(n=a*3|0,(a|0)>-1?(n|-2147483648)>=(o|0):(n^-2147483648|0)<(o|0)))return l=1,l|0}else n=a*3|0,t=o<<1;return r=Nr((t+a|0)*.14285714285714285)|0,i[e>>2]=r,a=Nr((n-o|0)*.14285714285714285)|0,i[c>>2]=a,i[s>>2]=0,n=(a|0)<(r|0),t=n?r:a,n=n?a:r,(n|0)<0&&(((n|0)==-2147483648||((t|0)>0?(2147483647-t|0)<(n|0):(-2147483648-t|0)>(n|0)))&&E(27795,26892,402,26917),((t|0)>-1?(t|-2147483648)>=(n|0):(t^-2147483648|0)<(n|0))&&E(27795,26892,402,26917)),t=a-r|0,(r|0)<0?(n=0-r|0,i[c>>2]=t,i[s>>2]=n,i[e>>2]=0,r=0):(t=a,n=0),(t|0)<0&&(r=r-t|0,i[e>>2]=r,n=n-t|0,i[s>>2]=n,i[c>>2]=0,t=0),o=r-n|0,a=t-n|0,(n|0)<0?(i[e>>2]=o,i[c>>2]=a,i[s>>2]=0,t=a,a=o,n=0):a=r,r=(t|0)<(a|0)?t:a,r=(n|0)<(r|0)?n:r,(r|0)<=0?(l=0,l|0):(i[e>>2]=a-r,i[c>>2]=t-r,i[s>>2]=n-r,l=0,l|0)}function Qe(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0;s=e+8|0,n=i[s>>2]|0,t=(i[e>>2]|0)-n|0,c=e+4|0,n=(i[c>>2]|0)-n|0,r=Nr(((t*3|0)-n|0)*.14285714285714285)|0,i[e>>2]=r,t=Nr(((n<<1)+t|0)*.14285714285714285)|0,i[c>>2]=t,i[s>>2]=0,n=t-r|0,(r|0)<0?(o=0-r|0,i[c>>2]=n,i[s>>2]=o,i[e>>2]=0,t=n,r=0,n=o):n=0,(t|0)<0&&(r=r-t|0,i[e>>2]=r,n=n-t|0,i[s>>2]=n,i[c>>2]=0,t=0),o=r-n|0,a=t-n|0,(n|0)<0?(i[e>>2]=o,i[c>>2]=a,i[s>>2]=0,t=a,a=o,n=0):a=r,r=(t|0)<(a|0)?t:a,r=(n|0)<(r|0)?n:r,!((r|0)<=0)&&(i[e>>2]=a-r,i[c>>2]=t-r,i[s>>2]=n-r)}function $e(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0;s=e+8|0,n=i[s>>2]|0,t=(i[e>>2]|0)-n|0,c=e+4|0,n=(i[c>>2]|0)-n|0,r=Nr(((t<<1)+n|0)*.14285714285714285)|0,i[e>>2]=r,t=Nr(((n*3|0)-t|0)*.14285714285714285)|0,i[c>>2]=t,i[s>>2]=0,n=t-r|0,(r|0)<0?(o=0-r|0,i[c>>2]=n,i[s>>2]=o,i[e>>2]=0,t=n,r=0,n=o):n=0,(t|0)<0&&(r=r-t|0,i[e>>2]=r,n=n-t|0,i[s>>2]=n,i[c>>2]=0,t=0),o=r-n|0,a=t-n|0,(n|0)<0?(i[e>>2]=o,i[c>>2]=a,i[s>>2]=0,t=a,a=o,n=0):a=r,r=(t|0)<(a|0)?t:a,r=(n|0)<(r|0)?n:r,!((r|0)<=0)&&(i[e>>2]=a-r,i[c>>2]=t-r,i[s>>2]=n-r)}function et(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0;t=i[e>>2]|0,s=e+4|0,n=i[s>>2]|0,c=e+8|0,r=i[c>>2]|0,a=n+(t*3|0)|0,i[e>>2]=a,n=r+(n*3|0)|0,i[s>>2]=n,t=(r*3|0)+t|0,i[c>>2]=t,r=n-a|0,(a|0)<0?(t=t-a|0,i[s>>2]=r,i[c>>2]=t,i[e>>2]=0,n=r,r=0):r=a,(n|0)<0&&(r=r-n|0,i[e>>2]=r,t=t-n|0,i[c>>2]=t,i[s>>2]=0,n=0),o=r-t|0,a=n-t|0,(t|0)<0?(i[e>>2]=o,i[s>>2]=a,i[c>>2]=0,r=o,t=0):a=n,n=(a|0)<(r|0)?a:r,n=(t|0)<(n|0)?t:n,!((n|0)<=0)&&(i[e>>2]=r-n,i[s>>2]=a-n,i[c>>2]=t-n)}function tt(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0;a=i[e>>2]|0,s=e+4|0,t=i[s>>2]|0,c=e+8|0,n=i[c>>2]|0,r=(t*3|0)+a|0,a=n+(a*3|0)|0,i[e>>2]=a,i[s>>2]=r,t=(n*3|0)+t|0,i[c>>2]=t,n=r-a|0,(a|0)<0?(t=t-a|0,i[s>>2]=n,i[c>>2]=t,i[e>>2]=0,a=0):n=r,(n|0)<0&&(a=a-n|0,i[e>>2]=a,t=t-n|0,i[c>>2]=t,i[s>>2]=0,n=0),o=a-t|0,r=n-t|0,(t|0)<0?(i[e>>2]=o,i[s>>2]=r,i[c>>2]=0,a=o,t=0):r=n,n=(r|0)<(a|0)?r:a,n=(t|0)<(n|0)?t:n,!((n|0)<=0)&&(i[e>>2]=a-n,i[s>>2]=r-n,i[c>>2]=t-n)}function nt(e,t){e|=0,t|=0;var n=0,r=0,a=0,o=0,s=0,c=0;(t+-1|0)>>>0>=6||(a=(i[15440+(t*12|0)>>2]|0)+(i[e>>2]|0)|0,i[e>>2]=a,c=e+4|0,r=(i[15440+(t*12|0)+4>>2]|0)+(i[c>>2]|0)|0,i[c>>2]=r,s=e+8|0,t=(i[15440+(t*12|0)+8>>2]|0)+(i[s>>2]|0)|0,i[s>>2]=t,n=r-a|0,(a|0)<0?(t=t-a|0,i[c>>2]=n,i[s>>2]=t,i[e>>2]=0,r=0):(n=r,r=a),(n|0)<0&&(r=r-n|0,i[e>>2]=r,t=t-n|0,i[s>>2]=t,i[c>>2]=0,n=0),o=r-t|0,a=n-t|0,(t|0)<0?(i[e>>2]=o,i[c>>2]=a,i[s>>2]=0,r=o,t=0):a=n,n=(a|0)<(r|0)?a:r,n=(t|0)<(n|0)?t:n,!((n|0)<=0)&&(i[e>>2]=r-n,i[c>>2]=a-n,i[s>>2]=t-n))}function rt(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0;a=i[e>>2]|0,s=e+4|0,t=i[s>>2]|0,c=e+8|0,n=i[c>>2]|0,r=t+a|0,a=n+a|0,i[e>>2]=a,i[s>>2]=r,t=n+t|0,i[c>>2]=t,n=r-a|0,(a|0)<0?(t=t-a|0,i[s>>2]=n,i[c>>2]=t,i[e>>2]=0,r=0):(n=r,r=a),(n|0)<0&&(r=r-n|0,i[e>>2]=r,t=t-n|0,i[c>>2]=t,i[s>>2]=0,n=0),o=r-t|0,a=n-t|0,(t|0)<0?(i[e>>2]=o,i[s>>2]=a,i[c>>2]=0,r=o,t=0):a=n,n=(a|0)<(r|0)?a:r,n=(t|0)<(n|0)?t:n,!((n|0)<=0)&&(i[e>>2]=r-n,i[s>>2]=a-n,i[c>>2]=t-n)}function it(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0;t=i[e>>2]|0,s=e+4|0,r=i[s>>2]|0,c=e+8|0,n=i[c>>2]|0,a=r+t|0,i[e>>2]=a,r=n+r|0,i[s>>2]=r,t=n+t|0,i[c>>2]=t,n=r-a|0,(a|0)<0?(t=t-a|0,i[s>>2]=n,i[c>>2]=t,i[e>>2]=0,r=0):(n=r,r=a),(n|0)<0&&(r=r-n|0,i[e>>2]=r,t=t-n|0,i[c>>2]=t,i[s>>2]=0,n=0),o=r-t|0,a=n-t|0,(t|0)<0?(i[e>>2]=o,i[s>>2]=a,i[c>>2]=0,r=o,t=0):a=n,n=(a|0)<(r|0)?a:r,n=(t|0)<(n|0)?t:n,!((n|0)<=0)&&(i[e>>2]=r-n,i[s>>2]=a-n,i[c>>2]=t-n)}function at(e){switch(e|=0,e|0){case 1:e=5;break;case 5:e=4;break;case 4:e=6;break;case 6:e=2;break;case 2:e=3;break;case 3:e=1;break;default:}return e|0}function ot(e){switch(e|=0,e|0){case 1:e=3;break;case 3:e=2;break;case 2:e=6;break;case 6:e=4;break;case 4:e=5;break;case 5:e=1;break;default:}return e|0}function st(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0;t=i[e>>2]|0,s=e+4|0,n=i[s>>2]|0,c=e+8|0,r=i[c>>2]|0,a=n+(t<<1)|0,i[e>>2]=a,n=r+(n<<1)|0,i[s>>2]=n,t=(r<<1)+t|0,i[c>>2]=t,r=n-a|0,(a|0)<0?(t=t-a|0,i[s>>2]=r,i[c>>2]=t,i[e>>2]=0,n=r,r=0):r=a,(n|0)<0&&(r=r-n|0,i[e>>2]=r,t=t-n|0,i[c>>2]=t,i[s>>2]=0,n=0),o=r-t|0,a=n-t|0,(t|0)<0?(i[e>>2]=o,i[s>>2]=a,i[c>>2]=0,r=o,t=0):a=n,n=(a|0)<(r|0)?a:r,n=(t|0)<(n|0)?t:n,!((n|0)<=0)&&(i[e>>2]=r-n,i[s>>2]=a-n,i[c>>2]=t-n)}function ct(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0;a=i[e>>2]|0,s=e+4|0,t=i[s>>2]|0,c=e+8|0,n=i[c>>2]|0,r=(t<<1)+a|0,a=n+(a<<1)|0,i[e>>2]=a,i[s>>2]=r,t=(n<<1)+t|0,i[c>>2]=t,n=r-a|0,(a|0)<0?(t=t-a|0,i[s>>2]=n,i[c>>2]=t,i[e>>2]=0,a=0):n=r,(n|0)<0&&(a=a-n|0,i[e>>2]=a,t=t-n|0,i[c>>2]=t,i[s>>2]=0,n=0),o=a-t|0,r=n-t|0,(t|0)<0?(i[e>>2]=o,i[s>>2]=r,i[c>>2]=0,a=o,t=0):r=n,n=(r|0)<(a|0)?r:a,n=(t|0)<(n|0)?t:n,!((n|0)<=0)&&(i[e>>2]=a-n,i[s>>2]=r-n,i[c>>2]=t-n)}function lt(e,t){e|=0,t|=0;var n=0,r=0,a=0,o=0,s=0,c=0;return s=(i[e>>2]|0)-(i[t>>2]|0)|0,c=(s|0)<0,r=(i[e+4>>2]|0)-(i[t+4>>2]|0)-(c?s:0)|0,o=(r|0)<0,a=(c?0-s|0:0)+(i[e+8>>2]|0)-(i[t+8>>2]|0)+(o?0-r|0:0)|0,e=(a|0)<0,t=e?0:a,n=(o?0:r)-(e?a:0)|0,a=(c?0:s)-(o?r:0)-(e?a:0)|0,e=(n|0)<(a|0)?n:a,e=(t|0)<(e|0)?t:e,r=(e|0)>0,t=t-(r?e:0)|0,n=n-(r?e:0)|0,e=a-(r?e:0)|0,e=(e|0)>-1?e:0-e|0,n=(n|0)>-1?n:0-n|0,t=(t|0)>-1?t:0-t|0,t=(n|0)>(t|0)?n:t,((e|0)>(t|0)?e:t)|0}function ut(e,t){e|=0,t|=0;var n=0;n=i[e+8>>2]|0,i[t>>2]=(i[e>>2]|0)-n,i[t+4>>2]=(i[e+4>>2]|0)-n}function dt(e,t){e|=0,t|=0;var n=0,r=0,a=0,o=0,s=0,c=0;return r=i[e>>2]|0,i[t>>2]=r,a=i[e+4>>2]|0,s=t+4|0,i[s>>2]=a,c=t+8|0,i[c>>2]=0,n=(a|0)<(r|0),e=n?r:a,n=n?a:r,(n|0)<0&&((n|0)==-2147483648||((e|0)>0?(2147483647-e|0)<(n|0):(-2147483648-e|0)>(n|0))||((e|0)>-1?(e|-2147483648)>=(n|0):(e^-2147483648|0)<(n|0)))?(t=1,t|0):(e=a-r|0,(r|0)<0?(n=0-r|0,i[s>>2]=e,i[c>>2]=n,i[t>>2]=0,r=0):(e=a,n=0),(e|0)<0&&(r=r-e|0,i[t>>2]=r,n=n-e|0,i[c>>2]=n,i[s>>2]=0,e=0),o=r-n|0,a=e-n|0,(n|0)<0?(i[t>>2]=o,i[s>>2]=a,i[c>>2]=0,e=a,a=o,n=0):a=r,r=(e|0)<(a|0)?e:a,r=(n|0)<(r|0)?n:r,(r|0)<=0?(t=0,t|0):(i[t>>2]=a-r,i[s>>2]=e-r,i[c>>2]=n-r,t=0,t|0))}function ft(e){e|=0;var t=0,n=0,r=0,a=0;t=e+8|0,a=i[t>>2]|0,n=a-(i[e>>2]|0)|0,i[e>>2]=n,r=e+4|0,e=(i[r>>2]|0)-a|0,i[r>>2]=e,i[t>>2]=0-(e+n)}function pt(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0;n=i[e>>2]|0,t=0-n|0,i[e>>2]=t,s=e+8|0,i[s>>2]=0,c=e+4|0,r=i[c>>2]|0,a=r+n|0,(n|0)>0?(i[c>>2]=a,i[s>>2]=n,i[e>>2]=0,t=0,r=a):n=0,(r|0)<0?(o=t-r|0,i[e>>2]=o,n=n-r|0,i[s>>2]=n,i[c>>2]=0,a=o-n|0,t=0-n|0,(n|0)<0?(i[e>>2]=a,i[c>>2]=t,i[s>>2]=0,r=t,n=0):(r=0,a=o)):a=t,t=(r|0)<(a|0)?r:a,t=(n|0)<(t|0)?n:t,!((t|0)<=0)&&(i[e>>2]=a-t,i[c>>2]=r-t,i[s>>2]=n-t)}function mt(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o=0,s=0,c=0,l=0,u=0,d=0,f=0;if(f=A,A=A+64|0,d=f,c=f+56|0,!(!0&(t&2013265920|0)==134217728&(!0&(r&2013265920|0)==134217728)))return a=5,A=f,a|0;if((e|0)==(n|0)&(t|0)==(r|0))return i[a>>2]=0,a=0,A=f,a|0;if(s=I(e|0,t|0,52)|0,T()|0,s&=15,u=I(n|0,r|0,52)|0,T()|0,(s|0)!=(u&15|0))return a=12,A=f,a|0;if(o=s+-1|0,s>>>0>1){It(e,t,o,d)|0,It(n,r,o,c)|0,u=d,l=i[u>>2]|0,u=i[u+4>>2]|0;a:do if((l|0)==(i[c>>2]|0)&&(u|0)==(i[c+4>>2]|0)){s=(s^15)*3|0,o=I(e|0,t|0,s|0)|0,T()|0,o&=7,s=I(n|0,r|0,s|0)|0,T()|0,s&=7;do if((o|0)==0|(s|0)==0)i[a>>2]=1,o=0;else if((o|0)==7)o=5;else{if((o|0)==1|(s|0)==1&&Rt(l,u)|0){o=5;break}if((i[15536+(o<<2)>>2]|0)!=(s|0)&&(i[15568+(o<<2)>>2]|0)!=(s|0))break a;i[a>>2]=1,o=0}while(0);return a=o,A=f,a|0}while(0)}o=d,s=o+56|0;do i[o>>2]=0,o=o+4|0;while((o|0)<(s|0));return ce(e,t,1,d)|0,t=d,!((i[t>>2]|0)==(n|0)&&(i[t+4>>2]|0)==(r|0))&&(t=d+8|0,!((i[t>>2]|0)==(n|0)&&(i[t+4>>2]|0)==(r|0)))&&(t=d+16|0,!((i[t>>2]|0)==(n|0)&&(i[t+4>>2]|0)==(r|0)))&&(t=d+24|0,!((i[t>>2]|0)==(n|0)&&(i[t+4>>2]|0)==(r|0)))&&(t=d+32|0,!((i[t>>2]|0)==(n|0)&&(i[t+4>>2]|0)==(r|0)))&&(t=d+40|0,!((i[t>>2]|0)==(n|0)&&(i[t+4>>2]|0)==(r|0)))?(o=d+48|0,o=((i[o>>2]|0)==(n|0)?(i[o+4>>2]|0)==(r|0):0)&1):o=1,i[a>>2]=o,a=0,A=f,a|0}function ht(e,t,n,r,a){return e|=0,t|=0,n|=0,r|=0,a|=0,n=ge(e,t,n,r)|0,(n|0)==7?(a=11,a|0):(r=L(n|0,0,56)|0,t=t&-2130706433|(T()|0)|268435456,i[a>>2]=e|r,i[a+4>>2]=t,a=0,a|0)}function gt(e,t,n){return e|=0,t|=0,n|=0,!0&(t&2013265920|0)==268435456?(i[n>>2]=e,i[n+4>>2]=t&-2130706433|134217728,n=0,n|0):(n=6,n|0)}function _t(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0;return a=A,A=A+16|0,r=a,i[r>>2]=0,!0&(t&2013265920|0)==268435456?(o=I(e|0,t|0,56)|0,T()|0,r=fe(e,t&-2130706433|134217728,o&7,r,n)|0,A=a,r|0):(r=6,A=a,r|0)}function vt(e,t){e|=0,t|=0;var n=0;switch(n=I(e|0,t|0,56)|0,T()|0,n&7){case 0:case 7:return n=0,n|0;default:}return n=t&-2130706433|134217728,!(!0&(t&2013265920|0)==268435456)||!0&(t&117440512|0)==16777216&(Rt(e,n)|0)!=0?(n=0,n|0):(n=Pt(e,n)|0,n|0)}function yt(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0;return a=A,A=A+16|0,r=a,!0&(t&2013265920|0)==268435456?(o=t&-2130706433|134217728,s=n,i[s>>2]=e,i[s+4>>2]=o,i[r>>2]=0,t=I(e|0,t|0,56)|0,T()|0,r=fe(e,o,t&7,r,n+8|0)|0,A=a,r|0):(r=6,A=a,r|0)}function bt(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0;return a=(Rt(e,t)|0)==0,t&=-2130706433,r=n,i[r>>2]=a?e:0,i[r+4>>2]=a?t|285212672:0,r=n+8|0,i[r>>2]=e,i[r+4>>2]=t|301989888,r=n+16|0,i[r>>2]=e,i[r+4>>2]=t|318767104,r=n+24|0,i[r>>2]=e,i[r+4>>2]=t|335544320,r=n+32|0,i[r>>2]=e,i[r+4>>2]=t|352321536,n=n+40|0,i[n>>2]=e,i[n+4>>2]=t|369098752,0}function xt(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0;return s=A,A=A+16|0,a=s,o=t&-2130706433|134217728,!0&(t&2013265920|0)==268435456?(r=I(e|0,t|0,56)|0,T()|0,r=br(e,o,r&7)|0,(r|0)==-1?(i[n>>2]=0,o=6,A=s,o|0):(tn(e,o,a)|0&&E(27795,26932,282,26947),t=I(e|0,t|0,52)|0,T()|0,t&=15,Rt(e,o)|0?Dt(a,t,r,2,n):At(a,t,r,2,n),o=0,A=s,o|0)):(o=6,A=s,o|0)}function St(e,t,n){e|=0,t|=0,n|=0;var r=0,i=0;r=A,A=A+16|0,i=r,Ct(e,t,n,i),We(i,n+4|0),A=r}function Ct(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var o=0,s=0,c=0,l=0,u=0;if(l=A,A=A+16|0,u=l,wt(e,n,u),s=+h(+(1-a[u>>3]*.5)),s<1e-16){i[r>>2]=0,i[r+4>>2]=0,i[r+8>>2]=0,i[r+12>>2]=0,A=l;return}if(u=i[n>>2]|0,o=+a[15920+(u*24|0)>>3],o=+mn(o-+mn(+bn(15600+(u<<4)|0,e))),c=Qt(t)|0?+mn(o+-.3334731722518321):o,o=m(+s)*2.618033988749896,(t|0)>0){e=0;do o*=2.6457513110645907,e=e+1|0;while((e|0)!=(t|0))}s=+f(+c)*o,a[r>>3]=s,c=+p(+c)*o,a[r+8>>3]=c,A=l}function wt(e,t,n){e|=0,t|=0,n|=0;var r=0,o=0,s=0;if(s=A,A=A+32|0,o=s,yr(e,o),i[t>>2]=0,a[n>>3]=5,r=+vr(16400,o),r<+a[n>>3]&&(i[t>>2]=0,a[n>>3]=r),r=+vr(16424,o),r<+a[n>>3]&&(i[t>>2]=1,a[n>>3]=r),r=+vr(16448,o),r<+a[n>>3]&&(i[t>>2]=2,a[n>>3]=r),r=+vr(16472,o),r<+a[n>>3]&&(i[t>>2]=3,a[n>>3]=r),r=+vr(16496,o),r<+a[n>>3]&&(i[t>>2]=4,a[n>>3]=r),r=+vr(16520,o),r<+a[n>>3]&&(i[t>>2]=5,a[n>>3]=r),r=+vr(16544,o),r<+a[n>>3]&&(i[t>>2]=6,a[n>>3]=r),r=+vr(16568,o),r<+a[n>>3]&&(i[t>>2]=7,a[n>>3]=r),r=+vr(16592,o),r<+a[n>>3]&&(i[t>>2]=8,a[n>>3]=r),r=+vr(16616,o),r<+a[n>>3]&&(i[t>>2]=9,a[n>>3]=r),r=+vr(16640,o),r<+a[n>>3]&&(i[t>>2]=10,a[n>>3]=r),r=+vr(16664,o),r<+a[n>>3]&&(i[t>>2]=11,a[n>>3]=r),r=+vr(16688,o),r<+a[n>>3]&&(i[t>>2]=12,a[n>>3]=r),r=+vr(16712,o),r<+a[n>>3]&&(i[t>>2]=13,a[n>>3]=r),r=+vr(16736,o),r<+a[n>>3]&&(i[t>>2]=14,a[n>>3]=r),r=+vr(16760,o),r<+a[n>>3]&&(i[t>>2]=15,a[n>>3]=r),r=+vr(16784,o),r<+a[n>>3]&&(i[t>>2]=16,a[n>>3]=r),r=+vr(16808,o),r<+a[n>>3]&&(i[t>>2]=17,a[n>>3]=r),r=+vr(16832,o),r<+a[n>>3]&&(i[t>>2]=18,a[n>>3]=r),r=+vr(16856,o),!(r<+a[n>>3])){A=s;return}i[t>>2]=19,a[n>>3]=r,A=s}function Tt(e,t,n,r,o){e|=0,t|=0,n|=0,r|=0,o|=0;var s=0,c=0,l=0;if(s=+hr(e),s<1e-16){t=15600+(t<<4)|0,i[o>>2]=i[t>>2],i[o+4>>2]=i[t+4>>2],i[o+8>>2]=i[t+8>>2],i[o+12>>2]=i[t+12>>2];return}if(c=+v(+ +a[e+8>>3],+ +a[e>>3]),(n|0)>0){e=0;do s*=.37796447300922725,e=e+1|0;while((e|0)!=(n|0))}l=s*.3333333333333333,r?(n=(Qt(n)|0)==0,s=+_(+((n?l:l*.37796447300922725)*.381966011250105))):(s=+_(+(s*.381966011250105)),Qt(n)|0&&(c=+mn(c+.3334731722518321))),xn(15600+(t<<4)|0,+mn(+a[15920+(t*24|0)>>3]-c),s,o)}function Et(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0;r=A,A=A+16|0,a=r,Ke(e+4|0,a),Tt(a,i[e>>2]|0,t,0,n),A=r}function Dt(e,t,n,r,o){e|=0,t|=0,n|=0,r|=0,o|=0;var s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,D=0,O=0,ee=0,k=0,te=0,ne=0,re=0,ie=0,ae=0;if(re=A,A=A+272|0,s=re+256|0,b=re+240|0,k=re,te=re+224|0,ne=re+208|0,x=re+176|0,S=re+160|0,C=re+192|0,w=re+144|0,T=re+128|0,D=re+112|0,O=re+96|0,ee=re+80|0,i[s>>2]=t,i[b>>2]=i[e>>2],i[b+4>>2]=i[e+4>>2],i[b+8>>2]=i[e+8>>2],i[b+12>>2]=i[e+12>>2],Ot(b,s,k),i[o>>2]=0,b=r+n+((r|0)==5&1)|0,(b|0)<=(n|0)){A=re;return}u=i[s>>2]|0,d=te+4|0,f=x+4|0,p=n+5|0,m=16880+(u<<2)|0,h=16960+(u<<2)|0,g=T+8|0,_=D+8|0,v=O+8|0,y=ne+4|0,l=n;a:for(;;){c=k+(((l|0)%5|0)<<4)|0,i[ne>>2]=i[c>>2],i[ne+4>>2]=i[c+4>>2],i[ne+8>>2]=i[c+8>>2],i[ne+12>>2]=i[c+12>>2];do;while((N(ne,u,0,1)|0)==2);if((l|0)>(n|0)&(Qt(t)|0)!=0){if(i[x>>2]=i[ne>>2],i[x+4>>2]=i[ne+4>>2],i[x+8>>2]=i[ne+8>>2],i[x+12>>2]=i[ne+12>>2],Ke(d,S),r=i[x>>2]|0,s=i[17040+(r*80|0)+(i[te>>2]<<2)>>2]|0,i[x>>2]=i[18640+(r*80|0)+(s*20|0)>>2],c=i[18640+(r*80|0)+(s*20|0)+16>>2]|0,(c|0)>0){e=0;do rt(f),e=e+1|0;while((e|0)<(c|0))}switch(c=18640+(r*80|0)+(s*20|0)+4|0,i[C>>2]=i[c>>2],i[C+4>>2]=i[c+4>>2],i[C+8>>2]=i[c+8>>2],Je(C,(i[m>>2]|0)*3|0),M(f,C,f),Ge(f),Ke(f,w),ie=+(i[h>>2]|0),a[T>>3]=ie*3,a[g>>3]=0,ae=ie*-1.5,a[D>>3]=ae,a[_>>3]=ie*2.598076211353316,a[O>>3]=ae,a[v>>3]=ie*-2.598076211353316,i[17040+((i[x>>2]|0)*80|0)+(i[ne>>2]<<2)>>2]|0){case 1:e=D,r=T;break;case 3:e=O,r=D;break;case 2:e=T,r=O;break;default:e=12;break a}gr(S,w,r,e,ee),Tt(ee,i[x>>2]|0,u,1,o+8+(i[o>>2]<<4)|0),i[o>>2]=(i[o>>2]|0)+1}if((l|0)<(p|0)&&(Ke(y,x),Tt(x,i[ne>>2]|0,u,1,o+8+(i[o>>2]<<4)|0),i[o>>2]=(i[o>>2]|0)+1),i[te>>2]=i[ne>>2],i[te+4>>2]=i[ne+4>>2],i[te+8>>2]=i[ne+8>>2],i[te+12>>2]=i[ne+12>>2],l=l+1|0,(l|0)>=(b|0)){e=3;break}}if((e|0)==3){A=re;return}else (e|0)==12&&E(26970,27017,572,27027)}function Ot(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0,c=0,l=0;l=A,A=A+128|0,r=l+64|0,a=l,o=r,s=20240,c=o+60|0;do i[o>>2]=i[s>>2],o=o+4|0,s=s+4|0;while((o|0)<(c|0));o=a,s=20304,c=o+60|0;do i[o>>2]=i[s>>2],o=o+4|0,s=s+4|0;while((o|0)<(c|0));c=(Qt(i[t>>2]|0)|0)==0,r=c?r:a,a=e+4|0,st(a),ct(a),Qt(i[t>>2]|0)|0&&(tt(a),i[t>>2]=(i[t>>2]|0)+1),i[n>>2]=i[e>>2],t=n+4|0,M(a,r,t),Ge(t),i[n+16>>2]=i[e>>2],t=n+20|0,M(a,r+12|0,t),Ge(t),i[n+32>>2]=i[e>>2],t=n+36|0,M(a,r+24|0,t),Ge(t),i[n+48>>2]=i[e>>2],t=n+52|0,M(a,r+36|0,t),Ge(t),i[n+64>>2]=i[e>>2],n=n+68|0,M(a,r+48|0,n),Ge(n),A=l}function N(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0;if(h=A,A=A+32|0,p=h+12|0,c=h,m=e+4|0,f=i[16960+(t<<2)>>2]|0,d=(r|0)!=0,f=d?f*3|0:f,a=i[m>>2]|0,u=e+8|0,s=i[u>>2]|0,d){if(o=e+12|0,r=i[o>>2]|0,a=s+a+r|0,(a|0)==(f|0))return m=1,A=h,m|0;l=o}else l=e+12|0,r=i[l>>2]|0,a=s+a+r|0;if((a|0)<=(f|0))return m=0,A=h,m|0;do if((r|0)>0){if(r=i[e>>2]|0,(s|0)>0){o=18640+(r*80|0)+60|0,r=e;break}r=18640+(r*80|0)+40|0,n?(Ue(p,f,0,0),qe(m,p,c),it(c),M(c,p,m),o=r,r=e):(o=r,r=e)}else o=18640+((i[e>>2]|0)*80|0)+20|0,r=e;while(0);if(i[r>>2]=i[o>>2],a=o+16|0,(i[a>>2]|0)>0){r=0;do rt(m),r=r+1|0;while((r|0)<(i[a>>2]|0))}return e=o+4|0,i[p>>2]=i[e>>2],i[p+4>>2]=i[e+4>>2],i[p+8>>2]=i[e+8>>2],t=i[16880+(t<<2)>>2]|0,Je(p,d?t*3|0:t),M(m,p,m),Ge(m),r=d&&((i[u>>2]|0)+(i[m>>2]|0)+(i[l>>2]|0)|0)==(f|0)?1:2,m=r,A=h,m|0}function kt(e,t){e|=0,t|=0;var n=0;do n=N(e,t,0,1)|0;while((n|0)==2);return n|0}function At(e,t,n,r,o){e|=0,t|=0,n|=0,r|=0,o|=0;var s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,D=0,O=0,ee=0,k=0;if(O=A,A=A+240|0,s=O+224|0,C=O+208|0,w=O,T=O+192|0,D=O+176|0,v=O+160|0,y=O+144|0,b=O+128|0,x=O+112|0,S=O+96|0,i[s>>2]=t,i[C>>2]=i[e>>2],i[C+4>>2]=i[e+4>>2],i[C+8>>2]=i[e+8>>2],i[C+12>>2]=i[e+12>>2],jt(C,s,w),i[o>>2]=0,_=r+n+((r|0)==6&1)|0,(_|0)<=(n|0)){A=O;return}u=i[s>>2]|0,d=n+6|0,f=16960+(u<<2)|0,p=y+8|0,m=b+8|0,h=x+8|0,g=T+4|0,c=0,l=n,r=-1;a:for(;;){if(s=(l|0)%6|0,e=w+(s<<4)|0,i[T>>2]=i[e>>2],i[T+4>>2]=i[e+4>>2],i[T+8>>2]=i[e+8>>2],i[T+12>>2]=i[e+12>>2],e=c,c=N(T,u,0,1)|0,(l|0)>(n|0)&(Qt(t)|0)!=0&&(e|0)!=1&&(i[T>>2]|0)!=(r|0)){switch(Ke(w+(((s+5|0)%6|0)<<4)+4|0,D),Ke(w+(s<<4)+4|0,v),ee=+(i[f>>2]|0),a[y>>3]=ee*3,a[p>>3]=0,k=ee*-1.5,a[b>>3]=k,a[m>>3]=ee*2.598076211353316,a[x>>3]=k,a[h>>3]=ee*-2.598076211353316,s=i[C>>2]|0,i[17040+(s*80|0)+(((r|0)==(s|0)?i[T>>2]|0:r)<<2)>>2]|0){case 1:e=b,r=y;break;case 3:e=x,r=b;break;case 2:e=y,r=x;break;default:e=8;break a}gr(D,v,r,e,S),!(_r(D,S)|0)&&!(_r(v,S)|0)&&(Tt(S,i[C>>2]|0,u,1,o+8+(i[o>>2]<<4)|0),i[o>>2]=(i[o>>2]|0)+1)}if((l|0)<(d|0)&&(Ke(g,D),Tt(D,i[T>>2]|0,u,1,o+8+(i[o>>2]<<4)|0),i[o>>2]=(i[o>>2]|0)+1),l=l+1|0,(l|0)>=(_|0)){e=3;break}else r=i[T>>2]|0}if((e|0)==3){A=O;return}else (e|0)==8&&E(27054,27017,737,27099)}function jt(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0,c=0,l=0;l=A,A=A+160|0,r=l+80|0,a=l,o=r,s=20368,c=o+72|0;do i[o>>2]=i[s>>2],o=o+4|0,s=s+4|0;while((o|0)<(c|0));o=a,s=20448,c=o+72|0;do i[o>>2]=i[s>>2],o=o+4|0,s=s+4|0;while((o|0)<(c|0));c=(Qt(i[t>>2]|0)|0)==0,r=c?r:a,a=e+4|0,st(a),ct(a),Qt(i[t>>2]|0)|0&&(tt(a),i[t>>2]=(i[t>>2]|0)+1),i[n>>2]=i[e>>2],t=n+4|0,M(a,r,t),Ge(t),i[n+16>>2]=i[e>>2],t=n+20|0,M(a,r+12|0,t),Ge(t),i[n+32>>2]=i[e>>2],t=n+36|0,M(a,r+24|0,t),Ge(t),i[n+48>>2]=i[e>>2],t=n+52|0,M(a,r+36|0,t),Ge(t),i[n+64>>2]=i[e>>2],t=n+68|0,M(a,r+48|0,t),Ge(t),i[n+80>>2]=i[e>>2],n=n+84|0,M(a,r+60|0,n),Ge(n),A=l}function Mt(e,t){return e|=0,t|=0,t=I(e|0,t|0,52)|0,T()|0,t&15|0}function Nt(e,t){return e|=0,t|=0,t=I(e|0,t|0,45)|0,T()|0,t&127|0}function Pt(e,t){e|=0,t|=0;var n=0,i=0,a=0,o=0,s=0;return!(!0&(t&-16777216|0)==134217728)||(i=I(e|0,t|0,52)|0,T()|0,i&=15,n=I(e|0,t|0,45)|0,T()|0,n&=127,n>>>0>121)?(e=0,e|0):(s=(i^15)*3|0,a=I(e|0,t|0,s|0)|0,s=L(a|0,T()|0,s|0)|0,a=T()|0,o=Lr(-1227133514,-1171,s|0,a|0)|0,!((s&613566756&o|0)==0&(a&4681&(T()|0)|0)==0)||(s=(i*3|0)+19|0,o=L(~e|0,~t|0,s|0)|0,s=I(o|0,T()|0,s|0)|0,!((i|0)==15|(s|0)==0&(T()|0)==0))?(s=0,s|0):!(r[20528+n>>0]|0)||(t&=8191,(e|0)==0&(t|0)==0)?(s=1,s|0):(s=Kr(e|0,t|0,0)|0,T()|0,((63-s|0)%3|0)!=0|0))}function Ft(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0;if(a=L(t|0,0,52)|0,o=T()|0,n=L(n|0,0,45)|0,n=o|(T()|0)|134225919,(t|0)<1){o=-1,r=n,t=e,i[t>>2]=o,e=e+4|0,i[e>>2]=r;return}for(o=1,a=-1;s=(15-o|0)*3|0,c=L(7,0,s|0)|0,n&=~(T()|0),s=L(r|0,0,s|0)|0,a=a&~c|s,n|=T()|0,(o|0)!=(t|0);)o=o+1|0;c=e,s=c,i[s>>2]=a,c=c+4|0,i[c>>2]=n}function It(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0;if(o=I(e|0,t|0,52)|0,T()|0,o&=15,n>>>0>15)return r=4,r|0;if((o|0)<(n|0))return r=12,r|0;if((o|0)==(n|0))return i[r>>2]=e,i[r+4>>2]=t,r=0,r|0;if(a=L(n|0,0,52)|0,a|=e,e=T()|0|t&-15728641,(o|0)>(n|0))do t=L(7,0,(14-n|0)*3|0)|0,n=n+1|0,a=t|a,e=T()|0|e;while((n|0)<(o|0));return i[r>>2]=a,i[r+4>>2]=e,r=0,r|0}function Lt(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0;if(o=I(e|0,t|0,52)|0,T()|0,o&=15,!((n|0)<16&(o|0)<=(n|0)))return r=4,r|0;a=n-o|0,n=I(e|0,t|0,45)|0,T()|0;a:do if(!(Se(n&127)|0))n=Kn(7,0,a,((a|0)<0)<<31>>31)|0,a=T()|0;else{b:do if(o|0){for(n=1;s=L(7,0,(15-n|0)*3|0)|0,(s&e|0)==0&((T()|0)&t|0)==0;)if(n>>>0<o>>>0)n=n+1|0;else break b;n=Kn(7,0,a,((a|0)<0)<<31>>31)|0,a=T()|0;break a}while(0);n=Kn(7,0,a,((a|0)<0)<<31>>31)|0,n=Hr(n|0,T()|0,5,0)|0,n=Ir(n|0,T()|0,-5,-1)|0,n=Br(n|0,T()|0,6,0)|0,n=Ir(n|0,T()|0,1,0)|0,a=T()|0}while(0);return s=r,i[s>>2]=n,i[s+4>>2]=a,s=0,s|0}function Rt(e,t){e|=0,t|=0;var n=0,r=0,i=0;if(i=I(e|0,t|0,45)|0,T()|0,!(Se(i&127)|0))return i=0,i|0;i=I(e|0,t|0,52)|0,T()|0,i&=15;a:do if(!i)n=0;else for(r=1;;){if(n=I(e|0,t|0,(15-r|0)*3|0)|0,T()|0,n&=7,n|0)break a;if(r>>>0<i>>>0)r=r+1|0;else{n=0;break}}while(0);return i=(n|0)==0&1,i|0}function zt(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0;if(s=A,A=A+16|0,o=s,dn(o,e,t,n),t=o,e=i[t>>2]|0,t=i[t+4>>2]|0,(e|0)==0&(t|0)==0)return A=s,0;a=0,n=0;do c=r+(a<<3)|0,i[c>>2]=e,i[c+4>>2]=t,a=Ir(a|0,n|0,1,0)|0,n=T()|0,pn(o),c=o,e=i[c>>2]|0,t=i[c+4>>2]|0;while(!((e|0)==0&(t|0)==0));return A=s,0}function Bt(e,t,n,r){return e|=0,t|=0,n|=0,r|=0,(r|0)<(n|0)?(n=t,r=e,w(n|0),r|0):(n=L(-1,-1,((r-n|0)*3|0)+3|0)|0,r=L(~n|0,~(T()|0)|0,(15-r|0)*3|0)|0,n=~(T()|0)&t,r=~r&e,w(n|0),r|0)}function Vt(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0;return a=I(e|0,t|0,52)|0,T()|0,a&=15,(n|0)<16&(a|0)<=(n|0)?((a|0)<(n|0)&&(a=L(-1,-1,((n+-1-a|0)*3|0)+3|0)|0,a=L(~a|0,~(T()|0)|0,(15-n|0)*3|0)|0,t=~(T()|0)&t,e=~a&e),a=L(n|0,0,52)|0,n=t&-15728641|(T()|0),i[r>>2]=e|a,i[r+4>>2]=n,r=0,r|0):(r=4,r|0)}function Ht(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,D=0,O=0,ee=0,k=0,te=0,A=0;if((n|0)==0&(r|0)==0)return A=0,A|0;if(a=e,o=i[a>>2]|0,a=i[a+4>>2]|0,!0&(a&15728640|0)==0){if(!((r|0)>0|(r|0)==0&n>>>0>0)||(A=t,i[A>>2]=o,i[A+4>>2]=a,(n|0)==1&(r|0)==0))return A=0,A|0;a=1,o=0;do k=e+(a<<3)|0,te=i[k+4>>2]|0,A=t+(a<<3)|0,i[A>>2]=i[k>>2],i[A+4>>2]=te,a=Ir(a|0,o|0,1,0)|0,o=T()|0;while((o|0)<(r|0)|(o|0)==(r|0)&a>>>0<n>>>0);return a=0,a|0}if(ee=n<<3,te=Pr(ee)|0,!te)return A=13,A|0;if(Xr(te|0,e|0,ee|0)|0,k=Fr(n,8)|0,!k)return F(te),A=13,A|0;a:for(;;){a=te,u=i[a>>2]|0,a=i[a+4>>2]|0,D=I(u|0,a|0,52)|0,T()|0,D&=15,O=D+-1|0,w=(D|0)!=0,C=(r|0)>0|(r|0)==0&n>>>0>0;b:do if(w&C){if(y=L(O|0,0,52)|0,b=T()|0,O>>>0>15){if(!((u|0)==0&(a|0)==0)){A=16;break a}for(o=0,e=0;;){if(o=Ir(o|0,e|0,1,0)|0,e=T()|0,!((e|0)<(r|0)|(e|0)==(r|0)&o>>>0<n>>>0))break b;if(s=te+(o<<3)|0,S=i[s>>2]|0,s=i[s+4>>2]|0,!((S|0)==0&(s|0)==0)){a=s,A=16;break a}}}for(c=u,e=a,o=0,s=0;;){if(!((c|0)==0&(e|0)==0)){if(!(!0&(e&117440512|0)==0)){A=21;break a}if(d=I(c|0,e|0,52)|0,T()|0,d&=15,(d|0)<(O|0)){a=12,A=27;break a}if((d|0)!=(O|0)&&(c|=y,e=e&-15728641|b,d>>>0>=D>>>0)){l=O;do S=L(7,0,(14-l|0)*3|0)|0,l=l+1|0,c=S|c,e=T()|0|e;while(l>>>0<d>>>0)}if(p=Wr(c|0,e|0,n|0,r|0)|0,m=T()|0,l=k+(p<<3)|0,d=l,f=i[d>>2]|0,d=i[d+4>>2]|0,!((f|0)==0&(d|0)==0)){_=0,v=0;do{if((_|0)>(r|0)|(_|0)==(r|0)&v>>>0>n>>>0){A=31;break a}if((f|0)==(c|0)&(d&-117440513|0)==(e|0)){h=I(f|0,d|0,56)|0,T()|0,h&=7,g=h+1|0,S=I(f|0,d|0,45)|0,T()|0;c:do if(!(Se(S&127)|0))d=7;else{if(f=I(f|0,d|0,52)|0,T()|0,f&=15,!f){d=6;break}for(d=1;;){if(S=L(7,0,(15-d|0)*3|0)|0,!((S&c|0)==0&((T()|0)&e|0)==0)){d=7;break c}if(d>>>0<f>>>0)d=d+1|0;else{d=6;break}}}while(0);if((h+2|0)>>>0>d>>>0){A=41;break a}S=L(g|0,0,56)|0,e=T()|0|e&-117440513,x=l,i[x>>2]=0,i[x+4>>2]=0,c=S|c}else p=Ir(p|0,m|0,1,0)|0,p=Ur(p|0,T()|0,n|0,r|0)|0,m=T()|0;v=Ir(v|0,_|0,1,0)|0,_=T()|0,l=k+(p<<3)|0,d=l,f=i[d>>2]|0,d=i[d+4>>2]|0}while(!((f|0)==0&(d|0)==0))}S=l,i[S>>2]=c,i[S+4>>2]=e}if(o=Ir(o|0,s|0,1,0)|0,s=T()|0,!((s|0)<(r|0)|(s|0)==(r|0)&o>>>0<n>>>0))break b;e=te+(o<<3)|0,c=i[e>>2]|0,e=i[e+4>>2]|0}}while(0);if(S=Ir(n|0,r|0,5,0)|0,x=T()|0,x>>>0<0|(x|0)==0&S>>>0<11){A=85;break}if(S=Br(n|0,r|0,6,0)|0,T()|0,S=Fr(S,8)|0,!S){A=48;break}do if(C){for(g=0,e=0,h=0,_=0;;){if(d=k+(g<<3)|0,s=d,o=i[s>>2]|0,s=i[s+4>>2]|0,(o|0)==0&(s|0)==0)x=h;else{f=I(o|0,s|0,56)|0,T()|0,f&=7,c=f+1|0,p=s&-117440513,x=I(o|0,s|0,45)|0,T()|0;d:do if(Se(x&127)|0){if(m=I(o|0,s|0,52)|0,T()|0,m&=15,m|0)for(l=1;;){if(x=L(7,0,(15-l|0)*3|0)|0,!((o&x|0)==0&(p&(T()|0)|0)==0))break d;if(l>>>0<m>>>0)l=l+1|0;else break}s=L(c|0,0,56)|0,o=s|o,s=T()|0|p,c=d,i[c>>2]=o,i[c+4>>2]=s,c=f+2|0}while(0);(c|0)==7?(x=S+(e<<3)|0,i[x>>2]=o,i[x+4>>2]=s&-117440513,e=Ir(e|0,h|0,1,0)|0,x=T()|0):x=h}if(g=Ir(g|0,_|0,1,0)|0,_=T()|0,(_|0)<(r|0)|(_|0)==(r|0)&g>>>0<n>>>0)h=x;else break}if(C){if(v=O>>>0>15,y=L(O|0,0,52)|0,b=T()|0,!w){for(o=0,l=0,c=0,s=0;(u|0)==0&(a|0)==0||(O=t+(o<<3)|0,i[O>>2]=u,i[O+4>>2]=a,o=Ir(o|0,l|0,1,0)|0,l=T()|0),c=Ir(c|0,s|0,1,0)|0,s=T()|0,(s|0)<(r|0)|(s|0)==(r|0)&c>>>0<n>>>0;)a=te+(c<<3)|0,u=i[a>>2]|0,a=i[a+4>>2]|0;a=x;break}for(o=0,l=0,s=0,c=0;;){do if(!((u|0)==0&(a|0)==0)){if(m=I(u|0,a|0,52)|0,T()|0,m&=15,v|(m|0)<(O|0)){A=80;break a}if((m|0)!=(O|0)){if(d=u|y,f=a&-15728641|b,m>>>0>=D>>>0){p=O;do w=L(7,0,(14-p|0)*3|0)|0,p=p+1|0,d=w|d,f=T()|0|f;while(p>>>0<m>>>0)}}else d=u,f=a;h=Wr(d|0,f|0,n|0,r|0)|0,p=0,m=0,_=T()|0;do{if((p|0)>(r|0)|(p|0)==(r|0)&m>>>0>n>>>0){A=81;break a}if(w=k+(h<<3)|0,g=i[w+4>>2]|0,(g&-117440513|0)==(f|0)&&(i[w>>2]|0)==(d|0)){A=65;break}w=Ir(h|0,_|0,1,0)|0,h=Ur(w|0,T()|0,n|0,r|0)|0,_=T()|0,m=Ir(m|0,p|0,1,0)|0,p=T()|0,w=k+(h<<3)|0}while(!((i[w>>2]|0)==(d|0)&&(i[w+4>>2]|0)==(f|0)));if((A|0)==65&&(A=0,!0&(g&117440512|0)==100663296))break;w=t+(o<<3)|0,i[w>>2]=u,i[w+4>>2]=a,o=Ir(o|0,l|0,1,0)|0,l=T()|0}while(0);if(s=Ir(s|0,c|0,1,0)|0,c=T()|0,!((c|0)<(r|0)|(c|0)==(r|0)&s>>>0<n>>>0))break;a=te+(s<<3)|0,u=i[a>>2]|0,a=i[a+4>>2]|0}a=x}else o=0,a=x}else o=0,e=0,a=0;while(0);if(Zr(k|0,0,ee|0)|0,Xr(te|0,S|0,e<<3|0)|0,F(S),(e|0)==0&(a|0)==0){A=89;break}else t=t+(o<<3)|0,r=a,n=e}if((A|0)==16)!0&(a&117440512|0)==0?(a=4,A=27):A=21;else if((A|0)==31)E(27795,27122,529,27132);else if((A|0)==41)return F(te),F(k),A=10,A|0;else if((A|0)==48)return F(te),F(k),A=13,A|0;else (A|0)==80?E(27795,27122,620,27132):(A|0)==81?E(27795,27122,632,27132):(A|0)==85&&(Xr(t|0,te|0,n<<3|0)|0,A=89);return(A|0)==21?(F(te),F(k),A=5,A|0):(A|0)==27?(F(te),F(k),A=a,A|0):(A|0)==89?(F(te),F(k),A=0,A|0):0}function Ut(e,t,n,r,a,o,s){e|=0,t|=0,n|=0,r|=0,a|=0,o|=0,s|=0;var c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0;if(g=A,A=A+16|0,h=g,!((n|0)>0|(n|0)==0&t>>>0>0))return h=0,A=g,h|0;if((s|0)>=16)return h=12,A=g,h|0;p=0,m=0,f=0,c=0;a:for(;;){if(u=e+(p<<3)|0,l=i[u>>2]|0,u=i[u+4>>2]|0,d=I(l|0,u|0,52)|0,T()|0,(d&15|0)>(s|0)){c=12,l=11;break}if(dn(h,l,u,s),d=h,u=i[d>>2]|0,d=i[d+4>>2]|0,(u|0)==0&(d|0)==0)l=f;else{l=f;do{if(!((c|0)<(o|0)|(c|0)==(o|0)&l>>>0<a>>>0)){l=10;break a}f=r+(l<<3)|0,i[f>>2]=u,i[f+4>>2]=d,l=Ir(l|0,c|0,1,0)|0,c=T()|0,pn(h),f=h,u=i[f>>2]|0,d=i[f+4>>2]|0}while(!((u|0)==0&(d|0)==0))}if(p=Ir(p|0,m|0,1,0)|0,m=T()|0,(m|0)<(n|0)|(m|0)==(n|0)&p>>>0<t>>>0)f=l;else{c=0,l=11;break}}return(l|0)==10?(h=14,A=g,h|0):(l|0)==11?(A=g,c|0):0}function Wt(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0;p=A,A=A+16|0,f=p;a:do if((n|0)>0|(n|0)==0&t>>>0>0){for(u=0,s=0,o=0,d=0;;){if(l=e+(u<<3)|0,c=i[l>>2]|0,l=i[l+4>>2]|0,!((c|0)==0&(l|0)==0)&&(l=(Lt(c,l,r,f)|0)==0,c=f,s=Ir(i[c>>2]|0,i[c+4>>2]|0,s|0,o|0)|0,o=T()|0,!l)){o=12;break}if(u=Ir(u|0,d|0,1,0)|0,d=T()|0,!((d|0)<(n|0)|(d|0)==(n|0)&u>>>0<t>>>0))break a}return A=p,o|0}else s=0,o=0;while(0);return i[a>>2]=s,i[a+4>>2]=o,a=0,A=p,a|0}function Gt(e,t){return e|=0,t|=0,t=I(e|0,t|0,52)|0,T()|0,t&1|0}function Kt(e,t){e|=0,t|=0;var n=0,r=0,i=0;if(i=I(e|0,t|0,52)|0,T()|0,i&=15,!i)return i=0,i|0;for(r=1;;){if(n=I(e|0,t|0,(15-r|0)*3|0)|0,T()|0,n&=7,n|0){r=5;break}if(r>>>0<i>>>0)r=r+1|0;else{n=0,r=5;break}}return(r|0)==5?n|0:0}function qt(e,t){e|=0,t|=0;var n=0,r=0,i=0,a=0,o=0,s=0,c=0;if(c=I(e|0,t|0,52)|0,T()|0,c&=15,!c)return s=t,c=e,w(s|0),c|0;for(s=1,n=0;;){a=(15-s|0)*3|0,r=L(7,0,a|0)|0,i=T()|0,o=I(e|0,t|0,a|0)|0,T()|0,a=L(at(o&7)|0,0,a|0)|0,o=T()|0,e=a|e&~r,t=o|t&~i;a:do if(!n)if((a&r|0)==0&(o&i|0)==0)n=0;else if(r=I(e|0,t|0,52)|0,T()|0,r&=15,!r)n=1;else{n=1;b:for(;;){switch(o=I(e|0,t|0,(15-n|0)*3|0)|0,T()|0,o&7){case 1:break b;case 0:break;default:n=1;break a}if(n>>>0<r>>>0)n=n+1|0;else{n=1;break a}}for(n=1;;)if(o=(15-n|0)*3|0,i=I(e|0,t|0,o|0)|0,T()|0,a=L(7,0,o|0)|0,t&=~(T()|0),o=L(at(i&7)|0,0,o|0)|0,e=e&~a|o,t|=T()|0,n>>>0<r>>>0)n=n+1|0;else{n=1;break}}while(0);if(s>>>0<c>>>0)s=s+1|0;else break}return w(t|0),e|0}function Jt(e,t){e|=0,t|=0;var n=0,r=0,i=0,a=0,o=0;if(r=I(e|0,t|0,52)|0,T()|0,r&=15,!r)return n=t,r=e,w(n|0),r|0;for(n=1;a=(15-n|0)*3|0,o=I(e|0,t|0,a|0)|0,T()|0,i=L(7,0,a|0)|0,t&=~(T()|0),a=L(at(o&7)|0,0,a|0)|0,e=a|e&~i,t=T()|0|t,n>>>0<r>>>0;)n=n+1|0;return w(t|0),e|0}function Yt(e,t){e|=0,t|=0;var n=0,r=0,i=0,a=0,o=0,s=0,c=0;if(c=I(e|0,t|0,52)|0,T()|0,c&=15,!c)return s=t,c=e,w(s|0),c|0;for(s=1,n=0;;){a=(15-s|0)*3|0,r=L(7,0,a|0)|0,i=T()|0,o=I(e|0,t|0,a|0)|0,T()|0,a=L(ot(o&7)|0,0,a|0)|0,o=T()|0,e=a|e&~r,t=o|t&~i;a:do if(!n)if((a&r|0)==0&(o&i|0)==0)n=0;else if(r=I(e|0,t|0,52)|0,T()|0,r&=15,!r)n=1;else{n=1;b:for(;;){switch(o=I(e|0,t|0,(15-n|0)*3|0)|0,T()|0,o&7){case 1:break b;case 0:break;default:n=1;break a}if(n>>>0<r>>>0)n=n+1|0;else{n=1;break a}}for(n=1;;)if(i=(15-n|0)*3|0,a=L(7,0,i|0)|0,o=t&~(T()|0),t=I(e|0,t|0,i|0)|0,T()|0,t=L(ot(t&7)|0,0,i|0)|0,e=e&~a|t,t=o|(T()|0),n>>>0<r>>>0)n=n+1|0;else{n=1;break}}while(0);if(s>>>0<c>>>0)s=s+1|0;else break}return w(t|0),e|0}function Xt(e,t){e|=0,t|=0;var n=0,r=0,i=0,a=0,o=0;if(r=I(e|0,t|0,52)|0,T()|0,r&=15,!r)return n=t,r=e,w(n|0),r|0;for(n=1;o=(15-n|0)*3|0,a=L(7,0,o|0)|0,i=t&~(T()|0),t=I(e|0,t|0,o|0)|0,T()|0,t=L(ot(t&7)|0,0,o|0)|0,e=t|e&~a,t=T()|0|i,n>>>0<r>>>0;)n=n+1|0;return w(t|0),e|0}function Zt(e,t){e|=0,t|=0;var n=0,r=0,a=0,o=0,s=0,c=0,l=0,u=0,d=0;if(l=A,A=A+64|0,c=l+40|0,r=l+24|0,a=l+12|0,o=l,L(t|0,0,52)|0,n=T()|134225919,!t)return(i[e+4>>2]|0)>2||(i[e+8>>2]|0)>2||(i[e+12>>2]|0)>2?(s=0,c=0,w(s|0),A=l,c|0):(L(we(e)|0,0,45)|0,s=T()|0|n,c=-1,w(s|0),A=l,c|0);if(i[c>>2]=i[e>>2],i[c+4>>2]=i[e+4>>2],i[c+8>>2]=i[e+8>>2],i[c+12>>2]=i[e+12>>2],s=c+4|0,(t|0)>0)for(e=-1;i[r>>2]=i[s>>2],i[r+4>>2]=i[s+4>>2],i[r+8>>2]=i[s+8>>2],t&1?(Qe(s),i[a>>2]=i[s>>2],i[a+4>>2]=i[s+4>>2],i[a+8>>2]=i[s+8>>2],et(a)):($e(s),i[a>>2]=i[s>>2],i[a+4>>2]=i[s+4>>2],i[a+8>>2]=i[s+8>>2],tt(a)),qe(r,a,o),Ge(o),d=(15-t|0)*3|0,u=L(7,0,d|0)|0,n&=~(T()|0),d=L(Ye(o)|0,0,d|0)|0,e=d|e&~u,n=T()|0|n,(t|0)>1;)t=t+-1|0;else e=-1;a:do if((i[s>>2]|0)<=2&&(i[c+8>>2]|0)<=2&&(i[c+12>>2]|0)<=2){if(r=we(c)|0,t=L(r|0,0,45)|0,t|=e,e=T()|0|n&-1040385,o=Te(c)|0,!(Se(r)|0)){if((o|0)<=0)break;for(a=0;;){if(r=I(t|0,e|0,52)|0,T()|0,r&=15,r)for(n=1;d=(15-n|0)*3|0,c=I(t|0,e|0,d|0)|0,T()|0,u=L(7,0,d|0)|0,e&=~(T()|0),d=L(at(c&7)|0,0,d|0)|0,t=t&~u|d,e|=T()|0,n>>>0<r>>>0;)n=n+1|0;if(a=a+1|0,(a|0)==(o|0))break a}}a=I(t|0,e|0,52)|0,T()|0,a&=15;b:do if(a){n=1;c:for(;;){switch(d=I(t|0,e|0,(15-n|0)*3|0)|0,T()|0,d&7){case 1:break c;case 0:break;default:break b}if(n>>>0<a>>>0)n=n+1|0;else break b}if(Oe(r,i[c>>2]|0)|0)for(n=1;c=(15-n|0)*3|0,u=L(7,0,c|0)|0,d=e&~(T()|0),e=I(t|0,e|0,c|0)|0,T()|0,e=L(ot(e&7)|0,0,c|0)|0,t=t&~u|e,e=d|(T()|0),n>>>0<a>>>0;)n=n+1|0;else for(n=1;d=(15-n|0)*3|0,c=I(t|0,e|0,d|0)|0,T()|0,u=L(7,0,d|0)|0,e&=~(T()|0),d=L(at(c&7)|0,0,d|0)|0,t=t&~u|d,e|=T()|0,n>>>0<a>>>0;)n=n+1|0}while(0);if((o|0)>0){n=0;do t=qt(t,e)|0,e=T()|0,n=n+1|0;while((n|0)!=(o|0))}}else t=0,e=0;while(0);return u=e,d=t,w(u|0),A=l,d|0}function Qt(e){return e|=0,(e|0)%2|0}function $t(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0;return a=A,A=A+16|0,r=a,t>>>0>15?(r=4,A=a,r|0):(i[e+4>>2]&2146435072|0)==2146435072||(i[e+8+4>>2]&2146435072|0)==2146435072?(r=3,A=a,r|0):(St(e,t,r),t=Zt(r,t)|0,r=T()|0,i[n>>2]=t,i[n+4>>2]=r,(t|0)==0&(r|0)==0&&E(27795,27122,959,27145),r=0,A=a,r|0)}function en(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0;if(a=n+4|0,o=I(e|0,t|0,52)|0,T()|0,o&=15,s=I(e|0,t|0,45)|0,T()|0,r=(o|0)==0,Se(s&127)|0){if(r)return s=1,s|0;r=1}else{if(r)return s=0,s|0;r=!(i[a>>2]|0)&&!(i[n+8>>2]|0)?(i[n+12>>2]|0)!=0&1:1}for(n=1;n&1?et(a):tt(a),s=I(e|0,t|0,(15-n|0)*3|0)|0,T()|0,nt(a,s&7),n>>>0<o>>>0;)n=n+1|0;return r|0}function tn(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0,c=0,l=0,u=0,d=0;if(d=A,A=A+16|0,l=d,u=I(e|0,t|0,45)|0,T()|0,u&=127,u>>>0>121)return i[n>>2]=0,i[n+4>>2]=0,i[n+8>>2]=0,i[n+12>>2]=0,u=5,A=d,u|0;a:do if(Se(u)|0&&(o=I(e|0,t|0,52)|0,T()|0,o&=15,o|0)){r=1;b:for(;;){switch(c=I(e|0,t|0,(15-r|0)*3|0)|0,T()|0,c&7){case 5:break b;case 0:break;default:r=t;break a}if(r>>>0<o>>>0)r=r+1|0;else{r=t;break a}}for(a=1,r=t;t=(15-a|0)*3|0,s=L(7,0,t|0)|0,c=r&~(T()|0),r=I(e|0,r|0,t|0)|0,T()|0,r=L(ot(r&7)|0,0,t|0)|0,e=e&~s|r,r=c|(T()|0),a>>>0<o>>>0;)a=a+1|0}else r=t;while(0);if(c=7696+(u*28|0)|0,i[n>>2]=i[c>>2],i[n+4>>2]=i[c+4>>2],i[n+8>>2]=i[c+8>>2],i[n+12>>2]=i[c+12>>2],!(en(e,r,n)|0))return u=0,A=d,u|0;if(s=n+4|0,i[l>>2]=i[s>>2],i[l+4>>2]=i[s+4>>2],i[l+8>>2]=i[s+8>>2],o=I(e|0,r|0,52)|0,T()|0,c=o&15,o&1?(tt(s),o=c+1|0):o=c,!(Se(u)|0))r=0;else{c:do if(!c)r=0;else for(t=1;;){if(a=I(e|0,r|0,(15-t|0)*3|0)|0,T()|0,a&=7,a|0){r=a;break c}if(t>>>0<c>>>0)t=t+1|0;else{r=0;break}}while(0);r=(r|0)==4&1}if(!(N(n,o,r,0)|0))(o|0)!=(c|0)&&(i[s>>2]=i[l>>2],i[s+4>>2]=i[l+4>>2],i[s+8>>2]=i[l+8>>2]);else{if(Se(u)|0)do;while(N(n,o,0,0)|0);(o|0)!=(c|0)&&$e(s)}return u=0,A=d,u|0}function nn(e,t,n){e|=0,t|=0,n|=0;var r=0,i=0,a=0;return a=A,A=A+16|0,r=a,i=tn(e,t,r)|0,i|0?(A=a,i|0):(i=I(e|0,t|0,52)|0,T()|0,Et(r,i&15,n),i=0,A=a,i|0)}function rn(e,t,n){e|=0,t|=0,n|=0;var r=0,i=0,a=0,o=0,s=0;if(o=A,A=A+16|0,a=o,r=tn(e,t,a)|0,r|0)return a=r,A=o,a|0;r=I(e|0,t|0,45)|0,T()|0,r=(Se(r&127)|0)==0,i=I(e|0,t|0,52)|0,T()|0,i&=15;a:do if(!r){if(i|0)for(r=1;;){if(s=L(7,0,(15-r|0)*3|0)|0,!((s&e|0)==0&((T()|0)&t|0)==0))break a;if(r>>>0<i>>>0)r=r+1|0;else break}return Dt(a,i,0,5,n),s=0,A=o,s|0}while(0);return At(a,i,0,6,n),s=0,A=o,s|0}function an(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0;if(a=I(e|0,t|0,45)|0,T()|0,!(Se(a&127)|0))return a=2,i[n>>2]=a,0;if(a=I(e|0,t|0,52)|0,T()|0,a&=15,!a)return a=5,i[n>>2]=a,0;for(r=1;;){if(o=L(7,0,(15-r|0)*3|0)|0,!((o&e|0)==0&((T()|0)&t|0)==0)){r=2,e=6;break}if(r>>>0<a>>>0)r=r+1|0;else{r=5,e=6;break}}return(e|0)==6&&(i[n>>2]=r),0}function on(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0;f=A,A=A+128|0,u=f+112|0,o=f+96|0,d=f,a=I(e|0,t|0,52)|0,T()|0,c=a&15,i[u>>2]=c,s=I(e|0,t|0,45)|0,T()|0,s&=127;a:do if(Se(s)|0){if(c|0)for(r=1;;){if(l=L(7,0,(15-r|0)*3|0)|0,!((l&e|0)==0&((T()|0)&t|0)==0)){a=0;break a}if(r>>>0<c>>>0)r=r+1|0;else break}if(a&1)a=1;else return l=L(c+1|0,0,52)|0,d=T()|0|t&-15728641,u=L(7,0,(14-c|0)*3|0)|0,d=on((l|e)&~u,d&~(T()|0),n)|0,A=f,d|0}else a=0;while(0);if(r=tn(e,t,o)|0,!r){a?(Ot(o,u,d),l=5):(jt(o,u,d),l=6);b:do if(Se(s)|0)if(!c)e=5;else for(r=1;;){if(s=L(7,0,(15-r|0)*3|0)|0,!((s&e|0)==0&((T()|0)&t|0)==0)){e=2;break b}if(r>>>0<c>>>0)r=r+1|0;else{e=5;break}}else e=2;while(0);Zr(n|0,-1,e<<2|0)|0;c:do if(a)for(o=0;;){if(s=d+(o<<4)|0,kt(s,i[u>>2]|0)|0,s=i[s>>2]|0,c=i[n>>2]|0,(c|0)==-1|(c|0)==(s|0))r=n;else{a=0;do{if(a=a+1|0,a>>>0>=e>>>0){r=1;break c}r=n+(a<<2)|0,c=i[r>>2]|0}while(!((c|0)==-1|(c|0)==(s|0)))}if(i[r>>2]=s,o=o+1|0,o>>>0>=l>>>0){r=0;break}}else for(o=0;;){if(s=d+(o<<4)|0,N(s,i[u>>2]|0,0,1)|0,s=i[s>>2]|0,c=i[n>>2]|0,(c|0)==-1|(c|0)==(s|0))r=n;else{a=0;do{if(a=a+1|0,a>>>0>=e>>>0){r=1;break c}r=n+(a<<2)|0,c=i[r>>2]|0}while(!((c|0)==-1|(c|0)==(s|0)))}if(i[r>>2]=s,o=o+1|0,o>>>0>=l>>>0){r=0;break}}while(0)}return d=r,A=f,d|0}function sn(){return 12}function cn(e,t){e|=0,t|=0;var n=0,r=0,a=0,o=0,s=0,c=0,l=0;if(e>>>0>15)return c=4,c|0;if(L(e|0,0,52)|0,c=T()|134225919,!e){n=0,r=0;do Se(r)|0&&(L(r|0,0,45)|0,s=c|(T()|0),e=t+(n<<3)|0,i[e>>2]=-1,i[e+4>>2]=s,n=n+1|0),r=r+1|0;while((r|0)!=122);return n=0,n|0}n=0,s=0;do{if(Se(s)|0){for(L(s|0,0,45)|0,r=1,a=-1,o=c|(T()|0);l=L(7,0,(15-r|0)*3|0)|0,a&=~l,o&=~(T()|0),(r|0)!=(e|0);)r=r+1|0;l=t+(n<<3)|0,i[l>>2]=a,i[l+4>>2]=o,n=n+1|0}s=s+1|0}while((s|0)!=122);return n=0,n|0}function ln(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0;if(y=A,A=A+16|0,_=y,v=I(e|0,t|0,52)|0,T()|0,v&=15,n>>>0>15)return v=4,A=y,v|0;if((v|0)<(n|0))return v=12,A=y,v|0;if((v|0)!=(n|0))if(o=L(n|0,0,52)|0,o|=e,c=T()|0|t&-15728641,(v|0)>(n|0)){l=n;do g=L(7,0,(14-l|0)*3|0)|0,l=l+1|0,o=g|o,c=T()|0|c;while((l|0)<(v|0));g=o}else g=o;else g=e,c=t;h=I(g|0,c|0,45)|0,T()|0;a:do if(Se(h&127)|0){if(l=I(g|0,c|0,52)|0,T()|0,l&=15,l|0)for(o=1;;){if(h=L(7,0,(15-o|0)*3|0)|0,!((h&g|0)==0&((T()|0)&c|0)==0)){u=33;break a}if(o>>>0<l>>>0)o=o+1|0;else break}if(h=r,i[h>>2]=0,i[h+4>>2]=0,(v|0)>(n|0)){for(h=t&-15728641,m=v;;){if(p=m,m=m+-1|0,m>>>0>15|(v|0)<(m|0)){u=19;break}if((v|0)!=(m|0))if(o=L(m|0,0,52)|0,o|=e,l=T()|0|h,(v|0)<(p|0))f=o;else{u=m;do f=L(7,0,(14-u|0)*3|0)|0,u=u+1|0,o=f|o,l=T()|0|l;while((u|0)<(v|0));f=o}else f=e,l=t;if(d=I(f|0,l|0,45)|0,T()|0,!(Se(d&127)|0))o=0;else{d=I(f|0,l|0,52)|0,T()|0,d&=15;b:do if(!d)o=0;else for(u=1;;){if(o=I(f|0,l|0,(15-u|0)*3|0)|0,T()|0,o&=7,o|0)break b;if(u>>>0<d>>>0)u=u+1|0;else{o=0;break}}while(0);o=(o|0)==0&1}if(l=I(e|0,t|0,(15-p|0)*3|0)|0,T()|0,l&=7,(l|0)==7){a=5,u=42;break}if(o=(o|0)!=0,(l|0)==1&o){a=5,u=42;break}if(f=l+(((l|0)!=0&o)<<31>>31)|0,f|0&&(u=v-p|0,u=Kn(7,0,u,((u|0)<0)<<31>>31)|0,d=T()|0,o?(o=Hr(u|0,d|0,5,0)|0,o=Ir(o|0,T()|0,-5,-1)|0,o=Br(o|0,T()|0,6,0)|0,o=Ir(o|0,T()|0,1,0)|0,l=T()|0):(o=u,l=d),p=f+-1|0,p=Hr(u|0,d|0,p|0,((p|0)<0)<<31>>31|0)|0,p=Ir(o|0,l|0,p|0,T()|0)|0,f=T()|0,d=r,d=Ir(p|0,f|0,i[d>>2]|0,i[d+4>>2]|0)|0,f=T()|0,p=r,i[p>>2]=d,i[p+4>>2]=f),(m|0)<=(n|0)){u=37;break}}if((u|0)==19)E(27795,27122,1276,27158);else if((u|0)==37){s=r,a=i[s+4>>2]|0,s=i[s>>2]|0;break}else if((u|0)==42)return A=y,a|0}else a=0,s=0}else u=33;while(0);c:do if((u|0)==33)if(h=r,i[h>>2]=0,i[h+4>>2]=0,(v|0)>(n|0)){for(o=v;;){if(a=I(e|0,t|0,(15-o|0)*3|0)|0,T()|0,a&=7,(a|0)==7){a=5;break}if(s=v-o|0,s=Kn(7,0,s,((s|0)<0)<<31>>31)|0,a=Hr(s|0,T()|0,a|0,0)|0,s=T()|0,h=r,s=Ir(i[h>>2]|0,i[h+4>>2]|0,a|0,s|0)|0,a=T()|0,h=r,i[h>>2]=s,i[h+4>>2]=a,o=o+-1|0,(o|0)<=(n|0))break c}return A=y,a|0}else a=0,s=0;while(0);return Lt(g,c,v,_)|0&&E(27795,27122,1236,27173),v=_,_=i[v+4>>2]|0,((a|0)>-1|(a|0)==-1&s>>>0>4294967295)&((_|0)>(a|0)|((_|0)==(a|0)?(i[v>>2]|0)>>>0>s>>>0:0))?(v=0,A=y,v|0):(E(27795,27122,1316,27158),0)}function un(e,t,n,r,a,o){e|=0,t|=0,n|=0,r|=0,a|=0,o|=0;var s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0;if(f=A,A=A+16|0,s=f,a>>>0>15)return o=4,A=f,o|0;if(c=I(n|0,r|0,52)|0,T()|0,c&=15,(c|0)>(a|0))return o=12,A=f,o|0;if(Lt(n,r,a,s)|0&&E(27795,27122,1236,27173),d=s,u=i[d+4>>2]|0,!(((t|0)>-1|(t|0)==-1&e>>>0>4294967295)&((u|0)>(t|0)|((u|0)==(t|0)?(i[d>>2]|0)>>>0>e>>>0:0))))return o=2,A=f,o|0;d=a-c|0,a=L(a|0,0,52)|0,l=T()|0|r&-15728641,u=o,i[u>>2]=a|n,i[u+4>>2]=l,u=I(n|0,r|0,45)|0,T()|0;a:do if(Se(u&127)|0){if(c|0)for(s=1;;){if(u=L(7,0,(15-s|0)*3|0)|0,!((u&n|0)==0&((T()|0)&r|0)==0))break a;if(s>>>0<c>>>0)s=s+1|0;else break}if((d|0)<1)return o=0,A=f,o|0;for(u=c^15,r=-1,l=1,s=1;;){c=d-l|0,c=Kn(7,0,c,((c|0)<0)<<31>>31)|0,n=T()|0;do if(s)if(s=Hr(c|0,n|0,5,0)|0,s=Ir(s|0,T()|0,-5,-1)|0,s=Br(s|0,T()|0,6,0)|0,a=T()|0,(t|0)>(a|0)|(t|0)==(a|0)&e>>>0>s>>>0){t=Ir(e|0,t|0,-1,-1)|0,t=Lr(t|0,T()|0,s|0,a|0)|0,s=T()|0,p=o,h=i[p>>2]|0,p=i[p+4>>2]|0,g=(u+r|0)*3|0,m=L(7,0,g|0)|0,p&=~(T()|0),r=Br(t|0,s|0,c|0,n|0)|0,e=T()|0,a=Ir(r|0,e|0,2,0)|0,g=L(a|0,T()|0,g|0)|0,p=T()|0|p,a=o,i[a>>2]=g|h&~m,i[a+4>>2]=p,e=Hr(r|0,e|0,c|0,n|0)|0,e=Lr(t|0,s|0,e|0,T()|0)|0,s=0,t=T()|0;break}else{g=o,m=i[g>>2]|0,g=i[g+4>>2]|0,h=L(7,0,(u+r|0)*3|0)|0,g&=~(T()|0),s=o,i[s>>2]=m&~h,i[s+4>>2]=g,s=1;break}else m=o,a=i[m>>2]|0,m=i[m+4>>2]|0,r=(u+r|0)*3|0,p=L(7,0,r|0)|0,m&=~(T()|0),g=Br(e|0,t|0,c|0,n|0)|0,s=T()|0,r=L(g|0,s|0,r|0)|0,m=T()|0|m,h=o,i[h>>2]=r|a&~p,i[h+4>>2]=m,s=Hr(g|0,s|0,c|0,n|0)|0,e=Lr(e|0,t|0,s|0,T()|0)|0,s=0,t=T()|0;while(0);if((d|0)>(l|0))r=~l,l=l+1|0;else{t=0;break}}return A=f,t|0}while(0);if((d|0)<1)return g=0,A=f,g|0;for(a=c^15,s=1;;)if(h=d-s|0,h=Kn(7,0,h,((h|0)<0)<<31>>31)|0,g=T()|0,l=o,n=i[l>>2]|0,l=i[l+4>>2]|0,c=(a-s|0)*3|0,r=L(7,0,c|0)|0,l&=~(T()|0),p=Br(e|0,t|0,h|0,g|0)|0,m=T()|0,c=L(p|0,m|0,c|0)|0,l=T()|0|l,u=o,i[u>>2]=c|n&~r,i[u+4>>2]=l,g=Hr(p|0,m|0,h|0,g|0)|0,e=Lr(e|0,t|0,g|0,T()|0)|0,t=T()|0,(d|0)<=(s|0)){t=0;break}else s=s+1|0;return A=f,t|0}function dn(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0;a=I(t|0,n|0,52)|0,T()|0,a&=15,(t|0)==0&(n|0)==0|((r|0)>15|(a|0)>(r|0))?(o=-1,t=-1,n=0,a=0):(t=Bt(t,n,a+1|0,r)|0,s=(T()|0)&-15728641,n=L(r|0,0,52)|0,n=t|n,s|=T()|0,t=(Rt(n,s)|0)==0,o=a,t=t?-1:r,a=s),s=e,i[s>>2]=n,i[s+4>>2]=a,i[e+8>>2]=o,i[e+12>>2]=t}function fn(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0;if(a=I(e|0,t|0,52)|0,T()|0,a&=15,o=r+8|0,i[o>>2]=a,(e|0)==0&(t|0)==0|((n|0)>15|(a|0)>(n|0))){n=r,i[n>>2]=0,i[n+4>>2]=0,i[o>>2]=-1,i[r+12>>2]=-1;return}if(e=Bt(e,t,a+1|0,n)|0,o=(T()|0)&-15728641,a=L(n|0,0,52)|0,a=e|a,o|=T()|0,e=r,i[e>>2]=a,i[e+4>>2]=o,e=r+12|0,Rt(a,o)|0){i[e>>2]=n;return}else{i[e>>2]=-1;return}}function pn(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0,l=0,u=0;if(n=e,t=i[n>>2]|0,n=i[n+4>>2]|0,!((t|0)==0&(n|0)==0)&&(r=I(t|0,n|0,52)|0,T()|0,r&=15,c=L(1,0,(r^15)*3|0)|0,t=Ir(c|0,T()|0,t|0,n|0)|0,n=T()|0,c=e,i[c>>2]=t,i[c+4>>2]=n,c=e+8|0,s=i[c>>2]|0,!((r|0)<(s|0)))){for(l=e+12|0,o=r;;){if((o|0)==(s|0)){r=5;break}if(u=(o|0)==(i[l>>2]|0),a=(15-o|0)*3|0,r=I(t|0,n|0,a|0)|0,T()|0,r&=7,u&((r|0)==1&!0)){r=7;break}if(!((r|0)==7&!0)){r=10;break}if(u=L(1,0,a|0)|0,t=Ir(t|0,n|0,u|0,T()|0)|0,n=T()|0,u=e,i[u>>2]=t,i[u+4>>2]=n,(o|0)>(s|0))o=o+-1|0;else{r=10;break}}if((r|0)==5){u=e,i[u>>2]=0,i[u+4>>2]=0,i[c>>2]=-1,i[l>>2]=-1;return}else if((r|0)==7){s=L(1,0,a|0)|0,s=Ir(t|0,n|0,s|0,T()|0)|0,c=T()|0,u=e,i[u>>2]=s,i[u+4>>2]=c,i[l>>2]=o+-1;return}else if((r|0)==10)return}}function mn(e){e=+e;var t=0;return t=e<0?e+6.283185307179586:e,+(e>=6.283185307179586?t+-6.283185307179586:t)}function hn(e,t){return e|=0,t|=0,+l(+(a[e>>3]-+a[t>>3]))<17453292519943298e-27?(t=+l(+(a[e+8>>3]-+a[t+8>>3]))<17453292519943298e-27,t|0):(t=0,t|0)}function gn(e,t){switch(e=+e,t|=0,t|0){case 1:e=e<0?e+6.283185307179586:e;break;case 2:e=e>0?e+-6.283185307179586:e;break;default:}return+e}function _n(e,t){e|=0,t|=0;var n=0,r=0,i=0,o=0;return i=+a[t>>3],r=+a[e>>3],o=+p(+((i-r)*.5)),n=+p(+((a[t+8>>3]-+a[e+8>>3])*.5)),n=o*o+n*(f(+i)*+f(+r)*n),+(v(+ +u(+n),+ +u(+(1-n)))*2)}function vn(e,t){e|=0,t|=0;var n=0,r=0,i=0,o=0;return i=+a[t>>3],r=+a[e>>3],o=+p(+((i-r)*.5)),n=+p(+((a[t+8>>3]-+a[e+8>>3])*.5)),n=o*o+n*(f(+i)*+f(+r)*n),+(v(+ +u(+n),+ +u(+(1-n)))*2*6371.007180918475)}function yn(e,t){e|=0,t|=0;var n=0,r=0,i=0,o=0;return i=+a[t>>3],r=+a[e>>3],o=+p(+((i-r)*.5)),n=+p(+((a[t+8>>3]-+a[e+8>>3])*.5)),n=o*o+n*(f(+i)*+f(+r)*n),+(v(+ +u(+n),+ +u(+(1-n)))*2*6371.007180918475*1e3)}function bn(e,t){e|=0,t|=0;var n=0,r=0,i=0,o=0,s=0;return o=+a[t>>3],r=+f(+o),i=a[t+8>>3]-+a[e+8>>3],s=r*+p(+i),n=+a[e>>3],+ +v(+s,+(p(+o)*+f(+n)-f(+i)*(r*+p(+n))))}function xn(e,t,n,r){e|=0,t=+t,n=+n,r|=0;var o=0,s=0,c=0,u=0;if(n<1e-16){i[r>>2]=i[e>>2],i[r+4>>2]=i[e+4>>2],i[r+8>>2]=i[e+8>>2],i[r+12>>2]=i[e+12>>2];return}s=t<0?t+6.283185307179586:t,s=t>=6.283185307179586?s+-6.283185307179586:s;do if(s<1e-16)t=+a[e>>3]+n,a[r>>3]=t,o=r;else{if(o=+l(+(s+-3.141592653589793))<1e-16,t=+a[e>>3],o){t-=n,a[r>>3]=t,o=r;break}if(c=+f(+n),n=+p(+n),t=c*+p(+t)+f(+s)*(n*+f(+t)),t=t>1?1:t,t=+g(+(t<-1?-1:t)),a[r>>3]=t,+l(+(t+-1.5707963267948966))<1e-16){a[r>>3]=1.5707963267948966,a[r+8>>3]=0;return}if(+l(+(t+1.5707963267948966))<1e-16){a[r>>3]=-1.5707963267948966,a[r+8>>3]=0;return}if(u=1/f(+t),s=n*+p(+s)*u,n=+a[e>>3],t=u*((c-p(+t)*+p(+n))/f(+n)),c=s>1?1:s,t=t>1?1:t,t=+a[e+8>>3]+ +v(+(c<-1?-1:c),+(t<-1?-1:t)),t>3.141592653589793)do t+=-6.283185307179586;while(t>3.141592653589793);if(t<-3.141592653589793)do t+=6.283185307179586;while(t<-3.141592653589793);a[r+8>>3]=t;return}while(0);if(+l(+(t+-1.5707963267948966))<1e-16){a[o>>3]=1.5707963267948966,a[r+8>>3]=0;return}if(+l(+(t+1.5707963267948966))<1e-16){a[o>>3]=-1.5707963267948966,a[r+8>>3]=0;return}if(t=+a[e+8>>3],t>3.141592653589793)do t+=-6.283185307179586;while(t>3.141592653589793);if(t<-3.141592653589793)do t+=6.283185307179586;while(t<-3.141592653589793);a[r+8>>3]=t}function Sn(e,t){return e|=0,t|=0,e>>>0>15?(t=4,t|0):(a[t>>3]=+a[20656+(e<<3)>>3],t=0,t|0)}function Cn(e,t){return e|=0,t|=0,e>>>0>15?(t=4,t|0):(a[t>>3]=+a[20784+(e<<3)>>3],t=0,t|0)}function wn(e,t){return e|=0,t|=0,e>>>0>15?(t=4,t|0):(a[t>>3]=+a[20912+(e<<3)>>3],t=0,t|0)}function Tn(e,t){return e|=0,t|=0,e>>>0>15?(t=4,t|0):(a[t>>3]=+a[21040+(e<<3)>>3],t=0,t|0)}function En(e,t){e|=0,t|=0;var n=0;return e>>>0>15?(t=4,t|0):(n=Kn(7,0,e,((e|0)<0)<<31>>31)|0,n=Hr(n|0,T()|0,120,0)|0,e=T()|0,i[t>>2]=n|2,i[t+4>>2]=e,t=0,t|0)}function Dn(e,t,n){e|=0,t|=0,n|=0;var r=0,i=0,o=0,s=0,c=0,l=0,d=0,h=0,g=0,y=0;return y=+a[t>>3],h=+a[e>>3],l=+p(+((y-h)*.5)),o=+a[t+8>>3],d=+a[e+8>>3],s=+p(+((o-d)*.5)),c=+f(+h),g=+f(+y),s=l*l+s*(g*c*s),s=v(+ +u(+s),+ +u(+(1-s)))*2,l=+a[n>>3],y=+p(+((l-y)*.5)),r=+a[n+8>>3],o=+p(+((r-o)*.5)),i=+f(+l),o=y*y+o*(g*i*o),o=v(+ +u(+o),+ +u(+(1-o)))*2,l=+p(+((h-l)*.5)),r=+p(+((d-r)*.5)),r=l*l+r*(c*i*r),r=v(+ +u(+r),+ +u(+(1-r)))*2,i=(s+o+r)*.5,+(_(+ +u(+(m(+(i*.5))*+m(+((i-s)*.5))*m(+((i-o)*.5))*m(+((i-r)*.5)))))*4)}function On(e,t,n){e|=0,t|=0,n|=0;var r=0,o=0,s=0,c=0,l=0;if(l=A,A=A+192|0,s=l+168|0,c=l,o=nn(e,t,s)|0,o|0)return n=o,A=l,n|0;if(rn(e,t,c)|0&&E(27795,27190,415,27199),t=i[c>>2]|0,(t|0)>0){if(r=+Dn(c+8|0,c+8+(((t|0)!=1&1)<<4)|0,s)+0,(t|0)!=1){e=1;do o=e,e=e+1|0,r+=+Dn(c+8+(o<<4)|0,c+8+(((e|0)%(t|0)|0)<<4)|0,s);while((e|0)<(t|0))}}else r=0;return a[n>>3]=r,n=0,A=l,n|0}function kn(e,t,n){return e|=0,t|=0,n|=0,e=On(e,t,n)|0,e|0||(a[n>>3]=a[n>>3]*6371.007180918475*6371.007180918475),e|0}function An(e,t,n){return e|=0,t|=0,n|=0,e=On(e,t,n)|0,e|0||(a[n>>3]=a[n>>3]*6371.007180918475*6371.007180918475*1e3*1e3),e|0}function jn(e,t,n){e|=0,t|=0,n|=0;var r=0,o=0,s=0,c=0,l=0,d=0,m=0,h=0;if(l=A,A=A+176|0,c=l,e=xt(e,t,c)|0,e|0)return c=e,A=l,c|0;if(a[n>>3]=0,e=i[c>>2]|0,(e|0)<=1)return c=0,A=l,c|0;t=e+-1|0,e=0,r=+a[c+8>>3],o=+a[c+16>>3],s=0;do e=e+1|0,m=r,r=+a[c+8+(e<<4)>>3],h=+p(+((r-m)*.5)),d=o,o=+a[c+8+(e<<4)+8>>3],d=+p(+((o-d)*.5)),d=h*h+d*(f(+r)*+f(+m)*d),s+=v(+ +u(+d),+ +u(+(1-d)))*2;while((e|0)<(t|0));return a[n>>3]=s,c=0,A=l,c|0}function Mn(e,t,n){e|=0,t|=0,n|=0;var r=0,o=0,s=0,c=0,l=0,d=0,m=0,h=0;if(l=A,A=A+176|0,c=l,e=xt(e,t,c)|0,e|0)return c=e,s=+a[n>>3],s*=6371.007180918475,a[n>>3]=s,A=l,c|0;if(a[n>>3]=0,e=i[c>>2]|0,(e|0)<=1)return c=0,s=0,s*=6371.007180918475,a[n>>3]=s,A=l,c|0;t=e+-1|0,e=0,r=+a[c+8>>3],o=+a[c+16>>3],s=0;do e=e+1|0,m=r,r=+a[c+8+(e<<4)>>3],h=+p(+((r-m)*.5)),d=o,o=+a[c+8+(e<<4)+8>>3],d=+p(+((o-d)*.5)),d=h*h+d*(f(+m)*+f(+r)*d),s+=v(+ +u(+d),+ +u(+(1-d)))*2;while((e|0)!=(t|0));return a[n>>3]=s,c=0,h=s,h*=6371.007180918475,a[n>>3]=h,A=l,c|0}function Nn(e,t,n){e|=0,t|=0,n|=0;var r=0,o=0,s=0,c=0,l=0,d=0,m=0,h=0;if(l=A,A=A+176|0,c=l,e=xt(e,t,c)|0,e|0)return c=e,s=+a[n>>3],s*=6371.007180918475,s*=1e3,a[n>>3]=s,A=l,c|0;if(a[n>>3]=0,e=i[c>>2]|0,(e|0)<=1)return c=0,s=0,s*=6371.007180918475,s*=1e3,a[n>>3]=s,A=l,c|0;t=e+-1|0,e=0,r=+a[c+8>>3],o=+a[c+16>>3],s=0;do e=e+1|0,m=r,r=+a[c+8+(e<<4)>>3],h=+p(+((r-m)*.5)),d=o,o=+a[c+8+(e<<4)+8>>3],d=+p(+((o-d)*.5)),d=h*h+d*(f(+m)*+f(+r)*d),s+=v(+ +u(+d),+ +u(+(1-d)))*2;while((e|0)!=(t|0));return a[n>>3]=s,c=0,h=s,h*=6371.007180918475,h*=1e3,a[n>>3]=h,A=l,c|0}function Pn(e){e|=0;var t=0,n=0,r=0;return t=Fr(1,12)|0,t||E(27280,27235,49,27293),n=e+4|0,r=i[n>>2]|0,r|0?(r=r+8|0,i[r>>2]=t,i[n>>2]=t,t|0):(i[e>>2]|0&&E(27310,27235,61,27333),r=e,i[r>>2]=t,i[n>>2]=t,t|0)}function Fn(e,t){e|=0,t|=0;var n=0,r=0;return r=Pr(24)|0,r||E(27347,27235,78,27361),i[r>>2]=i[t>>2],i[r+4>>2]=i[t+4>>2],i[r+8>>2]=i[t+8>>2],i[r+12>>2]=i[t+12>>2],i[r+16>>2]=0,t=e+4|0,n=i[t>>2]|0,n|0?(i[n+16>>2]=r,i[t>>2]=r,r|0):(i[e>>2]|0&&E(27376,27235,82,27361),i[e>>2]=r,i[t>>2]=r,r|0)}function In(e){e|=0;var t=0,n=0,r=0,a=0;if(e)for(r=1;;){if(t=i[e>>2]|0,t|0)do{if(n=i[t>>2]|0,n|0)do a=n,n=i[n+16>>2]|0,F(a);while(n|0);a=t,t=i[t+8>>2]|0,F(a)}while(t|0);if(t=e,e=i[e+8>>2]|0,r||F(t),e)r=0;else break}}function Ln(e){e|=0;var t=0,n=0,r=0,o=0,s=0,c=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,D=0,O=0,ee=0,k=0,te=0,A=0,ne=0,re=0,ie=0,ae=0;if(o=e+8|0,i[o>>2]|0)return ae=1,ae|0;if(r=i[e>>2]|0,!r)return ae=0,ae|0;t=r,n=0;do n=n+1|0,t=i[t+8>>2]|0;while(t|0);if(n>>>0<2)return ae=0,ae|0;re=Pr(n<<2)|0,re||E(27396,27235,317,27415),ne=Pr(n<<5)|0,ne||E(27437,27235,321,27415),i[e>>2]=0,T=e+4|0,i[T>>2]=0,i[o>>2]=0,n=0,A=0,w=0,m=0;a:for(;;){if(p=i[r>>2]|0,p){s=0,c=p;do{if(d=+a[c+8>>3],t=c,c=i[c+16>>2]|0,f=(c|0)==0,o=f?p:c,u=+a[o+8>>3],+l(+(d-u))>3.141592653589793){ae=14;break}s+=(u-d)*(+a[t>>3]+ +a[o>>3])}while(!f);if((ae|0)==14){ae=0,s=0,t=p;do C=+a[t+8>>3],te=t+16|0,k=i[te>>2]|0,k=k|0?k:p,S=+a[k+8>>3],s+=(+a[t>>3]+ +a[k>>3])*((S<0?S+6.283185307179586:S)-(C<0?C+6.283185307179586:C)),t=i[(t|0?te:r)>>2]|0;while(t|0)}s>0?(i[re+(A<<2)>>2]=r,A=A+1|0,o=w,t=m):ae=19}else ae=19;if((ae|0)==19){ae=0;do if(n){if(t=n+8|0,i[t>>2]|0){ae=21;break a}if(n=Fr(1,12)|0,!n){ae=23;break a}i[t>>2]=n,o=n+4|0,c=n,t=m}else if(m){o=T,c=m+8|0,t=r,n=e;break}else if(i[e>>2]|0){ae=27;break a}else{o=T,c=e,t=r,n=e;break}while(0);if(i[c>>2]=r,i[o>>2]=r,c=ne+(w<<5)|0,f=i[r>>2]|0,f){for(p=ne+(w<<5)+8|0,a[p>>3]=17976931348623157e292,m=ne+(w<<5)+24|0,a[m>>3]=17976931348623157e292,a[c>>3]=-17976931348623157e292,h=ne+(w<<5)+16|0,a[h>>3]=-17976931348623157e292,b=17976931348623157e292,x=-17976931348623157e292,o=0,g=f,d=17976931348623157e292,v=17976931348623157e292,y=-17976931348623157e292,u=-17976931348623157e292;s=+a[g>>3],C=+a[g+8>>3],g=i[g+16>>2]|0,_=(g|0)==0,S=+a[(_?f:g)+8>>3],s<d&&(a[p>>3]=s,d=s),C<v&&(a[m>>3]=C,v=C),s>y?a[c>>3]=s:s=y,C>u&&(a[h>>3]=C,u=C),b=C>0&C<b?C:b,x=C<0&C>x?C:x,o|=+l(+(C-S))>3.141592653589793,!_;)y=s;o&&(a[h>>3]=x,a[m>>3]=b)}else i[c>>2]=0,i[c+4>>2]=0,i[c+8>>2]=0,i[c+12>>2]=0,i[c+16>>2]=0,i[c+20>>2]=0,i[c+24>>2]=0,i[c+28>>2]=0;o=w+1|0}if(te=r+8|0,r=i[te>>2]|0,i[te>>2]=0,r)w=o,m=t;else{ae=45;break}}if((ae|0)==21)E(27213,27235,35,27247);else if((ae|0)==23)E(27267,27235,37,27247);else if((ae|0)==27)E(27310,27235,61,27333);else if((ae|0)==45){b:do if((A|0)>0){for(te=(o|0)==0,ee=o<<2,k=(e|0)==0,O=0,t=0;;){if(D=i[re+(O<<2)>>2]|0,te)ae=73;else{if(w=Pr(ee)|0,!w){ae=50;break}if(T=Pr(ee)|0,!T){ae=52;break}c:do if(k)n=0;else{for(o=0,n=0,c=e;r=ne+(o<<5)|0,Rn(i[c>>2]|0,r,i[D>>2]|0)|0?(i[w+(n<<2)>>2]=c,i[T+(n<<2)>>2]=r,_=n+1|0):_=n,c=i[c+8>>2]|0,c;)o=o+1|0,n=_;if((_|0)>0)if(r=i[w>>2]|0,(_|0)==1)n=r;else for(h=0,g=-1,n=r,m=r;;){for(f=i[m>>2]|0,r=0,c=0;o=i[i[w+(c<<2)>>2]>>2]|0,p=(o|0)==(f|0)?r:r+((Rn(o,i[T+(c<<2)>>2]|0,i[f>>2]|0)|0)&1)|0,c=c+1|0,(c|0)!=(_|0);)r=p;if(o=(p|0)>(g|0),n=o?m:n,r=h+1|0,(r|0)==(_|0))break c;h=r,g=o?p:g,m=i[w+(r<<2)>>2]|0}else n=0}while(0);if(F(w),F(T),n){if(o=n+4|0,r=i[o>>2]|0,r)n=r+8|0;else if(i[n>>2]|0){ae=70;break}i[n>>2]=D,i[o>>2]=D}else ae=73}if((ae|0)==73){if(ae=0,t=i[D>>2]|0,t|0)do T=t,t=i[t+16>>2]|0,F(T);while(t|0);F(D),t=1}if(O=O+1|0,(O|0)>=(A|0)){ie=t;break b}}(ae|0)==50?E(27452,27235,249,27471):(ae|0)==52?E(27490,27235,252,27471):(ae|0)==70&&E(27310,27235,61,27333)}else ie=0;while(0);return F(re),F(ne),ae=ie,ae|0}return 0}function Rn(e,t,n){e|=0,t|=0,n|=0;var r=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0;if(!(Ie(t,n)|0)||(t=Pe(t)|0,r=+a[n>>3],o=+a[n+8>>3],o=t&o<0?o+6.283185307179586:o,e=i[e>>2]|0,!e))return e=0,e|0;if(t){t=0,d=o,n=e;a:for(;;){for(;c=+a[n>>3],o=+a[n+8>>3],n=n+16|0,f=i[n>>2]|0,f=f|0?f:e,s=+a[f>>3],l=+a[f+8>>3],c>s?(u=c,c=l):(u=s,s=c,c=o,o=l),r=r==s|r==u?r+2220446049250313e-31:r,r<s|r>u;)if(n=i[n>>2]|0,!n){n=22;break a}if(l=c<0?c+6.283185307179586:c,c=o<0?o+6.283185307179586:o,d=l==d|c==d?d+-2220446049250313e-31:d,u=l+(c-l)*((r-s)/(u-s)),(u<0?u+6.283185307179586:u)>d&&(t^=1),n=i[n>>2]|0,!n){n=22;break}}if((n|0)==22)return t|0}else{t=0,d=o,n=e;b:for(;;){for(;c=+a[n>>3],o=+a[n+8>>3],n=n+16|0,f=i[n>>2]|0,f=f|0?f:e,s=+a[f>>3],l=+a[f+8>>3],c>s?(u=c,c=l):(u=s,s=c,c=o,o=l),r=r==s|r==u?r+2220446049250313e-31:r,r<s|r>u;)if(n=i[n>>2]|0,!n){n=22;break b}if(d=c==d|o==d?d+-2220446049250313e-31:d,c+(o-c)*((r-s)/(u-s))>d&&(t^=1),n=i[n>>2]|0,!n){n=22;break}}if((n|0)==22)return t|0}return 0}function zn(e,t,n,a,o){e|=0,t|=0,n|=0,a|=0,o|=0;var s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0;if(b=A,A=A+32|0,y=b+16|0,v=b,s=I(e|0,t|0,52)|0,T()|0,s&=15,h=I(n|0,a|0,52)|0,T()|0,(s|0)!=(h&15|0))return y=12,A=b,y|0;if(d=I(e|0,t|0,45)|0,T()|0,d&=127,f=I(n|0,a|0,45)|0,T()|0,f&=127,d>>>0>121|f>>>0>121)return y=5,A=b,y|0;if(h=(d|0)!=(f|0),h){if(l=Ae(d,f)|0,(l|0)==7)return y=1,A=b,y|0;u=Ae(f,d)|0,(u|0)==7?E(27514,27538,161,27548):(g=l,c=u)}else g=0,c=0;p=Se(d)|0,m=Se(f)|0,i[y>>2]=0,i[y+4>>2]=0,i[y+8>>2]=0,i[y+12>>2]=0;do if(g){if(f=i[4272+(d*28|0)+(g<<2)>>2]|0,l=(f|0)>0,m)if(l){d=0,u=n,l=a;do u=Yt(u,l)|0,l=T()|0,c=ot(c)|0,(c|0)==1&&(c=ot(1)|0),d=d+1|0;while((d|0)!=(f|0));f=c,d=u,u=l}else f=c,d=n,u=a;else if(l){d=0,u=n,l=a;do u=Xt(u,l)|0,l=T()|0,c=ot(c)|0,d=d+1|0;while((d|0)!=(f|0));f=c,d=u,u=l}else f=c,d=n,u=a;if(en(d,u,y)|0,h||E(27563,27538,191,27548),l=(p|0)!=0,c=(m|0)!=0,l&c&&E(27590,27538,192,27548),l){if(c=Kt(e,t)|0,(c|0)==7){s=5;break}if(r[22e3+(c*7|0)+g>>0]|0){s=1;break}u=i[21168+(c*28|0)+(g<<2)>>2]|0,d=u}else if(c){if(c=Kt(d,u)|0,(c|0)==7){s=5;break}if(r[22e3+(c*7|0)+f>>0]|0){s=1;break}d=0,u=i[21168+(f*28|0)+(c<<2)>>2]|0}else d=0,u=0;if((d|u|0)<0)s=5;else{if((u|0)>0){l=y+4|0,c=0;do it(l),c=c+1|0;while((c|0)!=(u|0))}if(i[v>>2]=0,i[v+4>>2]=0,i[v+8>>2]=0,nt(v,g),s|0)for(;Qt(s)|0?et(v):tt(v),(s|0)>1;)s=s+-1|0;if((d|0)>0){s=0;do it(v),s=s+1|0;while((s|0)!=(d|0))}_=y+4|0,M(_,v,_),Ge(_),_=51}}else if(en(n,a,y)|0,(p|0)!=0&(m|0)!=0)if((f|0)!=(d|0)&&E(27621,27538,261,27548),c=Kt(e,t)|0,s=Kt(n,a)|0,(c|0)==7|(s|0)==7)s=5;else if(r[22e3+(c*7|0)+s>>0]|0)s=1;else if(c=i[21168+(c*28|0)+(s<<2)>>2]|0,(c|0)>0){l=y+4|0,s=0;do it(l),s=s+1|0;while((s|0)!=(c|0));_=51}else _=51;else _=51;while(0);return(_|0)==51&&(s=y+4|0,i[o>>2]=i[s>>2],i[o+4>>2]=i[s+4>>2],i[o+8>>2]=i[s+8>>2],s=0),y=s,A=b,y|0}function Bn(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0;if(g=A,A=A+48|0,u=g+36|0,s=g+24|0,c=g+12|0,l=g,a=I(e|0,t|0,52)|0,T()|0,a&=15,p=I(e|0,t|0,45)|0,T()|0,p&=127,p>>>0>121)return r=5,A=g,r|0;if(d=Se(p)|0,L(a|0,0,52)|0,_=T()|134225919,o=r,i[o>>2]=-1,i[o+4>>2]=_,!a)return a=Ye(n)|0,(a|0)==7||(a=ke(p,a)|0,(a|0)==127)?(_=1,A=g,_|0):(m=L(a|0,0,45)|0,h=T()|0,p=r,h=i[p+4>>2]&-1040385|h,_=r,i[_>>2]=i[p>>2]|m,i[_+4>>2]=h,_=0,A=g,_|0);for(i[u>>2]=i[n>>2],i[u+4>>2]=i[n+4>>2],i[u+8>>2]=i[n+8>>2],n=a;;){if(o=n,n=n+-1|0,i[s>>2]=i[u>>2],i[s+4>>2]=i[u+4>>2],i[s+8>>2]=i[u+8>>2],Qt(o)|0){if(a=Xe(u)|0,a|0){n=13;break}i[c>>2]=i[u>>2],i[c+4>>2]=i[u+4>>2],i[c+8>>2]=i[u+8>>2],et(c)}else{if(a=Ze(u)|0,a|0){n=13;break}i[c>>2]=i[u>>2],i[c+4>>2]=i[u+4>>2],i[c+8>>2]=i[u+8>>2],tt(c)}if(qe(s,c,l),Ge(l),a=r,y=i[a>>2]|0,a=i[a+4>>2]|0,b=(15-o|0)*3|0,v=L(7,0,b|0)|0,a&=~(T()|0),b=L(Ye(l)|0,0,b|0)|0,a=T()|0|a,_=r,i[_>>2]=b|y&~v,i[_+4>>2]=a,(o|0)<=1){n=14;break}}a:do if((n|0)!=13&&(n|0)==14)if((i[u>>2]|0)<=1&&(i[u+4>>2]|0)<=1&&(i[u+8>>2]|0)<=1){n=Ye(u)|0,a=ke(p,n)|0,l=(a|0)==127?0:Se(a)|0;b:do if(n){if(d){if(a=Kt(e,t)|0,(a|0)==7){a=5;break a}if(o=i[21376+(a*28|0)+(n<<2)>>2]|0,(o|0)>0){a=n,n=0;do a=at(a)|0,n=n+1|0;while((n|0)!=(o|0))}else a=n;if((a|0)==1){a=9;break a}n=ke(p,a)|0,(n|0)==127&&E(27648,27538,411,27678),Se(n)|0?E(27693,27538,412,27678):(h=n,m=o,f=a)}else h=a,m=0,f=n;if(c=i[4272+(p*28|0)+(f<<2)>>2]|0,(c|0)<=-1&&E(27724,27538,419,27678),!l){if((m|0)<0){a=5;break a}if(m|0){o=r,a=0,n=i[o>>2]|0,o=i[o+4>>2]|0;do n=Jt(n,o)|0,o=T()|0,b=r,i[b>>2]=n,i[b+4>>2]=o,a=a+1|0;while((a|0)<(m|0))}if((c|0)<=0){a=h,n=58;break}for(o=r,a=0,n=i[o>>2]|0,o=i[o+4>>2]|0;;)if(n=Jt(n,o)|0,o=T()|0,b=r,i[b>>2]=n,i[b+4>>2]=o,a=a+1|0,(a|0)==(c|0)){a=h,n=58;break b}}if(s=Ae(h,p)|0,(s|0)==7&&E(27514,27538,428,27678),a=r,n=i[a>>2]|0,a=i[a+4>>2]|0,(c|0)>0){o=0;do n=Jt(n,a)|0,a=T()|0,b=r,i[b>>2]=n,i[b+4>>2]=a,o=o+1|0;while((o|0)!=(c|0))}if(a=Kt(n,a)|0,(a|0)==7&&E(27795,27538,440,27678),n=Ce(h)|0,n=i[(n?21792:21584)+(s*28|0)+(a<<2)>>2]|0,(n|0)<0&&E(27795,27538,454,27678),!n)a=h,n=58;else{s=r,a=0,o=i[s>>2]|0,s=i[s+4>>2]|0;do o=qt(o,s)|0,s=T()|0,b=r,i[b>>2]=o,i[b+4>>2]=s,a=a+1|0;while((a|0)<(n|0));a=h,n=58}}else if((d|0)!=0&(l|0)!=0){if(n=Kt(e,t)|0,o=r,o=Kt(i[o>>2]|0,i[o+4>>2]|0)|0,(n|0)==7|(o|0)==7){a=5;break a}if(o=i[21376+(n*28|0)+(o<<2)>>2]|0,(o|0)<0){a=5;break a}if(!o)n=59;else{c=r,n=0,s=i[c>>2]|0,c=i[c+4>>2]|0;do s=Jt(s,c)|0,c=T()|0,b=r,i[b>>2]=s,i[b+4>>2]=c,n=n+1|0;while((n|0)<(o|0));n=58}}else n=58;while(0);if((n|0)==58&&l&&(n=59),(n|0)==59&&(b=r,(Kt(i[b>>2]|0,i[b+4>>2]|0)|0)==1)){a=9;break}b=r,v=i[b>>2]|0,b=i[b+4>>2]&-1040385,y=L(a|0,0,45)|0,b|=T()|0,a=r,i[a>>2]=v|y,i[a+4>>2]=b,a=0}else a=1;while(0);return b=a,A=g,b|0}function Vn(e,t,n,r,i,a){e|=0,t|=0,n|=0,r|=0,i|=0,a|=0;var o=0,s=0;return s=A,A=A+16|0,o=s,i?e=15:(e=zn(e,t,n,r,o)|0,e||=(ut(o,a),0)),A=s,e|0}function Hn(e,t,n,r,i){e|=0,t|=0,n|=0,r|=0,i|=0;var a=0,o=0;return o=A,A=A+16|0,a=o,r?n=15:(n=dt(n,a)|0,n||=Bn(e,t,a,i)|0),A=o,n|0}function Un(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o=0,s=0,c=0,l=0;return l=A,A=A+32|0,s=l+12|0,c=l,o=zn(e,t,e,t,s)|0,o|0?(c=o,A=l,c|0):(e=zn(e,t,n,r,c)|0,e|0?(c=e,A=l,c|0):(s=lt(s,c)|0,c=a,i[c>>2]=s,i[c+4>>2]=((s|0)<0)<<31>>31,c=0,A=l,c|0))}function Wn(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o=0,s=0,c=0,l=0;return l=A,A=A+32|0,s=l+12|0,c=l,o=zn(e,t,e,t,s)|0,!o&&(o=zn(e,t,n,r,c)|0,!o)?(r=lt(s,c)|0,r=Ir(r|0,((r|0)<0)<<31>>31|0,1,0)|0,s=T()|0,c=a,i[c>>2]=r,i[c+4>>2]=s,c=0,A=l,c|0):(c=o,A=l,c|0)}function Gn(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o=0,s=0,c=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,D=0,O=0;if(D=A,A=A+48|0,C=D+24|0,s=D+12|0,w=D,o=zn(e,t,e,t,C)|0,!o&&(o=zn(e,t,n,r,s)|0,!o)){x=lt(C,s)|0,S=((x|0)<0)<<31>>31,i[C>>2]=0,i[C+4>>2]=0,i[C+8>>2]=0,i[s>>2]=0,i[s+4>>2]=0,i[s+8>>2]=0,zn(e,t,e,t,C)|0&&E(27795,27538,692,27747),zn(e,t,n,r,s)|0&&E(27795,27538,697,27747),ft(C),ft(s),f=x|0?1/(x|0):0,n=i[C>>2]|0,_=f*+((i[s>>2]|0)-n|0),v=C+4|0,r=i[v>>2]|0,y=f*+((i[s+4>>2]|0)-r|0),b=C+8|0,o=i[b>>2]|0,f*=+((i[s+8>>2]|0)-o|0),i[w>>2]=n,p=w+4|0,i[p>>2]=r,m=w+8|0,i[m>>2]=o;a:do if((x|0)<0)o=0;else for(h=0,g=0;;){u=+(g>>>0)+4294967296*(h|0),O=_*u+ +(n|0),c=y*u+ +(r|0),u=f*u+ +(o|0),n=~~+Yr(+O),s=~~+Yr(+c),o=~~+Yr(+u),O=+l(+(+(n|0)-O)),c=+l(+(+(s|0)-c)),u=+l(+(+(o|0)-u));do if(O>c&O>u)n=0-(s+o)|0,r=s;else if(d=0-n|0,c>u){r=d-o|0;break}else{r=s,o=d-s|0;break}while(0);if(i[w>>2]=n,i[p>>2]=r,i[m>>2]=o,pt(w),o=Bn(e,t,w,a+(g<<3)|0)|0,o|0)break a;if(!((h|0)<(S|0)|(h|0)==(S|0)&g>>>0<x>>>0)){o=0;break a}n=Ir(g|0,h|0,1,0)|0,r=T()|0,h=r,g=n,n=i[C>>2]|0,r=i[v>>2]|0,o=i[b>>2]|0}while(0);return w=o,A=D,w|0}return w=o,A=D,w|0}function Kn(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var i=0,a=0,o=0;if((n|0)==0&(r|0)==0)return i=0,a=1,w(i|0),a|0;a=e,i=t,e=1,t=0;do o=(n&1|0)==0&!0,e=Hr((o?1:a)|0,(o?0:i)|0,e|0,t|0)|0,t=T()|0,n=Gr(n|0,r|0,1)|0,r=T()|0,a=Hr(a|0,i|0,a|0,i|0)|0,i=T()|0;while(!((n|0)==0&(r|0)==0));return w(t|0),e|0}function qn(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var o=0,s=0,c=0,l=0,u=0,d=0,p=0;l=A,A=A+16|0,s=l,c=I(e|0,t|0,52)|0,T()|0,c&=15;do if(c){if(o=nn(e,t,s)|0,!o){d=+a[s>>3],u=1/f(+d),p=+a[25968+(c<<3)>>3],a[n>>3]=d+p,a[n+8>>3]=d-p,d=+a[s+8>>3],u=p*u,a[n+16>>3]=u+d,a[n+24>>3]=d-u;break}return c=o,A=l,c|0}else{if(o=I(e|0,t|0,45)|0,T()|0,o&=127,o>>>0>121)return c=5,A=l,c|0;s=22064+(o<<5)|0,i[n>>2]=i[s>>2],i[n+4>>2]=i[s+4>>2],i[n+8>>2]=i[s+8>>2],i[n+12>>2]=i[s+12>>2],i[n+16>>2]=i[s+16>>2],i[n+20>>2]=i[s+20>>2],i[n+24>>2]=i[s+24>>2],i[n+28>>2]=i[s+28>>2];break}while(0);return He(n,r?1.4:1.1),r=26096+(c<<3)|0,(i[r>>2]|0)==(e|0)&&(i[r+4>>2]|0)==(t|0)&&(a[n>>3]=1.5707963267948966),c=26224+(c<<3)|0,(i[c>>2]|0)==(e|0)&&(i[c+4>>2]|0)==(t|0)&&(a[n+8>>3]=-1.5707963267948966),+a[n>>3]!=1.5707963267948966&&+a[n+8>>3]!=-1.5707963267948966?(c=0,A=l,c|0):(a[n+16>>3]=3.141592653589793,a[n+24>>3]=-3.141592653589793,c=0,A=l,c|0)}function Jn(e,t,n,a){e|=0,t|=0,n|=0,a|=0;var o=0,s=0,c=0,l=0,u=0,d=0,f=0;d=A,A=A+48|0,c=d+32|0,s=d+40|0,l=d,Ft(c,0,0,0),u=i[c>>2]|0,c=i[c+4>>2]|0;do if(n>>>0<=15){if(o=tr(a)|0,o|0){a=l,i[a>>2]=0,i[a+4>>2]=0,i[l+8>>2]=o,i[l+12>>2]=-1,a=l+16|0,u=l+29|0,i[a>>2]=0,i[a+4>>2]=0,i[a+8>>2]=0,r[a+12>>0]=0,r[u>>0]=r[s>>0]|0,r[u+1>>0]=r[s+1>>0]|0,r[u+2>>0]=r[s+2>>0]|0;break}if(o=Fr((i[t+8>>2]|0)+1|0,32)|0,o){nr(t,o),f=l,i[f>>2]=u,i[f+4>>2]=c,i[l+8>>2]=0,i[l+12>>2]=n,i[l+16>>2]=a,i[l+20>>2]=t,i[l+24>>2]=o,r[l+28>>0]=0,u=l+29|0,r[u>>0]=r[s>>0]|0,r[u+1>>0]=r[s+1>>0]|0,r[u+2>>0]=r[s+2>>0]|0;break}else{a=l,i[a>>2]=0,i[a+4>>2]=0,i[l+8>>2]=13,i[l+12>>2]=-1,a=l+16|0,u=l+29|0,i[a>>2]=0,i[a+4>>2]=0,i[a+8>>2]=0,r[a+12>>0]=0,r[u>>0]=r[s>>0]|0,r[u+1>>0]=r[s+1>>0]|0,r[u+2>>0]=r[s+2>>0]|0;break}}else u=l,i[u>>2]=0,i[u+4>>2]=0,i[l+8>>2]=4,i[l+12>>2]=-1,u=l+16|0,f=l+29|0,i[u>>2]=0,i[u+4>>2]=0,i[u+8>>2]=0,r[u+12>>0]=0,r[f>>0]=r[s>>0]|0,r[f+1>>0]=r[s+1>>0]|0,r[f+2>>0]=r[s+2>>0]|0;while(0);Yn(l),i[e>>2]=i[l>>2],i[e+4>>2]=i[l+4>>2],i[e+8>>2]=i[l+8>>2],i[e+12>>2]=i[l+12>>2],i[e+16>>2]=i[l+16>>2],i[e+20>>2]=i[l+20>>2],i[e+24>>2]=i[l+24>>2],i[e+28>>2]=i[l+28>>2],A=d}function Yn(e){e|=0;var t=0,n=0,a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0;if(S=A,A=A+336|0,h=S+168|0,g=S,a=e,n=i[a>>2]|0,a=i[a+4>>2]|0,(n|0)==0&(a|0)==0){A=S;return}if(t=e+28|0,r[t>>0]|0?(n=Xn(n,a)|0,a=T()|0):r[t>>0]=1,x=e+20|0,!(i[i[x>>2]>>2]|0)){t=e+24|0,n=i[t>>2]|0,n|0&&F(n),b=e,i[b>>2]=0,i[b+4>>2]=0,i[e+8>>2]=0,i[x>>2]=0,i[e+12>>2]=-1,i[e+16>>2]=0,i[t>>2]=0,A=S;return}b=e+16|0,t=i[b>>2]|0,o=t&15;a:do if((n|0)==0&(a|0)==0)y=e+24|0;else{_=e+12|0,p=(o|0)==3,f=t&255,u=(o|1)==3,m=e+24|0,d=(o+-1|0)>>>0<3,c=(o|2)==3,l=g+8|0;b:for(;;){if(s=I(n|0,a|0,52)|0,T()|0,s&=15,(s|0)==(i[_>>2]|0)){switch(f&15){case 0:case 2:case 3:if(o=nn(n,a,h)|0,o|0){v=15;break b}if(rr(i[x>>2]|0,i[m>>2]|0,h)|0){v=19;break b}break;default:}if(u&&(o=i[(i[x>>2]|0)+4>>2]|0,i[h>>2]=i[o>>2],i[h+4>>2]=i[o+4>>2],i[h+8>>2]=i[o+8>>2],i[h+12>>2]=i[o+12>>2],Ie(26832,h)|0)){if($t(i[(i[x>>2]|0)+4>>2]|0,s,g)|0){v=25;break}if(o=g,(i[o>>2]|0)==(n|0)&&(i[o+4>>2]|0)==(a|0)){v=29;break}}if(d){if(o=rn(n,a,h)|0,o|0){v=32;break}if(qn(n,a,g,0)|0){v=36;break}if(c&&ir(i[x>>2]|0,i[m>>2]|0,h,g)|0){v=42;break}if(u&&or(i[x>>2]|0,i[m>>2]|0,h,g)|0){v=42;break}}if(p){if(t=qn(n,a,h,1)|0,o=i[m>>2]|0,t|0){v=45;break}if(Le(o,h)|0){if(j(g,h),ze(h,i[m>>2]|0)|0){v=53;break}if(rr(i[x>>2]|0,i[m>>2]|0,l)|0){v=53;break}if(or(i[x>>2]|0,i[m>>2]|0,g,h)|0){v=53;break}}}}do if((s|0)<(i[_>>2]|0)){if(t=qn(n,a,h,1)|0,o=i[m>>2]|0,t|0){v=58;break b}if(!(Le(o,h)|0)){v=73;break}if(ze(i[m>>2]|0,h)|0&&(j(g,h),ir(i[x>>2]|0,i[m>>2]|0,g,h)|0)){v=65;break b}if(n=Vt(n,a,s+1|0,g)|0,n|0){v=67;break b}a=g,n=i[a>>2]|0,a=i[a+4>>2]|0}else v=73;while(0);if((v|0)==73&&(v=0,n=Xn(n,a)|0,a=T()|0),(n|0)==0&(a|0)==0){y=m;break a}}switch(v|0){case 15:t=i[m>>2]|0,t|0&&F(t),v=e,i[v>>2]=0,i[v+4>>2]=0,i[x>>2]=0,i[_>>2]=-1,i[b>>2]=0,i[m>>2]=0,i[e+8>>2]=o,v=20;break;case 19:i[e>>2]=n,i[e+4>>2]=a,v=20;break;case 25:E(27795,27761,470,27772);break;case 29:i[e>>2]=n,i[e+4>>2]=a,A=S;return;case 32:t=i[m>>2]|0,t|0&&F(t),y=e,i[y>>2]=0,i[y+4>>2]=0,i[x>>2]=0,i[_>>2]=-1,i[b>>2]=0,i[m>>2]=0,i[e+8>>2]=o,A=S;return;case 36:E(27795,27761,493,27772);break;case 42:i[e>>2]=n,i[e+4>>2]=a,A=S;return;case 45:o|0&&F(o),v=e,i[v>>2]=0,i[v+4>>2]=0,i[x>>2]=0,i[_>>2]=-1,i[b>>2]=0,i[m>>2]=0,i[e+8>>2]=t,v=55;break;case 53:i[e>>2]=n,i[e+4>>2]=a,v=55;break;case 58:o|0&&F(o),v=e,i[v>>2]=0,i[v+4>>2]=0,i[x>>2]=0,i[_>>2]=-1,i[b>>2]=0,i[m>>2]=0,i[e+8>>2]=t,v=71;break;case 65:i[e>>2]=n,i[e+4>>2]=a,v=71;break;case 67:t=i[m>>2]|0,t|0&&F(t),y=e,i[y>>2]=0,i[y+4>>2]=0,i[x>>2]=0,i[_>>2]=-1,i[b>>2]=0,i[m>>2]=0,i[e+8>>2]=n,A=S;return}if((v|0)==20){A=S;return}else if((v|0)==55){A=S;return}else if((v|0)==71){A=S;return}}while(0);t=i[y>>2]|0,t|0&&F(t),v=e,i[v>>2]=0,i[v+4>>2]=0,i[e+8>>2]=0,i[x>>2]=0,i[e+12>>2]=-1,i[b>>2]=0,i[y>>2]=0,A=S}function Xn(e,t){e|=0,t|=0;var n=0,r=0,a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0;f=A,A=A+16|0,d=f,r=I(e|0,t|0,52)|0,T()|0,r&=15,n=I(e|0,t|0,45)|0,T()|0;do if(r){for(;n=L(r+4095|0,0,52)|0,a=T()|0|t&-15728641,o=(15-r|0)*3|0,s=L(7,0,o|0)|0,c=T()|0,n=n|e|s,a|=c,l=I(e|0,t|0,o|0)|0,T()|0,l&=7,r=r+-1|0,!(l>>>0<6);)if(r)t=a,e=n;else{u=4;break}if((u|0)==4){n=I(n|0,a|0,45)|0,T()|0;break}return d=(l|0)==0&(Rt(n,a)|0)!=0,d=L((d?2:1)+l|0,0,o|0)|0,u=T()|0|t&~c,d|=e&~s,w(u|0),A=f,d|0}while(0);return n&=127,n>>>0>120?(u=0,d=0,w(u|0),A=f,d|0):(Ft(d,0,n+1|0,0),u=i[d+4>>2]|0,d=i[d>>2]|0,w(u|0),A=f,d|0)}function Zn(e,t,n,r,a,o){e|=0,t|=0,n|=0,r|=0,a|=0,o|=0;var s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0;_=A,A=A+160|0,f=_+80|0,c=_+64|0,p=_+112|0,g=_,Jn(f,e,t,n),u=f,dn(c,i[u>>2]|0,i[u+4>>2]|0,t),u=c,l=i[u>>2]|0,u=i[u+4>>2]|0,s=i[f+8>>2]|0,m=p+4|0,i[m>>2]=i[f>>2],i[m+4>>2]=i[f+4>>2],i[m+8>>2]=i[f+8>>2],i[m+12>>2]=i[f+12>>2],i[m+16>>2]=i[f+16>>2],i[m+20>>2]=i[f+20>>2],i[m+24>>2]=i[f+24>>2],i[m+28>>2]=i[f+28>>2],m=g,i[m>>2]=l,i[m+4>>2]=u,m=g+8|0,i[m>>2]=s,e=g+12|0,t=p,n=e+36|0;do i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0;while((e|0)<(n|0));if(p=g+48|0,i[p>>2]=i[c>>2],i[p+4>>2]=i[c+4>>2],i[p+8>>2]=i[c+8>>2],i[p+12>>2]=i[c+12>>2],(l|0)==0&(u|0)==0)return g=s,A=_,g|0;n=g+16|0,d=g+24|0,f=g+28|0,s=0,c=0,t=l,e=u;do{if(!((s|0)<(a|0)|(s|0)==(a|0)&c>>>0<r>>>0)){h=4;break}if(u=c,c=Ir(c|0,s|0,1,0)|0,s=T()|0,u=o+(u<<3)|0,i[u>>2]=t,i[u+4>>2]=e,pn(p),e=p,t=i[e>>2]|0,e=i[e+4>>2]|0,(t|0)==0&(e|0)==0){if(Yn(n),t=n,e=i[t>>2]|0,t=i[t+4>>2]|0,(e|0)==0&(t|0)==0){h=10;break}fn(e,t,i[f>>2]|0,p),e=p,t=i[e>>2]|0,e=i[e+4>>2]|0}u=g,i[u>>2]=t,i[u+4>>2]=e}while(!((t|0)==0&(e|0)==0));return(h|0)==4?(e=g+40|0,t=i[e>>2]|0,t|0&&F(t),h=g+16|0,i[h>>2]=0,i[h+4>>2]=0,i[d>>2]=0,i[g+36>>2]=0,i[f>>2]=-1,i[g+32>>2]=0,i[e>>2]=0,fn(0,0,0,p),i[g>>2]=0,i[g+4>>2]=0,i[m>>2]=0,g=14,A=_,g|0):((h|0)==10&&(i[g>>2]=0,i[g+4>>2]=0,i[m>>2]=i[d>>2]),g=i[m>>2]|0,A=_,g|0)}function Qn(e,t,n,o){e|=0,t|=0,n|=0,o|=0;var s=0,c=0,u=0,d=0,p=0,m=0,h=0,g=0,_=0,v=0;if(g=A,A=A+48|0,p=g+32|0,d=g+40|0,m=g,!(i[e>>2]|0))return h=o,i[h>>2]=0,i[h+4>>2]=0,h=0,A=g,h|0;Ft(p,0,0,0),u=p,s=i[u>>2]|0,u=i[u+4>>2]|0;do if(t>>>0>15)h=m,i[h>>2]=0,i[h+4>>2]=0,i[m+8>>2]=4,i[m+12>>2]=-1,h=m+16|0,n=m+29|0,i[h>>2]=0,i[h+4>>2]=0,i[h+8>>2]=0,r[h+12>>0]=0,r[n>>0]=r[d>>0]|0,r[n+1>>0]=r[d+1>>0]|0,r[n+2>>0]=r[d+2>>0]|0,n=4,h=9;else{if(n=tr(n)|0,n|0){p=m,i[p>>2]=0,i[p+4>>2]=0,i[m+8>>2]=n,i[m+12>>2]=-1,p=m+16|0,h=m+29|0,i[p>>2]=0,i[p+4>>2]=0,i[p+8>>2]=0,r[p+12>>0]=0,r[h>>0]=r[d>>0]|0,r[h+1>>0]=r[d+1>>0]|0,r[h+2>>0]=r[d+2>>0]|0,h=9;break}if(n=Fr((i[e+8>>2]|0)+1|0,32)|0,!n){h=m,i[h>>2]=0,i[h+4>>2]=0,i[m+8>>2]=13,i[m+12>>2]=-1,h=m+16|0,n=m+29|0,i[h>>2]=0,i[h+4>>2]=0,i[h+8>>2]=0,r[h+12>>0]=0,r[n>>0]=r[d>>0]|0,r[n+1>>0]=r[d+1>>0]|0,r[n+2>>0]=r[d+2>>0]|0,n=13,h=9;break}nr(e,n),v=m,i[v>>2]=s,i[v+4>>2]=u,u=m+8|0,i[u>>2]=0,i[m+12>>2]=t,i[m+20>>2]=e,i[m+24>>2]=n,r[m+28>>0]=0,s=m+29|0,r[s>>0]=r[d>>0]|0,r[s+1>>0]=r[d+1>>0]|0,r[s+2>>0]=r[d+2>>0]|0,i[m+16>>2]=3,_=+Fe(n),_*=+Ne(n),c=+l(+ +a[n>>3]),c=_/+f(+ +Jr(+c,+ +l(+ +a[n+8>>3])))*6371.007180918475*6371.007180918475,s=m+12|0,n=i[s>>2]|0;a:do if((n|0)>0)do{if(Sn(n+-1|0,p)|0,!(c/+a[p>>3]>10))break a;v=i[s>>2]|0,n=v+-1|0,i[s>>2]=n}while((v|0)>1);while(0);if(Yn(m),s=o,i[s>>2]=0,i[s+4>>2]=0,s=m,n=i[s>>2]|0,s=i[s+4>>2]|0,!((n|0)==0&(s|0)==0))do Lt(n,s,t,p)|0,d=p,e=o,d=Ir(i[e>>2]|0,i[e+4>>2]|0,i[d>>2]|0,i[d+4>>2]|0)|0,e=T()|0,v=o,i[v>>2]=d,i[v+4>>2]=e,Yn(m),v=m,n=i[v>>2]|0,s=i[v+4>>2]|0;while(!((n|0)==0&(s|0)==0));n=i[u>>2]|0}while(0);return v=n,A=g,v|0}function $n(e,t,n){e|=0,t|=0,n|=0;var r=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0;if(!(Ie(t,n)|0)||(t=Pe(t)|0,r=+a[n>>3],o=+a[n+8>>3],o=t&o<0?o+6.283185307179586:o,m=i[e>>2]|0,(m|0)<=0))return m=0,m|0;if(p=i[e+4>>2]|0,t){t=0,f=o,n=-1,e=0;a:for(;;){for(d=e;c=+a[p+(d<<4)>>3],o=+a[p+(d<<4)+8>>3],e=(n+2|0)%(m|0)|0,s=+a[p+(e<<4)>>3],l=+a[p+(e<<4)+8>>3],c>s?(u=c,c=l):(u=s,s=c,c=o,o=l),r=r==s|r==u?r+2220446049250313e-31:r,r<s|r>u;)if(n=d+1|0,(n|0)>=(m|0)){n=22;break a}else e=d,d=n,n=e;if(l=c<0?c+6.283185307179586:c,c=o<0?o+6.283185307179586:o,f=l==f|c==f?f+-2220446049250313e-31:f,u=l+(c-l)*((r-s)/(u-s)),(u<0?u+6.283185307179586:u)>f&&(t^=1),e=d+1|0,(e|0)>=(m|0)){n=22;break}else n=d}if((n|0)==22)return t|0}else{t=0,f=o,n=-1,e=0;b:for(;;){for(d=e;c=+a[p+(d<<4)>>3],o=+a[p+(d<<4)+8>>3],e=(n+2|0)%(m|0)|0,s=+a[p+(e<<4)>>3],l=+a[p+(e<<4)+8>>3],c>s?(u=c,c=l):(u=s,s=c,c=o,o=l),r=r==s|r==u?r+2220446049250313e-31:r,r<s|r>u;)if(n=d+1|0,(n|0)>=(m|0)){n=22;break b}else e=d,d=n,n=e;if(f=c==f|o==f?f+-2220446049250313e-31:f,c+(o-c)*((r-s)/(u-s))>f&&(t^=1),e=d+1|0,(e|0)>=(m|0)){n=22;break}else n=d}if((n|0)==22)return t|0}return 0}function er(e,t){e|=0,t|=0;var n=0,r=0,o=0,s=0,c=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0;if(_=i[e>>2]|0,!_){i[t>>2]=0,i[t+4>>2]=0,i[t+8>>2]=0,i[t+12>>2]=0,i[t+16>>2]=0,i[t+20>>2]=0,i[t+24>>2]=0,i[t+28>>2]=0;return}if(v=t+8|0,a[v>>3]=17976931348623157e292,y=t+24|0,a[y>>3]=17976931348623157e292,a[t>>3]=-17976931348623157e292,b=t+16|0,a[b>>3]=-17976931348623157e292,!((_|0)<=0)){for(h=i[e+4>>2]|0,f=17976931348623157e292,p=-17976931348623157e292,m=0,e=-1,s=17976931348623157e292,c=17976931348623157e292,d=-17976931348623157e292,r=-17976931348623157e292,g=0;n=+a[h+(g<<4)>>3],u=+a[h+(g<<4)+8>>3],e=e+2|0,o=+a[h+(((e|0)==(_|0)?0:e)<<4)+8>>3],n<s&&(a[v>>3]=n,s=n),u<c&&(a[y>>3]=u,c=u),n>d?a[t>>3]=n:n=d,u>r&&(a[b>>3]=u,r=u),f=u>0&u<f?u:f,p=u<0&u>p?u:p,m|=+l(+(u-o))>3.141592653589793,e=g+1|0,(e|0)!=(_|0);)x=g,d=n,g=e,e=x;m&&(a[b>>3]=p,a[y>>3]=f)}}function tr(e){return e|=0,(e>>>0<4?0:15)|0}function nr(e,t){e|=0,t|=0;var n=0,r=0,o=0,s=0,c=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,E=0;if(_=i[e>>2]|0,_){if(v=t+8|0,a[v>>3]=17976931348623157e292,y=t+24|0,a[y>>3]=17976931348623157e292,a[t>>3]=-17976931348623157e292,b=t+16|0,a[b>>3]=-17976931348623157e292,(_|0)>0){for(o=i[e+4>>2]|0,h=17976931348623157e292,g=-17976931348623157e292,r=0,n=-1,d=17976931348623157e292,f=17976931348623157e292,m=-17976931348623157e292,c=-17976931348623157e292,x=0;s=+a[o+(x<<4)>>3],p=+a[o+(x<<4)+8>>3],T=n+2|0,u=+a[o+(((T|0)==(_|0)?0:T)<<4)+8>>3],s<d&&(a[v>>3]=s,d=s),p<f&&(a[y>>3]=p,f=p),s>m?a[t>>3]=s:s=m,p>c&&(a[b>>3]=p,c=p),h=p>0&p<h?p:h,g=p<0&p>g?p:g,r|=+l(+(p-u))>3.141592653589793,n=x+1|0,(n|0)!=(_|0);)T=x,m=s,x=n,n=T;r&&(a[b>>3]=g,a[y>>3]=h)}}else i[t>>2]=0,i[t+4>>2]=0,i[t+8>>2]=0,i[t+12>>2]=0,i[t+16>>2]=0,i[t+20>>2]=0,i[t+24>>2]=0,i[t+28>>2]=0;if(T=e+8|0,n=i[T>>2]|0,!((n|0)<=0)){w=e+12|0,C=0;do if(o=i[w>>2]|0,r=C,C=C+1|0,y=t+(C<<5)|0,b=i[o+(r<<3)>>2]|0,b){if(x=t+(C<<5)+8|0,a[x>>3]=17976931348623157e292,e=t+(C<<5)+24|0,a[e>>3]=17976931348623157e292,a[y>>3]=-17976931348623157e292,S=t+(C<<5)+16|0,a[S>>3]=-17976931348623157e292,(b|0)>0){for(_=i[o+(r<<3)+4>>2]|0,h=17976931348623157e292,g=-17976931348623157e292,o=0,r=-1,v=0,d=17976931348623157e292,f=17976931348623157e292,p=-17976931348623157e292,c=-17976931348623157e292;s=+a[_+(v<<4)>>3],m=+a[_+(v<<4)+8>>3],r=r+2|0,u=+a[_+(((r|0)==(b|0)?0:r)<<4)+8>>3],s<d&&(a[x>>3]=s,d=s),m<f&&(a[e>>3]=m,f=m),s>p?a[y>>3]=s:s=p,m>c&&(a[S>>3]=m,c=m),h=m>0&m<h?m:h,g=m<0&m>g?m:g,o|=+l(+(m-u))>3.141592653589793,r=v+1|0,(r|0)!=(b|0);)E=v,v=r,p=s,r=E;o&&(a[S>>3]=g,a[e>>3]=h)}}else i[y>>2]=0,i[y+4>>2]=0,i[y+8>>2]=0,i[y+12>>2]=0,i[y+16>>2]=0,i[y+20>>2]=0,i[y+24>>2]=0,i[y+28>>2]=0,n=i[T>>2]|0;while((C|0)<(n|0))}}function rr(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0;if(!($n(e,t,n)|0))return a=0,a|0;if(a=e+8|0,(i[a>>2]|0)<=0)return a=1,a|0;for(r=e+12|0,e=0;;){if(o=e,e=e+1|0,$n((i[r>>2]|0)+(o<<3)|0,t+(e<<5)|0,n)|0){e=0,r=6;break}if((e|0)>=(i[a>>2]|0)){e=1,r=6;break}}return(r|0)==6?e|0:0}function ir(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0,d=0;if(u=A,A=A+16|0,c=u,s=n+8|0,!($n(e,t,s)|0))return l=0,A=u,l|0;l=e+8|0;a:do if((i[l>>2]|0)>0){for(o=e+12|0,a=0;;){if(d=a,a=a+1|0,$n((i[o>>2]|0)+(d<<3)|0,t+(a<<5)|0,s)|0){a=0;break}if((a|0)>=(i[l>>2]|0))break a}return A=u,a|0}while(0);if(ar(e,t,n,r)|0)return d=0,A=u,d|0;i[c>>2]=i[n>>2],i[c+4>>2]=s,a=i[l>>2]|0;b:do if((a|0)>0)for(e=e+12|0,s=0,o=a;;){if(a=i[e>>2]|0,(i[a+(s<<3)>>2]|0)>0){if($n(c,r,i[a+(s<<3)+4>>2]|0)|0){a=0;break b}if(a=s+1|0,ar((i[e>>2]|0)+(s<<3)|0,t+(a<<5)|0,n,r)|0){a=0;break b}o=i[l>>2]|0}else a=s+1|0;if((a|0)<(o|0))s=a;else{a=1;break}}else a=1;while(0);return d=a,A=u,d|0}function ar(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,E=0;if(w=A,A=A+176|0,b=w+172|0,o=w+168|0,x=w,!(Le(t,r)|0))return e=0,A=w,e|0;if(Re(t,r,b,o),Xr(x|0,n|0,168)|0,(i[n>>2]|0)>0){t=0;do T=x+8+(t<<4)+8|0,y=+gn(+a[T>>3],i[o>>2]|0),a[T>>3]=y,t=t+1|0;while((t|0)<(i[n>>2]|0))}_=+a[r>>3],v=+a[r+8>>3],y=+gn(+a[r+16>>3],i[o>>2]|0),h=+gn(+a[r+24>>3],i[o>>2]|0);a:do if((i[e>>2]|0)>0){if(r=e+4|0,o=i[x>>2]|0,(o|0)<=0){for(t=0;;)if(t=t+1|0,(t|0)>=(i[e>>2]|0)){t=0;break a}}for(n=0;;){if(t=i[r>>2]|0,m=+a[t+(n<<4)>>3],g=+gn(+a[t+(n<<4)+8>>3],i[b>>2]|0),t=i[r>>2]|0,n=n+1|0,T=(n|0)%(i[e>>2]|0)|0,s=+a[t+(T<<4)>>3],c=+gn(+a[t+(T<<4)+8>>3],i[b>>2]|0),!(m>=_)|!(s>=_)&&!(m<=v)|!(s<=v)&&!(g<=h)|!(c<=h)&&!(g>=y)|!(c>=y)){p=s-m,d=c-g,t=0;do if(E=t,t=t+1|0,T=(t|0)==(o|0)?0:t,s=+a[x+8+(E<<4)+8>>3],c=+a[x+8+(T<<4)+8>>3]-s,l=+a[x+8+(E<<4)>>3],u=+a[x+8+(T<<4)>>3]-l,f=p*c-d*u,f!=0&&(S=g-s,C=m-l,u=(S*u-c*C)/f,!(u<0|u>1))&&(f=(p*S-d*C)/f,f>=0&f<=1)){t=1;break a}while((t|0)<(o|0))}if((n|0)>=(i[e>>2]|0)){t=0;break}}}else t=0;while(0);return E=t,A=w,E|0}function or(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0;if(ar(e,t,n,r)|0)return o=1,o|0;if(o=e+8|0,(i[o>>2]|0)<=0)return o=0,o|0;for(a=e+12|0,e=0;;){if(s=e,e=e+1|0,ar((i[a>>2]|0)+(s<<3)|0,t+(e<<5)|0,n,r)|0){e=1,a=6;break}if((e|0)>=(i[o>>2]|0)){e=0,a=6;break}}return(a|0)==6?e|0:0}function sr(){return 8}function cr(){return 16}function lr(){return 168}function ur(){return 8}function dr(){return 16}function fr(){return 12}function pr(){return 8}function mr(e){return e|=0,+(+((i[e>>2]|0)>>>0)+4294967296*(i[e+4>>2]|0))}function hr(e){e|=0;var t=0,n=0;return n=+a[e>>3],t=+a[e+8>>3],+ +u(+(n*n+t*t))}function gr(e,t,n,r,i){e|=0,t|=0,n|=0,r|=0,i|=0;var o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0;u=+a[e>>3],l=+a[t>>3]-u,c=+a[e+8>>3],s=+a[t+8>>3]-c,f=+a[n>>3],o=+a[r>>3]-f,p=+a[n+8>>3],d=+a[r+8>>3]-p,o=(o*(c-p)-(u-f)*d)/(l*d-s*o),a[i>>3]=u+l*o,a[i+8>>3]=c+s*o}function _r(e,t){return e|=0,t|=0,+l(+(a[e>>3]-+a[t>>3]))<1.1920928955078125e-7?(t=+l(+(a[e+8>>3]-+a[t+8>>3]))<1.1920928955078125e-7,t|0):(t=0,t|0)}function vr(e,t){e|=0,t|=0;var n=0,r=0,i=0;return i=a[e>>3]-+a[t>>3],r=a[e+8>>3]-+a[t+8>>3],n=a[e+16>>3]-+a[t+16>>3],+(i*i+r*r+n*n)}function yr(e,t){e|=0,t|=0;var n=0,r=0,i=0;n=+a[e>>3],r=+f(+n),n=+p(+n),a[t+16>>3]=n,n=+a[e+8>>3],i=r*+f(+n),a[t>>3]=i,n=r*+p(+n),a[t+8>>3]=n}function br(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0;if(o=A,A=A+16|0,a=o,r=Rt(e,t)|0,(n+-1|0)>>>0>5||(r=(r|0)!=0,(n|0)==1&r))return a=-1,A=o,a|0;do if(xr(e,t,a)|0)r=-1;else if(r){r=((i[26352+(n<<2)>>2]|0)+5-(i[a>>2]|0)|0)%5|0;break}else{r=((i[26384+(n<<2)>>2]|0)+6-(i[a>>2]|0)|0)%6|0;break}while(0);return a=r,A=o,a|0}function xr(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0,c=0,l=0,u=0;if(u=A,A=A+32|0,s=u+16|0,c=u,r=tn(e,t,s)|0,r|0)return n=r,A=u,n|0;o=Nt(e,t)|0,l=Kt(e,t)|0,Ee(o,c),r=De(o,i[s>>2]|0)|0;a:do if(Se(o)|0){do switch(o|0){case 4:e=0;break;case 14:e=1;break;case 24:e=2;break;case 38:e=3;break;case 49:e=4;break;case 58:e=5;break;case 63:e=6;break;case 72:e=7;break;case 83:e=8;break;case 97:e=9;break;case 107:e=10;break;case 117:e=11;break;default:r=1;break a}while(0);if(a=i[26416+(e*24|0)+8>>2]|0,t=i[26416+(e*24|0)+16>>2]|0,e=i[s>>2]|0,(e|0)!=(i[c>>2]|0)&&(c=Ce(o)|0,e=i[s>>2]|0,c|(e|0)==(t|0)&&(r=(r+1|0)%6|0)),(l|0)==3&(e|0)==(t|0)){r=(r+5|0)%6|0,a=22;break}(l|0)==5&(e|0)==(a|0)&&(r=(r+1|0)%6|0),a=22}else a=22;while(0);return(a|0)==22&&(i[n>>2]=r,r=0),n=r,A=u,n|0}function Sr(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0;if(b=A,A=A+32|0,y=b+24|0,_=b+20|0,h=b+8|0,m=b+16|0,p=b,l=(Rt(e,t)|0)==0,l=l?6:5,d=I(e|0,t|0,52)|0,T()|0,d&=15,l>>>0<=n>>>0)return r=2,A=b,r|0;f=(d|0)==0,!f&&(g=L(7,0,(d^15)*3|0)|0,(g&e|0)==0&((T()|0)&t|0)==0)?a=n:o=4;a:do if((o|0)==4){if(a=(Rt(e,t)|0)!=0,((a?4:5)|0)<(n|0)||xr(e,t,y)|0||(o=(i[y>>2]|0)+n|0,a=a?26704+(((o|0)%5|0)<<2)|0:26736+(((o|0)%6|0)<<2)|0,g=i[a>>2]|0,(g|0)==7))return r=1,A=b,r|0;i[_>>2]=0,a=fe(e,t,g,_,h)|0;do if(!a){if(c=h,u=i[c>>2]|0,c=i[c+4>>2]|0,s=c>>>0<t>>>0|(c|0)==(t|0)&u>>>0<e>>>0,o=s?u:e,s=s?c:t,!f&&(f=L(7,0,(d^15)*3|0)|0,(u&f|0)==0&(c&(T()|0)|0)==0))a=n;else{if(c=(n+-1+l|0)%(l|0)|0,a=Rt(e,t)|0,(c|0)<0&&E(27795,27797,246,27806),l=(a|0)!=0,((l?4:5)|0)<(c|0)&&E(27795,27797,246,27806),xr(e,t,y)|0&&E(27795,27797,246,27806),a=(i[y>>2]|0)+c|0,a=l?26704+(((a|0)%5|0)<<2)|0:26736+(((a|0)%6|0)<<2)|0,c=i[a>>2]|0,(c|0)==7&&E(27795,27797,246,27806),i[m>>2]=0,a=fe(e,t,c,m,p)|0,a|0)break;u=p,l=i[u>>2]|0,u=i[u+4>>2]|0;do if(u>>>0<s>>>0|(u|0)==(s|0)&l>>>0<o>>>0){if(o=Rt(l,u)|0?ge(l,u,e,t)|0:i[26800+((((i[m>>2]|0)+(i[26768+(c<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,a=Rt(l,u)|0,(o+-1|0)>>>0>5){a=-1,o=l,s=u;break}if(a=(a|0)!=0,(o|0)==1&a){a=-1,o=l,s=u;break}do if(xr(l,u,y)|0)a=-1;else if(a){a=((i[26352+(o<<2)>>2]|0)+5-(i[y>>2]|0)|0)%5|0;break}else{a=((i[26384+(o<<2)>>2]|0)+6-(i[y>>2]|0)|0)%6|0;break}while(0);o=l,s=u}else a=n;while(0);c=h,u=i[c>>2]|0,c=i[c+4>>2]|0}if((o|0)==(u|0)&(s|0)==(c|0)){if(l=(Rt(u,c)|0)!=0,e=l?ge(u,c,e,t)|0:i[26800+((((i[_>>2]|0)+(i[26768+(g<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,a=Rt(u,c)|0,(e+-1|0)>>>0<=5&&(v=(a|0)!=0,!((e|0)==1&v)))do if(xr(u,c,y)|0)a=-1;else if(v){a=((i[26352+(e<<2)>>2]|0)+5-(i[y>>2]|0)|0)%5|0;break}else{a=((i[26384+(e<<2)>>2]|0)+6-(i[y>>2]|0)|0)%6|0;break}while(0);else a=-1;a=a+1|0,a=(a|0)==6|l&(a|0)==5?0:a}t=s,e=o;break a}while(0);return r=a,A=b,r|0}while(0);return v=L(a|0,0,56)|0,y=T()|0|t&-2130706433|536870912,i[r>>2]=v|e,i[r+4>>2]=y,r=0,A=b,r|0}function Cr(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0;return o=(Rt(e,t)|0)==0,r=Sr(e,t,0,n)|0,a=(r|0)==0,o?!a||(r=Sr(e,t,1,n+8|0)|0,r|0)||(r=Sr(e,t,2,n+16|0)|0,r|0)||(r=Sr(e,t,3,n+24|0)|0,r|0)||(r=Sr(e,t,4,n+32|0)|0,r)?(o=r,o|0):Sr(e,t,5,n+40|0)|0:!a||(r=Sr(e,t,1,n+8|0)|0,r|0)||(r=Sr(e,t,2,n+16|0)|0,r|0)||(r=Sr(e,t,3,n+24|0)|0,r|0)||(r=Sr(e,t,4,n+32|0)|0,r|0)?(o=r,o|0):(o=n+40|0,i[o>>2]=0,i[o+4>>2]=0,o=0,o|0)}function wr(e,t,n){e|=0,t|=0,n|=0;var r=0,a=0,o=0,s=0,c=0,l=0;return l=A,A=A+192|0,a=l,o=l+168|0,s=I(e|0,t|0,56)|0,T()|0,s&=7,c=t&-2130706433|134217728,r=tn(e,c,o)|0,r|0?(c=r,A=l,c|0):(t=I(e|0,t|0,52)|0,T()|0,t&=15,Rt(e,c)|0?Dt(o,t,s,1,a):At(o,t,s,1,a),c=a+8|0,i[n>>2]=i[c>>2],i[n+4>>2]=i[c+4>>2],i[n+8>>2]=i[c+8>>2],i[n+12>>2]=i[c+12>>2],c=0,A=l,c|0)}function P(e,t){e|=0,t|=0;var n=0,r=0,a=0,o=0;return a=A,A=A+16|0,n=a,!(!0&(t&2013265920|0)==536870912)||(r=t&-2130706433|134217728,!(Pt(e,r)|0))?(r=0,A=a,r|0):(o=I(e|0,t|0,56)|0,T()|0,o=(Sr(e,r,o&7,n)|0)==0,r=n,r=o&((i[r>>2]|0)==(e|0)?(i[r+4>>2]|0)==(t|0):0)&1,A=a,r|0)}function Tr(e,t,n){e|=0,t|=0,n|=0;var r=0;(t|0)>0?(r=Fr(t,4)|0,i[e>>2]=r,r||E(27819,27842,40,27856)):i[e>>2]=0,i[e+4>>2]=t,i[e+8>>2]=0,i[e+12>>2]=n}function Er(e){e|=0;var t=0,n=0,r=0,o=0,s=0,c=0,u=0;o=e+4|0,s=e+12|0,c=e+8|0;a:for(;;){for(n=i[o>>2]|0,t=0;;){if((t|0)>=(n|0))break a;if(r=i[e>>2]|0,u=i[r+(t<<2)>>2]|0,!u)t=t+1|0;else break}t=r+(~~(l(+(d(10,+ +(15-(i[s>>2]|0)|0))*(+a[u>>3]+ +a[u+8>>3])))%+(n|0))>>>0<<2)|0,n=i[t>>2]|0;b:do if(n|0){if(r=u+32|0,(n|0)==(u|0))i[t>>2]=i[r>>2];else{if(n=n+32|0,t=i[n>>2]|0,!t)break;for(;(t|0)!=(u|0);)if(n=t+32|0,t=i[n>>2]|0,!t)break b;i[n>>2]=i[r>>2]}F(u),i[c>>2]=(i[c>>2]|0)+-1}while(0)}F(i[e>>2]|0)}function Dr(e){e|=0;var t=0,n=0,r=0;for(r=i[e+4>>2]|0,n=0;;){if((n|0)>=(r|0)){t=0,n=4;break}if(t=i[(i[e>>2]|0)+(n<<2)>>2]|0,!t)n=n+1|0;else{n=4;break}}return(n|0)==4?t|0:0}function Or(e,t){e|=0,t|=0;var n=0,r=0,o=0,s=0;if(n=~~(l(+(d(10,+ +(15-(i[e+12>>2]|0)|0))*(+a[t>>3]+ +a[t+8>>3])))%+(i[e+4>>2]|0))>>>0,n=(i[e>>2]|0)+(n<<2)|0,r=i[n>>2]|0,!r)return s=1,s|0;s=t+32|0;do if((r|0)!=(t|0)){if(n=i[r+32>>2]|0,!n)return s=1,s|0;for(o=n;;){if((o|0)==(t|0)){o=8;break}if(n=i[o+32>>2]|0,n)r=o,o=n;else{n=1,o=10;break}}if((o|0)==8){i[r+32>>2]=i[s>>2];break}else if((o|0)==10)return n|0}else i[n>>2]=i[s>>2];while(0);return F(t),s=e+8|0,i[s>>2]=(i[s>>2]|0)+-1,s=0,s|0}function kr(e,t,n){e|=0,t|=0,n|=0;var r=0,o=0,s=0,c=0;s=Pr(40)|0,s||E(27872,27842,98,27885),i[s>>2]=i[t>>2],i[s+4>>2]=i[t+4>>2],i[s+8>>2]=i[t+8>>2],i[s+12>>2]=i[t+12>>2],o=s+16|0,i[o>>2]=i[n>>2],i[o+4>>2]=i[n+4>>2],i[o+8>>2]=i[n+8>>2],i[o+12>>2]=i[n+12>>2],i[s+32>>2]=0,o=~~(l(+(d(10,+ +(15-(i[e+12>>2]|0)|0))*(+a[t>>3]+ +a[t+8>>3])))%+(i[e+4>>2]|0))>>>0,o=(i[e>>2]|0)+(o<<2)|0,r=i[o>>2]|0;do if(!r)i[o>>2]=s;else{for(;!(hn(r,t)|0&&hn(r+16|0,n)|0);)if(o=i[r+32>>2]|0,r=o|0?o:r,!(i[r+32>>2]|0)){c=10;break}if((c|0)==10){i[r+32>>2]=s;break}return F(s),c=r,c|0}while(0);return c=e+8|0,i[c>>2]=(i[c>>2]|0)+1,c=s,c|0}function Ar(e,t,n){e|=0,t|=0,n|=0;var r=0,o=0;if(o=~~(l(+(d(10,+ +(15-(i[e+12>>2]|0)|0))*(+a[t>>3]+ +a[t+8>>3])))%+(i[e+4>>2]|0))>>>0,o=i[(i[e>>2]|0)+(o<<2)>>2]|0,!o)return n=0,n|0;if(!n){for(e=o;;){if(hn(e,t)|0){r=10;break}if(e=i[e+32>>2]|0,!e){e=0,r=10;break}}if((r|0)==10)return e|0}for(e=o;;){if(hn(e,t)|0&&hn(e+16|0,n)|0){r=10;break}if(e=i[e+32>>2]|0,!e){e=0,r=10;break}}return(r|0)==10?e|0:0}function jr(e,t){e|=0,t|=0;var n=0;if(n=~~(l(+(d(10,+ +(15-(i[e+12>>2]|0)|0))*(+a[t>>3]+ +a[t+8>>3])))%+(i[e+4>>2]|0))>>>0,e=i[(i[e>>2]|0)+(n<<2)>>2]|0,!e)return n=0,n|0;for(;;){if(hn(e,t)|0){t=5;break}if(e=i[e+32>>2]|0,!e){e=0,t=5;break}}return(t|0)==5?e|0:0}function Mr(){return 27904}function Nr(e){return e=+e,~~+Qr(+e)|0}function Pr(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0;S=A,A=A+16|0,p=S;do if(e>>>0<245){if(u=e>>>0<11?16:e+11&-8,e=u>>>3,f=i[6977]|0,n=f>>>e,n&3|0)return t=(n&1^1)+e|0,e=27948+(t<<1<<2)|0,n=e+8|0,r=i[n>>2]|0,a=r+8|0,o=i[a>>2]|0,(o|0)==(e|0)?i[6977]=f&~(1<<t):(i[o+12>>2]=e,i[n>>2]=o),x=t<<3,i[r+4>>2]=x|3,x=r+x+4|0,i[x>>2]=i[x>>2]|1,x=a,A=S,x|0;if(d=i[6979]|0,u>>>0>d>>>0){if(n|0)return t=2<<e,t=n<<e&(t|0-t),t=(t&0-t)+-1|0,c=t>>>12&16,t>>>=c,n=t>>>5&8,t>>>=n,o=t>>>2&4,t>>>=o,e=t>>>1&2,t>>>=e,r=t>>>1&1,r=(n|c|o|e|r)+(t>>>r)|0,t=27948+(r<<1<<2)|0,e=t+8|0,o=i[e>>2]|0,c=o+8|0,n=i[c>>2]|0,(n|0)==(t|0)?(e=f&~(1<<r),i[6977]=e):(i[n+12>>2]=t,i[e>>2]=n,e=f),x=r<<3,s=x-u|0,i[o+4>>2]=u|3,a=o+u|0,i[a+4>>2]=s|1,i[o+x>>2]=s,d|0&&(r=i[6982]|0,t=d>>>3,n=27948+(t<<1<<2)|0,t=1<<t,e&t?(e=n+8|0,t=i[e>>2]|0):(i[6977]=e|t,t=n,e=n+8|0),i[e>>2]=r,i[t+12>>2]=r,i[r+8>>2]=t,i[r+12>>2]=n),i[6979]=s,i[6982]=a,x=c,A=S,x|0;if(o=i[6978]|0,o){for(n=(o&0-o)+-1|0,a=n>>>12&16,n>>>=a,r=n>>>5&8,n>>>=r,s=n>>>2&4,n>>>=s,c=n>>>1&2,n>>>=c,l=n>>>1&1,l=i[28212+((r|a|s|c|l)+(n>>>l)<<2)>>2]|0,n=l,c=l,l=(i[l+4>>2]&-8)-u|0;e=i[n+16>>2]|0,!(!e&&(e=i[n+20>>2]|0,!e));)s=(i[e+4>>2]&-8)-u|0,a=s>>>0<l>>>0,n=e,c=a?e:c,l=a?s:l;if(s=c+u|0,s>>>0>c>>>0){a=i[c+24>>2]|0,t=i[c+12>>2]|0;do if((t|0)==(c|0)){if(e=c+20|0,t=i[e>>2]|0,!t&&(e=c+16|0,t=i[e>>2]|0,!t)){n=0;break}for(;;)if(r=t+20|0,n=i[r>>2]|0,n)t=n,e=r;else if(r=t+16|0,n=i[r>>2]|0,n)t=n,e=r;else break;i[e>>2]=0,n=t}else n=i[c+8>>2]|0,i[n+12>>2]=t,i[t+8>>2]=n,n=t;while(0);do if(a|0){if(t=i[c+28>>2]|0,e=28212+(t<<2)|0,(c|0)==(i[e>>2]|0)){if(i[e>>2]=n,!n){i[6978]=o&~(1<<t);break}}else if(x=a+16|0,i[((i[x>>2]|0)==(c|0)?x:a+20|0)>>2]=n,!n)break;i[n+24>>2]=a,t=i[c+16>>2]|0,t|0&&(i[n+16>>2]=t,i[t+24>>2]=n),t=i[c+20>>2]|0,t|0&&(i[n+20>>2]=t,i[t+24>>2]=n)}while(0);return l>>>0<16?(x=l+u|0,i[c+4>>2]=x|3,x=c+x+4|0,i[x>>2]=i[x>>2]|1):(i[c+4>>2]=u|3,i[s+4>>2]=l|1,i[s+l>>2]=l,d|0&&(r=i[6982]|0,t=d>>>3,n=27948+(t<<1<<2)|0,t=1<<t,t&f?(e=n+8|0,t=i[e>>2]|0):(i[6977]=t|f,t=n,e=n+8|0),i[e>>2]=r,i[t+12>>2]=r,i[r+8>>2]=t,i[r+12>>2]=n),i[6979]=l,i[6982]=s),x=c+8|0,A=S,x|0}else f=u}else f=u}else f=u}else if(e>>>0<=4294967231)if(e=e+11|0,u=e&-8,r=i[6978]|0,r){a=0-u|0,e>>>=8,e?u>>>0>16777215?l=31:(f=(e+1048320|0)>>>16&8,g=e<<f,c=(g+520192|0)>>>16&4,g<<=c,l=(g+245760|0)>>>16&2,l=14-(c|f|l)+(g<<l>>>15)|0,l=u>>>(l+7|0)&1|l<<1):l=0,n=i[28212+(l<<2)>>2]|0;a:do if(!n)n=0,e=0,g=61;else for(e=0,c=u<<((l|0)==31?0:25-(l>>>1)|0),o=0;;){if(s=(i[n+4>>2]&-8)-u|0,s>>>0<a>>>0)if(s)e=n,a=s;else{e=n,a=0,g=65;break a}if(g=i[n+20>>2]|0,n=i[n+16+(c>>>31<<2)>>2]|0,o=(g|0)==0|(g|0)==(n|0)?o:g,n)c<<=1;else{n=o,g=61;break}}while(0);if((g|0)==61){if((n|0)==0&(e|0)==0){if(e=2<<l,e=(e|0-e)&r,!e){f=u;break}f=(e&0-e)+-1|0,s=f>>>12&16,f>>>=s,o=f>>>5&8,f>>>=o,c=f>>>2&4,f>>>=c,l=f>>>1&2,f>>>=l,n=f>>>1&1,e=0,n=i[28212+((o|s|c|l|n)+(f>>>n)<<2)>>2]|0}n?g=65:(c=e,s=a)}if((g|0)==65)for(o=n;;)if(f=(i[o+4>>2]&-8)-u|0,n=f>>>0<a>>>0,a=n?f:a,e=n?o:e,n=i[o+16>>2]|0,n||=i[o+20>>2]|0,n)o=n;else{c=e,s=a;break}if(c|0&&s>>>0<((i[6979]|0)-u|0)>>>0&&(d=c+u|0,d>>>0>c>>>0)){o=i[c+24>>2]|0,t=i[c+12>>2]|0;do if((t|0)==(c|0)){if(e=c+20|0,t=i[e>>2]|0,!t&&(e=c+16|0,t=i[e>>2]|0,!t)){t=0;break}for(;;)if(a=t+20|0,n=i[a>>2]|0,n)t=n,e=a;else if(a=t+16|0,n=i[a>>2]|0,n)t=n,e=a;else break;i[e>>2]=0}else x=i[c+8>>2]|0,i[x+12>>2]=t,i[t+8>>2]=x;while(0);do if(o){if(e=i[c+28>>2]|0,n=28212+(e<<2)|0,(c|0)==(i[n>>2]|0)){if(i[n>>2]=t,!t){r&=~(1<<e),i[6978]=r;break}}else if(x=o+16|0,i[((i[x>>2]|0)==(c|0)?x:o+20|0)>>2]=t,!t)break;i[t+24>>2]=o,e=i[c+16>>2]|0,e|0&&(i[t+16>>2]=e,i[e+24>>2]=t),e=i[c+20>>2]|0,e&&(i[t+20>>2]=e,i[e+24>>2]=t)}while(0);b:do if(s>>>0<16)x=s+u|0,i[c+4>>2]=x|3,x=c+x+4|0,i[x>>2]=i[x>>2]|1;else{if(i[c+4>>2]=u|3,i[d+4>>2]=s|1,i[d+s>>2]=s,t=s>>>3,s>>>0<256){n=27948+(t<<1<<2)|0,e=i[6977]|0,t=1<<t,e&t?(e=n+8|0,t=i[e>>2]|0):(i[6977]=e|t,t=n,e=n+8|0),i[e>>2]=d,i[t+12>>2]=d,i[d+8>>2]=t,i[d+12>>2]=n;break}if(t=s>>>8,t?s>>>0>16777215?n=31:(b=(t+1048320|0)>>>16&8,x=t<<b,y=(x+520192|0)>>>16&4,x<<=y,n=(x+245760|0)>>>16&2,n=14-(y|b|n)+(x<<n>>>15)|0,n=s>>>(n+7|0)&1|n<<1):n=0,t=28212+(n<<2)|0,i[d+28>>2]=n,e=d+16|0,i[e+4>>2]=0,i[e>>2]=0,e=1<<n,!(r&e)){i[6978]=r|e,i[t>>2]=d,i[d+24>>2]=t,i[d+12>>2]=d,i[d+8>>2]=d;break}t=i[t>>2]|0;c:do if((i[t+4>>2]&-8|0)!=(s|0)){for(r=s<<((n|0)==31?0:25-(n>>>1)|0);n=t+16+(r>>>31<<2)|0,e=i[n>>2]|0,e;)if((i[e+4>>2]&-8|0)==(s|0)){t=e;break c}else r<<=1,t=e;i[n>>2]=d,i[d+24>>2]=t,i[d+12>>2]=d,i[d+8>>2]=d;break b}while(0);b=t+8|0,x=i[b>>2]|0,i[x+12>>2]=d,i[b>>2]=d,i[d+8>>2]=x,i[d+12>>2]=t,i[d+24>>2]=0}while(0);return x=c+8|0,A=S,x|0}else f=u}else f=u;else f=-1;while(0);if(n=i[6979]|0,n>>>0>=f>>>0)return t=n-f|0,e=i[6982]|0,t>>>0>15?(x=e+f|0,i[6982]=x,i[6979]=t,i[x+4>>2]=t|1,i[e+n>>2]=t,i[e+4>>2]=f|3):(i[6979]=0,i[6982]=0,i[e+4>>2]=n|3,x=e+n+4|0,i[x>>2]=i[x>>2]|1),x=e+8|0,A=S,x|0;if(s=i[6980]|0,s>>>0>f>>>0)return y=s-f|0,i[6980]=y,x=i[6983]|0,b=x+f|0,i[6983]=b,i[b+4>>2]=y|1,i[x+4>>2]=f|3,x=x+8|0,A=S,x|0;if(i[7095]|0?e=i[7097]|0:(i[7097]=4096,i[7096]=4096,i[7098]=-1,i[7099]=-1,i[7100]=0,i[7088]=0,i[7095]=p&-16^1431655768,e=4096),c=f+48|0,l=f+47|0,o=e+l|0,a=0-e|0,u=o&a,u>>>0<=f>>>0||(e=i[7087]|0,e|0&&(d=i[7085]|0,p=d+u|0,p>>>0<=d>>>0|p>>>0>e>>>0)))return x=0,A=S,x|0;d:do if(i[7088]&4)t=0,g=143;else{n=i[6983]|0;e:do if(n){for(r=28356;p=i[r>>2]|0,!(p>>>0<=n>>>0&&(p+(i[r+4>>2]|0)|0)>>>0>n>>>0);)if(e=i[r+8>>2]|0,e)r=e;else{g=128;break e}if(t=o-s&a,t>>>0<2147483647)if(e=$r(t|0)|0,(e|0)==((i[r>>2]|0)+(i[r+4>>2]|0)|0)){if((e|0)!=-1){s=t,o=e,g=145;break d}}else r=e,g=136;else t=0}else g=128;while(0);do if((g|0)==128)if(n=$r(0)|0,(n|0)!=-1&&(t=n,m=i[7096]|0,h=m+-1|0,t=(h&t|0?(h+t&0-m)-t|0:0)+u|0,m=i[7085]|0,h=t+m|0,t>>>0>f>>>0&t>>>0<2147483647)){if(p=i[7087]|0,p|0&&h>>>0<=m>>>0|h>>>0>p>>>0){t=0;break}if(e=$r(t|0)|0,(e|0)==(n|0)){s=t,o=n,g=145;break d}else r=e,g=136}else t=0;while(0);do if((g|0)==136){if(n=0-t|0,!(c>>>0>t>>>0&(t>>>0<2147483647&(r|0)!=-1)))if((r|0)==-1){t=0;break}else{s=t,o=r,g=145;break d}if(e=i[7097]|0,e=l-t+e&0-e,e>>>0>=2147483647){s=t,o=r,g=145;break d}if(($r(e|0)|0)==-1){$r(n|0)|0,t=0;break}else{s=e+t|0,o=r,g=145;break d}}while(0);i[7088]|=4,g=143}while(0);if((g|0)==143&&u>>>0<2147483647&&(y=$r(u|0)|0,h=$r(0)|0,_=h-y|0,v=_>>>0>(f+40|0)>>>0,!((y|0)==-1|v^1|y>>>0<h>>>0&((y|0)!=-1&(h|0)!=-1)^1))&&(s=v?_:t,o=y,g=145),(g|0)==145){t=(i[7085]|0)+s|0,i[7085]=t,t>>>0>(i[7086]|0)>>>0&&(i[7086]=t),l=i[6983]|0;f:do if(l){for(t=28356;;){if(e=i[t>>2]|0,n=i[t+4>>2]|0,(o|0)==(e+n|0)){g=154;break}if(r=i[t+8>>2]|0,r)t=r;else break}if((g|0)==154&&(b=t+4|0,!(i[t+12>>2]&8|0))&&o>>>0>l>>>0&e>>>0<=l>>>0){i[b>>2]=n+s,x=(i[6980]|0)+s|0,y=l+8|0,y=y&7|0?0-y&7:0,b=l+y|0,y=x-y|0,i[6983]=b,i[6980]=y,i[b+4>>2]=y|1,i[l+x+4>>2]=40,i[6984]=i[7099];break}for(o>>>0<(i[6981]|0)>>>0&&(i[6981]=o),n=o+s|0,t=28356;;){if((i[t>>2]|0)==(n|0)){g=162;break}if(e=i[t+8>>2]|0,e)t=e;else break}if((g|0)==162&&!(i[t+12>>2]&8|0)){i[t>>2]=o,d=t+4|0,i[d>>2]=(i[d>>2]|0)+s,d=o+8|0,d=o+(d&7|0?0-d&7:0)|0,t=n+8|0,t=n+(t&7|0?0-t&7:0)|0,u=d+f|0,c=t-d-f|0,i[d+4>>2]=f|3;g:do if((l|0)==(t|0))x=(i[6980]|0)+c|0,i[6980]=x,i[6983]=u,i[u+4>>2]=x|1;else{if((i[6982]|0)==(t|0)){x=(i[6979]|0)+c|0,i[6979]=x,i[6982]=u,i[u+4>>2]=x|1,i[u+x>>2]=x;break}if(e=i[t+4>>2]|0,(e&3|0)==1){s=e&-8,r=e>>>3;h:do if(e>>>0<256)if(e=i[t+8>>2]|0,n=i[t+12>>2]|0,(n|0)==(e|0)){i[6977]&=~(1<<r);break}else{i[e+12>>2]=n,i[n+8>>2]=e;break}else{o=i[t+24>>2]|0,e=i[t+12>>2]|0;do if((e|0)==(t|0)){if(n=t+16|0,r=n+4|0,e=i[r>>2]|0,e)n=r;else if(e=i[n>>2]|0,!e){e=0;break}for(;;)if(a=e+20|0,r=i[a>>2]|0,r)e=r,n=a;else if(a=e+16|0,r=i[a>>2]|0,r)e=r,n=a;else break;i[n>>2]=0}else x=i[t+8>>2]|0,i[x+12>>2]=e,i[e+8>>2]=x;while(0);if(!o)break;n=i[t+28>>2]|0,r=28212+(n<<2)|0;do if((i[r>>2]|0)!=(t|0)){if(x=o+16|0,i[((i[x>>2]|0)==(t|0)?x:o+20|0)>>2]=e,!e)break h}else{if(i[r>>2]=e,e|0)break;i[6978]&=~(1<<n);break h}while(0);if(i[e+24>>2]=o,n=t+16|0,r=i[n>>2]|0,r|0&&(i[e+16>>2]=r,i[r+24>>2]=e),n=i[n+4>>2]|0,!n)break;i[e+20>>2]=n,i[n+24>>2]=e}while(0);t=t+s|0,a=s+c|0}else a=c;if(t=t+4|0,i[t>>2]=i[t>>2]&-2,i[u+4>>2]=a|1,i[u+a>>2]=a,t=a>>>3,a>>>0<256){n=27948+(t<<1<<2)|0,e=i[6977]|0,t=1<<t,e&t?(e=n+8|0,t=i[e>>2]|0):(i[6977]=e|t,t=n,e=n+8|0),i[e>>2]=u,i[t+12>>2]=u,i[u+8>>2]=t,i[u+12>>2]=n;break}t=a>>>8;do if(!t)r=0;else{if(a>>>0>16777215){r=31;break}b=(t+1048320|0)>>>16&8,x=t<<b,y=(x+520192|0)>>>16&4,x<<=y,r=(x+245760|0)>>>16&2,r=14-(y|b|r)+(x<<r>>>15)|0,r=a>>>(r+7|0)&1|r<<1}while(0);if(t=28212+(r<<2)|0,i[u+28>>2]=r,e=u+16|0,i[e+4>>2]=0,i[e>>2]=0,e=i[6978]|0,n=1<<r,!(e&n)){i[6978]=e|n,i[t>>2]=u,i[u+24>>2]=t,i[u+12>>2]=u,i[u+8>>2]=u;break}t=i[t>>2]|0;i:do if((i[t+4>>2]&-8|0)!=(a|0)){for(r=a<<((r|0)==31?0:25-(r>>>1)|0);n=t+16+(r>>>31<<2)|0,e=i[n>>2]|0,e;)if((i[e+4>>2]&-8|0)==(a|0)){t=e;break i}else r<<=1,t=e;i[n>>2]=u,i[u+24>>2]=t,i[u+12>>2]=u,i[u+8>>2]=u;break g}while(0);b=t+8|0,x=i[b>>2]|0,i[x+12>>2]=u,i[b>>2]=u,i[u+8>>2]=x,i[u+12>>2]=t,i[u+24>>2]=0}while(0);return x=d+8|0,A=S,x|0}for(t=28356;e=i[t>>2]|0,!(e>>>0<=l>>>0&&(x=e+(i[t+4>>2]|0)|0,x>>>0>l>>>0));)t=i[t+8>>2]|0;a=x+-47|0,e=a+8|0,e=a+(e&7|0?0-e&7:0)|0,a=l+16|0,e=e>>>0<a>>>0?l:e,t=e+8|0,n=s+-40|0,y=o+8|0,y=y&7|0?0-y&7:0,b=o+y|0,y=n-y|0,i[6983]=b,i[6980]=y,i[b+4>>2]=y|1,i[o+n+4>>2]=40,i[6984]=i[7099],n=e+4|0,i[n>>2]=27,i[t>>2]=i[7089],i[t+4>>2]=i[7090],i[t+8>>2]=i[7091],i[t+12>>2]=i[7092],i[7089]=o,i[7090]=s,i[7092]=0,i[7091]=t,t=e+24|0;do b=t,t=t+4|0,i[t>>2]=7;while((b+8|0)>>>0<x>>>0);if((e|0)!=(l|0)){if(o=e-l|0,i[n>>2]=i[n>>2]&-2,i[l+4>>2]=o|1,i[e>>2]=o,t=o>>>3,o>>>0<256){n=27948+(t<<1<<2)|0,e=i[6977]|0,t=1<<t,e&t?(e=n+8|0,t=i[e>>2]|0):(i[6977]=e|t,t=n,e=n+8|0),i[e>>2]=l,i[t+12>>2]=l,i[l+8>>2]=t,i[l+12>>2]=n;break}if(t=o>>>8,t?o>>>0>16777215?r=31:(b=(t+1048320|0)>>>16&8,x=t<<b,y=(x+520192|0)>>>16&4,x<<=y,r=(x+245760|0)>>>16&2,r=14-(y|b|r)+(x<<r>>>15)|0,r=o>>>(r+7|0)&1|r<<1):r=0,n=28212+(r<<2)|0,i[l+28>>2]=r,i[l+20>>2]=0,i[a>>2]=0,t=i[6978]|0,e=1<<r,!(t&e)){i[6978]=t|e,i[n>>2]=l,i[l+24>>2]=n,i[l+12>>2]=l,i[l+8>>2]=l;break}t=i[n>>2]|0;j:do if((i[t+4>>2]&-8|0)!=(o|0)){for(r=o<<((r|0)==31?0:25-(r>>>1)|0);n=t+16+(r>>>31<<2)|0,e=i[n>>2]|0,e;)if((i[e+4>>2]&-8|0)==(o|0)){t=e;break j}else r<<=1,t=e;i[n>>2]=l,i[l+24>>2]=t,i[l+12>>2]=l,i[l+8>>2]=l;break f}while(0);b=t+8|0,x=i[b>>2]|0,i[x+12>>2]=l,i[b>>2]=l,i[l+8>>2]=x,i[l+12>>2]=t,i[l+24>>2]=0}}else x=i[6981]|0,(x|0)==0|o>>>0<x>>>0&&(i[6981]=o),i[7089]=o,i[7090]=s,i[7092]=0,i[6986]=i[7095],i[6985]=-1,i[6990]=27948,i[6989]=27948,i[6992]=27956,i[6991]=27956,i[6994]=27964,i[6993]=27964,i[6996]=27972,i[6995]=27972,i[6998]=27980,i[6997]=27980,i[7e3]=27988,i[6999]=27988,i[7002]=27996,i[7001]=27996,i[7004]=28004,i[7003]=28004,i[7006]=28012,i[7005]=28012,i[7008]=28020,i[7007]=28020,i[7010]=28028,i[7009]=28028,i[7012]=28036,i[7011]=28036,i[7014]=28044,i[7013]=28044,i[7016]=28052,i[7015]=28052,i[7018]=28060,i[7017]=28060,i[7020]=28068,i[7019]=28068,i[7022]=28076,i[7021]=28076,i[7024]=28084,i[7023]=28084,i[7026]=28092,i[7025]=28092,i[7028]=28100,i[7027]=28100,i[7030]=28108,i[7029]=28108,i[7032]=28116,i[7031]=28116,i[7034]=28124,i[7033]=28124,i[7036]=28132,i[7035]=28132,i[7038]=28140,i[7037]=28140,i[7040]=28148,i[7039]=28148,i[7042]=28156,i[7041]=28156,i[7044]=28164,i[7043]=28164,i[7046]=28172,i[7045]=28172,i[7048]=28180,i[7047]=28180,i[7050]=28188,i[7049]=28188,i[7052]=28196,i[7051]=28196,x=s+-40|0,y=o+8|0,y=y&7|0?0-y&7:0,b=o+y|0,y=x-y|0,i[6983]=b,i[6980]=y,i[b+4>>2]=y|1,i[o+x+4>>2]=40,i[6984]=i[7099];while(0);if(t=i[6980]|0,t>>>0>f>>>0)return y=t-f|0,i[6980]=y,x=i[6983]|0,b=x+f|0,i[6983]=b,i[b+4>>2]=y|1,i[x+4>>2]=f|3,x=x+8|0,A=S,x|0}return x=Mr()|0,i[x>>2]=12,x=0,A=S,x|0}function F(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,c=0,l=0;if(e){n=e+-8|0,a=i[6981]|0,e=i[e+-4>>2]|0,t=e&-8,l=n+t|0;do if(e&1)c=n,s=n;else{if(r=i[n>>2]|0,!(e&3)||(s=n+(0-r)|0,o=r+t|0,s>>>0<a>>>0))return;if((i[6982]|0)==(s|0)){if(e=l+4|0,t=i[e>>2]|0,(t&3|0)!=3){c=s,t=o;break}i[6979]=o,i[e>>2]=t&-2,i[s+4>>2]=o|1,i[s+o>>2]=o;return}if(n=r>>>3,r>>>0<256)if(e=i[s+8>>2]|0,t=i[s+12>>2]|0,(t|0)==(e|0)){i[6977]&=~(1<<n),c=s,t=o;break}else{i[e+12>>2]=t,i[t+8>>2]=e,c=s,t=o;break}a=i[s+24>>2]|0,e=i[s+12>>2]|0;do if((e|0)==(s|0)){if(t=s+16|0,n=t+4|0,e=i[n>>2]|0,e)t=n;else if(e=i[t>>2]|0,!e){e=0;break}for(;;)if(r=e+20|0,n=i[r>>2]|0,n)e=n,t=r;else if(r=e+16|0,n=i[r>>2]|0,n)e=n,t=r;else break;i[t>>2]=0}else c=i[s+8>>2]|0,i[c+12>>2]=e,i[e+8>>2]=c;while(0);if(a){if(t=i[s+28>>2]|0,n=28212+(t<<2)|0,(i[n>>2]|0)==(s|0)){if(i[n>>2]=e,!e){i[6978]&=~(1<<t),c=s,t=o;break}}else if(c=a+16|0,i[((i[c>>2]|0)==(s|0)?c:a+20|0)>>2]=e,!e){c=s,t=o;break}i[e+24>>2]=a,t=s+16|0,n=i[t>>2]|0,n|0&&(i[e+16>>2]=n,i[n+24>>2]=e),t=i[t+4>>2]|0,t?(i[e+20>>2]=t,i[t+24>>2]=e,c=s,t=o):(c=s,t=o)}else c=s,t=o}while(0);if(!(s>>>0>=l>>>0)&&(e=l+4|0,r=i[e>>2]|0,r&1)){if(r&2)i[e>>2]=r&-2,i[c+4>>2]=t|1,i[s+t>>2]=t,a=t;else{if((i[6983]|0)==(l|0)){if(l=(i[6980]|0)+t|0,i[6980]=l,i[6983]=c,i[c+4>>2]=l|1,(c|0)!=(i[6982]|0))return;i[6982]=0,i[6979]=0;return}if((i[6982]|0)==(l|0)){l=(i[6979]|0)+t|0,i[6979]=l,i[6982]=s,i[c+4>>2]=l|1,i[s+l>>2]=l;return}a=(r&-8)+t|0,n=r>>>3;do if(r>>>0<256)if(t=i[l+8>>2]|0,e=i[l+12>>2]|0,(e|0)==(t|0)){i[6977]&=~(1<<n);break}else{i[t+12>>2]=e,i[e+8>>2]=t;break}else{o=i[l+24>>2]|0,e=i[l+12>>2]|0;do if((e|0)==(l|0)){if(t=l+16|0,n=t+4|0,e=i[n>>2]|0,e)t=n;else if(e=i[t>>2]|0,!e){n=0;break}for(;;)if(r=e+20|0,n=i[r>>2]|0,n)e=n,t=r;else if(r=e+16|0,n=i[r>>2]|0,n)e=n,t=r;else break;i[t>>2]=0,n=e}else n=i[l+8>>2]|0,i[n+12>>2]=e,i[e+8>>2]=n,n=e;while(0);if(o|0){if(e=i[l+28>>2]|0,t=28212+(e<<2)|0,(i[t>>2]|0)==(l|0)){if(i[t>>2]=n,!n){i[6978]&=~(1<<e);break}}else if(r=o+16|0,i[((i[r>>2]|0)==(l|0)?r:o+20|0)>>2]=n,!n)break;i[n+24>>2]=o,e=l+16|0,t=i[e>>2]|0,t|0&&(i[n+16>>2]=t,i[t+24>>2]=n),e=i[e+4>>2]|0,e|0&&(i[n+20>>2]=e,i[e+24>>2]=n)}}while(0);if(i[c+4>>2]=a|1,i[s+a>>2]=a,(c|0)==(i[6982]|0)){i[6979]=a;return}}if(e=a>>>3,a>>>0<256){n=27948+(e<<1<<2)|0,t=i[6977]|0,e=1<<e,t&e?(t=n+8|0,e=i[t>>2]|0):(i[6977]=t|e,e=n,t=n+8|0),i[t>>2]=c,i[e+12>>2]=c,i[c+8>>2]=e,i[c+12>>2]=n;return}e=a>>>8,e?a>>>0>16777215?r=31:(s=(e+1048320|0)>>>16&8,l=e<<s,o=(l+520192|0)>>>16&4,l<<=o,r=(l+245760|0)>>>16&2,r=14-(o|s|r)+(l<<r>>>15)|0,r=a>>>(r+7|0)&1|r<<1):r=0,e=28212+(r<<2)|0,i[c+28>>2]=r,i[c+20>>2]=0,i[c+16>>2]=0,t=i[6978]|0,n=1<<r;a:do if(!(t&n))i[6978]=t|n,i[e>>2]=c,i[c+24>>2]=e,i[c+12>>2]=c,i[c+8>>2]=c;else{e=i[e>>2]|0;b:do if((i[e+4>>2]&-8|0)!=(a|0)){for(r=a<<((r|0)==31?0:25-(r>>>1)|0);n=e+16+(r>>>31<<2)|0,t=i[n>>2]|0,t;)if((i[t+4>>2]&-8|0)==(a|0)){e=t;break b}else r<<=1,e=t;i[n>>2]=c,i[c+24>>2]=e,i[c+12>>2]=c,i[c+8>>2]=c;break a}while(0);s=e+8|0,l=i[s>>2]|0,i[l+12>>2]=c,i[s>>2]=c,i[c+8>>2]=l,i[c+12>>2]=e,i[c+24>>2]=0}while(0);if(l=(i[6985]|0)+-1|0,i[6985]=l,!(l|0)){for(e=28364;e=i[e>>2]|0,e;)e=e+8|0;i[6985]=-1}}}}function Fr(e,t){e|=0,t|=0;var n=0;return e?(n=b(t,e)|0,(t|e)>>>0>65535&&(n=((n>>>0)/(e>>>0)|0)==(t|0)?n:-1)):n=0,e=Pr(n)|0,!e||!(i[e+-4>>2]&3)||Zr(e|0,0,n|0)|0,e|0}function Ir(e,t,n,r){return e|=0,t|=0,n|=0,r|=0,n=e+n>>>0,(w(t+r+(n>>>0<e>>>0|0)>>>0|0),n|0)|0}function Lr(e,t,n,r){return e|=0,t|=0,n|=0,r|=0,r=t-r-(n>>>0>e>>>0|0)>>>0,(w(r|0),e-n>>>0|0)|0}function Rr(e){return e|=0,(e?31-(C(e^e-1)|0)|0:32)|0}function zr(e,t,n,r,a){e|=0,t|=0,n|=0,r|=0,a|=0;var o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0;if(d=e,l=t,u=l,s=n,p=r,c=p,!u)return o=(a|0)!=0,c?o?(i[a>>2]=e|0,i[a+4>>2]=t&0,p=0,a=0,(w(p|0),a)|0):(p=0,a=0,(w(p|0),a)|0):(o&&(i[a>>2]=(d>>>0)%(s>>>0),i[a+4>>2]=0),p=0,a=(d>>>0)/(s>>>0)>>>0,(w(p|0),a)|0);o=(c|0)==0;do if(s){if(!o){if(o=(C(c|0)|0)-(C(u|0)|0)|0,o>>>0<=31){f=o+1|0,c=31-o|0,t=o-31>>31,s=f,e=d>>>(f>>>0)&t|u<<c,t=u>>>(f>>>0)&t,o=0,c=d<<c;break}return a?(i[a>>2]=e|0,i[a+4>>2]=l|t&0,p=0,a=0,(w(p|0),a)|0):(p=0,a=0,(w(p|0),a)|0)}if(o=s-1|0,o&s|0){c=(C(s|0)|0)+33-(C(u|0)|0)|0,h=64-c|0,f=32-c|0,l=f>>31,m=c-32|0,t=m>>31,s=c,e=f-1>>31&u>>>(m>>>0)|(u<<f|d>>>(c>>>0))&t,t&=u>>>(c>>>0),o=d<<h&l,c=(u<<h|d>>>(m>>>0))&l|d<<f&c-33>>31;break}return a|0&&(i[a>>2]=o&d,i[a+4>>2]=0),(s|0)==1?(m=l|t&0,h=e|0,(w(m|0),h)|0):(h=Rr(s|0)|0,m=u>>>(h>>>0)|0,h=u<<32-h|d>>>(h>>>0)|0,(w(m|0),h)|0)}else{if(o)return a|0&&(i[a>>2]=(u>>>0)%(s>>>0),i[a+4>>2]=0),m=0,h=(u>>>0)/(s>>>0)>>>0,(w(m|0),h)|0;if(!d)return a|0&&(i[a>>2]=0,i[a+4>>2]=(u>>>0)%(c>>>0)),m=0,h=(u>>>0)/(c>>>0)>>>0,(w(m|0),h)|0;if(o=c-1|0,!(o&c))return a|0&&(i[a>>2]=e|0,i[a+4>>2]=o&u|t&0),m=0,h=u>>>((Rr(c|0)|0)>>>0),(w(m|0),h)|0;if(o=(C(c|0)|0)-(C(u|0)|0)|0,o>>>0<=30){t=o+1|0,c=31-o|0,s=t,e=u<<c|d>>>(t>>>0),t=u>>>(t>>>0),o=0,c=d<<c;break}return a?(i[a>>2]=e|0,i[a+4>>2]=l|t&0,m=0,h=0,(w(m|0),h)|0):(m=0,h=0,(w(m|0),h)|0)}while(0);if(!s)u=c,l=0,c=0;else{f=n|0,d=p|r&0,u=Ir(f|0,d|0,-1,-1)|0,n=T()|0,l=c,c=0;do r=l,l=o>>>31|l<<1,o=c|o<<1,r=e<<1|r>>>31|0,p=e>>>31|t<<1|0,Lr(u|0,n|0,r|0,p|0)|0,h=T()|0,m=h>>31|((h|0)<0?-1:0)<<1,c=m&1,e=Lr(r|0,p|0,m&f|0,(((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1)&d|0)|0,t=T()|0,s=s-1|0;while(s|0);u=l,l=0}return s=0,a|0&&(i[a>>2]=e,i[a+4>>2]=t),m=(o|0)>>>31|(u|s)<<1|(s<<1|o>>>31)&0|l,h=(o<<1|0)&-2|c,(w(m|0),h)|0}function Br(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var i=0,a=0,o=0,s=0,c=0,l=0;return l=t>>31|((t|0)<0?-1:0)<<1,c=((t|0)<0?-1:0)>>31|((t|0)<0?-1:0)<<1,a=r>>31|((r|0)<0?-1:0)<<1,i=((r|0)<0?-1:0)>>31|((r|0)<0?-1:0)<<1,s=Lr(l^e|0,c^t|0,l|0,c|0)|0,o=T()|0,e=a^l,t=i^c,Lr((zr(s,o,Lr(a^n|0,i^r|0,a|0,i|0)|0,T()|0,0)|0)^e|0,(T()|0)^t|0,e|0,t|0)|0}function Vr(e,t){e|=0,t|=0;var n=0,r=0,i=0,a=0;return a=e&65535,i=t&65535,n=b(i,a)|0,r=e>>>16,e=(n>>>16)+(b(i,r)|0)|0,i=t>>>16,t=b(i,a)|0,(w((e>>>16)+(b(i,r)|0)+(((e&65535)+t|0)>>>16)|0),e+t<<16|n&65535|0)|0}function Hr(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var i=0,a=0;return i=e,a=n,n=Vr(i,a)|0,e=T()|0,(w((b(t,a)|0)+(b(r,i)|0)+e|e&0|0),n|0)|0}function Ur(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0,s=0,c=0,l=0,u=0;return a=A,A=A+16|0,c=a|0,s=t>>31|((t|0)<0?-1:0)<<1,o=((t|0)<0?-1:0)>>31|((t|0)<0?-1:0)<<1,u=r>>31|((r|0)<0?-1:0)<<1,l=((r|0)<0?-1:0)>>31|((r|0)<0?-1:0)<<1,e=Lr(s^e|0,o^t|0,s|0,o|0)|0,t=T()|0,zr(e,t,Lr(u^n|0,l^r|0,u|0,l|0)|0,T()|0,c)|0,r=Lr(i[c>>2]^s|0,i[c+4>>2]^o|0,s|0,o|0)|0,n=T()|0,A=a,(w(n|0),r)|0}function Wr(e,t,n,r){e|=0,t|=0,n|=0,r|=0;var a=0,o=0;return o=A,A=A+16|0,a=o|0,zr(e,t,n,r,a)|0,A=o,(w(i[a+4>>2]|0),i[a>>2]|0)|0}function Gr(e,t,n){return e|=0,t|=0,n|=0,(n|0)<32?(w(t>>n|0),e>>>n|(t&(1<<n)-1)<<32-n):(w(((t|0)<0?-1:0)|0),t>>n-32|0)}function I(e,t,n){return e|=0,t|=0,n|=0,(n|0)<32?(w(t>>>n|0),e>>>n|(t&(1<<n)-1)<<32-n):(w(0),t>>>n-32|0)}function L(e,t,n){return e|=0,t|=0,n|=0,(n|0)<32?(w(t<<n|(e&(1<<n)-1<<32-n)>>>32-n|0),e<<n):(w(e<<n-32|0),0)}function Kr(e,t,n){return e|=0,t|=0,n|=0,t=C(t)|0,(t|0)==32&&(t=t+(C(e)|0)|0),w(0),t|0}function qr(e,t){return e=+e,t=+t,e==e?t==t?+S(+e,+t):+e:+t}function Jr(e,t){return e=+e,t=+t,e==e?t==t?+x(+e,+t):+e:+t}function Yr(e){return e=+e,e>=0?+c(e+.5):+y(e-.5)}function Xr(e,t,n){e|=0,t|=0,n|=0;var a=0,o=0,s=0;if((n|0)>=8192)return ee(e|0,t|0,n|0)|0,e|0;if(s=e|0,o=e+n|0,(e&3)==(t&3)){for(;e&3;){if(!n)return s|0;r[e>>0]=r[t>>0]|0,e=e+1|0,t=t+1|0,n=n-1|0}for(n=o&-4|0,a=n-64|0;(e|0)<=(a|0);)i[e>>2]=i[t>>2],i[e+4>>2]=i[t+4>>2],i[e+8>>2]=i[t+8>>2],i[e+12>>2]=i[t+12>>2],i[e+16>>2]=i[t+16>>2],i[e+20>>2]=i[t+20>>2],i[e+24>>2]=i[t+24>>2],i[e+28>>2]=i[t+28>>2],i[e+32>>2]=i[t+32>>2],i[e+36>>2]=i[t+36>>2],i[e+40>>2]=i[t+40>>2],i[e+44>>2]=i[t+44>>2],i[e+48>>2]=i[t+48>>2],i[e+52>>2]=i[t+52>>2],i[e+56>>2]=i[t+56>>2],i[e+60>>2]=i[t+60>>2],e=e+64|0,t=t+64|0;for(;(e|0)<(n|0);)i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0}else for(n=o-4|0;(e|0)<(n|0);)r[e>>0]=r[t>>0]|0,r[e+1>>0]=r[t+1>>0]|0,r[e+2>>0]=r[t+2>>0]|0,r[e+3>>0]=r[t+3>>0]|0,e=e+4|0,t=t+4|0;for(;(e|0)<(o|0);)r[e>>0]=r[t>>0]|0,e=e+1|0,t=t+1|0;return s|0}function Zr(e,t,n){e|=0,t|=0,n|=0;var a=0,o=0,s=0,c=0;if(s=e+n|0,t&=255,(n|0)>=67){for(;e&3;)r[e>>0]=t,e=e+1|0;for(a=s&-4|0,c=t|t<<8|t<<16|t<<24,o=a-64|0;(e|0)<=(o|0);)i[e>>2]=c,i[e+4>>2]=c,i[e+8>>2]=c,i[e+12>>2]=c,i[e+16>>2]=c,i[e+20>>2]=c,i[e+24>>2]=c,i[e+28>>2]=c,i[e+32>>2]=c,i[e+36>>2]=c,i[e+40>>2]=c,i[e+44>>2]=c,i[e+48>>2]=c,i[e+52>>2]=c,i[e+56>>2]=c,i[e+60>>2]=c,e=e+64|0;for(;(e|0)<(a|0);)i[e>>2]=c,e=e+4|0}for(;(e|0)<(s|0);)r[e>>0]=t,e=e+1|0;return s-n|0}function Qr(e){return e=+e,e>=0?+c(e+.5):+y(e-.5)}function $r(e){e|=0;var t=0,n=0,r=0;return r=O()|0,n=i[s>>2]|0,t=n+e|0,(e|0)>0&(t|0)<(n|0)|(t|0)<0?(te(t|0)|0,D(12),-1):(t|0)>(r|0)&&!(k(t|0)|0)?(D(12),-1):(i[s>>2]=t,n|0)}return{___divdi3:Br,___muldi3:Hr,___remdi3:Ur,___uremdi3:Wr,_areNeighborCells:mt,_bitshift64Ashr:Gr,_bitshift64Lshr:I,_bitshift64Shl:L,_calloc:Fr,_cellAreaKm2:kn,_cellAreaM2:An,_cellAreaRads2:On,_cellToBoundary:rn,_cellToCenterChild:Vt,_cellToChildPos:ln,_cellToChildren:zt,_cellToChildrenSize:Lt,_cellToLatLng:nn,_cellToLocalIj:Vn,_cellToParent:It,_cellToVertex:Sr,_cellToVertexes:Cr,_cellsToDirectedEdge:ht,_cellsToLinkedMultiPolygon:xe,_childPosToCell:un,_compactCells:Ht,_destroyLinkedMultiPolygon:In,_directedEdgeToBoundary:xt,_directedEdgeToCells:yt,_edgeLengthKm:Mn,_edgeLengthM:Nn,_edgeLengthRads:jn,_emscripten_replace_memory:ne,_free:F,_getBaseCellNumber:Nt,_getDirectedEdgeDestination:_t,_getDirectedEdgeOrigin:gt,_getHexagonAreaAvgKm2:Sn,_getHexagonAreaAvgM2:Cn,_getHexagonEdgeLengthAvgKm:wn,_getHexagonEdgeLengthAvgM:Tn,_getIcosahedronFaces:on,_getNumCells:En,_getPentagons:cn,_getRes0Cells:Me,_getResolution:Mt,_greatCircleDistanceKm:vn,_greatCircleDistanceM:yn,_greatCircleDistanceRads:_n,_gridDisk:ce,_gridDiskDistances:le,_gridDistance:Un,_gridPathCells:Gn,_gridPathCellsSize:Wn,_gridRing:pe,_gridRingUnsafe:me,_i64Add:Ir,_i64Subtract:Lr,_isPentagon:Rt,_isResClassIII:Gt,_isValidCell:Pt,_isValidDirectedEdge:vt,_isValidVertex:P,_latLngToCell:$t,_llvm_ctlz_i64:Kr,_llvm_maxnum_f64:qr,_llvm_minnum_f64:Jr,_llvm_round_f64:Yr,_localIjToCell:Hn,_malloc:Pr,_maxFaceCount:an,_maxGridDiskSize:se,_maxPolygonToCellsSize:_e,_maxPolygonToCellsSizeExperimental:Qn,_memcpy:Xr,_memset:Zr,_originToDirectedEdges:bt,_pentagonCount:sn,_polygonToCells:ye,_polygonToCellsExperimental:Zn,_readInt64AsDoubleFromPointer:mr,_res0CellCount:je,_round:Qr,_sbrk:$r,_sizeOfCellBoundary:lr,_sizeOfCoordIJ:pr,_sizeOfGeoLoop:ur,_sizeOfGeoPolygon:dr,_sizeOfH3Index:sr,_sizeOfLatLng:cr,_sizeOfLinkedGeoPolygon:fr,_uncompactCells:Ut,_uncompactCellsSize:Wt,_vertexToLatLng:wr,establishStackSpace:oe,stackAlloc:re,stackRestore:ae,stackSave:ie}})({Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},{a:rt,b:d,c:f,d:Re,e:Be,f:ze,g:j,h:Ue,i:Ve,j:Pe,k:Fe,l:He,m:Ie,n:Le,o:Ne,p:oe},O);t.___divdi3=M.___divdi3,t.___muldi3=M.___muldi3,t.___remdi3=M.___remdi3,t.___uremdi3=M.___uremdi3,t._areNeighborCells=M._areNeighborCells,t._bitshift64Ashr=M._bitshift64Ashr,t._bitshift64Lshr=M._bitshift64Lshr,t._bitshift64Shl=M._bitshift64Shl,t._calloc=M._calloc,t._cellAreaKm2=M._cellAreaKm2,t._cellAreaM2=M._cellAreaM2,t._cellAreaRads2=M._cellAreaRads2,t._cellToBoundary=M._cellToBoundary,t._cellToCenterChild=M._cellToCenterChild,t._cellToChildPos=M._cellToChildPos,t._cellToChildren=M._cellToChildren,t._cellToChildrenSize=M._cellToChildrenSize,t._cellToLatLng=M._cellToLatLng,t._cellToLocalIj=M._cellToLocalIj,t._cellToParent=M._cellToParent,t._cellToVertex=M._cellToVertex,t._cellToVertexes=M._cellToVertexes,t._cellsToDirectedEdge=M._cellsToDirectedEdge,t._cellsToLinkedMultiPolygon=M._cellsToLinkedMultiPolygon,t._childPosToCell=M._childPosToCell,t._compactCells=M._compactCells,t._destroyLinkedMultiPolygon=M._destroyLinkedMultiPolygon,t._directedEdgeToBoundary=M._directedEdgeToBoundary,t._directedEdgeToCells=M._directedEdgeToCells,t._edgeLengthKm=M._edgeLengthKm,t._edgeLengthM=M._edgeLengthM,t._edgeLengthRads=M._edgeLengthRads;var qe=t._emscripten_replace_memory=M._emscripten_replace_memory;t._free=M._free,t._getBaseCellNumber=M._getBaseCellNumber,t._getDirectedEdgeDestination=M._getDirectedEdgeDestination,t._getDirectedEdgeOrigin=M._getDirectedEdgeOrigin,t._getHexagonAreaAvgKm2=M._getHexagonAreaAvgKm2,t._getHexagonAreaAvgM2=M._getHexagonAreaAvgM2,t._getHexagonEdgeLengthAvgKm=M._getHexagonEdgeLengthAvgKm,t._getHexagonEdgeLengthAvgM=M._getHexagonEdgeLengthAvgM,t._getIcosahedronFaces=M._getIcosahedronFaces,t._getNumCells=M._getNumCells,t._getPentagons=M._getPentagons,t._getRes0Cells=M._getRes0Cells,t._getResolution=M._getResolution,t._greatCircleDistanceKm=M._greatCircleDistanceKm,t._greatCircleDistanceM=M._greatCircleDistanceM,t._greatCircleDistanceRads=M._greatCircleDistanceRads,t._gridDisk=M._gridDisk,t._gridDiskDistances=M._gridDiskDistances,t._gridDistance=M._gridDistance,t._gridPathCells=M._gridPathCells,t._gridPathCellsSize=M._gridPathCellsSize,t._gridRing=M._gridRing,t._gridRingUnsafe=M._gridRingUnsafe,t._i64Add=M._i64Add,t._i64Subtract=M._i64Subtract,t._isPentagon=M._isPentagon,t._isResClassIII=M._isResClassIII,t._isValidCell=M._isValidCell,t._isValidDirectedEdge=M._isValidDirectedEdge,t._isValidVertex=M._isValidVertex,t._latLngToCell=M._latLngToCell,t._llvm_ctlz_i64=M._llvm_ctlz_i64,t._llvm_maxnum_f64=M._llvm_maxnum_f64,t._llvm_minnum_f64=M._llvm_minnum_f64,t._llvm_round_f64=M._llvm_round_f64,t._localIjToCell=M._localIjToCell,t._malloc=M._malloc,t._maxFaceCount=M._maxFaceCount,t._maxGridDiskSize=M._maxGridDiskSize,t._maxPolygonToCellsSize=M._maxPolygonToCellsSize,t._maxPolygonToCellsSizeExperimental=M._maxPolygonToCellsSizeExperimental,t._memcpy=M._memcpy,t._memset=M._memset,t._originToDirectedEdges=M._originToDirectedEdges,t._pentagonCount=M._pentagonCount,t._polygonToCells=M._polygonToCells,t._polygonToCellsExperimental=M._polygonToCellsExperimental,t._readInt64AsDoubleFromPointer=M._readInt64AsDoubleFromPointer,t._res0CellCount=M._res0CellCount,t._round=M._round,t._sbrk=M._sbrk,t._sizeOfCellBoundary=M._sizeOfCellBoundary,t._sizeOfCoordIJ=M._sizeOfCoordIJ,t._sizeOfGeoLoop=M._sizeOfGeoLoop,t._sizeOfGeoPolygon=M._sizeOfGeoPolygon,t._sizeOfH3Index=M._sizeOfH3Index,t._sizeOfLatLng=M._sizeOfLatLng,t._sizeOfLinkedGeoPolygon=M._sizeOfLinkedGeoPolygon,t._uncompactCells=M._uncompactCells,t._uncompactCellsSize=M._uncompactCellsSize,t._vertexToLatLng=M._vertexToLatLng,t.establishStackSpace=M.establishStackSpace;var Je=t.stackAlloc=M.stackAlloc,Ye=t.stackRestore=M.stackRestore,Xe=t.stackSave=M.stackSave;if(t.asm=M,t.cwrap=b,t.setValue=m,t.getValue=h,Oe){Ae(Oe)||(Oe=o(Oe)),Ee(`memory initializer`);var Ze=function(e){e.byteLength&&(e=new Uint8Array(e)),k.set(e,p),t.memoryInitializerRequest&&delete t.memoryInitializerRequest.response,De(`memory initializer`)},Qe=function(){s(Oe,Ze,function(){throw`could not load memory initializer `+Oe})},$e=Ke(Oe);if($e)Ze($e.buffer);else if(t.memoryInitializerRequest){var et=function(){var e=t.memoryInitializerRequest,n=e.response;if(e.status!==200&&e.status!==0){var r=Ke(t.memoryInitializerRequestURL);if(r)n=r.buffer;else{console.warn(`a problem seems to have happened with Module.memoryInitializerRequest, status: `+e.status+`, retrying `+Oe),Qe();return}}Ze(n)};t.memoryInitializerRequest.response?setTimeout(et,0):t.memoryInitializerRequest.addEventListener(`load`,et)}else Qe()}var tt;Te=function e(){tt||nt(),tt||(Te=e)};function nt(e){if(e||=i,Ce>0||(pe(),Ce>0))return;function n(){tt||(tt=!0,!g&&(me(),he(),t.onRuntimeInitialized&&t.onRuntimeInitialized(),ge()))}t.setStatus?(t.setStatus(`Running...`),setTimeout(function(){setTimeout(function(){t.setStatus(``)},1),n()},1)):n()}t.run=nt;function rt(e){throw t.onAbort&&t.onAbort(e),e+=``,c(e),l(e),g=!0,`abort(`+e+`). Build with -s ASSERTIONS=1 for more info.`}if(t.abort=rt,t.preInit)for(typeof t.preInit==`function`&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return nt(),e}(typeof q_==`object`?q_:{}),J_=`number`,Y_=J_,X_=J_,Z_=J_,Q_=J_,$_=J_,ev=J_,tv=[[`sizeOfH3Index`,J_],[`sizeOfLatLng`,J_],[`sizeOfCellBoundary`,J_],[`sizeOfGeoLoop`,J_],[`sizeOfGeoPolygon`,J_],[`sizeOfLinkedGeoPolygon`,J_],[`sizeOfCoordIJ`,J_],[`readInt64AsDoubleFromPointer`,J_],[`isValidCell`,X_,[Z_,Q_]],[`latLngToCell`,Y_,[J_,J_,$_,ev]],[`cellToLatLng`,Y_,[Z_,Q_,ev]],[`cellToBoundary`,Y_,[Z_,Q_,ev]],[`maxGridDiskSize`,Y_,[J_,ev]],[`gridDisk`,Y_,[Z_,Q_,J_,ev]],[`gridDiskDistances`,Y_,[Z_,Q_,J_,ev,ev]],[`gridRing`,Y_,[Z_,Q_,J_,ev]],[`gridRingUnsafe`,Y_,[Z_,Q_,J_,ev]],[`maxPolygonToCellsSize`,Y_,[ev,$_,J_,ev]],[`polygonToCells`,Y_,[ev,$_,J_,ev]],[`maxPolygonToCellsSizeExperimental`,Y_,[ev,$_,J_,ev]],[`polygonToCellsExperimental`,Y_,[ev,$_,J_,J_,J_,ev]],[`cellsToLinkedMultiPolygon`,Y_,[ev,J_,ev]],[`destroyLinkedMultiPolygon`,null,[ev]],[`compactCells`,Y_,[ev,ev,J_,J_]],[`uncompactCells`,Y_,[ev,J_,J_,ev,J_,$_]],[`uncompactCellsSize`,Y_,[ev,J_,J_,$_,ev]],[`isPentagon`,X_,[Z_,Q_]],[`isResClassIII`,X_,[Z_,Q_]],[`getBaseCellNumber`,J_,[Z_,Q_]],[`getResolution`,J_,[Z_,Q_]],[`maxFaceCount`,Y_,[Z_,Q_,ev]],[`getIcosahedronFaces`,Y_,[Z_,Q_,ev]],[`cellToParent`,Y_,[Z_,Q_,$_,ev]],[`cellToChildren`,Y_,[Z_,Q_,$_,ev]],[`cellToCenterChild`,Y_,[Z_,Q_,$_,ev]],[`cellToChildrenSize`,Y_,[Z_,Q_,$_,ev]],[`cellToChildPos`,Y_,[Z_,Q_,$_,ev]],[`childPosToCell`,Y_,[J_,J_,Z_,Q_,$_,ev]],[`areNeighborCells`,Y_,[Z_,Q_,Z_,Q_,ev]],[`cellsToDirectedEdge`,Y_,[Z_,Q_,Z_,Q_,ev]],[`getDirectedEdgeOrigin`,Y_,[Z_,Q_,ev]],[`getDirectedEdgeDestination`,Y_,[Z_,Q_,ev]],[`isValidDirectedEdge`,X_,[Z_,Q_]],[`directedEdgeToCells`,Y_,[Z_,Q_,ev]],[`originToDirectedEdges`,Y_,[Z_,Q_,ev]],[`directedEdgeToBoundary`,Y_,[Z_,Q_,ev]],[`gridDistance`,Y_,[Z_,Q_,Z_,Q_,ev]],[`gridPathCells`,Y_,[Z_,Q_,Z_,Q_,ev]],[`gridPathCellsSize`,Y_,[Z_,Q_,Z_,Q_,ev]],[`cellToLocalIj`,Y_,[Z_,Q_,Z_,Q_,J_,ev]],[`localIjToCell`,Y_,[Z_,Q_,ev,J_,ev]],[`getHexagonAreaAvgM2`,Y_,[$_,ev]],[`getHexagonAreaAvgKm2`,Y_,[$_,ev]],[`getHexagonEdgeLengthAvgM`,Y_,[$_,ev]],[`getHexagonEdgeLengthAvgKm`,Y_,[$_,ev]],[`greatCircleDistanceM`,J_,[ev,ev]],[`greatCircleDistanceKm`,J_,[ev,ev]],[`greatCircleDistanceRads`,J_,[ev,ev]],[`cellAreaM2`,Y_,[Z_,Q_,ev]],[`cellAreaKm2`,Y_,[Z_,Q_,ev]],[`cellAreaRads2`,Y_,[Z_,Q_,ev]],[`edgeLengthM`,Y_,[Z_,Q_,ev]],[`edgeLengthKm`,Y_,[Z_,Q_,ev]],[`edgeLengthRads`,Y_,[Z_,Q_,ev]],[`getNumCells`,Y_,[$_,ev]],[`getRes0Cells`,Y_,[ev]],[`res0CellCount`,J_],[`getPentagons`,Y_,[J_,ev]],[`pentagonCount`,J_],[`cellToVertex`,Y_,[Z_,Q_,J_,ev]],[`cellToVertexes`,Y_,[Z_,Q_,ev]],[`vertexToLatLng`,Y_,[Z_,Q_,ev]],[`isValidVertex`,X_,[Z_,Q_]]],nv=0,rv=1,iv=2,av=3,ov=4,sv=5,cv=6,lv=7,uv=8,dv=9,fv=10,pv=11,mv=12,hv=13,gv=14,_v=15,vv={};vv[nv]=`Success`,vv[rv]=`The operation failed but a more specific error is not available`,vv[iv]=`Argument was outside of acceptable range`,vv[av]=`Latitude or longitude arguments were outside of acceptable range`,vv[ov]=`Resolution argument was outside of acceptable range`,vv[sv]=`Cell argument was not valid`,vv[cv]=`Directed edge argument was not valid`,vv[lv]=`Undirected edge argument was not valid`,vv[uv]=`Vertex argument was not valid`,vv[dv]=`Pentagon distortion was encountered`,vv[fv]=`Duplicate input`,vv[pv]=`Cell arguments were not neighbors`,vv[mv]=`Cell arguments had incompatible resolutions`,vv[hv]=`Memory allocation failed`,vv[gv]=`Bounds of provided memory were insufficient`,vv[_v]=`Mode or flags argument was not valid`;var yv=1e3,bv=1001,xv=1002,Sv={};Sv[yv]=`Unknown unit`,Sv[bv]=`Array length out of bounds`,Sv[xv]=`Got unexpected null value for H3 index`;var Cv=`Unknown error`;function wv(e,t,n){var r=n&&`value`in n,i=Error((e[t]||Cv)+` (code: `+t+(r?`, value: `+n.value:``)+`)`);return i.code=t,i}function Tv(e,t){return wv(vv,e,arguments.length===2?{value:t}:{})}function Ev(e,t){return wv(Sv,e,arguments.length===2?{value:t}:{})}function Dv(e){if(e!==0)throw Tv(e)}var Ov={};tv.forEach(function(e){Ov[e[0]]=q_.cwrap.apply(q_,e)});var kv=16,Av=4,jv=8,Mv=8,Nv=Ov.sizeOfH3Index(),Pv=Ov.sizeOfLatLng(),Fv=Ov.sizeOfCellBoundary(),Iv=Ov.sizeOfGeoPolygon(),Lv=Ov.sizeOfGeoLoop();Ov.sizeOfLinkedGeoPolygon(),Ov.sizeOfCoordIJ();function Rv(e){if(typeof e!=`number`||e<0||e>15||Math.floor(e)!==e)throw Tv(ov,e);return e}function zv(e){if(!e)throw Ev(xv);return e}var Bv=2**32-1;function Vv(e){if(e>Bv)throw Ev(bv,e);return e}var Hv=/[^0-9a-fA-F]/;function Uv(e){if(Array.isArray(e)&&e.length===2&&Number.isInteger(e[0])&&Number.isInteger(e[1]))return e;if(typeof e!=`string`||Hv.test(e))return[0,0];var t=parseInt(e.substring(0,e.length-8),kv);return[parseInt(e.substring(e.length-8),kv),t]}function Wv(e){if(e>=0)return e.toString(kv);e&=2147483647;var t=Kv(8,e.toString(kv));return t=(parseInt(t[0],kv)+8).toString(kv)+t.substring(1),t}function Gv(e,t){return Wv(t)+Kv(8,Wv(e))}function Kv(e,t){for(var n=e-t.length,r=``,i=0;i<n;i++)r+=`0`;return r+=t,r}function qv(e,t,n){for(var r=e.length,i=q_._calloc(r,Pv),a=n?1:0,o=n?0:1,s=0;s<r*2;s+=2)q_.HEAPF64.set([e[s/2][a],e[s/2][o]].map(sy),i/jv+s);return q_.HEAPU32.set([r,i],t/Av),t}function Jv(e,t){var n=e.length-1,r=q_._calloc(Iv),i=0,a=i+Lv,o=a+Av;qv(e[0],r+i,t);var s;if(n>0){s=q_._calloc(n,Lv);for(var c=0;c<n;c++)qv(e[c+1],s+Lv*c,t)}return q_.setValue(r+a,n,`i32`),q_.setValue(r+o,s,`i32`),r}function Yv(e){var t=0,n=t+Lv,r=n+Av,i=Av;q_._free(q_.getValue(e+t+i,`i8*`));var a=q_.getValue(e+n,`i32`);if(a>0){for(var o=q_.getValue(e+r,`i32`),s=0;s<a;s++)q_._free(q_.getValue(o+Lv*s+i,`i8*`));q_._free(o)}q_._free(e)}function Xv(e,t){t===void 0&&(t=0);var n=q_.getValue(e+Nv*t,`i32`),r=q_.getValue(e+Nv*t+Av,`i32`);return r?Gv(n,r):null}function Zv(e){return Ov.readInt64AsDoubleFromPointer(e)}function Qv(e,t){for(var n=[],r=0;r<t;r++){var i=Xv(e,r);i!==null&&n.push(i)}return n}function $v(e){return cy(q_.getValue(e,`double`))}function ey(e){return[$v(e),$v(e+jv)]}function ty(e){return[$v(e+jv),$v(e)]}function ny(e,t,n){for(var r=q_.getValue(e,`i32`),i=e+jv,a=[],o=t?ty:ey,s=0;s<r*2;s+=2)a.push(o(i+jv*s));return n&&a.push(a[0]),a}function ry(e,t,n){var r=q_._malloc(Pv);q_.HEAPF64.set([e,t].map(sy),r/jv);var i=q_._malloc(Nv);try{return Dv(Ov.latLngToCell(r,n,i)),zv(Xv(i))}finally{q_._free(i),q_._free(r)}}function iy(e){var t=q_._malloc(Pv),n=Uv(e),r=n[0],i=n[1];try{return Dv(Ov.cellToLatLng(r,i,t)),ey(t)}finally{q_._free(t)}}function ay(e,t){var n=q_._malloc(Fv),r=Uv(e),i=r[0],a=r[1];try{return Dv(Ov.cellToBoundary(i,a,n)),ny(n,t,t)}finally{q_._free(n)}}function oy(e,t,n){if(Rv(t),n=!!n,e.length===0||e[0].length===0)return[];var r=Jv(typeof e[0][0]==`number`?[e]:e,n),i=q_._malloc(Mv);try{Dv(Ov.maxPolygonToCellsSize(r,t,0,i));var a=Vv(Zv(i)),o=q_._calloc(a,Nv);try{return Dv(Ov.polygonToCells(r,t,0,o)),Qv(o,a)}finally{q_._free(o)}}finally{q_._free(i),Yv(r)}}function sy(e){return e*Math.PI/180}function cy(e){return e*180/Math.PI}function ly(e){return e=Math.max(0,Math.min(1,e)),`rgb(`+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-e*14825.05)))))))+`, `+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+e*707.56)))))))+`, `+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-e*6838.66)))))))+`)`}var uy=`alphaMap.alphaTest.anisotropy.anisotropyMap.anisotropyRotation.aoMap.aoMapIntensity.attenuationColor.attenuationDistance.bumpMap.clearcoat.clearcoatMap.clearcoatNormalMap.clearcoatNormalScale.clearcoatRoughness.color.dispersion.displacementMap.emissive.emissiveIntensity.emissiveMap.envMap.envMapIntensity.gradientMap.ior.iridescence.iridescenceIOR.iridescenceMap.iridescenceThicknessMap.lightMap.lightMapIntensity.map.matcap.metalness.metalnessMap.normalMap.normalScale.opacity.roughness.roughnessMap.sheen.sheenColor.sheenColorMap.sheenRoughnessMap.shininess.specular.specularColor.specularColorMap.specularIntensity.specularIntensityMap.specularMap.thickness.transmission.transmissionMap`.split(`.`),dy=new WeakMap,fy=class{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=uy,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){let t=e.getMRT();return t!==null&&t.has(`velocity`)}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){let{geometry:n,material:r,object:i}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(t.center=i.center.clone()),i.morphTargetInfluences&&(t.morphTargetInfluences=i.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){let{width:n,height:r}=e.context;t.bufferWidth=n,t.bufferHeight=r}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){let t={};for(let n in e)t[n]={version:e[n].version};return t}containsNode(e){let t=e.material;for(let e in t)if(t[e]&&t[e].isNode)return!0;return e.renderer.overrideNodes.modelViewMatrix!==null||e.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(e){let t={};for(let n of this.refreshUniforms){let r=e[n];r!=null&&(typeof r==`object`&&r.clone!==void 0?r.isTexture===!0?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e,t){let{object:n,material:r,geometry:i}=e,a=this.getRenderObjectData(e);if(a.worldMatrix.equals(n.matrixWorld)!==!0)return a.worldMatrix.copy(n.matrixWorld),!1;let o=a.material;for(let e in o){let t=o[e],n=r[e];if(t.equals!==void 0){if(t.equals(n)===!1)return t.copy(n),!1}else if(n.isTexture===!0){if(t.id!==n.id||t.version!==n.version)return t.id=n.id,t.version=n.version,!1}else if(t!==n)return o[e]=n,!1}if(o.transmission>0){let{width:t,height:n}=e.context;if(a.bufferWidth!==t||a.bufferHeight!==n)return a.bufferWidth=t,a.bufferHeight=n,!1}let s=a.geometry,c=i.attributes,l=s.attributes,u=Object.keys(l),d=Object.keys(c);if(s.id!==i.id)return s.id=i.id,!1;if(u.length!==d.length)return a.geometry.attributes=this.getAttributesData(c),!1;for(let e of u){let t=l[e],n=c[e];if(n===void 0)return delete l[e],!1;if(t.version!==n.version)return t.version=n.version,!1}let f=i.index,p=s.indexVersion,m=f?f.version:null;if(p!==m)return s.indexVersion=m,!1;if(s.drawRange.start!==i.drawRange.start||s.drawRange.count!==i.drawRange.count)return s.drawRange.start=i.drawRange.start,s.drawRange.count=i.drawRange.count,!1;if(a.morphTargetInfluences){let e=!1;for(let t=0;t<a.morphTargetInfluences.length;t++)a.morphTargetInfluences[t]!==n.morphTargetInfluences[t]&&(a.morphTargetInfluences[t]=n.morphTargetInfluences[t],e=!0);if(e)return!1}if(a.lights){for(let e=0;e<t.length;e++)if(a.lights[e].map!==t[e].map)return!1}return a.center&&a.center.equals(n.center)===!1?(a.center.copy(n.center),!0):(e.bundle!==null&&(a.version=e.bundle.version),!0)}getLightsData(e){let t=[];for(let n of e)n.isSpotLight===!0&&n.map!==null&&t.push({map:n.map.version});return t}getLights(e,t){if(dy.has(e)){let n=dy.get(e);if(n.renderId===t)return n.lightsData}let n=this.getLightsData(e.getLights());return dy.set(e,{renderId:t,lightsData:n}),n}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;let{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;let r=e.object.static===!0,i=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(r||i)return!1;let a=this.getLights(e.lightsNode,n);return this.equals(e,a)!==!0}};function py(e,t=0){let n=3735928559^t,r=1103547991^t;if(e instanceof Array)for(let t=0,i;t<e.length;t++)i=e[t],n=Math.imul(n^i,2654435761),r=Math.imul(r^i,1597334677);else for(let t=0,i;t<e.length;t++)i=e.charCodeAt(t),n=Math.imul(n^i,2654435761),r=Math.imul(r^i,1597334677);return n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(n^n>>>13,3266489909),4294967296*(2097151&r)+(n>>>0)}var my=e=>py(e),hy=e=>py(e),gy=(...e)=>py(e),_y=new Map([[1,`float`],[2,`vec2`],[3,`vec3`],[4,`vec4`],[9,`mat3`],[16,`mat4`]]),vy=new WeakMap;function yy(e){return _y.get(e)}function by(e){if(/[iu]?vec\d/.test(e))return e.startsWith(`ivec`)?Int32Array:e.startsWith(`uvec`)?Uint32Array:Float32Array;if(/mat\d/.test(e)||/float/.test(e))return Float32Array;if(/uint/.test(e))return Uint32Array;if(/int/.test(e))return Int32Array;throw Error(`THREE.NodeUtils: Unsupported type: ${e}`)}function xy(e){if(/float|int|uint/.test(e))return 1;if(/vec2/.test(e))return 2;if(/vec3/.test(e))return 3;if(/vec4/.test(e)||/mat2/.test(e))return 4;if(/mat3/.test(e))return 9;if(/mat4/.test(e))return 16;N(`TSL: Unsupported type:`,e)}function Sy(e){if(/float|int|uint/.test(e))return 1;if(/vec2/.test(e))return 2;if(/vec3/.test(e))return 3;if(/vec4/.test(e)||/mat2/.test(e))return 4;if(/mat3/.test(e))return 12;if(/mat4/.test(e))return 16;N(`TSL: Unsupported type:`,e)}function Cy(e){if(/float|int|uint/.test(e))return 4;if(/vec2/.test(e))return 8;if(/vec3/.test(e)||/vec4/.test(e))return 16;if(/mat2/.test(e))return 8;if(/mat3/.test(e))return 48;if(/mat4/.test(e))return 64;N(`TSL: Unsupported type:`,e)}function wy(e){if(e==null)return null;let t=typeof e;return e.isNode===!0?`node`:t===`number`?`float`:t===`boolean`?`bool`:t===`string`?`string`:t===`function`?`shader`:e.isVector2===!0?`vec2`:e.isVector3===!0?`vec3`:e.isVector4===!0?`vec4`:e.isMatrix2===!0?`mat2`:e.isMatrix3===!0?`mat3`:e.isMatrix4===!0?`mat4`:e.isColor===!0?`color`:e instanceof ArrayBuffer?`ArrayBuffer`:null}function Ty(e,...t){let n=e?e.slice(-4):void 0;return t.length===1&&(n===`vec2`?t=[t[0],t[0]]:n===`vec3`?t=[t[0],t[0],t[0]]:n===`vec4`&&(t=[t[0],t[0],t[0],t[0]])),e===`color`?new a(...t):n===`vec2`?new Fe(...t):n===`vec3`?new j(...t):n===`vec4`?new Je(...t):n===`mat2`?new en(...t):n===`mat3`?new gr(...t):n===`mat4`?new F(...t):e===`bool`?t[0]||!1:e===`float`||e===`int`||e===`uint`?t[0]||0:e===`string`?t[0]||``:e===`ArrayBuffer`?Oy(t[0]):null}function Ey(e){let t=vy.get(e);return t===void 0&&(t={},vy.set(e,t)),t}function Dy(e){let t=``,n=new Uint8Array(e);for(let e=0;e<n.length;e++)t+=String.fromCharCode(n[e]);return btoa(t)}function Oy(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer}var ky={VERTEX:`vertex`,FRAGMENT:`fragment`},Ay={NONE:`none`,FRAME:`frame`,RENDER:`render`,OBJECT:`object`},jy={BOOLEAN:`bool`,INTEGER:`int`,FLOAT:`float`,VECTOR2:`vec2`,VECTOR3:`vec3`,VECTOR4:`vec4`,MATRIX2:`mat2`,MATRIX3:`mat3`,MATRIX4:`mat4`},My={READ_ONLY:`readOnly`,WRITE_ONLY:`writeOnly`,READ_WRITE:`readWrite`},Ny=[`fragment`,`vertex`],Py=[`setup`,`analyze`,`generate`],Fy=[...Ny,`compute`],Iy=[`x`,`y`,`z`,`w`],Ly={analyze:`setup`,generate:`analyze`},Ry=0,zy=class extends pn{static get type(){return`Node`}constructor(e=null){super(),this.nodeType=e,this.updateType=Ay.NONE,this.updateBeforeType=Ay.NONE,this.updateAfterType=Ay.NONE,this.uuid=Bn.generateUUID(),this.version=0,this.name=``,this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,`id`,{value:Ry++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,Ay.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Ay.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Ay.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(let{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:`dispose`})}traverse(e){e(this);for(let t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){let t=[];e.add(this);for(let n of Object.getOwnPropertyNames(this)){let r=this[n];if(!(n.startsWith(`_`)===!0||e.has(r))){if(Array.isArray(r)===!0)for(let e=0;e<r.length;e++){let i=r[e];i&&i.isNode===!0&&t.push({property:n,index:e,childNode:i})}else if(r&&r.isNode===!0)t.push({property:n,childNode:r});else if(r&&Object.getPrototypeOf(r)===Object.prototype)for(let e in r){if(e.startsWith(`_`)===!0)continue;let i=r[e];i&&i.isNode===!0&&t.push({property:n,index:e,childNode:i})}}}return t}getCacheKey(e=!1,t=null){if(e||=this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);let n=[];for(let{property:r,childNode:i}of this._getChildren(t))n.push(my(r.slice(0,-4)),i.getCacheKey(e,t));this._cacheKey=gy(hy(n),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){let t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return`void`}getNodeType(e){let t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){let t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){let t=e.getNodeProperties(this),n=0;for(let e of this.getChildren())t[`node`+ n++]=e;return t.outputNode||null}analyze(e,t=null){let n=e.increaseUsage(this);if(this.parents===!0){let n=e.getDataFromNode(this,`any`);n.stages=n.stages||{},n.stages[e.shaderStage]=n.stages[e.shaderStage]||[],n.stages[e.shaderStage].push(t)}if(n===1){let t=e.getNodeProperties(this);for(let n of Object.values(t))n&&n.isNode===!0&&n.build(e,this)}}generate(e,t){let{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){P(`Abstract function.`)}updateAfter(){P(`Abstract function.`)}update(){P(`Abstract function.`)}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){let n=this.getShared(e);if(this!==n)return n.build(e,t);if(this._beforeNodes!==null){let n=this._beforeNodes;this._beforeNodes=null;for(let r of n)r.build(e,t);this._beforeNodes=n}let r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;let i=Ly[e.buildStage];if(i&&r.buildStages[i]!==!0){let t=e.getBuildStage();e.setBuildStage(i),this.build(e),e.setBuildStage(t)}e.addNode(this),e.addChain(this);let a=null,o=e.getBuildStage();if(o===`setup`){this.updateReference(e);let t=e.getNodeProperties(this);if(t.initialized!==!0){t.initialized=!0,t.outputNode=this.setup(e)||t.outputNode||null;for(let n of Object.values(t))if(n&&n.isNode===!0){if(n.parents===!0){let t=e.getNodeProperties(n);t.parents=t.parents||[],t.parents.push(this)}n.build(e)}}a=t.outputNode}else if(o===`analyze`)this.analyze(e,t);else if(o===`generate`){if(this.generate.length<2){let n=this.getNodeType(e),r=e.getDataFromNode(this);a=r.snippet,a===void 0?r.generated===void 0?(r.generated=!0,a=this.generate(e)||``,r.snippet=a):(P(`Node: Recursion detected.`,this),a=`/* Recursion detected. */`):r.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),a=e.format(a,n,t)}else a=this.generate(e,t)||``;a===``&&t!==null&&t!==`void`&&t!==`OutputType`&&(N(`TSL: Invalid generated code, expected a "${t}".`),a=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),a}getSerializeChildren(){return this._getChildren()}serialize(e){let t=this.getSerializeChildren(),n={};for(let{property:r,index:i,childNode:a}of t)i===void 0?n[r]=a.toJSON(e.meta).uuid:(n[r]===void 0&&(n[r]=Number.isInteger(i)?[]:{}),n[r][i]=a.toJSON(e.meta).uuid);Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){let t=e.meta.nodes;for(let n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){let r=[];for(let i of e.inputNodes[n])r.push(t[i]);this[n]=r}else if(typeof e.inputNodes[n]==`object`){let r={};for(let i in e.inputNodes[n])r[i]=t[e.inputNodes[n][i]];this[n]=r}else this[n]=t[e.inputNodes[n]]}}toJSON(e){let{uuid:t,type:n}=this,r=e===void 0||typeof e==`string`;r&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];i===void 0&&(i={uuid:t,type:n,meta:e,metadata:{version:4.7,type:`Node`,generator:`Node.toJSON`}},r!==!0&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function a(e){let t=[];for(let n in e){let r=e[n];delete r.metadata,t.push(r)}return t}if(r){let t=a(e.textures),n=a(e.images),r=a(e.nodes);t.length>0&&(i.textures=t),n.length>0&&(i.images=n),r.length>0&&(i.nodes=r)}return i}},By=class extends zy{static get type(){return`ArrayElementNode`}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){let t=this.indexNode.getNodeType(e);return`${this.node.build(e)}[ ${this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:`uint`)} ]`}},Vy=class extends zy{static get type(){return`ConvertNode`}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){let t=this.node.getNodeType(e),n=null;for(let r of this.convertTo.split(`|`))(n===null||e.getTypeLength(t)===e.getTypeLength(r))&&(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){let n=this.node,r=this.getNodeType(e),i=n.build(e,r);return e.format(i,r,t)}},Hy=class extends zy{static get type(){return`TempNode`}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()===`generate`){let n=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(r.propertyName!==void 0)return e.format(r.propertyName,n,t);if(n!==`void`&&t!==`void`&&this.hasDependencies(e)){let i=super.build(e,n),a=e.getVarFromNode(this,null,n),o=e.getPropertyName(a);return e.addLineFlowCode(`${o} = ${i}`,this),r.snippet=i,r.propertyName=o,e.format(r.propertyName,n,t)}}return super.build(e,t)}},Uy=class extends Hy{static get type(){return`JoinNode`}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType===null?e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0)):e.getVectorType(this.nodeType)}generate(e,t){let n=this.getNodeType(e),r=e.getTypeLength(n),i=this.nodes,a=e.getComponentType(n),o=[],s=0;for(let t of i){if(s>=r){N(`TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let i=t.getNodeType(e),c=e.getTypeLength(i),l;if(s+c>r&&(N(`TSL: Length of '${n}()' data exceeds maximum length of output type.`),c=r-s,i=e.getTypeFromLength(c)),s+=c,l=t.build(e,i),e.getComponentType(i)!==a){let t=e.getTypeFromLength(c,a);l=e.format(l,i,t)}o.push(l)}let c=`${e.getType(n)}( ${o.join(`, `)} )`;return e.format(c,n,t)}},Wy=Iy.join(``),Gy=class extends zy{static get type(){return`SplitNode`}constructor(e,t=`x`){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(let t of this.components)e=Math.max(Iy.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){let n=this.node,r=e.getTypeLength(n.getNodeType(e)),i=null;if(r>1){let a=null;this.getVectorLength()>=r&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));let o=n.build(e,a);i=this.components.length===r&&this.components===Wy.slice(0,this.components.length)?e.format(o,a,t):e.format(`${o}.${this.components}`,this.getNodeType(e),t)}else i=n.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}},Ky=class extends Hy{static get type(){return`SetNode`}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){let{sourceNode:t,components:n,targetNode:r}=this,i=this.getNodeType(e),a=e.getComponentType(r.getNodeType(e)),o=e.getTypeFromLength(n.length,a),s=r.build(e,o),c=t.build(e,i),l=e.getTypeLength(i),u=[];for(let e=0;e<l;e++){let t=Iy[e];t===n[0]?(u.push(s),e+=n.length-1):u.push(c+`.`+t)}return`${e.getType(i)}( ${u.join(`, `)} )`}},qy=class extends Hy{static get type(){return`FlipNode`}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){let{components:t,sourceNode:n}=this,r=this.getNodeType(e),i=n.build(e),a=e.getVarFromNode(this),o=e.getPropertyName(a);e.addLineFlowCode(o+` = `+i,this);let s=e.getTypeLength(r),c=[],l=0;for(let e=0;e<s;e++){let n=Iy[e];n===t[l]?(c.push(`1.0 - `+(o+`.`+n)),l++):c.push(o+`.`+n)}return`${e.getType(r)}( ${c.join(`, `)} )`}},Jy=class extends zy{static get type(){return`InputNode`}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?wy(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=wy(this.value),e.nodeType=this.nodeType,e.valueType===`ArrayBuffer`&&(e.value=Dy(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?Ty(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){P(`Abstract function.`)}},Yy=/float|u?int/,Xy=class extends Jy{static get type(){return`ConstNode`}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){let n=this.getNodeType(e);return Yy.test(n)&&Yy.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}},Zy=class extends zy{static get type(){return`MemberNode`}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!==`void`}getNodeType(e){return this.hasMember(e)===!1?`float`:this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return`float`;let n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){P(`TSL: Member "${this.property}" does not exist in struct.`);let t=this.getNodeType(e);return e.generateConst(t)}return this.structNode.build(e)+`.`+this.property}},Qy=null,$y=new Map;function B(e,t){if($y.has(e)){P(`TSL: Redefinition of method chaining '${e}'.`);return}if(typeof t!=`function`)throw Error(`THREE.TSL: Node element ${e} is not a function`);$y.set(e,t),e!==`assign`&&(zy.prototype[e]=function(...e){return this.isStackNode?this.addToStack(t(...e)):t(this,...e)},zy.prototype[e+`Assign`]=function(...e){return this.isStackNode?this.assign(e[0],t(...e)):this.assign(t(this,...e))})}var eb=e=>e.replace(/r|s/g,`x`).replace(/g|t/g,`y`).replace(/b|p/g,`z`).replace(/a|q/g,`w`),tb=e=>eb(e).split(``).sort().join(``);zy.prototype.assign=function(...e){if(this.isStackNode!==!0)return Qy===null?N(`TSL: No stack defined for assign operation. Make sure the assign is inside a Fn().`):Qy.assign(this,...e),this;{let t=$y.get(`assign`);return this.addToStack(t(...e))}},zy.prototype.toVarIntent=function(){return this},zy.prototype.get=function(e){return new Zy(this,e)};var nb={};function rb(e,t,n){nb[e]=nb[t]=nb[n]={get(){this._cache=this._cache||{};let t=this._cache[e];return t===void 0&&(t=new Gy(this,e),this._cache[e]=t),t},set(t){this[e].assign(V(t))}};let r=e.toUpperCase(),i=t.toUpperCase(),a=n.toUpperCase();zy.prototype[`set`+r]=zy.prototype[`set`+i]=zy.prototype[`set`+a]=function(t){let n=tb(e);return new Ky(this,n,V(t))},zy.prototype[`flip`+r]=zy.prototype[`flip`+i]=zy.prototype[`flip`+a]=function(){let t=tb(e);return new qy(this,t)}}var ib=[`x`,`y`,`z`,`w`],ab=[`r`,`g`,`b`,`a`],ob=[`s`,`t`,`p`,`q`];for(let e=0;e<4;e++){let t=ib[e],n=ab[e],r=ob[e];rb(t,n,r);for(let i=0;i<4;i++){t=ib[e]+ib[i],n=ab[e]+ab[i],r=ob[e]+ob[i],rb(t,n,r);for(let a=0;a<4;a++){t=ib[e]+ib[i]+ib[a],n=ab[e]+ab[i]+ab[a],r=ob[e]+ob[i]+ob[a],rb(t,n,r);for(let o=0;o<4;o++)t=ib[e]+ib[i]+ib[a]+ib[o],n=ab[e]+ab[i]+ab[a]+ab[o],r=ob[e]+ob[i]+ob[a]+ob[o],rb(t,n,r)}}}for(let e=0;e<32;e++)nb[e]={get(){this._cache=this._cache||{};let t=this._cache[e];return t===void 0&&(t=new By(this,new Xy(e,`uint`)),this._cache[e]=t),t},set(t){this[e].assign(V(t))}};Object.defineProperties(zy.prototype,nb);var sb=new WeakMap,cb=function(e,t=null){let n=wy(e);return n===`node`?e:t===null&&(n===`float`||n===`boolean`)||n&&n!==`shader`&&n!==`string`?V(Db(e,t)):n===`shader`?e.isFn?e:W(e):e},lb=function(e,t=null){for(let n in e)e[n]=V(e[n],t);return e},ub=function(e,t=null){let n=e.length;for(let r=0;r<n;r++)e[r]=V(e[r],t);return e},db=function(e,t=null,n=null,r=null){function i(e){return r===null?e=V(e):(e=V(Object.assign(e,r)),r.intent===!0&&(e=e.toVarIntent())),e}let a,o=t,s,c;function l(t){let n;return n=o?/[a-z]/i.test(o)?o+`()`:o:e.type,s!==void 0&&t.length<s?(N(`TSL: "${n}" parameter length is less than minimum required.`),t.concat(Array(s-t.length).fill(0))):c!==void 0&&t.length>c?(N(`TSL: "${n}" parameter length exceeds limit.`),t.slice(0,c)):t}return t===null?a=(...t)=>i(new e(...Pb(l(t)))):n===null?a=(...n)=>i(new e(t,...Pb(l(n)))):(n=V(n),a=(...r)=>i(new e(t,...Pb(l(r)),n))),a.setParameterLength=(...e)=>(e.length===1?s=c=e[0]:e.length===2&&([s,c]=e),a),a.setName=e=>(o=e,a),a},fb=function(e,...t){return V(new e(...Pb(t)))},pb=class extends zy{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){let{shaderNode:t,rawInputs:n}=this,r=e.getNodeProperties(t),i=e.getClosestSubBuild(t.subBuilds)||``,a=i||`default`;if(r[a])return r[a];let o=e.subBuildFn,s=e.fnCall;e.subBuildFn=i,e.fnCall=this;let c=null;if(t.layout){let r=sb.get(e.constructor);r===void 0&&(r=new WeakMap,sb.set(e.constructor,r));let i=r.get(t);i===void 0&&(i=V(e.buildFunctionNode(t)),r.set(t,i)),e.addInclude(i);let a=n?mb(n):null;c=V(i.call(a))}else{let r=new Proxy(e,{get:(e,t,n)=>{let r;return r=Symbol.iterator===t?function*(){yield void 0}:Reflect.get(e,t,n),r}}),i=n?hb(n):null,a=Array.isArray(n)?n.length>0:n!==null,o=t.jsFunc;c=V(a||o.length>1?o(i,r):o(r))}return e.subBuildFn=o,e.fnCall=s,t.once&&(r[a]=c),c}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){let t=e.getNodeProperties(this),n=e.getSubBuildOutput(this);return t[n]=t[n]||this.setupOutput(e),t[n].subBuild=e.getClosestSubBuild(this),t[n]}build(e,t=null){let n=null,r=e.getBuildStage(),i=e.getNodeProperties(this),a=e.getSubBuildOutput(this),o=this.getOutputNode(e),s=e.fnCall;if(e.fnCall=this,r===`setup`){let t=e.getSubBuildProperty(`initialized`,this);if(i[t]!==!0&&(i[t]=!0,i[a]=this.getOutputNode(e),i[a].build(e),this.shaderNode.subBuilds))for(let t of e.chaining){let n=e.getDataFromNode(t,`any`);n.subBuilds=n.subBuilds||new Set;for(let e of this.shaderNode.subBuilds)n.subBuilds.add(e)}n=i[a]}else r===`analyze`?o.build(e,t):r===`generate`&&(n=o.build(e,t)||``);return e.fnCall=s,n}};function mb(e){let t;return Nb(e),t=e[0]&&(e[0].isNode||Object.getPrototypeOf(e[0])!==Object.prototype)?[...e]:e[0],t}function hb(e){let t=0;return Nb(e),new Proxy(e,{get:(n,r,i)=>{let a;if(r===`length`)return a=e.length,a;if(Symbol.iterator===r)a=function*(){for(let t of e)yield V(t)};else{if(e.length>0)if(Object.getPrototypeOf(e[0])===Object.prototype){let n=e[0];a=n[r]===void 0?n[t++]:Reflect.get(n,r,i)}else e[0]instanceof zy&&(a=e[r]===void 0?e[t++]:Reflect.get(e,r,i));else a=Reflect.get(n,r,i);a=V(a)}return a}})}var gb=class extends zy{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new pb(this,e)}setup(){return this.call()}},_b=[!1,!0],vb=[0,1,2,3],yb=[-1,-2],bb=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],xb=new Map;for(let e of _b)xb.set(e,new Xy(e));var Sb=new Map;for(let e of vb)Sb.set(e,new Xy(e,`uint`));var Cb=new Map([...Sb].map(e=>new Xy(e.value,`int`)));for(let e of yb)Cb.set(e,new Xy(e,`int`));var wb=new Map([...Cb].map(e=>new Xy(e.value)));for(let e of bb)wb.set(e,new Xy(e));for(let e of bb)wb.set(-e,new Xy(-e));var Tb={bool:xb,uint:Sb,ints:Cb,float:wb},Eb=new Map([...xb,...wb]),Db=(e,t)=>Eb.has(e)?Eb.get(e):e.isNode===!0?e:new Xy(e,t),Ob=function(e,t=null){return(...n)=>{for(let t of n)if(t===void 0)return N(`TSL: Invalid parameter for the type "${e}".`),V(new Xy(0,e));if((n.length===0||![`bool`,`float`,`int`,`uint`].includes(e)&&n.every(e=>{let t=typeof e;return t!==`object`&&t!==`function`}))&&(n=[Ty(e,...n)]),n.length===1&&t!==null&&t.has(n[0]))return Mb(t.get(n[0]));if(n.length===1){let t=Db(n[0],e);return t.nodeType===e?Mb(t):Mb(new Vy(t,e))}return Mb(new Uy(n.map(e=>Db(e)),e))}},kb=e=>typeof e==`object`&&e?e.value:e,Ab=e=>e==null?null:e.nodeType||e.convertTo||(typeof e==`string`?e:null);function jb(e,t){return new gb(e,t)}var V=(e,t=null)=>cb(e,t),Mb=(e,t=null)=>V(e,t).toVarIntent(),Nb=(e,t=null)=>new lb(e,t),Pb=(e,t=null)=>new ub(e,t),Fb=(e,t=null,n=null,r=null)=>new db(e,t,n,r),H=(e,...t)=>new fb(e,...t),U=(e,t=null,n=null,r={})=>new db(e,t,n,{...r,intent:!0}),Ib=0,Lb=class extends zy{constructor(e,t=null){super();let n=null;t!==null&&(typeof t==`object`?n=t.return:(typeof t==`string`?n=t:N(`TSL: Invalid layout type.`),t=null)),this.shaderNode=new jb(e,n),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){let t=this.shaderNode.nodeType;if(typeof e.inputs!=`object`){let n={name:`fn`+ Ib++,type:t,inputs:[]};for(let t in e)t!==`return`&&n.inputs.push({name:t,type:e[t]});e=n}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||`float`}call(...e){let t=this.shaderNode.call(e);return this.shaderNode.nodeType===`void`&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){let t=this.getNodeType(e);return N(`TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".`),e.generateConst(t)}};function W(e,t=null){let n=new Lb(e,t);return new Proxy(()=>{},{apply(e,t,r){return n.call(...r)},get(e,t,r){return Reflect.get(n,t,r)},set(e,t,r,i){return Reflect.set(n,t,r,i)}})}var Rb=e=>{Qy=e},zb=()=>Qy,Bb=(...e)=>Qy.If(...e),Vb=(...e)=>Qy.Switch(...e);function Hb(e){return Qy&&Qy.addToStack(e),e}B(`toStack`,Hb);var Ub=new Ob(`color`),G=new Ob(`float`,Tb.float),K=new Ob(`int`,Tb.ints),q=new Ob(`uint`,Tb.uint),Wb=new Ob(`bool`,Tb.bool),J=new Ob(`vec2`),Gb=new Ob(`ivec2`),Kb=new Ob(`uvec2`),qb=new Ob(`bvec2`),Y=new Ob(`vec3`),Jb=new Ob(`ivec3`),Yb=new Ob(`uvec3`),Xb=new Ob(`bvec3`),Zb=new Ob(`vec4`),Qb=new Ob(`ivec4`),$b=new Ob(`uvec4`),ex=new Ob(`bvec4`),tx=new Ob(`mat2`),nx=new Ob(`mat3`),rx=new Ob(`mat4`),ix=(e=``)=>V(new Xy(e,`string`)),ax=e=>V(new Xy(e,`ArrayBuffer`));B(`toColor`,Ub),B(`toFloat`,G),B(`toInt`,K),B(`toUint`,q),B(`toBool`,Wb),B(`toVec2`,J),B(`toIVec2`,Gb),B(`toUVec2`,Kb),B(`toBVec2`,qb),B(`toVec3`,Y),B(`toIVec3`,Jb),B(`toUVec3`,Yb),B(`toBVec3`,Xb),B(`toVec4`,Zb),B(`toIVec4`,Qb),B(`toUVec4`,$b),B(`toBVec4`,ex),B(`toMat2`,tx),B(`toMat3`,nx),B(`toMat4`,rx);var ox=Fb(By).setParameterLength(2),sx=(e,t)=>V(new Vy(V(e),t)),cx=(e,t)=>V(new Gy(V(e),t));B(`element`,ox),B(`convert`,sx);var lx=e=>(P(`TSL: append() has been renamed to Stack().`),Hb(e));B(`append`,e=>(P(`TSL: .append() has been renamed to .toStack().`),Hb(e)));var ux=class extends zy{static get type(){return`PropertyNode`}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return my(this.type+`:`+(this.name||``)+`:`+(this.varying?`1`:`0`))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}},dx=(e,t)=>V(new ux(e,t)),fx=(e,t)=>V(new ux(e,t,!0)),px=H(ux,`vec4`,`DiffuseColor`),mx=H(ux,`vec3`,`EmissiveColor`),hx=H(ux,`float`,`Roughness`),gx=H(ux,`float`,`Metalness`),_x=H(ux,`float`,`Clearcoat`),vx=H(ux,`float`,`ClearcoatRoughness`),yx=H(ux,`vec3`,`Sheen`),bx=H(ux,`float`,`SheenRoughness`),xx=H(ux,`float`,`Iridescence`),Sx=H(ux,`float`,`IridescenceIOR`),Cx=H(ux,`float`,`IridescenceThickness`),wx=H(ux,`float`,`AlphaT`),Tx=H(ux,`float`,`Anisotropy`),Ex=H(ux,`vec3`,`AnisotropyT`),Dx=H(ux,`vec3`,`AnisotropyB`),Ox=H(ux,`color`,`SpecularColor`),kx=H(ux,`float`,`SpecularF90`),Ax=H(ux,`float`,`Shininess`),jx=H(ux,`vec4`,`Output`),Mx=H(ux,`float`,`dashSize`),Nx=H(ux,`float`,`gapSize`),Px=H(ux,`float`,`pointWidth`),Fx=H(ux,`float`,`IOR`),Ix=H(ux,`float`,`Transmission`),Lx=H(ux,`float`,`Thickness`),Rx=H(ux,`float`,`AttenuationDistance`),zx=H(ux,`color`,`AttenuationColor`),Bx=H(ux,`float`,`Dispersion`),Vx=class extends zy{static get type(){return`UniformGroupNode`}constructor(e,t=!1,n=1){super(`string`),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}},Hx=e=>new Vx(e),Ux=(e,t=0)=>new Vx(e,!0,t),Wx=Ux(`frame`),Gx=Ux(`render`),Kx=Hx(`object`),qx=class extends Jy{static get type(){return`UniformNode`}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name=``,this.groupNode=Kx}setName(e){return this.name=e,this}label(e){return P(`TSL: "label()" has been deprecated. Use "setName()" instead.`),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(t=>{let n=e(t,this);n!==void 0&&(this.value=n)},t)}getInputType(e){let t=super.getInputType(e);return t===`bool`&&(t=`uint`),t}generate(e,t){let n=this.getNodeType(e),r=this.getUniformHash(e),i=e.getNodeFromHash(r);i===void 0&&(e.setHashNode(this,r),i=this);let a=i.getInputType(e),o=e.getUniformFromNode(i,a,e.shaderStage,this.name||e.context.nodeName),s=e.getPropertyName(o);e.context.nodeName!==void 0&&delete e.context.nodeName;let c=s;if(n===`bool`){let t=e.getDataFromNode(this),r=t.propertyName;if(r===void 0){let i=e.getVarFromNode(this,null,`bool`);r=e.getPropertyName(i),t.propertyName=r,c=e.format(s,a,n),e.addLineFlowCode(`${r} = ${c}`,this)}c=r}return e.format(c,n,t)}},Jx=(e,t)=>{let n=Ab(t||e);return n===e&&(e=Ty(n)),e=e&&e.isNode===!0?e.node&&e.node.value||e.value:e,V(new qx(e,n))},Yx=class extends Hy{static get type(){return`ArrayNode`}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){let t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}},Xx=(...e)=>{let t;if(e.length===1){let n=e[0];t=new Yx(null,n.length,n)}else{let n=e[0],r=e[1];t=new Yx(n,r)}return V(t)};B(`toArray`,(e,t)=>Xx(Array(t).fill(e)));var Zx=Fb(class extends Hy{static get type(){return`AssignNode`}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t===`void`?`void`:this.targetNode.getNodeType(e)}needsSplitAssign(e){let{targetNode:t}=this;if(e.isAvailable(`swizzleAssign`)===!1&&t.isSplitNode&&t.components.length>1){let n=e.getTypeLength(t.node.getNodeType(e));return Iy.join(``).slice(0,n)!==t.components}return!1}setup(e){let{targetNode:t,sourceNode:n}=this,r=t.getScope(),i=e.getNodeProperties(r);i.assign=!0;let a=e.getNodeProperties(this);a.sourceNode=n,a.targetNode=t.context({assign:!0})}generate(e,t){let{targetNode:n,sourceNode:r}=e.getNodeProperties(this),i=this.needsSplitAssign(e),a=n.build(e),o=n.getNodeType(e),s=r.build(e,o),c=r.getNodeType(e),l=e.getDataFromNode(this),u;if(l.initialized===!0)t!==`void`&&(u=a);else if(i){let r=e.getVarFromNode(this,null,o),i=e.getPropertyName(r);e.addLineFlowCode(`${i} = ${s}`,this);let c=n.node,l=c.node.context({assign:!0}).build(e);for(let t=0;t<c.components.length;t++){let n=c.components[t];e.addLineFlowCode(`${l}.${n} = ${i}[ ${t} ]`,this)}t!==`void`&&(u=a)}else u=`${a} = ${s}`,(t===`void`||c===`void`)&&(e.addLineFlowCode(u,this),t!==`void`&&(u=a));return l.initialized=!0,e.format(u,o,t)}}).setParameterLength(2);B(`assign`,Zx);var Qx=class extends Hy{static get type(){return`FunctionCallNode`}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){let t=[],n=this.functionNode,r=n.getInputs(e),i=this.parameters,a=(t,n)=>{let r=n.type,i=r===`pointer`,a;return a=i?`&`+t.build(e):t.build(e,r),a};if(Array.isArray(i)){if(i.length>r.length)N(`TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'.`),i.length=r.length;else if(i.length<r.length)for(N(`TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.`);i.length<r.length;)i.push(G(0));for(let e=0;e<i.length;e++)t.push(a(i[e],r[e]))}else for(let e of r){let n=i[e.name];n===void 0?(N(`TSL: Input '${e.name}' not found in \'Fn()\'.`),t.push(a(G(0),e))):t.push(a(n,e))}return`${n.build(e,`property`)}( ${t.join(`, `)} )`}},$x=(e,...t)=>(t=t.length>1||t[0]&&t[0].isNode===!0?Pb(t):Nb(t[0]),new Qx(V(e),t));B(`call`,$x);var eS={"==":`equal`,"!=":`notEqual`,"<":`lessThan`,">":`greaterThan`,"<=":`lessThanEqual`,">=":`greaterThanEqual`,"%":`mod`},tS=class e extends Hy{static get type(){return`OperatorNode`}constructor(t,n,r,...i){if(super(),i.length>0){let a=new e(t,n,r);for(let n=0;n<i.length-1;n++)a=new e(t,a,i[n]);n=a,r=i[i.length-1]}this.op=t,this.aNode=n,this.bNode=r,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(eS[this.op],t)}getNodeType(e,t=null){let n=this.op,r=this.aNode,i=this.bNode,a=r.getNodeType(e),o=i?i.getNodeType(e):null;if(a===`void`||o===`void`)return t||`void`;if(n===`%`)return a;if(n===`~`||n===`&`||n===`|`||n===`^`||n===`>>`||n===`<<`)return e.getIntegerType(a);if(n===`!`||n===`&&`||n===`||`||n===`^^`)return`bool`;if(n===`==`||n===`!=`||n===`<`||n===`>`||n===`<=`||n===`>=`){let t=Math.max(e.getTypeLength(a),e.getTypeLength(o));return t>1?`bvec${t}`:`bool`}else{if(e.isMatrix(a)){if(o===`float`)return a;if(e.isVector(o))return e.getVectorFromMatrix(a);if(e.isMatrix(o))return a}else if(e.isMatrix(o)){if(a===`float`)return o;if(e.isVector(a))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(a)?o:a}}generate(e,t){let n=this.op,{aNode:r,bNode:i}=this,a=this.getNodeType(e,t),o=null,s=null;a===`void`?o=s=a:(o=r.getNodeType(e),s=i?i.getNodeType(e):null,n===`<`||n===`>`||n===`<=`||n===`>=`||n===`==`||n===`!=`?e.isVector(o)?s=o:e.isVector(s)?o=s:o!==s&&(o=s=`float`):n===`>>`||n===`<<`?(o=a,s=e.changeComponentType(s,`uint`)):n===`%`?(o=a,s=e.isInteger(o)&&e.isInteger(s)?s:o):e.isMatrix(o)?s===`float`?s=`float`:e.isVector(s)?s=e.getVectorFromMatrix(o):e.isMatrix(s)||(o=s=a):o=e.isMatrix(s)?o===`float`?`float`:e.isVector(o)?e.getVectorFromMatrix(s):s=a:s=a);let c=r.build(e,o),l=i?i.build(e,s):null,u=e.getFunctionOperator(n);if(t!==`void`){let r=e.renderer.coordinateSystem===te;if(n===`==`||n===`!=`||n===`<`||n===`>`||n===`<=`||n===`>=`)return r&&e.isVector(o)?e.format(`${this.getOperatorMethod(e,t)}( ${c}, ${l} )`,a,t):e.format(`( ${c} ${n} ${l} )`,a,t);if(n===`%`)return e.isInteger(s)?e.format(`( ${c} % ${l} )`,a,t):e.format(`${this.getOperatorMethod(e,a)}( ${c}, ${l} )`,a,t);if(n===`!`||n===`~`)return e.format(`(${n}${c})`,o,t);if(u)return e.format(`${u}( ${c}, ${l} )`,a,t);if(e.isMatrix(o)&&s===`float`)return e.format(`( ${l} ${n} ${c} )`,a,t);if(o===`float`&&e.isMatrix(s))return e.format(`${c} ${n} ${l}`,a,t);{let i=`( ${c} ${n} ${l} )`;return!r&&a===`bool`&&e.isVector(o)&&e.isVector(s)&&(i=`all${i}`),e.format(i,a,t)}}else if(o!==`void`)return u?e.format(`${u}( ${c}, ${l} )`,a,t):e.isMatrix(o)&&s===`float`?e.format(`${l} ${n} ${c}`,a,t):e.format(`${c} ${n} ${l}`,a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}},nS=U(tS,`+`).setParameterLength(2,1/0).setName(`add`),rS=U(tS,`-`).setParameterLength(2,1/0).setName(`sub`),iS=U(tS,`*`).setParameterLength(2,1/0).setName(`mul`),aS=U(tS,`/`).setParameterLength(2,1/0).setName(`div`),oS=U(tS,`%`).setParameterLength(2).setName(`mod`),sS=U(tS,`==`).setParameterLength(2).setName(`equal`),cS=U(tS,`!=`).setParameterLength(2).setName(`notEqual`),lS=U(tS,`<`).setParameterLength(2).setName(`lessThan`),uS=U(tS,`>`).setParameterLength(2).setName(`greaterThan`),dS=U(tS,`<=`).setParameterLength(2).setName(`lessThanEqual`),fS=U(tS,`>=`).setParameterLength(2).setName(`greaterThanEqual`),pS=U(tS,`&&`).setParameterLength(2,1/0).setName(`and`),mS=U(tS,`||`).setParameterLength(2,1/0).setName(`or`),hS=U(tS,`!`).setParameterLength(1).setName(`not`),gS=U(tS,`^^`).setParameterLength(2).setName(`xor`),_S=U(tS,`&`).setParameterLength(2).setName(`bitAnd`),vS=U(tS,`~`).setParameterLength(1).setName(`bitNot`),yS=U(tS,`|`).setParameterLength(2).setName(`bitOr`),bS=U(tS,`^`).setParameterLength(2).setName(`bitXor`),xS=U(tS,`<<`).setParameterLength(2).setName(`shiftLeft`),SS=U(tS,`>>`).setParameterLength(2).setName(`shiftRight`),CS=W(([e])=>(e.addAssign(1),e)),wS=W(([e])=>(e.subAssign(1),e)),TS=W(([e])=>{let t=K(e).toConst();return e.addAssign(1),t}),ES=W(([e])=>{let t=K(e).toConst();return e.subAssign(1),t});B(`add`,nS),B(`sub`,rS),B(`mul`,iS),B(`div`,aS),B(`mod`,oS),B(`equal`,sS),B(`notEqual`,cS),B(`lessThan`,lS),B(`greaterThan`,uS),B(`lessThanEqual`,dS),B(`greaterThanEqual`,fS),B(`and`,pS),B(`or`,mS),B(`not`,hS),B(`xor`,gS),B(`bitAnd`,_S),B(`bitNot`,vS),B(`bitOr`,yS),B(`bitXor`,bS),B(`shiftLeft`,xS),B(`shiftRight`,SS),B(`incrementBefore`,CS),B(`decrementBefore`,wS),B(`increment`,TS),B(`decrement`,ES);var DS=(e,t)=>(P(`TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.`),oS(K(e),K(t)));B(`modInt`,DS);var X=class e extends Hy{static get type(){return`MathNode`}constructor(t,n,r=null,i=null){if(super(),(t===e.MAX||t===e.MIN)&&arguments.length>3){let a=new e(t,n,r);for(let n=2;n<arguments.length-1;n++)a=new e(t,a,arguments[n]);n=a,r=arguments[arguments.length-1],i=null}this.method=t,this.aNode=n,this.bNode=r,this.cNode=i,this.isMathNode=!0}getInputType(e){let t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(n)?0:e.getTypeLength(n),o=e.isMatrix(r)?0:e.getTypeLength(r);return i>a&&i>o?t:a>o?n:o>i?r:t}getNodeType(t){let n=this.method;return n===e.LENGTH||n===e.DISTANCE||n===e.DOT?`float`:n===e.CROSS?`vec3`:n===e.ALL||n===e.ANY?`bool`:n===e.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),`bool`):this.getInputType(t)}setup(t){let{aNode:n,bNode:r,method:i}=this,a=null;if(i===e.ONE_MINUS)a=rS(1,n);else if(i===e.RECIPROCAL)a=aS(1,n);else if(i===e.DIFFERENCE)a=eC(rS(n,r));else if(i===e.TRANSFORM_DIRECTION){let e=n,i=r;t.isMatrix(e.getNodeType(t))?i=Zb(Y(i),0):e=Zb(Y(e),0);let o=iS(e,i).xyz;a=KS(o)}return a===null?super.setup(t):a}generate(t,n){if(t.getNodeProperties(this).outputNode)return super.generate(t,n);let r=this.method,i=this.getNodeType(t),a=this.getInputType(t),o=this.aNode,s=this.bNode,c=this.cNode,l=t.renderer.coordinateSystem;if(r===e.NEGATE)return t.format(`( - `+o.build(t,a)+` )`,i,n);{let u=[];return r===e.CROSS?u.push(o.build(t,i),s.build(t,i)):l===2e3&&r===e.STEP?u.push(o.build(t,t.getTypeLength(o.getNodeType(t))===1?`float`:a),s.build(t,a)):l===2e3&&(r===e.MIN||r===e.MAX)?u.push(o.build(t,a),s.build(t,t.getTypeLength(s.getNodeType(t))===1?`float`:a)):r===e.REFRACT?u.push(o.build(t,a),s.build(t,a),c.build(t,`float`)):r===e.MIX?u.push(o.build(t,a),s.build(t,a),c.build(t,t.getTypeLength(c.getNodeType(t))===1?`float`:a)):(l===2001&&r===e.ATAN&&s!==null&&(r=`atan2`),t.shaderStage!==`fragment`&&(r===e.DFDX||r===e.DFDY)&&(P(`TSL: '${r}' is not supported in the ${t.shaderStage} stage.`),r=`/*`+r+`*/`),u.push(o.build(t,a)),s!==null&&u.push(s.build(t,a)),c!==null&&u.push(c.build(t,a))),t.format(`${t.getMethod(r,i)}( ${u.join(`, `)} )`,i,n)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}};X.ALL=`all`,X.ANY=`any`,X.RADIANS=`radians`,X.DEGREES=`degrees`,X.EXP=`exp`,X.EXP2=`exp2`,X.LOG=`log`,X.LOG2=`log2`,X.SQRT=`sqrt`,X.INVERSE_SQRT=`inversesqrt`,X.FLOOR=`floor`,X.CEIL=`ceil`,X.NORMALIZE=`normalize`,X.FRACT=`fract`,X.SIN=`sin`,X.COS=`cos`,X.TAN=`tan`,X.ASIN=`asin`,X.ACOS=`acos`,X.ATAN=`atan`,X.ABS=`abs`,X.SIGN=`sign`,X.LENGTH=`length`,X.NEGATE=`negate`,X.ONE_MINUS=`oneMinus`,X.DFDX=`dFdx`,X.DFDY=`dFdy`,X.ROUND=`round`,X.RECIPROCAL=`reciprocal`,X.TRUNC=`trunc`,X.FWIDTH=`fwidth`,X.TRANSPOSE=`transpose`,X.DETERMINANT=`determinant`,X.INVERSE=`inverse`,X.EQUALS=`equals`,X.MIN=`min`,X.MAX=`max`,X.STEP=`step`,X.REFLECT=`reflect`,X.DISTANCE=`distance`,X.DIFFERENCE=`difference`,X.DOT=`dot`,X.CROSS=`cross`,X.POW=`pow`,X.TRANSFORM_DIRECTION=`transformDirection`,X.MIX=`mix`,X.CLAMP=`clamp`,X.REFRACT=`refract`,X.SMOOTHSTEP=`smoothstep`,X.FACEFORWARD=`faceforward`;var OS=G(1e-6),kS=G(1e6),AS=G(Math.PI),jS=G(Math.PI*2),MS=G(Math.PI*2),NS=G(Math.PI*.5),PS=U(X,X.ALL).setParameterLength(1),FS=U(X,X.ANY).setParameterLength(1),IS=U(X,X.RADIANS).setParameterLength(1),LS=U(X,X.DEGREES).setParameterLength(1),RS=U(X,X.EXP).setParameterLength(1),zS=U(X,X.EXP2).setParameterLength(1),BS=U(X,X.LOG).setParameterLength(1),VS=U(X,X.LOG2).setParameterLength(1),HS=U(X,X.SQRT).setParameterLength(1),US=U(X,X.INVERSE_SQRT).setParameterLength(1),WS=U(X,X.FLOOR).setParameterLength(1),GS=U(X,X.CEIL).setParameterLength(1),KS=U(X,X.NORMALIZE).setParameterLength(1),qS=U(X,X.FRACT).setParameterLength(1),JS=U(X,X.SIN).setParameterLength(1),YS=U(X,X.COS).setParameterLength(1),XS=U(X,X.TAN).setParameterLength(1),ZS=U(X,X.ASIN).setParameterLength(1),QS=U(X,X.ACOS).setParameterLength(1),$S=U(X,X.ATAN).setParameterLength(1,2),eC=U(X,X.ABS).setParameterLength(1),tC=U(X,X.SIGN).setParameterLength(1),nC=U(X,X.LENGTH).setParameterLength(1),rC=U(X,X.NEGATE).setParameterLength(1),iC=U(X,X.ONE_MINUS).setParameterLength(1),aC=U(X,X.DFDX).setParameterLength(1),oC=U(X,X.DFDY).setParameterLength(1),sC=U(X,X.ROUND).setParameterLength(1),cC=U(X,X.RECIPROCAL).setParameterLength(1),lC=U(X,X.TRUNC).setParameterLength(1),uC=U(X,X.FWIDTH).setParameterLength(1),dC=U(X,X.TRANSPOSE).setParameterLength(1),fC=U(X,X.DETERMINANT).setParameterLength(1),pC=U(X,X.INVERSE).setParameterLength(1),mC=(e,t)=>(P(`TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"`),sS(e,t)),hC=U(X,X.MIN).setParameterLength(2,1/0),gC=U(X,X.MAX).setParameterLength(2,1/0),_C=U(X,X.STEP).setParameterLength(2),vC=U(X,X.REFLECT).setParameterLength(2),yC=U(X,X.DISTANCE).setParameterLength(2),bC=U(X,X.DIFFERENCE).setParameterLength(2),xC=U(X,X.DOT).setParameterLength(2),SC=U(X,X.CROSS).setParameterLength(2),CC=U(X,X.POW).setParameterLength(2),wC=e=>iS(e,e),TC=e=>iS(e,e,e),EC=e=>iS(e,e,e,e),DC=U(X,X.TRANSFORM_DIRECTION).setParameterLength(2),OC=e=>iS(tC(e),CC(eC(e),1/3)),kC=e=>xC(e,e),AC=U(X,X.MIX).setParameterLength(3),jC=(e,t=0,n=1)=>V(new X(X.CLAMP,V(e),V(t),V(n))),MC=e=>jC(e),NC=U(X,X.REFRACT).setParameterLength(3),PC=U(X,X.SMOOTHSTEP).setParameterLength(3),FC=U(X,X.FACEFORWARD).setParameterLength(3),IC=W(([e])=>qS(JS(oS(xC(e.xy,J(12.9898,78.233)),AS)).mul(43758.5453))),LC=(e,t,n)=>AC(t,n,e),RC=(e,t,n)=>PC(t,n,e),zC=(e,t)=>_C(t,e),BC=(e,t)=>(P(`TSL: "atan2" is overloaded. Use "atan" instead.`),$S(e,t)),VC=FC,HC=US;B(`all`,PS),B(`any`,FS),B(`equals`,mC),B(`radians`,IS),B(`degrees`,LS),B(`exp`,RS),B(`exp2`,zS),B(`log`,BS),B(`log2`,VS),B(`sqrt`,HS),B(`inverseSqrt`,US),B(`floor`,WS),B(`ceil`,GS),B(`normalize`,KS),B(`fract`,qS),B(`sin`,JS),B(`cos`,YS),B(`tan`,XS),B(`asin`,ZS),B(`acos`,QS),B(`atan`,$S),B(`abs`,eC),B(`sign`,tC),B(`length`,nC),B(`lengthSq`,kC),B(`negate`,rC),B(`oneMinus`,iC),B(`dFdx`,aC),B(`dFdy`,oC),B(`round`,sC),B(`reciprocal`,cC),B(`trunc`,lC),B(`fwidth`,uC),B(`atan2`,BC),B(`min`,hC),B(`max`,gC),B(`step`,zC),B(`reflect`,vC),B(`distance`,yC),B(`dot`,xC),B(`cross`,SC),B(`pow`,CC),B(`pow2`,wC),B(`pow3`,TC),B(`pow4`,EC),B(`transformDirection`,DC),B(`mix`,LC),B(`clamp`,jC),B(`refract`,NC),B(`smoothstep`,RC),B(`faceForward`,FC),B(`difference`,bC),B(`saturate`,MC),B(`cbrt`,OC),B(`transpose`,dC),B(`determinant`,fC),B(`inverse`,pC),B(`rand`,IC);var UC=Fb(class extends zy{static get type(){return`ConditionalNode`}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){let{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,`setup`),this.getNodeType(e);let r=t.getNodeType(e);if(n!==null){let t=n.getNodeType(e);if(e.getTypeLength(t)>e.getTypeLength(r))return t}return r}setup(e){let t=this.condNode,n=this.ifNode.isolate(),r=this.elseNode?this.elseNode.isolate():null,i=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=i,r!==null&&(e.getDataFromNode(r).parentNodeBlock=i);let a=e.context.uniformFlow,o=e.getNodeProperties(this);o.condNode=t,o.ifNode=a?n:n.context({nodeBlock:n}),o.elseNode=r?a?r:r.context({nodeBlock:r}):null}generate(e,t){let n=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;let{condNode:i,ifNode:a,elseNode:o}=e.getNodeProperties(this),s=e.currentFunctionNode,c=t!==`void`,l=c?dx(n).build(e):``;r.nodeProperty=l;let u=i.build(e,`bool`);if(e.context.uniformFlow&&o!==null){let r=a.build(e,n),i=o.build(e,n),s=e.getTernary(u,r,i);return e.format(s,n,t)}e.addFlowCode(`\n${e.tab}if ( ${u} ) {\n\n`).addFlowTab();let d=a.build(e,n);if(d&&(c?d=l+` = `+d+`;`:(d=`return `+d+`;`,s===null&&(P(`TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.`),d=`// `+d))),e.removeFlowTab().addFlowCode(e.tab+`	`+d+`

`+e.tab+`}`),o!==null){e.addFlowCode(` else {

`).addFlowTab();let t=o.build(e,n);t&&(c?t=l+` = `+t+`;`:(t=`return `+t+`;`,s===null&&(P(`TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.`),t=`// `+t))),e.removeFlowTab().addFlowCode(e.tab+`	`+t+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(l,n,t)}}).setParameterLength(2,3);B(`select`,UC);var WC=class extends zy{static get type(){return`ContextNode`}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){let t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){let t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){let n=e.addContext(this.value),r=this.node.build(e,t);return e.setContext(n),r}},GC=Fb(WC).setParameterLength(1,2),KC=e=>GC(e,{uniformFlow:!0}),qC=(e,t)=>GC(e,{nodeName:t});function JC(e,t){return P(`TSL: "label()" has been deprecated. Use "setName()" instead.`),qC(e,t)}B(`context`,GC),B(`label`,JC),B(`uniformFlow`,KC),B(`setName`,qC);var YC=class extends zy{static get type(){return`VarNode`}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){let t=e.getNodeProperties(this).assign;return t!==!0&&this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&e.fnCall&&e.fnCall.shaderNode&&e.getDataFromNode(this.node.shaderNode).hasLoop&&(t=!0),t}build(...e){let t=e[0];return this._hasStack(t)===!1&&t.buildStage===`setup`&&(t.context.nodeLoop||t.context.nodeBlock)&&t.getBaseStack().addToStack(this),this.intent===!0&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){let{node:t,name:n,readOnly:r}=this,{renderer:i}=e,a=i.backend.isWebGPUBackend===!0,o=!1,s=!1;r&&(o=e.isDeterministic(t),s=a?r:o);let c=this.getNodeType(e);if(c==`void`)return this.intent!==!0&&N(`TSL: ".toVar()" can not be used with void type.`),t.build(e);let l=e.getVectorType(c),u=t.build(e,l),d=e.getVarFromNode(this,n,l,void 0,s),f=e.getPropertyName(d),p=f;if(s)if(a)p=o?`const ${f}`:`let ${f}`;else{let n=t.getArrayCount(e);p=`const ${e.getVar(d.type,f,n)}`}return e.addLineFlowCode(`${p} = ${u}`,this),f}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}},XC=Fb(YC),ZC=(e,t=null)=>XC(e,t).toStack(),QC=(e,t=null)=>XC(e,t,!0).toStack(),$C=e=>XC(e).setIntent(!0).toStack();B(`toVar`,ZC),B(`toConst`,QC),B(`toVarIntent`,$C);var ew=class extends zy{static get type(){return`SubBuild`}constructor(e,t,n=null){super(n),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);let t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);let n=this.node.build(e,...t);return e.removeSubBuild(),n}},tw=(e,t,n=null)=>V(new ew(V(e),t,n)),nw=Fb(class extends zy{static get type(){return`VaryingNode`}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){let t=e.getNodeProperties(this),n=t.varying;if(n===void 0){let r=this.name,i=this.getNodeType(e),a=this.interpolationType,o=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,r,i,a,o),t.node=tw(this.node,`VERTEX`)}return n.needsInterpolation||=e.shaderStage===`fragment`,n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(ky.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(ky.VERTEX,this.node)}generate(e){let t=e.getSubBuildProperty(`property`,e.currentStack),n=e.getNodeProperties(this),r=this.setupVarying(e);if(n[t]===void 0){let i=this.getNodeType(e),a=e.getPropertyName(r,ky.VERTEX);e.flowNodeFromShaderStage(ky.VERTEX,n.node,i,a),n[t]=a}return e.getPropertyName(r)}}).setParameterLength(1,2),rw=e=>nw(e);B(`toVarying`,nw),B(`toVertexStage`,rw),B(`varying`,(...e)=>(P(`TSL: .varying() has been renamed to .toVarying().`),nw(...e))),B(`vertexStage`,(...e)=>(P(`TSL: .vertexStage() has been renamed to .toVertexStage().`),nw(...e)));var iw=W(([e])=>AC(e.mul(.9478672986).add(.0521327014).pow(2.4),e.mul(.0773993808),e.lessThanEqual(.04045))).setLayout({name:`sRGBTransferEOTF`,type:`vec3`,inputs:[{name:`color`,type:`vec3`}]}),aw=W(([e])=>AC(e.pow(.41666).mul(1.055).sub(.055),e.mul(12.92),e.lessThanEqual(.0031308))).setLayout({name:`sRGBTransferOETF`,type:`vec3`,inputs:[{name:`color`,type:`vec3`}]}),ow=`WorkingColorSpace`,sw=`OutputColorSpace`,cw=class extends Hy{static get type(){return`ColorSpaceNode`}constructor(e,t,n){super(`vec4`),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===ow?Un.workingColorSpace:t===sw?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){let{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target),i=t;return Un.enabled===!1||n===r||!n||!r?i:(Un.getTransfer(n)===`srgb`&&(i=Zb(iw(i.rgb),i.a)),Un.getPrimaries(n)!==Un.getPrimaries(r)&&(i=Zb(nx(Un._getMatrix(new gr,n,r)).mul(i.rgb),i.a)),Un.getTransfer(r)===`srgb`&&(i=Zb(aw(i.rgb),i.a)),i)}},lw=(e,t)=>V(new cw(V(e),ow,t)),uw=(e,t)=>V(new cw(V(e),t,ow)),dw=(e,t,n)=>V(new cw(V(e),t,n));B(`workingToColorSpace`,lw),B(`colorSpaceToWorking`,uw);var fw=class extends By{static get type(){return`ReferenceElementNode`}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){let t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}},pw=class extends zy{static get type(){return`ReferenceBaseNode`}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split(`.`),this.reference=n,this.node=null,this.group=null,this.updateType=Ay.OBJECT}setGroup(e){return this.group=e,this}element(e){return V(new fw(this,V(e)))}setNodeType(e){let t=Jx(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){let{properties:t}=this,n=e[t[0]];for(let e=1;e<t.length;e++)n=n[t[e]];return n}updateReference(e){return this.reference=this.object===null?e.object:this.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);let e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}},mw=(e,t,n)=>V(new pw(e,t,n)),hw=class extends pw{static get type(){return`RendererReferenceNode`}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(Gx)}updateReference(e){return this.reference=this.renderer===null?e.renderer:this.renderer,this.reference}},gw=(e,t,n=null)=>V(new hw(e,t,n)),_w=class extends Hy{static get type(){return`ToneMappingNode`}constructor(e,t=yw,n=null){super(`vec3`),this._toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return gy(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){let t=this.colorNode||e.context.color,n=this._toneMapping;if(n===0)return t;let r=null,i=e.renderer.library.getToneMappingFunction(n);return i===null?(N(`ToneMappingNode: Unsupported Tone Mapping configuration.`,n),r=t):r=Zb(i(t.rgb,this.exposureNode),t.a),r}},vw=(e,t,n)=>V(new _w(e,V(t),V(n))),yw=gw(`toneMappingExposure`,`float`);B(`toneMapping`,(e,t,n)=>vw(t,n,e));var bw=class extends Jy{static get type(){return`BufferAttributeNode`}constructor(e,t=null,n=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=Pr,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;let t=this.getNodeType(e),n=this.value,r=e.getTypeLength(t),i=this.bufferStride||r,a=this.bufferOffset,o=n.isInterleavedBuffer===!0?n:new He(n,i),s=new Ze(o,r,a);o.setUsage(this.usage),this.attribute=s,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){let t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n),i=null;return e.shaderStage===`vertex`||e.shaderStage===`compute`?(this.name=r,i=r):i=nw(this).build(e,t),i}getInputType(){return`bufferAttribute`}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}},xw=(e,t=null,n=0,r=0)=>V(new bw(e,t,n,r)),Sw=(e,t=null,n=0,r=0)=>xw(e,t,n,r).setUsage(Vr),Cw=(e,t=null,n=0,r=0)=>xw(e,t,n,r).setInstanced(!0),ww=(e,t=null,n=0,r=0)=>Sw(e,t,n,r).setInstanced(!0);B(`toAttribute`,e=>xw(e.value));var Tw=class extends zy{static get type(){return`ComputeNode`}constructor(e,t){super(`void`),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name=``,this.updateBeforeType=Ay.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:`dispose`})}setName(e){return this.name=e,this}label(e){return P(`TSL: "label()" has been deprecated. Use "setName()" instead.`),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){let t=this.computeNode.build(e);if(t){let n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){let{shaderStage:n}=e;if(n===`compute`){let t=this.computeNode.build(e,`void`);t!==``&&e.addLineFlowCode(t,this)}else{let n=e.getNodeProperties(this).outputComputeNode;if(n)return n.build(e,t)}}},Ew=(e,t=[64])=>{(t.length===0||t.length>3)&&N(`TSL: compute() workgroupSize must have 1, 2, or 3 elements`);for(let e=0;e<t.length;e++){let n=t[e];(typeof n!=`number`||n<=0||!Number.isInteger(n))&&N(`TSL: compute() workgroupSize element at index [ ${e} ] must be a positive integer`)}for(;t.length<3;)t.push(1);return V(new Tw(V(e),t))},Dw=(e,t,n)=>Ew(e,n).setCount(t);B(`compute`,Dw),B(`computeKernel`,Ew);var Ow=class extends zy{static get type(){return`IsolateNode`}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){let t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);let r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){let n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);let i=this.node.build(e,...t);return e.setCache(n),i}setParent(e){return this.parent=e,this}getParent(){return this.parent}},kw=e=>new Ow(V(e));function Aw(e,t=!0){return P(`TSL: "cache()" has been deprecated. Use "isolate()" instead.`),kw(e).setParent(t)}B(`cache`,Aw),B(`isolate`,kw);var jw=Fb(class extends zy{static get type(){return`BypassNode`}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){let t=this.callNode.build(e,`void`);return t!==``&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}).setParameterLength(2);B(`bypass`,jw);var Mw=class extends zy{static get type(){return`RemapNode`}constructor(e,t,n,r=G(0),i=G(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){let{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:i,doClamp:a}=this,o=e.sub(t).div(n.sub(t));return a===!0&&(o=o.clamp()),o.mul(i.sub(r)).add(r)}},Nw=Fb(Mw,null,null,{doClamp:!1}).setParameterLength(3,5),Pw=Fb(Mw).setParameterLength(3,5);B(`remap`,Nw),B(`remapClamp`,Pw);var Fw=class extends zy{static get type(){return`ExpressionNode`}constructor(e=``,t=`void`){super(t),this.snippet=e}generate(e,t){let n=this.getNodeType(e),r=this.snippet;if(n===`void`)e.addLineFlowCode(r,this);else return e.format(r,n,t)}},Iw=Fb(Fw).setParameterLength(1,2),Lw=e=>(e?UC(e,Iw(`discard`)):Iw(`discard`)).toStack(),Rw=()=>Iw(`return`).toStack();B(`discard`,Lw);var zw=class extends Hy{static get type(){return`RenderOutputNode`}constructor(e,t,n){super(`vec4`),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color,n=(this._toneMapping===null?e.toneMapping:this._toneMapping)||0,r=(this.outputColorSpace===null?e.outputColorSpace:this.outputColorSpace)||``;return n!==0&&(t=t.toneMapping(n)),r!==``&&r!==Un.workingColorSpace&&(t=t.workingToColorSpace(r)),t}},Bw=(e,t=null,n=null)=>V(new zw(V(e),t,n));B(`renderOutput`,Bw);var Vw=class extends Hy{static get type(){return`DebugNode`}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){let t=this.callback,n=this.node.build(e),r=`--- TSL debug - `+e.shaderStage+` shader ---`,i=`-`.repeat(r.length),a=``;return a+=`// #`+r+`#
`,a+=e.flow.code.replace(/^\t/gm,``)+`
`,a+=`/* ... */ `+n+` /* ... */
`,a+=`// #`+i+`#
`,t===null?Te(a):t(e,a),n}},Hw=(e,t=null)=>V(new Vw(V(e),t)).toStack();B(`debug`,Hw);var Uw=class{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}},Ww=class extends zy{static get type(){return`InspectorNode`}constructor(e,t=``,n=null){super(),this.node=e,this.name=t,this.callback=n,this.updateType=Ay.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==Uw&&be(`TSL: ".toInspector()" is only available with WebGPU.`),t}};function Gw(e,t=``,n=null){return e=V(e),e.before(new Ww(e,t,n))}B(`toInspector`,Gw);function Kw(e){P(`TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add`,e)}var qw=class extends zy{static get type(){return`AttributeNode`}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){let n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){let r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t=`float`}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){let t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){let r=e.geometry.getAttribute(t),i=e.getTypeFromAttribute(r),a=e.getAttribute(t,i);return e.shaderStage===`vertex`?e.format(a.name,i,n):nw(this).build(e,n)}else return P(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}},Jw=(e,t=null)=>V(new qw(e,t)),Yw=(e=0)=>Jw(`uv`+(e>0?e:``),`vec2`),Xw=Fb(class extends zy{static get type(){return`TextureSizeNode`}constructor(e,t=null){super(`uvec2`),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){let n=this.textureNode.build(e,`property`),r=this.levelNode===null?`0`:this.levelNode.build(e,`int`);return e.format(`${e.getMethod(`textureDimensions`)}( ${n}, ${r} )`,this.getNodeType(e),t)}}).setParameterLength(1,2),Zw=Fb(class extends qx{static get type(){return`MaxMipLevelNode`}constructor(e){super(0),this._textureNode=e,this.updateType=Ay.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){let e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){let{width:e,height:t}=n;this.value=Math.log2(Math.max(e,t))}}}).setParameterLength(1),Qw=new wn,$w=class extends qx{static get type(){return`TextureNode`}constructor(e=Qw,t=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Ay.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?`float`:this.value.type===1014?`uvec4`:this.value.type===1013?`ivec4`:`vec4`}getInputType(){return`texture`}getDefaultUV(){return Yw(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Jx(this.value.matrix)),this._matrixUniform.mul(Y(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=Jx(!1)),t=t.toVar(),t=this.sampler?this._flipYUniform.select(t.flipY(),t):this._flipYUniform.select(t.setY(K(Xw(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){let t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;let n=this.value;if(!n||n.isTexture!==!0)throw Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=W(()=>{let t=this.uvNode;return(t===null||e.context.forceUVContext===!0)&&e.context.getUV&&(t=e.context.getUV(this,e)),t||=this.getDefaultUV(),this.updateMatrix===!0&&(t=this.getTransformedUV(t)),t=this.setupUV(e,t),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?Ay.OBJECT:Ay.NONE,t})(),i=this.levelNode;i===null&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=i,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?`vec2`:`ivec2`)}generateOffset(e,t){return t.build(e,`ivec2`)}generateSnippet(e,t,n,r,i,a,o,s,c){let l=this.value,u;return u=i?e.generateTextureBias(l,t,n,i,a,c):s?e.generateTextureGrad(l,t,n,s,a,c):o?e.generateTextureCompare(l,t,n,o,a,c):this.sampler===!1?e.generateTextureLoad(l,t,n,r,a,c):r?e.generateTextureLevel(l,t,n,r,a,c):e.generateTexture(l,t,n,a,c),u}generate(e,t){let n=this.value,r=e.getNodeProperties(this),i=super.generate(e,`property`);if(/^sampler/.test(t))return i+`_sampler`;if(e.isReference(t))return i;{let a=e.getDataFromNode(this),o=a.propertyName;if(o===void 0){let{uvNode:t,levelNode:n,biasNode:s,compareNode:c,depthNode:l,gradNode:u,offsetNode:d}=r,f=this.generateUV(e,t),p=n?n.build(e,`float`):null,m=s?s.build(e,`float`):null,h=l?l.build(e,`int`):null,g=c?c.build(e,`float`):null,_=u?[u[0].build(e,`vec2`),u[1].build(e,`vec2`)]:null,v=d?this.generateOffset(e,d):null,y=e.getVarFromNode(this);o=e.getPropertyName(y);let b=this.generateSnippet(e,i,f,p,m,h,g,_,v);e.addLineFlowCode(`${o} = ${b}`,this),a.snippet=b,a.propertyName=o}let s=o,c=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(s=uw(Iw(s,c),n.colorSpace).setup(e).build(e,c)),e.format(s,c,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return P(`TextureNode: .uv() has been renamed. Use .sample() instead.`),this.sample(e)}sample(e){let t=this.clone();return t.uvNode=V(e),t.referenceNode=this.getBase(),V(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){let t=this.clone();t.biasNode=V(e).mul(Zw(t)),t.referenceNode=this.getBase();let n=t.value;return t.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===1003||n.magFilter===1003)&&(P(`TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture.`),t.biasNode=null),V(t)}level(e){let t=this.clone();return t.levelNode=V(e),t.referenceNode=this.getBase(),V(t)}size(e){return Xw(this,e)}bias(e){let t=this.clone();return t.biasNode=V(e),t.referenceNode=this.getBase(),V(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){let t=this.clone();return t.compareNode=V(e),t.referenceNode=this.getBase(),V(t)}grad(e,t){let n=this.clone();return n.gradNode=[V(e),V(t)],n.referenceNode=this.getBase(),V(n)}depth(e){let t=this.clone();return t.depthNode=V(e),t.referenceNode=this.getBase(),V(t)}offset(e){let t=this.clone();return t.offsetNode=V(e),t.referenceNode=this.getBase(),V(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){let e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();let n=this._flipYUniform;n!==null&&(n.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){let e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}},eT=Fb($w).setParameterLength(1,4).setName(`texture`),tT=(e=Qw,t=null,n=null,r=null)=>{let i;return e&&e.isTextureNode===!0?(i=V(e.clone()),i.referenceNode=e.getBase(),t!==null&&(i.uvNode=V(t)),n!==null&&(i.levelNode=V(n)),r!==null&&(i.biasNode=V(r))):i=eT(e,t,n,r),i},nT=(e=Qw)=>tT(e),rT=(...e)=>tT(...e).setSampler(!1),iT=(e,t,n)=>tT(e,t).level(n),aT=e=>(e.isNode===!0?e:tT(e)).convert(`sampler`),oT=e=>(e.isNode===!0?e:tT(e)).convert(`samplerComparison`),sT=class extends qx{static get type(){return`BufferNode`}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return`buffer`}},cT=(e,t,n)=>V(new sT(e,t,n)),lT=class extends By{static get type(){return`UniformArrayElementNode`}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){let t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}},uT=class extends sT{static get type(){return`UniformArrayNode`}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?wy(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Ay.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){let e=this.elementType,t=`vec4`;return e===`mat2`?t=`mat2`:/mat/.test(e)===!0?t=`mat4`:e.charAt(0)===`i`?t=`ivec4`:e.charAt(0)===`u`&&(t=`uvec4`),t}update(){let{array:e,value:t}=this,n=this.elementType;if(n===`float`||n===`int`||n===`uint`)for(let n=0;n<e.length;n++){let r=n*4;t[r]=e[n]}else if(n===`color`)for(let n=0;n<e.length;n++){let r=n*4,i=e[n];t[r]=i.r,t[r+1]=i.g,t[r+2]=i.b||0}else if(n===`mat2`)for(let n=0;n<e.length;n++){let r=n*4,i=e[n];t[r]=i.elements[0],t[r+1]=i.elements[1],t[r+2]=i.elements[2],t[r+3]=i.elements[3]}else if(n===`mat3`)for(let n=0;n<e.length;n++){let r=n*16,i=e[n];t[r]=i.elements[0],t[r+1]=i.elements[1],t[r+2]=i.elements[2],t[r+4]=i.elements[3],t[r+5]=i.elements[4],t[r+6]=i.elements[5],t[r+8]=i.elements[6],t[r+9]=i.elements[7],t[r+10]=i.elements[8],t[r+15]=1}else if(n===`mat4`)for(let n=0;n<e.length;n++){let r=n*16,i=e[n];for(let e=0;e<i.elements.length;e++)t[r+e]=i.elements[e]}else for(let n=0;n<e.length;n++){let r=n*4,i=e[n];t[r]=i.x,t[r+1]=i.y,t[r+2]=i.z||0,t[r+3]=i.w||0}}setup(e){let t=this.array.length,n=this.elementType,r=Float32Array,i=this.paddedType,a=e.getTypeLength(i);return n.charAt(0)===`i`&&(r=Int32Array),n.charAt(0)===`u`&&(r=Uint32Array),this.value=new r(t*a),this.bufferCount=t,this.bufferType=i,super.setup(e)}element(e){return V(new lT(this,V(e)))}},dT=(e,t)=>V(new uT(e,t)),fT=Fb(class extends zy{constructor(e){super(`float`),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}).setParameterLength(1),pT,mT,hT=class e extends zy{static get type(){return`ScreenNode`}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===e.DPR?`float`:this.scope===e.VIEWPORT?`vec4`:`vec2`}getUpdateType(){let t=Ay.NONE;return(this.scope===e.SIZE||this.scope===e.VIEWPORT||this.scope===e.DPR)&&(t=Ay.RENDER),this.updateType=t,t}update({renderer:t}){let n=t.getRenderTarget();this.scope===e.VIEWPORT?n===null?(t.getViewport(mT),mT.multiplyScalar(t.getPixelRatio())):mT.copy(n.viewport):this.scope===e.DPR?this._output.value=t.getPixelRatio():n===null?t.getDrawingBufferSize(pT):(pT.width=n.width,pT.height=n.height)}setup(){let t=this.scope,n=null;return n=t===e.SIZE?Jx(pT||=new Fe):t===e.VIEWPORT?Jx(mT||=new Je):t===e.DPR?Jx(1):J(yT.div(vT)),this._output=n,n}generate(t){if(this.scope===e.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){let n=t.getNodeProperties(vT).outputNode.build(t);e=`${t.getType(`vec2`)}( ${e}.x, ${n}.y - ${e}.y )`}return e}return super.generate(t)}};hT.COORDINATE=`coordinate`,hT.VIEWPORT=`viewport`,hT.SIZE=`size`,hT.UV=`uv`,hT.DPR=`dpr`;var gT=H(hT,hT.DPR),_T=H(hT,hT.UV),vT=H(hT,hT.SIZE),yT=H(hT,hT.COORDINATE),bT=H(hT,hT.VIEWPORT),xT=bT.zw,ST=yT.sub(bT.xy),CT=ST.div(xT),wT=W(()=>(P(`TSL: "viewportResolution" is deprecated. Use "screenSize" instead.`),vT),`vec2`).once()(),TT=Jx(0,`uint`).setName(`u_cameraIndex`).setGroup(Ux(`cameraIndex`)).toVarying(`v_cameraIndex`),ET=Jx(`float`).setName(`cameraNear`).setGroup(Gx).onRenderUpdate(({camera:e})=>e.near),DT=Jx(`float`).setName(`cameraFar`).setGroup(Gx).onRenderUpdate(({camera:e})=>e.far),OT=W(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){let n=[];for(let t of e.cameras)n.push(t.projectionMatrix);t=dT(n).setGroup(Gx).setName(`cameraProjectionMatrices`).element(e.isMultiViewCamera?fT(`gl_ViewID_OVR`):TT).toConst(`cameraProjectionMatrix`)}else t=Jx(`mat4`).setName(`cameraProjectionMatrix`).setGroup(Gx).onRenderUpdate(({camera:e})=>e.projectionMatrix);return t}).once()(),kT=W(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){let n=[];for(let t of e.cameras)n.push(t.projectionMatrixInverse);t=dT(n).setGroup(Gx).setName(`cameraProjectionMatricesInverse`).element(e.isMultiViewCamera?fT(`gl_ViewID_OVR`):TT).toConst(`cameraProjectionMatrixInverse`)}else t=Jx(`mat4`).setName(`cameraProjectionMatrixInverse`).setGroup(Gx).onRenderUpdate(({camera:e})=>e.projectionMatrixInverse);return t}).once()(),AT=W(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){let n=[];for(let t of e.cameras)n.push(t.matrixWorldInverse);t=dT(n).setGroup(Gx).setName(`cameraViewMatrices`).element(e.isMultiViewCamera?fT(`gl_ViewID_OVR`):TT).toConst(`cameraViewMatrix`)}else t=Jx(`mat4`).setName(`cameraViewMatrix`).setGroup(Gx).onRenderUpdate(({camera:e})=>e.matrixWorldInverse);return t}).once()(),jT=W(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){let n=[];for(let t of e.cameras)n.push(t.matrixWorld);t=dT(n).setGroup(Gx).setName(`cameraWorldMatrices`).element(e.isMultiViewCamera?fT(`gl_ViewID_OVR`):TT).toConst(`cameraWorldMatrix`)}else t=Jx(`mat4`).setName(`cameraWorldMatrix`).setGroup(Gx).onRenderUpdate(({camera:e})=>e.matrixWorld);return t}).once()(),MT=W(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){let n=[];for(let t of e.cameras)n.push(t.normalMatrix);t=dT(n).setGroup(Gx).setName(`cameraNormalMatrices`).element(e.isMultiViewCamera?fT(`gl_ViewID_OVR`):TT).toConst(`cameraNormalMatrix`)}else t=Jx(`mat3`).setName(`cameraNormalMatrix`).setGroup(Gx).onRenderUpdate(({camera:e})=>e.normalMatrix);return t}).once()(),NT=W(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){let n=[];for(let t=0,r=e.cameras.length;t<r;t++)n.push(new j);t=dT(n).setGroup(Gx).setName(`cameraPositions`).onRenderUpdate(({camera:e},t)=>{let n=e.cameras,r=t.array;for(let e=0,t=n.length;e<t;e++)r[e].setFromMatrixPosition(n[e].matrixWorld)}).element(e.isMultiViewCamera?fT(`gl_ViewID_OVR`):TT).toConst(`cameraPosition`)}else t=Jx(new j).setName(`cameraPosition`).setGroup(Gx).onRenderUpdate(({camera:e},t)=>t.value.setFromMatrixPosition(e.matrixWorld));return t}).once()(),PT=W(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){let n=[];for(let t of e.cameras)n.push(t.viewport);t=dT(n,`vec4`).setGroup(Gx).setName(`cameraViewports`).element(TT).toConst(`cameraViewport`)}else t=Zb(0,0,vT.x,vT.y).toConst(`cameraViewport`);return t}).once()(),FT=new r,IT=class e extends zy{static get type(){return`Object3DNode`}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Ay.OBJECT,this.uniformNode=new qx(null)}getNodeType(){let t=this.scope;if(t===e.WORLD_MATRIX)return`mat4`;if(t===e.POSITION||t===e.VIEW_POSITION||t===e.DIRECTION||t===e.SCALE)return`vec3`;if(t===e.RADIUS)return`float`}update(t){let n=this.object3d,r=this.uniformNode,i=this.scope;if(i===e.WORLD_MATRIX)r.value=n.matrixWorld;else if(i===e.POSITION)r.value=r.value||new j,r.value.setFromMatrixPosition(n.matrixWorld);else if(i===e.SCALE)r.value=r.value||new j,r.value.setFromMatrixScale(n.matrixWorld);else if(i===e.DIRECTION)r.value=r.value||new j,n.getWorldDirection(r.value);else if(i===e.VIEW_POSITION){let e=t.camera;r.value=r.value||new j,r.value.setFromMatrixPosition(n.matrixWorld),r.value.applyMatrix4(e.matrixWorldInverse)}else if(i===e.RADIUS){let e=t.object.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),FT.copy(e.boundingSphere).applyMatrix4(n.matrixWorld),r.value=FT.radius}}generate(t){let n=this.scope;return n===e.WORLD_MATRIX?this.uniformNode.nodeType=`mat4`:n===e.POSITION||n===e.VIEW_POSITION||n===e.DIRECTION||n===e.SCALE?this.uniformNode.nodeType=`vec3`:n===e.RADIUS&&(this.uniformNode.nodeType=`float`),this.uniformNode.build(t)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}};IT.WORLD_MATRIX=`worldMatrix`,IT.POSITION=`position`,IT.SCALE=`scale`,IT.VIEW_POSITION=`viewPosition`,IT.DIRECTION=`direction`,IT.RADIUS=`radius`;var LT=Fb(IT,IT.DIRECTION).setParameterLength(1),RT=Fb(IT,IT.WORLD_MATRIX).setParameterLength(1),zT=Fb(IT,IT.POSITION).setParameterLength(1),BT=Fb(IT,IT.SCALE).setParameterLength(1),VT=Fb(IT,IT.VIEW_POSITION).setParameterLength(1),HT=Fb(IT,IT.RADIUS).setParameterLength(1),UT=class extends IT{static get type(){return`ModelNode`}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}},WT=H(UT,UT.DIRECTION),GT=H(UT,UT.WORLD_MATRIX),KT=H(UT,UT.POSITION),qT=H(UT,UT.SCALE),JT=H(UT,UT.VIEW_POSITION),YT=H(UT,UT.RADIUS),XT=Jx(new gr).onObjectUpdate(({object:e},t)=>t.value.getNormalMatrix(e.matrixWorld)),ZT=Jx(new F).onObjectUpdate(({object:e},t)=>t.value.copy(e.matrixWorld).invert()),QT=W(e=>e.renderer.overrideNodes.modelViewMatrix||$T).once()().toVar(`modelViewMatrix`),$T=AT.mul(GT),eE=W(e=>(e.context.isHighPrecisionModelViewMatrix=!0,Jx(`mat4`).onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar(`highpModelViewMatrix`),tE=W(e=>{let t=e.context.isHighPrecisionModelViewMatrix;return Jx(`mat3`).onObjectUpdate(({object:e,camera:n})=>(t!==!0&&e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix)))}).once()().toVar(`highpModelNormalViewMatrix`),nE=Jw(`position`,`vec3`),rE=nE.toVarying(`positionLocal`),iE=nE.toVarying(`positionPrevious`),aE=W(e=>GT.mul(rE).xyz.toVarying(e.getSubBuildProperty(`v_positionWorld`)),`vec3`).once([`POSITION`])(),oE=W(()=>rE.transformDirection(GT).toVarying(`v_positionWorldDirection`).normalize().toVar(`positionWorldDirection`),`vec3`).once([`POSITION`])(),sE=W(e=>e.context.setupPositionView().toVarying(`v_positionView`),`vec3`).once([`POSITION`])(),cE=W(e=>{let t;return t=e.camera.isOrthographicCamera?Y(0,0,1):sE.negate().toVarying(`v_positionViewDirection`).normalize(),t.toVar(`positionViewDirection`)},`vec3`).once([`POSITION`])(),lE=H(class extends zy{static get type(){return`FrontFacingNode`}constructor(){super(`bool`),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!==`fragment`)return`true`;let{material:t}=e;return t.side===1?`false`:e.getFrontFacing()}}),uE=G(lE).mul(2).sub(1),dE=W(([e],{material:t})=>{let n=t.side;return n===1?e=e.mul(-1):n===2&&(e=e.mul(uE)),e}),fE=Jw(`normal`,`vec3`),pE=W(e=>e.geometry.hasAttribute(`normal`)===!1?(P(`TSL: Vertex attribute "normal" not found on geometry.`),Y(0,1,0)):fE,`vec3`).once()().toVar(`normalLocal`),mE=sE.dFdx().cross(sE.dFdy()).normalize().toVar(`normalFlat`),hE=W(e=>{let t;return t=e.material.flatShading===!0?mE:xE(pE).toVarying(`v_normalViewGeometry`).normalize(),t},`vec3`).once()().toVar(`normalViewGeometry`),gE=W(e=>{let t=hE.transformDirection(AT);return e.material.flatShading!==!0&&(t=t.toVarying(`v_normalWorldGeometry`)),t.normalize().toVar(`normalWorldGeometry`)},`vec3`).once()(),_E=W(({subBuildFn:e,material:t,context:n})=>{let r;return e===`NORMAL`||e===`VERTEX`?(r=hE,t.flatShading!==!0&&(r=dE(r))):r=n.setupNormal().context({getUV:null}),r},`vec3`).once([`NORMAL`,`VERTEX`])().toVar(`normalView`),vE=_E.transformDirection(AT).toVar(`normalWorld`),yE=W(({subBuildFn:e,context:t})=>{let n;return n=e===`NORMAL`||e===`VERTEX`?_E:t.setupClearcoatNormal().context({getUV:null}),n},`vec3`).once([`NORMAL`,`VERTEX`])().toVar(`clearcoatNormalView`),bE=W(([e,t=GT])=>{let n=nx(t),r=e.div(Y(n[0].dot(n[0]),n[1].dot(n[1]),n[2].dot(n[2])));return n.mul(r).xyz}),xE=W(([e],t)=>{let n=t.renderer.overrideNodes.modelNormalViewMatrix;if(n!==null)return n.transformDirection(e);let r=XT.mul(e);return AT.transformDirection(r)}),SE=W(()=>(P(`TSL: "transformedNormalView" is deprecated. Use "normalView" instead.`),_E)).once([`NORMAL`,`VERTEX`])(),CE=W(()=>(P(`TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.`),vE)).once([`NORMAL`,`VERTEX`])(),wE=W(()=>(P(`TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.`),yE)).once([`NORMAL`,`VERTEX`])(),TE=new Ir,EE=new F,DE=Jx(0).onReference(({material:e})=>e).onObjectUpdate(({material:e})=>e.refractionRatio),OE=Jx(1).onReference(({material:e})=>e).onObjectUpdate(function({material:e,scene:t}){return e.envMap?e.envMapIntensity:t.environmentIntensity}),kE=Jx(new F).onReference(function(e){return e.material}).onObjectUpdate(function({material:e,scene:t}){let n=t.environment!==null&&e.envMap===null?t.environmentRotation:e.envMapRotation;return n?(TE.copy(n),EE.makeRotationFromEuler(TE)):EE.identity(),EE}),AE=cE.negate().reflect(_E),jE=cE.negate().refract(_E,DE),ME=AE.transformDirection(AT).toVar(`reflectVector`),NE=jE.transformDirection(AT).toVar(`reflectVector`),PE=new k,FE=Fb(class extends $w{static get type(){return`CubeTextureNode`}constructor(e,t=null,n=null,r=null){super(e,t,n,r),this.isCubeTextureNode=!0}getInputType(){return`cubeTexture`}getDefaultUV(){let e=this.value;return e.mapping===301?ME:e.mapping===302?NE:(N(`CubeTextureNode: Mapping "%s" not supported.`,e.mapping),Y(0,0,0))}setUpdateMatrix(){}setupUV(e,t){let n=this.value;return(e.renderer.coordinateSystem===2001||!n.isRenderTargetTexture)&&(t=Y(t.x.negate(),t.yz)),kE.mul(t)}generateUV(e,t){return t.build(e,this.sampler===!0?`vec3`:`ivec3`)}}).setParameterLength(1,4).setName(`cubeTexture`),IE=(e=PE,t=null,n=null,r=null)=>{let i;return e&&e.isCubeTextureNode===!0?(i=V(e.clone()),i.referenceNode=e,t!==null&&(i.uvNode=V(t)),n!==null&&(i.levelNode=V(n)),r!==null&&(i.biasNode=V(r))):i=FE(e,t,n,r),i},LE=(e=PE)=>FE(e),RE=class extends By{static get type(){return`ReferenceElementNode`}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){let t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}},zE=class extends zy{static get type(){return`ReferenceNode`}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split(`.`),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Ay.OBJECT}element(e){return V(new RE(this,V(e)))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return P(`TSL: "label()" has been deprecated. Use "setName()" instead.`),this.setName(e)}setNodeType(e){let t=null;t=this.count===null?Array.isArray(this.getValueFromReference())?dT(null,e):e===`texture`?tT(null):e===`cubeTexture`?IE(null):Jx(null,e):cT(null,e,this.count),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){let{properties:t}=this,n=e[t[0]];for(let e=1;e<t.length;e++)n=n[t[e]];return n}updateReference(e){return this.reference=this.object===null?e.object:this.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);let e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}},BE=(e,t,n)=>V(new zE(e,t,n)),VE=(e,t,n,r)=>V(new zE(e,t,r,n)),HE=class extends zE{static get type(){return`MaterialReferenceNode`}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material===null?e.material:this.material,this.reference}},UE=(e,t,n=null)=>V(new HE(e,t,n)),WE=Yw(),GE=sE.dFdx(),KE=sE.dFdy(),qE=WE.dFdx(),JE=WE.dFdy(),YE=_E,XE=KE.cross(YE),ZE=YE.cross(GE),QE=XE.mul(qE.x).add(ZE.mul(JE.x)),$E=XE.mul(qE.y).add(ZE.mul(JE.y)),eD=QE.dot(QE).max($E.dot($E)),tD=eD.equal(0).select(0,eD.inverseSqrt()),nD=QE.mul(tD).toVar(`tangentViewFrame`),rD=$E.mul(tD).toVar(`bitangentViewFrame`),iD=W(e=>(e.geometry.hasAttribute(`tangent`)===!1&&e.geometry.computeTangents(),Jw(`tangent`,`vec4`)))(),aD=iD.xyz.toVar(`tangentLocal`),oD=W(({subBuildFn:e,geometry:t,material:n})=>{let r;return r=e===`VERTEX`||t.hasAttribute(`tangent`)?QT.mul(Zb(aD,0)).xyz.toVarying(`v_tangentView`).normalize():nD,n.flatShading!==!0&&(r=dE(r)),r},`vec3`).once([`NORMAL`,`VERTEX`])().toVar(`tangentView`),sD=oD.transformDirection(AT).toVarying(`v_tangentWorld`).normalize().toVar(`tangentWorld`),cD=W(([e,t],{subBuildFn:n,material:r})=>{let i=e.mul(iD.w).xyz;return n===`NORMAL`&&r.flatShading!==!0&&(i=i.toVarying(t)),i}).once([`NORMAL`]),lD=cD(fE.cross(iD),`v_bitangentGeometry`).normalize().toVar(`bitangentGeometry`),uD=cD(pE.cross(aD),`v_bitangentLocal`).normalize().toVar(`bitangentLocal`),dD=W(({subBuildFn:e,geometry:t,material:n})=>{let r;return r=e===`VERTEX`||t.hasAttribute(`tangent`)?cD(_E.cross(oD),`v_bitangentView`).normalize():rD,n.flatShading!==!0&&(r=dE(r)),r},`vec3`).once([`NORMAL`,`VERTEX`])().toVar(`bitangentView`),fD=cD(vE.cross(sD),`v_bitangentWorld`).normalize().toVar(`bitangentWorld`),pD=nx(oD,dD,_E).toVar(`TBNViewMatrix`),mD=cE.mul(pD),hD=(e,t)=>e.sub(mD.mul(t)),gD=W(()=>{let e=Dx.cross(cE);return e=e.cross(Dx).normalize(),e=AC(e,_E,Tx.mul(hx.oneMinus()).oneMinus().pow2().pow2()).normalize(),e}).once()(),_D=Fb(class extends Hy{static get type(){return`NormalMapNode`}constructor(e,t=null){super(`vec3`),this.node=e,this.scaleNode=t,this.normalMapType=0}setup({material:e}){let{normalMapType:t,scaleNode:n}=this,r=this.node.mul(2).sub(1);if(n!==null){let t=n;e.flatShading===!0&&(t=dE(t)),r=Y(r.xy.mul(t),r.z)}let i=null;return t===1?i=xE(r):t===0?i=pD.mul(r).normalize():(N(`NodeMaterial: Unsupported normal map type: ${t}`),i=_E),i}}).setParameterLength(1,2),vD=W(({textureNode:e,bumpScale:t})=>{let n=t=>e.isolate().context({getUV:e=>t(e.uvNode||Yw()),forceUVContext:!0}),r=G(n(e=>e));return J(G(n(e=>e.add(e.dFdx()))).sub(r),G(n(e=>e.add(e.dFdy()))).sub(r)).mul(t)}),yD=W(e=>{let{surf_pos:t,surf_norm:n,dHdxy:r}=e,i=t.dFdx().normalize(),a=t.dFdy().normalize(),o=n,s=a.cross(o),c=o.cross(i),l=i.dot(s).mul(uE),u=l.sign().mul(r.x.mul(s).add(r.y.mul(c)));return l.abs().mul(n).sub(u).normalize()}),bD=Fb(class extends Hy{static get type(){return`BumpMapNode`}constructor(e,t=null){super(`vec3`),this.textureNode=e,this.scaleNode=t}setup(){let e=this.scaleNode===null?1:this.scaleNode;return yD({surf_pos:sE,surf_norm:_E,dHdxy:vD({textureNode:this.textureNode,bumpScale:e})})}}).setParameterLength(1,2),xD=new Map,Z=class e extends zy{static get type(){return`MaterialNode`}constructor(e){super(),this.scope=e}getCache(e,t){let n=xD.get(e);return n===void 0&&(n=UE(e,t),xD.set(e,n)),n}getFloat(e){return this.getCache(e,`float`)}getColor(e){return this.getCache(e,`color`)}getTexture(e){return this.getCache(e===`map`?`map`:e+`Map`,`texture`)}setup(t){let n=t.context.material,r=this.scope,i=null;if(r===e.COLOR){let e=n.color===void 0?Y():this.getColor(r);i=n.map&&n.map.isTexture===!0?e.mul(this.getTexture(`map`)):e}else if(r===e.OPACITY){let e=this.getFloat(r);i=n.alphaMap&&n.alphaMap.isTexture===!0?e.mul(this.getTexture(`alpha`)):e}else if(r===e.SPECULAR_STRENGTH)i=n.specularMap&&n.specularMap.isTexture===!0?this.getTexture(`specular`).r:G(1);else if(r===e.SPECULAR_INTENSITY){let e=this.getFloat(r);i=n.specularIntensityMap&&n.specularIntensityMap.isTexture===!0?e.mul(this.getTexture(r).a):e}else if(r===e.SPECULAR_COLOR){let e=this.getColor(r);i=n.specularColorMap&&n.specularColorMap.isTexture===!0?e.mul(this.getTexture(r).rgb):e}else if(r===e.ROUGHNESS){let e=this.getFloat(r);i=n.roughnessMap&&n.roughnessMap.isTexture===!0?e.mul(this.getTexture(r).g):e}else if(r===e.METALNESS){let e=this.getFloat(r);i=n.metalnessMap&&n.metalnessMap.isTexture===!0?e.mul(this.getTexture(r).b):e}else if(r===e.EMISSIVE){let e=this.getFloat(`emissiveIntensity`),t=this.getColor(r).mul(e);i=n.emissiveMap&&n.emissiveMap.isTexture===!0?t.mul(this.getTexture(r)):t}else if(r===e.NORMAL)n.normalMap?(i=_D(this.getTexture(`normal`),this.getCache(`normalScale`,`vec2`)),i.normalMapType=n.normalMapType):i=n.bumpMap?bD(this.getTexture(`bump`).r,this.getFloat(`bumpScale`)):_E;else if(r===e.CLEARCOAT){let e=this.getFloat(r);i=n.clearcoatMap&&n.clearcoatMap.isTexture===!0?e.mul(this.getTexture(r).r):e}else if(r===e.CLEARCOAT_ROUGHNESS){let e=this.getFloat(r);i=n.clearcoatRoughnessMap&&n.clearcoatRoughnessMap.isTexture===!0?e.mul(this.getTexture(r).r):e}else if(r===e.CLEARCOAT_NORMAL)i=n.clearcoatNormalMap?_D(this.getTexture(r),this.getCache(r+`Scale`,`vec2`)):_E;else if(r===e.SHEEN){let e=this.getColor(`sheenColor`).mul(this.getFloat(`sheen`));i=n.sheenColorMap&&n.sheenColorMap.isTexture===!0?e.mul(this.getTexture(`sheenColor`).rgb):e}else if(r===e.SHEEN_ROUGHNESS){let e=this.getFloat(r);i=n.sheenRoughnessMap&&n.sheenRoughnessMap.isTexture===!0?e.mul(this.getTexture(r).a):e,i=i.clamp(.07,1)}else if(r===e.ANISOTROPY)if(n.anisotropyMap&&n.anisotropyMap.isTexture===!0){let e=this.getTexture(r);i=tx(aO.x,aO.y,aO.y.negate(),aO.x).mul(e.rg.mul(2).sub(J(1)).normalize().mul(e.b))}else i=aO;else if(r===e.IRIDESCENCE_THICKNESS){let e=BE(`1`,`float`,n.iridescenceThicknessRange);if(n.iridescenceThicknessMap){let t=BE(`0`,`float`,n.iridescenceThicknessRange);i=e.sub(t).mul(this.getTexture(r).g).add(t)}else i=e}else if(r===e.TRANSMISSION){let e=this.getFloat(r);i=n.transmissionMap?e.mul(this.getTexture(r).r):e}else if(r===e.THICKNESS){let e=this.getFloat(r);i=n.thicknessMap?e.mul(this.getTexture(r).g):e}else if(r===e.IOR)i=this.getFloat(r);else if(r===e.LIGHT_MAP)i=this.getTexture(r).rgb.mul(this.getFloat(`lightMapIntensity`));else if(r===e.AO)i=this.getTexture(r).r.sub(1).mul(this.getFloat(`aoMapIntensity`)).add(1);else if(r===e.LINE_DASH_OFFSET)i=n.dashOffset?this.getFloat(r):G(0);else{let e=this.getNodeType(t);i=this.getCache(r,e)}return i}};Z.ALPHA_TEST=`alphaTest`,Z.COLOR=`color`,Z.OPACITY=`opacity`,Z.SHININESS=`shininess`,Z.SPECULAR=`specular`,Z.SPECULAR_STRENGTH=`specularStrength`,Z.SPECULAR_INTENSITY=`specularIntensity`,Z.SPECULAR_COLOR=`specularColor`,Z.REFLECTIVITY=`reflectivity`,Z.ROUGHNESS=`roughness`,Z.METALNESS=`metalness`,Z.NORMAL=`normal`,Z.CLEARCOAT=`clearcoat`,Z.CLEARCOAT_ROUGHNESS=`clearcoatRoughness`,Z.CLEARCOAT_NORMAL=`clearcoatNormal`,Z.EMISSIVE=`emissive`,Z.ROTATION=`rotation`,Z.SHEEN=`sheen`,Z.SHEEN_ROUGHNESS=`sheenRoughness`,Z.ANISOTROPY=`anisotropy`,Z.IRIDESCENCE=`iridescence`,Z.IRIDESCENCE_IOR=`iridescenceIOR`,Z.IRIDESCENCE_THICKNESS=`iridescenceThickness`,Z.IOR=`ior`,Z.TRANSMISSION=`transmission`,Z.THICKNESS=`thickness`,Z.ATTENUATION_DISTANCE=`attenuationDistance`,Z.ATTENUATION_COLOR=`attenuationColor`,Z.LINE_SCALE=`scale`,Z.LINE_DASH_SIZE=`dashSize`,Z.LINE_GAP_SIZE=`gapSize`,Z.LINE_WIDTH=`linewidth`,Z.LINE_DASH_OFFSET=`dashOffset`,Z.POINT_SIZE=`size`,Z.DISPERSION=`dispersion`,Z.LIGHT_MAP=`light`,Z.AO=`ao`;var SD=H(Z,Z.ALPHA_TEST),CD=H(Z,Z.COLOR),wD=H(Z,Z.SHININESS),TD=H(Z,Z.EMISSIVE),ED=H(Z,Z.OPACITY),DD=H(Z,Z.SPECULAR),OD=H(Z,Z.SPECULAR_INTENSITY),kD=H(Z,Z.SPECULAR_COLOR),AD=H(Z,Z.SPECULAR_STRENGTH),jD=H(Z,Z.REFLECTIVITY),MD=H(Z,Z.ROUGHNESS),ND=H(Z,Z.METALNESS),PD=H(Z,Z.NORMAL),FD=H(Z,Z.CLEARCOAT),ID=H(Z,Z.CLEARCOAT_ROUGHNESS),LD=H(Z,Z.CLEARCOAT_NORMAL),RD=H(Z,Z.ROTATION),zD=H(Z,Z.SHEEN),BD=H(Z,Z.SHEEN_ROUGHNESS),VD=H(Z,Z.ANISOTROPY),HD=H(Z,Z.IRIDESCENCE),UD=H(Z,Z.IRIDESCENCE_IOR),WD=H(Z,Z.IRIDESCENCE_THICKNESS),GD=H(Z,Z.TRANSMISSION),KD=H(Z,Z.THICKNESS),qD=H(Z,Z.IOR),JD=H(Z,Z.ATTENUATION_DISTANCE),YD=H(Z,Z.ATTENUATION_COLOR),XD=H(Z,Z.LINE_SCALE),ZD=H(Z,Z.LINE_DASH_SIZE),QD=H(Z,Z.LINE_GAP_SIZE),$D=H(Z,Z.LINE_WIDTH),eO=H(Z,Z.LINE_DASH_OFFSET),tO=H(Z,Z.POINT_SIZE),nO=H(Z,Z.DISPERSION),rO=H(Z,Z.LIGHT_MAP),iO=H(Z,Z.AO),aO=Jx(new Fe).onReference(function(e){return e.material}).onRenderUpdate(function({material:e}){this.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation))}),oO=W(e=>e.context.setupModelViewProjection(),`vec4`).once()().toVarying(`v_modelViewProjection`),sO=class e extends zy{static get type(){return`IndexNode`}constructor(e){super(`uint`),this.scope=e,this.isIndexNode=!0}generate(t){let n=this.getNodeType(t),r=this.scope,i;if(r===e.VERTEX)i=t.getVertexIndex();else if(r===e.INSTANCE)i=t.getInstanceIndex();else if(r===e.DRAW)i=t.getDrawIndex();else if(r===e.INVOCATION_LOCAL)i=t.getInvocationLocalIndex();else if(r===e.INVOCATION_SUBGROUP)i=t.getInvocationSubgroupIndex();else if(r===e.SUBGROUP)i=t.getSubgroupIndex();else throw Error(`THREE.IndexNode: Unknown scope: `+r);let a;return a=t.shaderStage===`vertex`||t.shaderStage===`compute`?i:nw(this).build(t,n),a}};sO.VERTEX=`vertex`,sO.INSTANCE=`instance`,sO.SUBGROUP=`subgroup`,sO.INVOCATION_LOCAL=`invocationLocal`,sO.INVOCATION_SUBGROUP=`invocationSubgroup`,sO.DRAW=`draw`;var cO=H(sO,sO.VERTEX),lO=H(sO,sO.INSTANCE),uO=H(sO,sO.SUBGROUP),dO=H(sO,sO.INVOCATION_SUBGROUP),fO=H(sO,sO.INVOCATION_LOCAL),pO=H(sO,sO.DRAW),mO=class extends zy{static get type(){return`InstanceNode`}constructor(e,t,n=null){super(`void`),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Ay.FRAME,this.buffer=null,this.bufferColor=null}setup(e){let{instanceMatrix:t,instanceColor:n}=this,{count:r}=t,{instanceMatrixNode:i,instanceColorNode:a}=this;if(i===null){if(r<=1e3)i=cT(t.array,`mat4`,Math.max(r,1)).element(lO);else{let e=new qn(t.array,16,1);this.buffer=e;let n=t.usage===35048?ww:Cw;i=rx(n(e,`vec4`,16,0),n(e,`vec4`,16,4),n(e,`vec4`,16,8),n(e,`vec4`,16,12))}this.instanceMatrixNode=i}if(n&&a===null){let e=new Qn(n.array,3),t=n.usage===35048?ww:Cw;this.bufferColor=e,a=Y(t(e,`vec3`,3,0)),this.instanceColorNode=a}let o=i.mul(rE).xyz;if(rE.assign(o),e.hasGeometryAttribute(`normal`)){let e=bE(pE,i);pE.assign(e)}this.instanceColorNode!==null&&fx(`vec3`,`vInstanceColor`).assign(this.instanceColorNode)}update(){this.buffer!==null&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==35048&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==35048&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}},hO=Fb(mO).setParameterLength(2,3),gO=Fb(class extends mO{static get type(){return`InstancedMeshNode`}constructor(e){let{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}}).setParameterLength(1),_O=Fb(class extends zy{static get type(){return`BatchNode`}constructor(e){super(`void`),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=lO:this.batchingIdNode=pO);let t=W(([e])=>{let t=K(Xw(rT(this.batchMesh._indirectTexture),0).x),n=K(e).mod(t),r=K(e).div(t);return rT(this.batchMesh._indirectTexture,Gb(n,r)).x}).setLayout({name:`getIndirectIndex`,type:`uint`,inputs:[{name:`id`,type:`int`}]})(K(this.batchingIdNode)),n=this.batchMesh._matricesTexture,r=K(Xw(rT(n),0).x),i=G(t).mul(4).toInt().toVar(),a=i.mod(r),o=i.div(r),s=rx(rT(n,Gb(a,o)),rT(n,Gb(a.add(1),o)),rT(n,Gb(a.add(2),o)),rT(n,Gb(a.add(3),o))),c=this.batchMesh._colorsTexture;if(c!==null){let e=W(([e])=>{let t=K(Xw(rT(c),0).x),n=e;return rT(c,Gb(n.mod(t),n.div(t))).rgb}).setLayout({name:`getBatchingColor`,type:`vec3`,inputs:[{name:`id`,type:`int`}]})(t);fx(`vec3`,`vBatchColor`).assign(e)}let l=nx(s);rE.assign(s.mul(rE));let u=pE.div(Y(l[0].dot(l[0]),l[1].dot(l[1]),l[2].dot(l[2]))),d=l.mul(u).xyz;pE.assign(d),e.hasGeometryAttribute(`tangent`)&&aD.mulAssign(l)}}).setParameterLength(1),vO=Fb(class extends By{static get type(){return`StorageArrayElementNode`}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){let n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(e,t):`void`}setup(e){return e.isAvailable(`storageBuffer`)===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let n,r=e.context.assign;if(n=e.isAvailable(`storageBuffer`)===!1?this.node.isPBO===!0&&r!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!==`compute`)?e.generatePBO(this):this.node.build(e):super.generate(e),r!==!0){let r=this.getNodeType(e);n=e.format(n,r,t)}return n}}).setParameterLength(2),yO=class extends sT{static get type(){return`StorageBufferNode`}constructor(e,t=null,n=0){let r,i=null;t&&t.isStruct?(r=`struct`,i=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(n=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(r=yy(e.itemSize),n=e.count):r=t,super(e,r,n),this.isStorageBufferNode=!0,this.structTypeNode=i,this.access=My.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?`indirectStorageBuffer`:`storageBuffer`}element(e){return vO(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(My.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=xw(this.value),this._varying=nw(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable(`storageBuffer`)||e.isAvailable(`indirectStorageBuffer`))return super.getNodeType(e);let{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode===null?`void`:this.structTypeNode.getMemberType(e,t)}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable(`storageBuffer`)||e.isAvailable(`indirectStorageBuffer`))return super.generate(e);let{attribute:t,varying:n}=this.getAttributeData(),r=n.build(e);return e.registerTransform(r,t),r}},bO=(e,t=null,n=0)=>V(new yO(e,t,n)),xO=(e,t,n)=>(P(`TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.`),bO(e,t,n).setPBO(!0)),SO=new WeakMap,CO=class extends zy{static get type(){return`SkinningNode`}constructor(e){super(`void`),this.skinnedMesh=e,this.updateType=Ay.OBJECT,this.skinIndexNode=Jw(`skinIndex`,`uvec4`),this.skinWeightNode=Jw(`skinWeight`,`vec4`),this.bindMatrixNode=BE(`bindMatrix`,`mat4`),this.bindMatrixInverseNode=BE(`bindMatrixInverse`,`mat4`),this.boneMatricesNode=VE(`skeleton.boneMatrices`,`mat4`,e.skeleton.bones.length),this.positionNode=rE,this.toPositionNode=rE,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){let{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:a}=this,o=e.element(n.x),s=e.element(n.y),c=e.element(n.z),l=e.element(n.w),u=i.mul(t),d=nS(o.mul(r.x).mul(u),s.mul(r.y).mul(u),c.mul(r.z).mul(u),l.mul(r.w).mul(u));return a.mul(d).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=pE){let{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:a}=this,o=e.element(n.x),s=e.element(n.y),c=e.element(n.z),l=e.element(n.w),u=nS(r.x.mul(o),r.y.mul(s),r.z.mul(c),r.w.mul(l));return u=a.mul(u).mul(i),u.transformDirection(t).xyz}getPreviousSkinnedPosition(e){let t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=VE(`skeleton.previousBoneMatrices`,`mat4`,t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,iE)}needsPreviousBoneMatrices(e){let t=e.renderer.getMRT();return t&&t.has(`velocity`)||Ey(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&iE.assign(this.getPreviousSkinnedPosition(e));let t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute(`normal`)){let t=this.getSkinnedNormal();pE.assign(t),e.hasGeometryAttribute(`tangent`)&&aD.assign(t)}return t}generate(e,t){if(t!==`void`)return super.generate(e,t)}update(e){let t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;SO.get(t)!==e.frameId&&(SO.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}},wO=e=>V(new CO(e)),TO=(e,t=null)=>{let n=new CO(e);return n.positionNode=bO(new Qn(e.geometry.getAttribute(`position`).array,3),`vec3`).setPBO(!0).toReadOnly().element(lO).toVar(),n.skinIndexNode=bO(new Qn(new Uint32Array(e.geometry.getAttribute(`skinIndex`).array),4),`uvec4`).setPBO(!0).toReadOnly().element(lO).toVar(),n.skinWeightNode=bO(new Qn(e.geometry.getAttribute(`skinWeight`).array,4),`vec4`).setPBO(!0).toReadOnly().element(lO).toVar(),n.bindMatrixNode=Jx(e.bindMatrix,`mat4`),n.bindMatrixInverseNode=Jx(e.bindMatrixInverse,`mat4`),n.boneMatricesNode=cT(e.skeleton.boneMatrices,`mat4`,e.skeleton.bones.length),n.toPositionNode=t,V(n)},EO=class extends zy{static get type(){return`LoopNode`}constructor(e=[]){super(`void`),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){let t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;let n={};for(let e=0,t=this.params.length-1;e<t;e++){let t=this.params[e],r=t.isNode!==!0&&t.name||this.getVarName(e);n[r]=Iw(r,t.isNode!==!0&&t.type||`int`)}let r=e.addStack(),i=this.params[this.params.length-1](n);t.returnsNode=i.context({nodeLoop:i}),t.stackNode=r;let a=this.params[0];if(a.isNode!==!0&&typeof a.update==`function`){let e=W(this.params[0].update)(n);t.updateNode=e.context({nodeLoop:e})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){let t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){let t=this.getProperties(e),n=this.params,r=t.stackNode;for(let r=0,i=n.length-1;r<i;r++){let i=n[r],a=!1,o=null,s=null,c=null,l=null,u=null,d=null;i.isNode?i.getNodeType(e)===`bool`?(a=!0,l=`bool`,s=i.build(e,l)):(l=`int`,c=this.getVarName(r),o=`0`,s=i.build(e,l),u=`<`):(l=i.type||`int`,c=i.name||this.getVarName(r),o=i.start,s=i.end,u=i.condition,d=i.update,typeof o==`number`?o=e.generateConst(l,o):o&&o.isNode&&(o=o.build(e,l)),typeof s==`number`?s=e.generateConst(l,s):s&&s.isNode&&(s=s.build(e,l)),o!==void 0&&s===void 0?(o+=` - 1`,s=`0`,u=`>=`):s!==void 0&&o===void 0&&(o=`0`,u=`<`),u===void 0&&(u=Number(o)>Number(s)?`>=`:`<`));let f;if(a)f=`while ( ${s} )`;else{let n={start:o,end:s},r=n.start,i=n.end,a,p=()=>u.includes(`<`)?`+=`:`-=`;if(d!=null)switch(typeof d){case`function`:a=e.flowStagesNode(t.updateNode,`void`).code.replace(/\t|;/g,``);break;case`number`:a=c+` `+p()+` `+e.generateConst(l,d);break;case`string`:a=c+` `+d;break;default:d.isNode?a=c+` `+p()+` `+d.build(e):(N(`TSL: 'Loop( { update: ... } )' is not a function, string or number.`),a=`break /* invalid update */`)}else d=l===`int`||l===`uint`?u.includes(`<`)?`++`:`--`:p()+` 1.`,a=c+` `+d;f=`for ( ${e.getVar(l,c)+` = `+r}; ${c+` `+u+` `+i}; ${a} )`}e.addFlowCode((r===0?`
`:``)+e.tab+f+` {

`).addFlowTab()}let i=r.build(e,`void`);t.returnsNode.build(e,`void`),e.removeFlowTab().addFlowCode(`
`+e.tab+i);for(let t=0,n=this.params.length-1;t<n;t++)e.addFlowCode((t===0?``:e.tab)+`}

`).removeFlowTab();e.addFlowTab()}},DO=(...e)=>new EO(Pb(e,`int`)).toStack(),OO=()=>Iw(`continue`).toStack(),kO=()=>Iw(`break`).toStack(),AO=new WeakMap,jO=new Je,MO=W(({bufferMap:e,influence:t,stride:n,width:r,depth:i,offset:a})=>{let o=K(cO).mul(n).add(a),s=o.div(r);return rT(e,Gb(o.sub(s.mul(r)),s)).depth(i).xyz.mul(t)});function NO(e){let t=e.morphAttributes.position!==void 0,n=e.morphAttributes.normal!==void 0,r=e.morphAttributes.color!==void 0,i=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,a=i===void 0?0:i.length,o=AO.get(e);if(o===void 0||o.count!==a){o!==void 0&&o.texture.dispose();let i=e.morphAttributes.position||[],s=e.morphAttributes.normal||[],c=e.morphAttributes.color||[],l=0;t===!0&&(l=1),n===!0&&(l=2),r===!0&&(l=3);let u=e.attributes.position.count*l,d=1,f=4096;u>f&&(d=Math.ceil(u/f),u=f);let p=new Float32Array(u*d*4*a),m=new Ot(p,u,d,a);m.type=Dn,m.needsUpdate=!0;let h=l*4;for(let e=0;e<a;e++){let a=i[e],o=s[e],l=c[e],f=u*d*4*e;for(let e=0;e<a.count;e++){let i=e*h;t===!0&&(jO.fromBufferAttribute(a,e),p[f+i+0]=jO.x,p[f+i+1]=jO.y,p[f+i+2]=jO.z,p[f+i+3]=0),n===!0&&(jO.fromBufferAttribute(o,e),p[f+i+4]=jO.x,p[f+i+5]=jO.y,p[f+i+6]=jO.z,p[f+i+7]=0),r===!0&&(jO.fromBufferAttribute(l,e),p[f+i+8]=jO.x,p[f+i+9]=jO.y,p[f+i+10]=jO.z,p[f+i+11]=l.itemSize===4?jO.w:1)}}o={count:a,texture:m,stride:l,size:new Fe(u,d)},AO.set(e,o);function g(){m.dispose(),AO.delete(e),e.removeEventListener(`dispose`,g)}e.addEventListener(`dispose`,g)}return o}var PO=Fb(class extends zy{static get type(){return`MorphNode`}constructor(e){super(`void`),this.mesh=e,this.morphBaseInfluence=Jx(1),this.updateType=Ay.OBJECT}setup(e){let{geometry:t}=e,n=t.morphAttributes.position!==void 0,r=t.hasAttribute(`normal`)&&t.morphAttributes.normal!==void 0,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=i===void 0?0:i.length,{texture:o,stride:s,size:c}=NO(t);n===!0&&rE.mulAssign(this.morphBaseInfluence),r===!0&&pE.mulAssign(this.morphBaseInfluence);let l=K(c.width);DO(a,({i:e})=>{let t=G(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?t.assign(rT(this.mesh.morphTexture,Gb(K(e).add(1),K(lO))).r):t.assign(BE(`morphTargetInfluences`,`float`).element(e).toVar()),Bb(t.notEqual(0),()=>{n===!0&&rE.addAssign(MO({bufferMap:o,influence:t,stride:s,width:l,depth:e,offset:K(0)})),r===!0&&pE.addAssign(MO({bufferMap:o,influence:t,stride:s,width:l,depth:e,offset:K(1)}))})})}update(){let e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((e,t)=>e+t,0)}}).setParameterLength(1),FO=class extends zy{static get type(){return`LightingNode`}constructor(){super(`vec3`),this.isLightingNode=!0}},IO=class extends FO{static get type(){return`AONode`}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}},LO=Fb(class extends WC{static get type(){return`LightingContextNode`}constructor(e,t=null,n=null,r=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){let{backdropNode:e,backdropAlphaNode:t}=this,n={directDiffuse:Y().toVar(`directDiffuse`),directSpecular:Y().toVar(`directSpecular`),indirectDiffuse:Y().toVar(`indirectDiffuse`),indirectSpecular:Y().toVar(`indirectSpecular`)};return{radiance:Y().toVar(`radiance`),irradiance:Y().toVar(`irradiance`),iblIrradiance:Y().toVar(`iblIrradiance`),ambientOcclusion:G(1).toVar(`ambientOcclusion`),reflectedLight:n,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||=this.getContext(),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}),RO=class extends FO{static get type(){return`IrradianceNode`}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}},zO=new Fe,BO=class extends $w{static get type(){return`ViewportTextureNode`}constructor(e=_T,t=null,n=null){let r=null;n===null?(r=new cr,r.minFilter=Kt,n=r):r=n,super(n,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=r,this.isOutputTextureNode=!0,this.updateBeforeType=Ay.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,n;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,n=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,n=this._cacheTextures),e===null)return t;if(n.has(e)===!1){let r=t.clone();n.set(e,r)}return n.get(e)}updateReference(e){let t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){let t=e.renderer,n=t.getRenderTarget();n===null?t.getDrawingBufferSize(zO):zO.set(n.width,n.height);let r=this.getTextureForReference(n);(r.image.width!==zO.width||r.image.height!==zO.height)&&(r.image.width=zO.width,r.image.height=zO.height,r.needsUpdate=!0);let i=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(r),r.generateMipmaps=i}clone(){let e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}},VO=Fb(BO).setParameterLength(0,3),HO=Fb(BO,null,null,{generateMipmaps:!0}).setParameterLength(0,3),UO=null,WO=Fb(class extends BO{static get type(){return`ViewportDepthTextureNode`}constructor(e=_T,t=null){UO===null&&(UO=new Mt),super(e,t,UO)}getTextureForReference(){return UO}}).setParameterLength(0,2),GO=class e extends zy{static get type(){return`ViewportDepthNode`}constructor(e,t=null){super(`float`),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(t){let{scope:n}=this;return n===e.DEPTH_BASE?t.getFragDepth():super.generate(t)}setup({camera:t}){let{scope:n}=this,r=this.valueNode,i=null;return n===e.DEPTH_BASE?r!==null&&(i=QO().assign(r)):n===e.DEPTH?i=t.isPerspectiveCamera?JO(sE.z,ET,DT):KO(sE.z,ET,DT):n===e.LINEAR_DEPTH&&(i=r===null?KO(sE.z,ET,DT):t.isPerspectiveCamera?KO(YO(r,ET,DT),ET,DT):r),i}};GO.DEPTH_BASE=`depthBase`,GO.DEPTH=`depth`,GO.LINEAR_DEPTH=`linearDepth`;var KO=(e,t,n)=>e.add(t).div(t.sub(n)),qO=(e,t,n)=>t.sub(n).mul(e).sub(t),JO=(e,t,n)=>t.add(e).mul(n).div(n.sub(t).mul(e)),YO=(e,t,n)=>t.mul(n).div(n.sub(t).mul(e).sub(n)),XO=(e,t,n)=>{t=t.max(1e-6).toVar();let r=VS(e.negate().div(t)),i=VS(n.div(t));return r.div(i)},ZO=(e,t,n)=>{let r=e.mul(BS(n.div(t)));return G(Math.E).pow(r).mul(t).negate()},QO=Fb(GO,GO.DEPTH_BASE),$O=H(GO,GO.DEPTH),ek=Fb(GO,GO.LINEAR_DEPTH).setParameterLength(0,1),tk=ek(WO());$O.assign=e=>QO(e);var nk=class e extends zy{static get type(){return`ClippingNode`}constructor(t=e.DEFAULT){super(),this.scope=t}setup(t){super.setup(t);let{intersectionPlanes:n,unionPlanes:r}=t.clippingContext;return this.hardwareClipping=t.material.hardwareClipping,this.scope===e.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===e.HARDWARE?this.setupHardwareClipping(r,t):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return W(()=>{let n=G().toVar(`distanceToPlane`),r=G().toVar(`distanceToGradient`),i=G(1).toVar(`clipOpacity`),a=t.length;if(this.hardwareClipping===!1&&a>0){let e=dT(t).setGroup(Gx);DO(a,({i:t})=>{let a=e.element(t);n.assign(sE.dot(a.xyz).negate().add(a.w)),r.assign(n.fwidth().div(2)),i.mulAssign(PC(r.negate(),r,n))})}let o=e.length;if(o>0){let t=dT(e).setGroup(Gx),a=G(1).toVar(`intersectionClipOpacity`);DO(o,({i:e})=>{let i=t.element(e);n.assign(sE.dot(i.xyz).negate().add(i.w)),r.assign(n.fwidth().div(2)),a.mulAssign(PC(r.negate(),r,n).oneMinus())}),i.mulAssign(a.oneMinus())}px.a.mulAssign(i),px.a.equal(0).discard()})()}setupDefault(e,t){return W(()=>{let n=t.length;if(this.hardwareClipping===!1&&n>0){let e=dT(t).setGroup(Gx);DO(n,({i:t})=>{let n=e.element(t);sE.dot(n.xyz).greaterThan(n.w).discard()})}let r=e.length;if(r>0){let t=dT(e).setGroup(Gx),n=Wb(!0).toVar(`clipped`);DO(r,({i:e})=>{let r=t.element(e);n.assign(sE.dot(r.xyz).greaterThan(r.w).and(n))}),n.discard()}})()}setupHardwareClipping(e,t){let n=e.length;return t.enableHardwareClipping(n),W(()=>{let r=dT(e).setGroup(Gx),i=fT(t.getClipDistance());DO(n,({i:e})=>{let t=r.element(e),n=sE.dot(t.xyz).sub(t.w).negate();i.element(e).assign(n)})})()}};nk.ALPHA_TO_COVERAGE=`alphaToCoverage`,nk.DEFAULT=`default`,nk.HARDWARE=`hardware`;var rk=()=>V(new nk),ik=()=>V(new nk(nk.ALPHA_TO_COVERAGE)),ak=()=>V(new nk(nk.HARDWARE)),ok=.05,sk=W(([e])=>qS(iS(1e4,JS(iS(17,e.x).add(iS(.1,e.y)))).mul(nS(.1,eC(JS(iS(13,e.y).add(e.x))))))),ck=W(([e])=>sk(J(sk(e.xy),e.z))),lk=W(([e])=>{let t=gC(nC(aC(e.xyz)),nC(oC(e.xyz))),n=G(1).div(G(ok).mul(t)).toVar(`pixScale`),r=J(zS(WS(VS(n))),zS(GS(VS(n)))),i=J(ck(WS(r.x.mul(e.xyz))),ck(WS(r.y.mul(e.xyz)))),a=qS(VS(n)),o=nS(iS(a.oneMinus(),i.x),iS(a,i.y)),s=hC(a,a.oneMinus()),c=Y(o.mul(o).div(iS(2,s).mul(rS(1,s))),o.sub(iS(.5,s)).div(rS(1,s)),rS(1,rS(1,o).mul(rS(1,o)).div(iS(2,s).mul(rS(1,s)))));return jC(o.lessThan(s.oneMinus()).select(o.lessThan(s).select(c.x,c.y),c.z),1e-6,1)}).setLayout({name:`getAlphaHashThreshold`,type:`float`,inputs:[{name:`position`,type:`vec3`}]}),uk=class extends qw{static get type(){return`VertexColorNode`}constructor(e){super(null,`vec4`),this.isVertexColorNode=!0,this.index=e}getAttributeName(){let e=this.index;return`color`+(e>0?e:``)}generate(e){let t=this.getAttributeName(e),n=e.hasGeometryAttribute(t),r;return r=n===!0?super.generate(e):e.generateConst(this.nodeType,new Je(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}},dk=(e=0)=>V(new uk(e)),fk=W(([e,t])=>hC(1,e.oneMinus().div(t)).oneMinus()).setLayout({name:`blendBurn`,type:`vec3`,inputs:[{name:`base`,type:`vec3`},{name:`blend`,type:`vec3`}]}),pk=W(([e,t])=>hC(e.div(t.oneMinus()),1)).setLayout({name:`blendDodge`,type:`vec3`,inputs:[{name:`base`,type:`vec3`},{name:`blend`,type:`vec3`}]}),mk=W(([e,t])=>e.oneMinus().mul(t.oneMinus()).oneMinus()).setLayout({name:`blendScreen`,type:`vec3`,inputs:[{name:`base`,type:`vec3`},{name:`blend`,type:`vec3`}]}),hk=W(([e,t])=>AC(e.mul(2).mul(t),e.oneMinus().mul(2).mul(t.oneMinus()).oneMinus(),_C(.5,e))).setLayout({name:`blendOverlay`,type:`vec3`,inputs:[{name:`base`,type:`vec3`},{name:`blend`,type:`vec3`}]}),gk=W(([e,t])=>{let n=t.a.add(e.a.mul(t.a.oneMinus()));return Zb(t.rgb.mul(t.a).add(e.rgb.mul(e.a).mul(t.a.oneMinus())).div(n),n)}).setLayout({name:`blendColor`,type:`vec4`,inputs:[{name:`base`,type:`vec4`},{name:`blend`,type:`vec4`}]}),_k=W(([e])=>Zb(e.rgb.mul(e.a),e.a),{color:`vec4`,return:`vec4`}),vk=W(([e])=>(Bb(e.a.equal(0),()=>Zb(0)),Zb(e.rgb.div(e.a),e.a)),{color:`vec4`,return:`vec4`}),yk=(...e)=>(P(`TSL: "burn" has been renamed. Use "blendBurn" instead.`),fk(e)),bk=(...e)=>(P(`TSL: "dodge" has been renamed. Use "blendDodge" instead.`),pk(e)),xk=(...e)=>(P(`TSL: "screen" has been renamed. Use "blendScreen" instead.`),mk(e)),Sk=(...e)=>(P(`TSL: "overlay" has been renamed. Use "blendOverlay" instead.`),hk(e)),Ck=class extends Ar{static get type(){return`NodeMaterial`}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,`shadowPositionNode`,{get:()=>this.receivedShadowPositionNode,set:e=>{P(`NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".`),this.receivedShadowPositionNode=e}})}_getNodeChildren(){let e=[];for(let t of Object.getOwnPropertyNames(this)){if(t.startsWith(`_`)===!0)continue;let n=this[t];n&&n.isNode===!0&&e.push({property:t,childNode:n})}return e}customProgramCacheKey(){let e=[];for(let{property:t,childNode:n}of this._getNodeChildren())e.push(my(t.slice(0,-4)),n.getCacheKey());return this.type+hy(e)}build(e){this.setup(e)}setupObserver(e){return new fy(e)}setup(e){e.context.setupNormal=()=>tw(this.setupNormal(e),`NORMAL`,`vec3`),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);let t=e.renderer,n=t.getRenderTarget();e.addStack();let r=tw(this.setupVertex(e),`VERTEX`),i=this.vertexNode||r;e.stack.outputNode=i,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow(`vertex`,e.removeStack()),e.addStack();let a,o=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n===null?t.depth===!0&&this.setupDepth(e):n.depthBuffer===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);let r=this.setupLighting(e);o!==null&&e.stack.addToStack(o);let i=Zb(r,px.a).max(0);a=this.setupOutput(e,i),jx.assign(a);let s=this.outputNode!==null;if(s&&(a=this.outputNode),n!==null){let e=t.getMRT(),n=this.mrtNode;e===null?n!==null&&(a=n):(s&&jx.assign(a),a=e,n!==null&&(a=e.merge(n)))}}else{let t=this.fragmentNode;t.isOutputStructNode!==!0&&(t=Zb(t)),a=this.setupOutput(e,t)}e.stack.outputNode=a,e.addFlow(`fragment`,e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;let{unionPlanes:t,intersectionPlanes:n}=e.clippingContext,r=null;if(t.length>0||n.length>0){let t=e.renderer.currentSamples;this.alphaToCoverage&&t>1?r=ik():e.stack.addToStack(rk())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;let t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable(`clipDistance`)&&(e.stack.addToStack(ak()),this.hardwareClipping=!0)}setupDepth(e){let{renderer:t,camera:n}=e,r=this.depthNode;if(r===null){let e=t.getMRT();e&&e.has(`depth`)?r=e.get(`depth`):t.logarithmicDepthBuffer===!0&&(r=n.isPerspectiveCamera?XO(sE.z,ET,DT):KO(sE.z,ET,DT))}r!==null&&$O.assign(r).toStack()}setupPositionView(){return QT.mul(rE).xyz}setupModelViewProjection(){return OT.mul(sE)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),oO}setupPosition(e){let{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&PO(t).toStack(),t.isSkinnedMesh===!0&&wO(t).toStack(),this.displacementMap){let e=UE(`displacementMap`,`texture`),t=UE(`displacementScale`,`float`),n=UE(`displacementBias`,`float`);rE.addAssign(pE.normalize().mul(e.x.mul(t).add(n)))}return t.isBatchedMesh&&_O(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&gO(t).toStack(),this.positionNode!==null&&rE.assign(tw(this.positionNode,`POSITION`,`vec3`)),rE}setupDiffuseColor(e){let{object:t,geometry:n}=e;this.maskNode!==null&&Wb(this.maskNode).not().discard();let r=this.colorNode?Zb(this.colorNode):CD;this.vertexColors===!0&&n.hasAttribute(`color`)&&(r=r.mul(dk())),t.instanceColor&&(r=fx(`vec3`,`vInstanceColor`).mul(r)),t.isBatchedMesh&&t._colorsTexture&&(r=fx(`vec3`,`vBatchColor`).mul(r)),px.assign(r);let i=this.opacityNode?G(this.opacityNode):ED;px.a.assign(px.a.mul(i));let a=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(a=this.alphaTestNode===null?SD:G(this.alphaTestNode),this.alphaToCoverage===!0?(px.a=PC(a,a.add(uC(px.a)),px.a),px.a.lessThanEqual(0).discard()):px.a.lessThanEqual(a).discard()),this.alphaHash===!0&&px.a.lessThan(lk(rE)).discard(),e.isOpaque()&&px.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Y(0):px.rgb}setupNormal(){return this.normalNode?Y(this.normalNode):PD}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?UE(`envMap`,`cubeTexture`):UE(`envMap`,`texture`)),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new RO(rO)),t}setupLights(e){let t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);let r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),this.aoNode!==null||e.material.aoMap){let e=this.aoNode===null?iO:this.aoNode;t.push(new IO(e))}let i=this.lightsNode||e.lightsNode;return t.length>0&&(i=e.renderer.lighting.createNode([...i.getLights(),...t])),i}setupLightingModel(){}setupLighting(e){let{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:i}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null,o=this.setupOutgoingLight(e);return a&&a.getScope().hasLights?o=LO(a,this.setupLightingModel(e)||null,n,r):n!==null&&(o=Y(r===null?n:AC(o,n,r))),(i&&i.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(mx.assign(Y(i||TD)),o=o.add(mx)),o}setupFog(e,t){let n=e.fogNode;return n&&(jx.assign(t),t=Zb(n.toVar())),t}setupPremultipliedAlpha(e,t){return _k(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(let t in e){let n=e[t];this[t]===void 0&&(this[t]=n,n&&n.clone&&(this[t]=n.clone()))}let t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(let e in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,e)===void 0&&t[e].get!==void 0&&Object.defineProperty(this.constructor.prototype,e,t[e])}toJSON(e){let t=e===void 0||typeof e==`string`;t&&(e={textures:{},images:{},nodes:{}});let n=Ar.prototype.toJSON.call(this,e);n.inputNodes={};for(let{property:t,childNode:r}of this._getNodeChildren())n.inputNodes[t]=r.toJSON(e).uuid;function r(e){let t=[];for(let n in e){let r=e[n];delete r.metadata,t.push(r)}return t}if(t){let t=r(e.textures),i=r(e.images),a=r(e.nodes);t.length>0&&(n.textures=t),i.length>0&&(n.images=i),a.length>0&&(n.nodes=a)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}},wk=new Oe,Tk=class extends Ck{static get type(){return`LineBasicNodeMaterial`}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(wk),this.setValues(e)}},Ek=new Dr,Dk=class extends Ck{static get type(){return`LineDashedNodeMaterial`}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(Ek),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){let e=this.offsetNode?G(this.offsetNode):eO,t=this.dashScaleNode?G(this.dashScaleNode):XD,n=this.dashSizeNode?G(this.dashSizeNode):ZD,r=this.gapSizeNode?G(this.gapSizeNode):QD;Mx.assign(n),Nx.assign(r);let i=nw(Jw(`lineDistance`).mul(t));(e?i.add(e):i).mod(Mx.add(Nx)).greaterThan(Mx).discard()}},Ok=null,kk=Fb(class extends BO{static get type(){return`ViewportSharedTextureNode`}constructor(e=_T,t=null){Ok===null&&(Ok=new cr),super(e,t,Ok)}getTextureForReference(){return Ok}updateReference(){return this}}).setParameterLength(0,2),Ak=e=>V(e).mul(.5).add(.5),jk=e=>V(e).mul(2).sub(1),Mk=new xr,Nk=class extends Ck{static get type(){return`MeshNormalNodeMaterial`}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Mk),this.setValues(e)}setupDiffuseColor(){let e=this.opacityNode?G(this.opacityNode):ED;px.assign(uw(Zb(Ak(_E),e),De))}},Pk=W(([e=oE])=>J(e.z.atan(e.x).mul(1/(Math.PI*2)).add(.5),e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5))),Fk=class extends he{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){let n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i=new ct(5,5,5),a=Pk(oE),o=new Ck;o.colorNode=tT(t,a,0),o.side=1,o.blending=0;let s=new tr(i,o),c=new Se;c.add(s),t.minFilter===1008&&(t.minFilter=Vt);let l=new Pe(1,10,this),u=e.getMRT();return e.setMRT(null),l.update(e,c),e.setMRT(u),t.minFilter=n,t.currentGenerateMipmaps=r,s.geometry.dispose(),s.material.dispose(),this}},Ik=new WeakMap,Lk=class extends Hy{static get type(){return`CubeMapNode`}constructor(e){super(`vec3`),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=IE(null);let t=new k;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Ay.RENDER}updateBefore(e){let{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){let e=r.isTextureNode?r.value:n[r.property];if(e&&e.isTexture){let n=e.mapping;if(n===303||n===304){if(Ik.has(e)){let t=Ik.get(e);Bk(t,e.mapping),this._cubeTexture=t}else{let n=e.image;if(Rk(n)){let r=new Fk(n.height);r.fromEquirectangularTexture(t,e),Bk(r.texture,e.mapping),this._cubeTexture=r.texture,Ik.set(e,r.texture),e.addEventListener(`dispose`,zk)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}};function Rk(e){return e==null?!1:e.height>0}function zk(e){let t=e.target;t.removeEventListener(`dispose`,zk);let n=Ik.get(t);n!==void 0&&(Ik.delete(t),n.dispose())}function Bk(e,t){t===303?e.mapping=301:t===304&&(e.mapping=302)}var Vk=Fb(Lk).setParameterLength(1),Hk=class extends FO{static get type(){return`BasicEnvironmentNode`}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=Vk(this.envNode)}},Uk=class extends FO{static get type(){return`BasicLightMapNode`}constructor(e=null){super(),this.lightMapNode=e}setup(e){let t=G(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}},Wk=class{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}},Gk=class extends Wk{constructor(){super()}indirect({context:e}){let t=e.ambientOcclusion,n=e.reflectedLight,r=e.irradianceLightMap;n.indirectDiffuse.assign(Zb(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign(Zb(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(px.rgb)}finish(e){let{material:t,context:n}=e,r=n.outgoingLight,i=e.context.environment;if(i)switch(t.combine){case 0:r.rgb.assign(AC(r.rgb,r.rgb.mul(i.rgb),AD.mul(jD)));break;case 1:r.rgb.assign(AC(r.rgb,i.rgb,AD.mul(jD)));break;case 2:r.rgb.addAssign(i.rgb.mul(AD.mul(jD)));break;default:P(`BasicLightingModel: Unsupported .combine value:`,t.combine);break}}},Kk=new Wr,qk=class extends Ck{static get type(){return`MeshBasicNodeMaterial`}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Kk),this.setValues(e)}setupNormal(){return dE(hE)}setupEnvironment(e){let t=super.setupEnvironment(e);return t?new Hk(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Uk(rO)),t}setupOutgoingLight(){return px.rgb}setupLightingModel(){return new Gk}},Jk=W(({f0:e,f90:t,dotVH:n})=>{let r=n.mul(-5.55473).sub(6.98316).mul(n).exp2();return e.mul(r.oneMinus()).add(t.mul(r))}),Yk=W(e=>e.diffuseColor.mul(1/Math.PI)),Xk=()=>G(.25),Zk=W(({dotNH:e})=>Ax.mul(G(.5)).add(1).mul(G(1/Math.PI)).mul(e.pow(Ax))),Qk=W(({lightDirection:e})=>{let t=e.add(cE).normalize(),n=_E.dot(t).clamp(),r=Jk({f0:Ox,f90:1,dotVH:cE.dot(t).clamp()}),i=Xk(),a=Zk({dotNH:n});return r.mul(i).mul(a)}),$k=class extends Gk{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){let r=_E.dot(e).clamp().mul(t);n.directDiffuse.addAssign(r.mul(Yk({diffuseColor:px.rgb}))),this.specular===!0&&n.directSpecular.addAssign(r.mul(Qk({lightDirection:e})).mul(AD))}indirect(e){let{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(Yk({diffuseColor:px}))),r.indirectDiffuse.mulAssign(t)}},eA=new gn,tA=class extends Ck{static get type(){return`MeshLambertNodeMaterial`}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(eA),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t?new Hk(t):null}setupLightingModel(){return new $k(!1)}},nA=new or,rA=class extends Ck{static get type(){return`MeshPhongNodeMaterial`}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(nA),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t?new Hk(t):null}setupLightingModel(){return new $k}setupVariants(){let e=(this.shininessNode?G(this.shininessNode):wD).max(1e-4);Ax.assign(e);let t=this.specularNode||DD;Ox.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}},iA=W(e=>{if(e.geometry.hasAttribute(`normal`)===!1)return G(0);let t=hE.dFdx().abs().max(hE.dFdy().abs());return t.x.max(t.y).max(t.z)}),aA=W(e=>{let{roughness:t}=e,n=iA(),r=t.max(.0525);return r=r.add(n),r=r.min(1),r}),oA=W(({alpha:e,dotNL:t,dotNV:n})=>{let r=e.pow2(),i=t.mul(r.add(r.oneMinus().mul(n.pow2())).sqrt()),a=n.mul(r.add(r.oneMinus().mul(t.pow2())).sqrt());return aS(.5,i.add(a).max(OS))}).setLayout({name:`V_GGX_SmithCorrelated`,type:`float`,inputs:[{name:`alpha`,type:`float`},{name:`dotNL`,type:`float`},{name:`dotNV`,type:`float`}]}),sA=W(({alphaT:e,alphaB:t,dotTV:n,dotBV:r,dotTL:i,dotBL:a,dotNV:o,dotNL:s})=>{let c=s.mul(Y(e.mul(n),t.mul(r),o).length()),l=o.mul(Y(e.mul(i),t.mul(a),s).length());return aS(.5,c.add(l)).saturate()}).setLayout({name:`V_GGX_SmithCorrelated_Anisotropic`,type:`float`,inputs:[{name:`alphaT`,type:`float`,qualifier:`in`},{name:`alphaB`,type:`float`,qualifier:`in`},{name:`dotTV`,type:`float`,qualifier:`in`},{name:`dotBV`,type:`float`,qualifier:`in`},{name:`dotTL`,type:`float`,qualifier:`in`},{name:`dotBL`,type:`float`,qualifier:`in`},{name:`dotNV`,type:`float`,qualifier:`in`},{name:`dotNL`,type:`float`,qualifier:`in`}]}),cA=W(({alpha:e,dotNH:t})=>{let n=e.pow2(),r=t.pow2().mul(n.oneMinus()).oneMinus();return n.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:`D_GGX`,type:`float`,inputs:[{name:`alpha`,type:`float`},{name:`dotNH`,type:`float`}]}),lA=G(1/Math.PI),uA=W(({alphaT:e,alphaB:t,dotNH:n,dotTH:r,dotBH:i})=>{let a=e.mul(t),o=Y(t.mul(r),e.mul(i),a.mul(n)),s=o.dot(o),c=a.div(s);return lA.mul(a.mul(c.pow2()))}).setLayout({name:`D_GGX_Anisotropic`,type:`float`,inputs:[{name:`alphaT`,type:`float`,qualifier:`in`},{name:`alphaB`,type:`float`,qualifier:`in`},{name:`dotNH`,type:`float`,qualifier:`in`},{name:`dotTH`,type:`float`,qualifier:`in`},{name:`dotBH`,type:`float`,qualifier:`in`}]}),dA=W(({lightDirection:e,f0:t,f90:n,roughness:r,f:i,normalView:a=_E,USE_IRIDESCENCE:o,USE_ANISOTROPY:s})=>{let c=r.pow2(),l=e.add(cE).normalize(),u=a.dot(e).clamp(),d=a.dot(cE).clamp(),f=a.dot(l).clamp(),p=Jk({f0:t,f90:n,dotVH:cE.dot(l).clamp()}),m,h;if(kb(o)&&(p=xx.mix(p,i)),kb(s)){let t=Ex.dot(e),n=Ex.dot(cE),r=Ex.dot(l),i=Dx.dot(e),a=Dx.dot(cE),o=Dx.dot(l);m=sA({alphaT:wx,alphaB:c,dotTV:n,dotBV:a,dotTL:t,dotBL:i,dotNV:d,dotNL:u}),h=uA({alphaT:wx,alphaB:c,dotNH:f,dotTH:r,dotBH:o})}else m=oA({alpha:c,dotNL:u,dotNV:d}),h=cA({alpha:c,dotNH:f});return p.mul(m).mul(h)}),fA=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]),pA=null,mA=W(({roughness:e,dotNV:t})=>{pA===null&&(pA=new ie(fA,32,32,Ve,_t),pA.minFilter=Vt,pA.magFilter=Vt,pA.wrapS=Jn,pA.wrapT=Jn,pA.generateMipmaps=!1,pA.needsUpdate=!0);let n=J(e,t);return tT(pA,n).rg}),hA=W(({lightDirection:e,f0:t,f90:n,roughness:r,f:i,USE_IRIDESCENCE:a,USE_ANISOTROPY:o})=>{let s=dA({lightDirection:e,f0:t,f90:n,roughness:r,f:i,USE_IRIDESCENCE:a,USE_ANISOTROPY:o}),c=_E.dot(e).clamp(),l=mA({roughness:r,dotNV:_E.dot(cE).clamp()}),u=mA({roughness:r,dotNV:c}),d=t.mul(l.x).add(n.mul(l.y)),f=t.mul(u.x).add(n.mul(u.y)),p=l.x.add(l.y),m=u.x.add(u.y),h=G(1).sub(p),g=G(1).sub(m),_=t.add(t.oneMinus().mul(.047619)),v=d.mul(f).mul(_).div(G(1).sub(h.mul(g).mul(_).mul(_)).add(OS)),y=h.mul(g),b=v.mul(y);return s.add(b)}),gA=W(e=>{let{dotNV:t,specularColor:n,specularF90:r,roughness:i}=e,a=mA({dotNV:t,roughness:i});return n.mul(a.x).add(r.mul(a.y))}),_A=W(({f:e,f90:t,dotVH:n})=>{let r=n.oneMinus().saturate(),i=r.mul(r),a=r.mul(i,i).clamp(0,.9999);return e.sub(Y(t).mul(a)).div(a.oneMinus())}).setLayout({name:`Schlick_to_F0`,type:`vec3`,inputs:[{name:`f`,type:`vec3`},{name:`f90`,type:`float`},{name:`dotVH`,type:`float`}]}),vA=W(({roughness:e,dotNH:t})=>{let n=e.pow2(),r=G(1).div(n),i=t.pow2().oneMinus().max(.0078125);return G(2).add(r).mul(i.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:`D_Charlie`,type:`float`,inputs:[{name:`roughness`,type:`float`},{name:`dotNH`,type:`float`}]}),yA=W(({dotNV:e,dotNL:t})=>G(1).div(G(4).mul(t.add(e).sub(t.mul(e))))).setLayout({name:`V_Neubelt`,type:`float`,inputs:[{name:`dotNV`,type:`float`},{name:`dotNL`,type:`float`}]}),bA=W(({lightDirection:e})=>{let t=e.add(cE).normalize(),n=_E.dot(e).clamp(),r=_E.dot(cE).clamp(),i=vA({roughness:bx,dotNH:_E.dot(t).clamp()}),a=yA({dotNV:r,dotNL:n});return yx.mul(i).mul(a)}),xA=W(({N:e,V:t,roughness:n})=>{let r=J(n,e.dot(t).saturate().oneMinus().sqrt());return r.assign(r.mul(.984375).add(.0078125)),r}).setLayout({name:`LTC_Uv`,type:`vec2`,inputs:[{name:`N`,type:`vec3`},{name:`V`,type:`vec3`},{name:`roughness`,type:`float`}]}),SA=W(({f:e})=>{let t=e.length();return gC(t.mul(t).add(e.z).div(t.add(1)),0)}).setLayout({name:`LTC_ClippedSphereFormFactor`,type:`float`,inputs:[{name:`f`,type:`vec3`}]}),CA=W(({v1:e,v2:t})=>{let n=e.dot(t),r=n.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),a=r.add(4.1616724).mul(r).add(3.417594).toVar(),o=i.div(a),s=n.greaterThan(0).select(o,gC(n.mul(n).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return e.cross(t).mul(s)}).setLayout({name:`LTC_EdgeVectorFormFactor`,type:`vec3`,inputs:[{name:`v1`,type:`vec3`},{name:`v2`,type:`vec3`}]}),wA=W(({N:e,V:t,P:n,mInv:r,p0:i,p1:a,p2:o,p3:s})=>{let c=a.sub(i).toVar(),l=s.sub(i).toVar(),u=c.cross(l),d=Y().toVar();return Bb(u.dot(n.sub(i)).greaterThanEqual(0),()=>{let c=t.sub(e.mul(t.dot(e))).normalize(),l=e.cross(c).negate(),u=r.mul(nx(c,l,e).transpose()).toVar(),f=u.mul(i.sub(n)).normalize().toVar(),p=u.mul(a.sub(n)).normalize().toVar(),m=u.mul(o.sub(n)).normalize().toVar(),h=u.mul(s.sub(n)).normalize().toVar(),g=Y(0).toVar();g.addAssign(CA({v1:f,v2:p})),g.addAssign(CA({v1:p,v2:m})),g.addAssign(CA({v1:m,v2:h})),g.addAssign(CA({v1:h,v2:f})),d.assign(Y(SA({f:g})))}),d}).setLayout({name:`LTC_Evaluate`,type:`vec3`,inputs:[{name:`N`,type:`vec3`},{name:`V`,type:`vec3`},{name:`P`,type:`vec3`},{name:`mInv`,type:`mat3`},{name:`p0`,type:`vec3`},{name:`p1`,type:`vec3`},{name:`p2`,type:`vec3`},{name:`p3`,type:`vec3`}]}),TA=1/6,EA=e=>iS(TA,iS(e,iS(e,e.negate().add(3)).sub(3)).add(1)),DA=e=>iS(TA,iS(e,iS(e,iS(3,e).sub(6))).add(4)),OA=e=>iS(TA,iS(e,iS(e,iS(-3,e).add(3)).add(3)).add(1)),kA=e=>iS(TA,CC(e,3)),AA=e=>EA(e).add(DA(e)),jA=e=>OA(e).add(kA(e)),MA=e=>nS(-1,DA(e).div(EA(e).add(DA(e)))),NA=e=>nS(1,kA(e).div(OA(e).add(kA(e)))),PA=(e,t,n)=>{let r=e.uvNode,i=iS(r,t.zw).add(.5),a=WS(i),o=qS(i),s=AA(o.x),c=jA(o.x),l=MA(o.x),u=NA(o.x),d=MA(o.y),f=NA(o.y),p=J(a.x.add(l),a.y.add(d)).sub(.5).mul(t.xy),m=J(a.x.add(u),a.y.add(d)).sub(.5).mul(t.xy),h=J(a.x.add(l),a.y.add(f)).sub(.5).mul(t.xy),g=J(a.x.add(u),a.y.add(f)).sub(.5).mul(t.xy),_=AA(o.y).mul(nS(s.mul(e.sample(p).level(n)),c.mul(e.sample(m).level(n)))),v=jA(o.y).mul(nS(s.mul(e.sample(h).level(n)),c.mul(e.sample(g).level(n))));return _.add(v)},FA=W(([e,t])=>{let n=J(e.size(K(t))),r=J(e.size(K(t.add(1)))),i=aS(1,n),a=aS(1,r),o=PA(e,Zb(i,n),WS(t)),s=PA(e,Zb(a,r),GS(t));return qS(t).mix(o,s)}),IA=W(([e,t])=>FA(e,t.mul(Zw(e)))),LA=W(([e,t,n,r,i])=>{let a=Y(NC(t.negate(),KS(e),aS(1,r))),o=Y(nC(i[0].xyz),nC(i[1].xyz),nC(i[2].xyz));return KS(a).mul(n.mul(o))}).setLayout({name:`getVolumeTransmissionRay`,type:`vec3`,inputs:[{name:`n`,type:`vec3`},{name:`v`,type:`vec3`},{name:`thickness`,type:`float`},{name:`ior`,type:`float`},{name:`modelMatrix`,type:`mat4`}]}),RA=W(([e,t])=>e.mul(jC(t.mul(2).sub(2),0,1))).setLayout({name:`applyIorToRoughness`,type:`float`,inputs:[{name:`roughness`,type:`float`},{name:`ior`,type:`float`}]}),zA=HO(),BA=HO(),VA=W(([e,t,n],{material:r})=>FA((r.side===1?zA:BA).sample(e),VS(vT.x).mul(RA(t,n)))),HA=W(([e,t,n])=>(Bb(n.notEqual(0),()=>RS(BS(t).negate().div(n).negate().mul(e))),Y(1))).setLayout({name:`volumeAttenuation`,type:`vec3`,inputs:[{name:`transmissionDistance`,type:`float`},{name:`attenuationColor`,type:`vec3`},{name:`attenuationDistance`,type:`float`}]}),UA=W(([e,t,n,r,i,a,o,s,c,l,u,d,f,p,m])=>{let h,g;if(m){h=Zb().toVar(),g=Y().toVar();let i=u.sub(1).mul(m.mul(.025)),a=Y(u.sub(i),u,u.add(i));DO({start:0,end:3},({i})=>{let u=a.element(i),m=LA(e,t,d,u,s),_=o.add(m),v=l.mul(c.mul(Zb(_,1))),y=J(v.xy.div(v.w)).toVar();y.addAssign(1),y.divAssign(2),y.assign(J(y.x,y.y.oneMinus()));let b=VA(y,n,u);h.element(i).assign(b.element(i)),h.a.addAssign(b.a),g.element(i).assign(r.element(i).mul(HA(nC(m),f,p).element(i)))}),h.a.divAssign(3)}else{let i=LA(e,t,d,u,s),a=o.add(i),m=l.mul(c.mul(Zb(a,1))),_=J(m.xy.div(m.w)).toVar();_.addAssign(1),_.divAssign(2),_.assign(J(_.x,_.y.oneMinus())),h=VA(_,n,u),g=r.mul(HA(nC(i),f,p))}let _=g.rgb.mul(h.rgb),v=Y(gA({dotNV:e.dot(t).clamp(),specularColor:i,specularF90:a,roughness:n})),y=g.r.add(g.g,g.b).div(3);return Zb(v.oneMinus().mul(_),h.a.oneMinus().mul(y).oneMinus())}),WA=nx(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),GA=e=>{let t=e.sqrt();return Y(1).add(t).div(Y(1).sub(t))},KA=(e,t)=>e.sub(t).div(e.add(t)).pow2(),qA=(e,t)=>{let n=e.mul(2*Math.PI*1e-9),r=Y(54856e-17,44201e-17,52481e-17),i=Y(1681e3,1795300,2208400),a=Y(43278e5,93046e5,66121e5),o=G(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(n.mul(2239900).add(t.x).cos()).mul(n.pow2().mul(-45282e5).exp()),s=r.mul(a.mul(2*Math.PI).sqrt()).mul(i.mul(n).add(t).cos()).mul(n.pow2().negate().mul(a).exp());return s=Y(s.x.add(o),s.y,s.z).div(1.0685e-7),WA.mul(s)},JA=W(({outsideIOR:e,eta2:t,cosTheta1:n,thinFilmThickness:r,baseF0:i})=>{let a=AC(e,t,PC(0,.03,r)),o=e.div(a).pow2().mul(n.pow2().oneMinus()).oneMinus();Bb(o.lessThan(0),()=>Y(1));let s=o.sqrt(),c=Jk({f0:KA(a,e),f90:1,dotVH:n}),l=c.oneMinus(),u=a.lessThan(e).select(Math.PI,0),d=G(Math.PI).sub(u),f=GA(i.clamp(0,.9999)),p=Jk({f0:KA(f,a.toVec3()),f90:1,dotVH:s}),m=Y(f.x.lessThan(a).select(Math.PI,0),f.y.lessThan(a).select(Math.PI,0),f.z.lessThan(a).select(Math.PI,0)),h=a.mul(r,s,2),g=Y(d).add(m),_=c.mul(p).clamp(1e-5,.9999),v=_.sqrt(),y=l.pow2().mul(p).div(Y(1).sub(_)),b=c.add(y).toVar(),x=y.sub(l).toVar();return DO({start:1,end:2,condition:`<=`,name:`m`},({m:e})=>{x.mulAssign(v);let t=qA(G(e).mul(h),G(e).mul(g)).mul(2);b.addAssign(x.mul(t))}),b.max(Y(0))}).setLayout({name:`evalIridescence`,type:`vec3`,inputs:[{name:`outsideIOR`,type:`float`},{name:`eta2`,type:`float`},{name:`cosTheta1`,type:`float`},{name:`thinFilmThickness`,type:`float`},{name:`baseF0`,type:`vec3`}]}),YA=W(({normal:e,viewDir:t,roughness:n})=>{let r=e.dot(t).saturate(),i=n.pow2(),a=UC(n.lessThan(.25),G(-339.2).mul(i).add(G(161.4).mul(n)).sub(25.9),G(-8.48).mul(i).add(G(14.3).mul(n)).sub(9.95)),o=UC(n.lessThan(.25),G(44).mul(i).sub(G(23.7).mul(n)).add(3.26),G(1.97).mul(i).sub(G(3.27).mul(n)).add(.72));return UC(n.lessThan(.25),0,G(.1).mul(n).sub(.025)).add(a.mul(r).add(o).exp()).mul(1/Math.PI).saturate()}),XA=Y(.04),ZA=G(1),QA=class extends Wk{constructor(e=!1,t=!1,n=!1,r=!1,i=!1,a=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=r,this.transmission=i,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Y().toVar(`clearcoatRadiance`),this.clearcoatSpecularDirect=Y().toVar(`clearcoatSpecularDirect`),this.clearcoatSpecularIndirect=Y().toVar(`clearcoatSpecularIndirect`)),this.sheen===!0&&(this.sheenSpecularDirect=Y().toVar(`sheenSpecularDirect`),this.sheenSpecularIndirect=Y().toVar(`sheenSpecularIndirect`)),this.iridescence===!0){let e=_E.dot(cE).clamp();this.iridescenceFresnel=JA({outsideIOR:G(1),eta2:Sx,cosTheta1:e,thinFilmThickness:Cx,baseF0:Ox}),this.iridescenceF0=_A({f:this.iridescenceFresnel,f90:1,dotVH:e})}if(this.transmission===!0){let t=aE,n=NT.sub(aE).normalize(),r=vE,i=e.context;i.backdrop=UA(r,n,hx,px,Ox,kx,t,GT,AT,OT,Fx,Lx,zx,Rx,this.dispersion?Bx:null),i.backdropAlpha=Ix,px.a.mulAssign(AC(1,i.backdrop.a,Ix))}super.start(e)}computeMultiscattering(e,t,n){let r=mA({roughness:hx,dotNV:_E.dot(cE).clamp()}),i=this.iridescenceF0?xx.mix(Ox,this.iridescenceF0):Ox,a=i.mul(r.x).add(n.mul(r.y)),o=r.x.add(r.y).oneMinus(),s=i.add(i.oneMinus().mul(.047619)),c=a.mul(s).div(o.mul(s).oneMinus());e.addAssign(a),t.addAssign(c.mul(o))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){let r=_E.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(r.mul(bA({lightDirection:e}))),this.clearcoat===!0){let n=yE.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(n.mul(dA({lightDirection:e,f0:XA,f90:ZA,roughness:vx,normalView:yE})))}n.directDiffuse.addAssign(r.mul(Yk({diffuseColor:px.rgb}))),n.directSpecular.addAssign(r.mul(hA({lightDirection:e,f0:Ox,f90:1,roughness:hx,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:r,reflectedLight:i,ltc_1:a,ltc_2:o}){let s=t.add(n).sub(r),c=t.sub(n).sub(r),l=t.sub(n).add(r),u=t.add(n).add(r),d=_E,f=cE,p=sE.toVar(),m=xA({N:d,V:f,roughness:hx}),h=a.sample(m).toVar(),g=o.sample(m).toVar(),_=nx(Y(h.x,0,h.y),Y(0,1,0),Y(h.z,0,h.w)).toVar(),v=Ox.mul(g.x).add(Ox.oneMinus().mul(g.y)).toVar();i.directSpecular.addAssign(e.mul(v).mul(wA({N:d,V:f,P:p,mInv:_,p0:s,p1:c,p2:l,p3:u}))),i.directDiffuse.addAssign(e.mul(px).mul(wA({N:d,V:f,P:p,mInv:nx(1,0,0,0,1,0,0,0,1),p0:s,p1:c,p2:l,p3:u})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){let{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul(Yk({diffuseColor:px})))}indirectSpecular(e){let{radiance:t,iblIrradiance:n,reflectedLight:r}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(yx,YA({normal:_E,viewDir:cE,roughness:bx}))),this.clearcoat===!0){let e=gA({dotNV:yE.dot(cE).clamp(),specularColor:XA,specularF90:ZA,roughness:vx});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(e))}let i=Y().toVar(`singleScattering`),a=Y().toVar(`multiScattering`),o=n.mul(1/Math.PI);this.computeMultiscattering(i,a,kx);let s=i.add(a),c=px.mul(s.r.max(s.g).max(s.b).oneMinus());r.indirectSpecular.addAssign(t.mul(i)),r.indirectSpecular.addAssign(a.mul(o)),r.indirectDiffuse.addAssign(c.mul(o))}ambientOcclusion(e){let{ambientOcclusion:t,reflectedLight:n}=e.context,r=_E.dot(cE).clamp().add(t),i=hx.mul(-16).oneMinus().negate().exp2(),a=t.sub(r.pow(i).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(a)}finish({context:e}){let{outgoingLight:t}=e;if(this.clearcoat===!0){let e=Jk({dotVH:yE.dot(cE).clamp(),f0:XA,f90:ZA}),n=t.mul(_x.mul(e).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(_x));t.assign(n)}if(this.sheen===!0){let e=yx.r.max(yx.g).max(yx.b).mul(.157).oneMinus(),n=t.mul(e).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(n)}}},$A=G(1),ej=G(-2),tj=G(.8),nj=G(-1),rj=G(.4),ij=G(2),aj=G(.305),oj=G(3),sj=G(.21),cj=G(4),lj=G(4),uj=G(16),dj=W(([e])=>{let t=Y(eC(e)).toVar(),n=G(-1).toVar();return Bb(t.x.greaterThan(t.z),()=>{Bb(t.x.greaterThan(t.y),()=>{n.assign(UC(e.x.greaterThan(0),0,3))}).Else(()=>{n.assign(UC(e.y.greaterThan(0),1,4))})}).Else(()=>{Bb(t.z.greaterThan(t.y),()=>{n.assign(UC(e.z.greaterThan(0),2,5))}).Else(()=>{n.assign(UC(e.y.greaterThan(0),1,4))})}),n}).setLayout({name:`getFace`,type:`float`,inputs:[{name:`direction`,type:`vec3`}]}),fj=W(([e,t])=>{let n=J().toVar();return Bb(t.equal(0),()=>{n.assign(J(e.z,e.y).div(eC(e.x)))}).ElseIf(t.equal(1),()=>{n.assign(J(e.x.negate(),e.z.negate()).div(eC(e.y)))}).ElseIf(t.equal(2),()=>{n.assign(J(e.x.negate(),e.y).div(eC(e.z)))}).ElseIf(t.equal(3),()=>{n.assign(J(e.z.negate(),e.y).div(eC(e.x)))}).ElseIf(t.equal(4),()=>{n.assign(J(e.x.negate(),e.z).div(eC(e.y)))}).Else(()=>{n.assign(J(e.x,e.y).div(eC(e.z)))}),iS(.5,n.add(1))}).setLayout({name:`getUV`,type:`vec2`,inputs:[{name:`direction`,type:`vec3`},{name:`face`,type:`float`}]}),pj=W(([e])=>{let t=G(0).toVar();return Bb(e.greaterThanEqual(tj),()=>{t.assign($A.sub(e).mul(nj.sub(ej)).div($A.sub(tj)).add(ej))}).ElseIf(e.greaterThanEqual(rj),()=>{t.assign(tj.sub(e).mul(ij.sub(nj)).div(tj.sub(rj)).add(nj))}).ElseIf(e.greaterThanEqual(aj),()=>{t.assign(rj.sub(e).mul(oj.sub(ij)).div(rj.sub(aj)).add(ij))}).ElseIf(e.greaterThanEqual(sj),()=>{t.assign(aj.sub(e).mul(cj.sub(oj)).div(aj.sub(sj)).add(oj))}).Else(()=>{t.assign(G(-2).mul(VS(iS(1.16,e))))}),t}).setLayout({name:`roughnessToMip`,type:`float`,inputs:[{name:`roughness`,type:`float`}]}),mj=W(([e,t])=>{let n=e.toVar();n.assign(iS(2,n).sub(1));let r=Y(n,1).toVar();return Bb(t.equal(0),()=>{r.assign(r.zyx)}).ElseIf(t.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(t.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(t.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(t.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(t.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:`getDirection`,type:`vec3`,inputs:[{name:`uv`,type:`vec2`},{name:`face`,type:`float`}]}),hj=W(([e,t,n,r,i,a])=>{let o=G(n),s=Y(t),c=jC(pj(o),ej,a),l=qS(c),u=WS(c),d=Y(gj(e,s,u,r,i,a)).toVar();return Bb(l.notEqual(0),()=>{let t=Y(gj(e,s,u.add(1),r,i,a)).toVar();d.assign(AC(d,t,l))}),d}),gj=W(([e,t,n,r,i,a])=>{let o=G(n).toVar(),s=Y(t),c=G(dj(s)).toVar(),l=G(gC(lj.sub(o),0)).toVar();o.assign(gC(o,lj));let u=G(zS(o)).toVar(),d=J(fj(s,c).mul(u.sub(2)).add(1)).toVar();return Bb(c.greaterThan(2),()=>{d.y.addAssign(u),c.subAssign(3)}),d.x.addAssign(c.mul(u)),d.x.addAssign(l.mul(iS(3,uj))),d.y.addAssign(iS(4,zS(a).sub(u))),d.x.mulAssign(r),d.y.mulAssign(i),e.sample(d).grad(J(),J())}),_j=W(({envMap:e,mipInt:t,outputDirection:n,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:s})=>{let c=YS(r);return gj(e,n.mul(c).add(i.cross(n).mul(JS(r))).add(i.mul(i.dot(n).mul(c.oneMinus()))),t,a,o,s)}),vj=W(({n:e,latitudinal:t,poleAxis:n,outputDirection:r,weights:i,samples:a,dTheta:o,mipInt:s,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})=>{let f=Y(UC(t,n,SC(n,r))).toVar();Bb(f.equal(Y(0)),()=>{f.assign(Y(r.z,0,r.x.negate()))}),f.assign(KS(f));let p=Y().toVar();return p.addAssign(i.element(0).mul(_j({theta:0,axis:f,outputDirection:r,mipInt:s,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),DO({start:K(1),end:e},({i:e})=>{Bb(e.greaterThanEqual(a),()=>{kO()});let t=G(o.mul(G(e))).toVar();p.addAssign(i.element(e).mul(_j({theta:t.mul(-1),axis:f,outputDirection:r,mipInt:s,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),p.addAssign(i.element(e).mul(_j({theta:t,axis:f,outputDirection:r,mipInt:s,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})))}),Zb(p,1)}),yj=W(([e])=>{let t=q(e).toVar();return t.assign(t.shiftLeft(q(16)).bitOr(t.shiftRight(q(16)))),t.assign(t.bitAnd(q(1431655765)).shiftLeft(q(1)).bitOr(t.bitAnd(q(2863311530)).shiftRight(q(1)))),t.assign(t.bitAnd(q(858993459)).shiftLeft(q(2)).bitOr(t.bitAnd(q(3435973836)).shiftRight(q(2)))),t.assign(t.bitAnd(q(252645135)).shiftLeft(q(4)).bitOr(t.bitAnd(q(4042322160)).shiftRight(q(4)))),t.assign(t.bitAnd(q(16711935)).shiftLeft(q(8)).bitOr(t.bitAnd(q(4278255360)).shiftRight(q(8)))),G(t).mul(23283064365386963e-26)}),bj=W(([e,t])=>J(G(e).div(G(t)),yj(e))),xj=W(([e,t,n])=>{let r=Y(t).toVar(),i=G(n),a=i.mul(i).toVar(),o=KS(Y(a.mul(r.x),a.mul(r.y),r.z)).toVar(),s=o.x.mul(o.x).add(o.y.mul(o.y)),c=UC(s.greaterThan(0),Y(o.y.negate(),o.x,0).div(HS(s)),Y(1,0,0)).toVar(),l=SC(o,c).toVar(),u=HS(e.x),d=iS(2,3.14159265359).mul(e.y),f=u.mul(YS(d)).toVar(),p=u.mul(JS(d)).toVar(),m=iS(.5,o.z.add(1));p.assign(m.oneMinus().mul(HS(f.mul(f).oneMinus())).add(m.mul(p)));let h=c.mul(f).add(l.mul(p)).add(o.mul(HS(gC(0,f.mul(f).add(p.mul(p)).oneMinus()))));return KS(Y(a.mul(h.x),a.mul(h.y),gC(0,h.z)))}),Sj=W(({roughness:e,mipInt:t,envMap:n,N_immutable:r,GGX_SAMPLES:i,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:s})=>{let c=Y(r).toVar(),l=Y(0).toVar(),u=G(0).toVar();return Bb(e.lessThan(.001),()=>{l.assign(gj(n,c,t,a,o,s))}).Else(()=>{let r=KS(SC(UC(eC(c.z).lessThan(.999),Y(0,0,1),Y(1,0,0)),c)).toVar(),d=SC(c,r).toVar();DO({start:q(0),end:i},({i:f})=>{let p=xj(bj(f,i),Y(0,0,1),e),m=KS(r.mul(p.x).add(d.mul(p.y)).add(c.mul(p.z))),h=KS(m.mul(xC(c,m).mul(2)).sub(c)),g=gC(xC(c,h),0);Bb(g.greaterThan(0),()=>{let e=gj(n,h,t,a,o,s);l.addAssign(e.mul(g)),u.addAssign(g)})}),Bb(u.greaterThan(0),()=>{l.assign(l.div(u))})}),Zb(l,1)}),Cj=4,wj=[.125,.215,.35,.446,.526,.582],Tj=20,Ej=512,Dj=new kt(-1,1,1,-1,0,1),Oj=new Ee(90,1),kj=new a,Aj=null,jj=0,Mj=0,Nj=new j,Pj=new WeakMap,Fj=[3,1,5,0,4,2],Ij=mj(Yw(),Jw(`faceIndex`)).normalize(),Lj=Y(Ij.x,Ij.y,Ij.z),Rj=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,r=100,i={}){let{size:a=256,position:o=Nj,renderTarget:s=null}=i;if(this._setSize(a),this._hasInitialized===!1){P(`PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.`);let a=s||this._allocateTarget();return i.renderTarget=a,this.fromSceneAsync(e,t,n,r,i),a}Aj=this._renderer.getRenderTarget(),jj=this._renderer.getActiveCubeFace(),Mj=this._renderer.getActiveMipmapLevel();let c=s||this._allocateTarget();return c.depthBuffer=!0,this._init(c),this._sceneToCubeUV(e,n,r,c,o),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}async fromSceneAsync(e,t=0,n=.1,r=100,i={}){return be(`PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.`),await this._renderer.init(),this.fromScene(e,t,n,r,i)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){P(`PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.`),this._setSizeFromTexture(e);let n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return be(`PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.`),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){P(`PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead.`),this._setSizeFromTexture(e);let n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return be(`PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.`),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Gj(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Kj(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===301||e.mapping===302?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=2**this._lodMax}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(Aj,jj,Mj),e.scissorTest=!1,Vj(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),Aj=this._renderer.getRenderTarget(),jj=this._renderer.getActiveCubeFace(),Mj=this._renderer.getActiveMipmapLevel();let n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){return Bj(3*Math.max(this._cubeSize,112),4*this._cubeSize)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Bj(e.width,e.height);let{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=zj(t)),this._blurMaterial=Uj(t,e.width,e.height),this._ggxMaterial=Wj(t,e.width,e.height)}}async _compileMaterial(e){let t=new tr(new Xr,e);await this._renderer.compile(t,Dj)}_sceneToCubeUV(e,t,n,r,i){let a=Oj;a.near=t,a.far=n;let o=[1,1,1,1,-1,1],s=[1,-1,1,-1,1,-1],c=this._renderer,l=c.autoClear;c.getClearColor(kj),c.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new tr(new ct,new Wr({name:`PMREM.Background`,side:1,depthWrite:!1,depthTest:!1})));let u=this._backgroundBox,d=u.material,f=!1,p=e.background;p?p.isColor&&(d.color.copy(p),e.background=null,f=!0):(d.color.copy(kj),f=!0),c.setRenderTarget(r),c.clear(),f&&c.render(u,a);for(let t=0;t<6;t++){let n=t%3;n===0?(a.up.set(0,o[t],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x+s[t],i.y,i.z)):n===1?(a.up.set(0,0,o[t]),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y+s[t],i.z)):(a.up.set(0,o[t],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y,i.z+s[t]));let l=this._cubeSize;Vj(r,n*l,t>2?l:0,l,l),c.render(e,a)}c.autoClear=l,e.background=p}_textureToCubeUV(e,t){let n=this._renderer,r=e.mapping===301||e.mapping===302;r?this._cubemapMaterial===null&&(this._cubemapMaterial=Gj(e)):this._equirectMaterial===null&&(this._equirectMaterial=Kj(e));let i=r?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=e;let a=this._lodMeshes[0];a.material=i;let o=this._cubeSize;Vj(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,Dj)}_applyPMREM(e){let t=this._renderer,n=t.autoClear;t.autoClear=!1;let r=this._lodMeshes.length;for(let t=1;t<r;t++)this._applyGGXFilter(e,t-1,t);t.autoClear=n}_applyGGXFilter(e,t,n){let r=this._renderer,i=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[n];o.material=a;let s=Pj.get(a),c=n/(this._lodMeshes.length-1),l=t/(this._lodMeshes.length-1),u=Math.sqrt(c*c-l*l)*(.05+c*.95),{_lodMax:d}=this,f=this._sizeLods[n],p=3*f*(n>d-Cj?n-d+Cj:0),m=4*(this._cubeSize-f);e.texture.frame=(e.texture.frame||0)+1,s.envMap.value=e.texture,s.roughness.value=u,s.mipInt.value=d-t,Vj(i,p,m,3*f,2*f),r.setRenderTarget(i),r.render(o,Dj),i.texture.frame=(i.texture.frame||0)+1,s.envMap.value=i.texture,s.roughness.value=0,s.mipInt.value=d-n,Vj(e,p,m,3*f,2*f),r.setRenderTarget(e),r.render(o,Dj)}_blur(e,t,n,r,i){let a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,`latitudinal`,i),this._halfBlur(a,e,n,n,r,`longitudinal`,i)}_halfBlur(e,t,n,r,i,a,o){let s=this._renderer,c=this._blurMaterial;a!==`latitudinal`&&a!==`longitudinal`&&N(`blur direction must be either latitudinal or longitudinal!`);let l=this._lodMeshes[r];l.material=c;let u=Pj.get(c),d=this._sizeLods[n]-1,f=isFinite(i)?Math.PI/(2*d):2*Math.PI/(2*Tj-1),p=i/f,m=isFinite(i)?1+Math.floor(3*p):Tj;m>Tj&&P(`sigmaRadians, ${i}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Tj}`);let h=[],g=0;for(let e=0;e<Tj;++e){let t=e/p,n=Math.exp(-t*t/2);h.push(n),e===0?g+=n:e<m&&(g+=2*n)}for(let e=0;e<h.length;e++)h[e]=h[e]/g;e.texture.frame=(e.texture.frame||0)+1,u.envMap.value=e.texture,u.samples.value=m,u.weights.array=h,u.latitudinal.value=a===`latitudinal`?1:0,o&&(u.poleAxis.value=o);let{_lodMax:_}=this;u.dTheta.value=f,u.mipInt.value=_-n;let v=this._sizeLods[r];Vj(t,3*v*(r>_-Cj?r-_+Cj:0),4*(this._cubeSize-v),3*v,2*v),s.setRenderTarget(t),s.render(l,Dj)}};function zj(e){let t=[],n=[],r=[],i=e,a=e-Cj+1+wj.length;for(let o=0;o<a;o++){let a=2**i;t.push(a);let s=1/a;o>e-Cj?s=wj[o-e+Cj-1]:o===0&&(s=0),n.push(s);let c=1/(a-2),l=-c,u=1+c,d=[l,l,u,l,u,u,l,l,u,u,l,u],f=new Float32Array(108),p=new Float32Array(72),m=new Float32Array(36);for(let e=0;e<6;e++){let t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0],i=Fj[e];f.set(r,18*i),p.set(d,12*i);let a=[i,i,i,i,i,i];m.set(a,6*i)}let g=new Xr;g.setAttribute(`position`,new h(f,3)),g.setAttribute(`uv`,new h(p,2)),g.setAttribute(`faceIndex`,new h(m,1)),r.push(new tr(g,null)),i>Cj&&i--}return{lodMeshes:r,sizeLods:t,sigmas:n}}function Bj(e,t){let n=new p(e,t,{magFilter:Vt,minFilter:Vt,generateMipmaps:!1,type:_t,format:jr,colorSpace:i});return n.texture.mapping=306,n.texture.name=`PMREM.cubeUv`,n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function Vj(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Hj(e){let t=new Ck;return t.depthTest=!1,t.depthWrite=!1,t.blending=0,t.name=`PMREM_${e}`,t}function Uj(e,t,n){let r=dT(Array(Tj).fill(0)),i=Jx(new j(0,1,0)),a=Jx(0),o=G(Tj),s=Jx(0),c={n:o,latitudinal:s,weights:r,poleAxis:i,outputDirection:Lj,dTheta:a,samples:Jx(1),envMap:tT(),mipInt:Jx(0),CUBEUV_TEXEL_WIDTH:G(1/t),CUBEUV_TEXEL_HEIGHT:G(1/n),CUBEUV_MAX_MIP:G(e)},l=Hj(`blur`);return l.fragmentNode=vj({...c,latitudinal:s.equal(1)}),Pj.set(l,c),l}function Wj(e,t,n){let r={envMap:tT(),roughness:Jx(0),mipInt:Jx(0),CUBEUV_TEXEL_WIDTH:G(1/t),CUBEUV_TEXEL_HEIGHT:G(1/n),CUBEUV_MAX_MIP:G(e)},i=Hj(`ggx`);return i.fragmentNode=Sj({...r,N_immutable:Lj,GGX_SAMPLES:q(Ej)}),Pj.set(i,r),i}function Gj(e){let t=Hj(`cubemap`);return t.fragmentNode=IE(e,Lj),t}function Kj(e){let t=Hj(`equirect`);return t.fragmentNode=tT(e,Pk(Lj),0),t}var qj=new WeakMap;function Jj(e){let t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(2**t,112)),texelHeight:n,maxMip:t}}function Yj(e,t,n){let r=Xj(t),i=r.get(e);if((i===void 0?-1:i.pmremVersion)!==e.pmremVersion){let t=e.image;if(e.isCubeTexture)if(Qj(t))i=n.fromCubemap(e,i);else return null;else if($j(t))i=n.fromEquirectangular(e,i);else return null;i.pmremVersion=e.pmremVersion,r.set(e,i)}return i.texture}function Xj(e){let t=qj.get(e);return t===void 0&&(t=new WeakMap,qj.set(e,t)),t}var Zj=class extends Hy{static get type(){return`PMREMNode`}constructor(e,t=null,n=null){super(`vec3`),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;let r=new wn;r.isRenderTargetTexture=!0,this._texture=tT(r),this._width=Jx(0),this._height=Jx(0),this._maxMip=Jx(0),this.updateBeforeType=Ay.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){let t=Jj(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem,n=t?t.pmremVersion:-1,r=this._value;n!==r.pmremVersion&&(t=r.isPMREMTexture===!0?r:Yj(r,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new Rj(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=kE.mul(Y(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),hj(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}};function Qj(e){if(e==null)return!1;let t=0;for(let n=0;n<6;n++)e[n]!==void 0&&t++;return t===6}function $j(e){return e==null?!1:e.height>0}var eM=Fb(Zj).setParameterLength(1,3),tM=new WeakMap,nM=class extends FO{static get type(){return`EnvironmentNode`}constructor(e=null){super(),this.envNode=e}setup(e){let{material:t}=e,n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){let e=n.isTextureNode?n.value:t[n.property],r=tM.get(e);r===void 0&&(r=eM(e),tM.set(e,r)),n=r}let r=t.useAnisotropy===!0||t.anisotropy>0?gD:_E,i=n.context(rM(hx,r)).mul(OE),a=n.context(iM(vE)).mul(Math.PI).mul(OE),o=kw(i),s=kw(a);e.context.radiance.addAssign(o),e.context.iblIrradiance.addAssign(s);let c=e.context.lightingModel.clearcoatRadiance;if(c){let e=kw(n.context(rM(vx,yE)).mul(OE));c.addAssign(e)}}},rM=(e,t)=>{let n=null;return{getUV:()=>(n===null&&(n=cE.negate().reflect(t),n=EC(e).mix(n,t).normalize(),n=n.transformDirection(AT)),n),getTextureLevel:()=>e}},iM=e=>({getUV:()=>e,getTextureLevel:()=>G(1)}),aM=new An,oM=class extends Ck{static get type(){return`MeshStandardNodeMaterial`}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(aM),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new nM(t):null}setupLightingModel(){return new QA}setupSpecular(){let e=AC(Y(.04),px.rgb,gx);Ox.assign(e),kx.assign(1)}setupVariants(){let e=this.metalnessNode?G(this.metalnessNode):ND;gx.assign(e);let t=this.roughnessNode?G(this.roughnessNode):MD;t=aA({roughness:t}),hx.assign(t),this.setupSpecular(),px.assign(Zb(px.rgb.mul(e.oneMinus()),px.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}},sM=new Fn,cM=class extends oM{static get type(){return`MeshPhysicalNodeMaterial`}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(sM),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){let e=this.iorNode?G(this.iorNode):qD;Fx.assign(e),Ox.assign(AC(hC(wC(Fx.sub(1).div(Fx.add(1))).mul(kD),Y(1)).mul(OD),px.rgb,gx)),kx.assign(AC(OD,1,gx))}setupLightingModel(){return new QA(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){let e=this.clearcoatNode?G(this.clearcoatNode):FD,t=this.clearcoatRoughnessNode?G(this.clearcoatRoughnessNode):ID;_x.assign(e),vx.assign(aA({roughness:t}))}if(this.useSheen){let e=this.sheenNode?Y(this.sheenNode):zD,t=this.sheenRoughnessNode?G(this.sheenRoughnessNode):BD;yx.assign(e),bx.assign(t)}if(this.useIridescence){let e=this.iridescenceNode?G(this.iridescenceNode):HD,t=this.iridescenceIORNode?G(this.iridescenceIORNode):UD,n=this.iridescenceThicknessNode?G(this.iridescenceThicknessNode):WD;xx.assign(e),Sx.assign(t),Cx.assign(n)}if(this.useAnisotropy){let e=(this.anisotropyNode?J(this.anisotropyNode):VD).toVar();Tx.assign(e.length()),Bb(Tx.equal(0),()=>{e.assign(J(1,0))}).Else(()=>{e.divAssign(J(Tx)),Tx.assign(Tx.saturate())}),wx.assign(Tx.pow2().mix(hx.pow2(),1)),Ex.assign(pD[0].mul(e.x).add(pD[1].mul(e.y))),Dx.assign(pD[1].mul(e.x).sub(pD[0].mul(e.y)))}if(this.useTransmission){let e=this.transmissionNode?G(this.transmissionNode):GD,t=this.thicknessNode?G(this.thicknessNode):KD,n=this.attenuationDistanceNode?G(this.attenuationDistanceNode):JD,r=this.attenuationColorNode?Y(this.attenuationColorNode):YD;if(Ix.assign(e),Lx.assign(t),Rx.assign(n),zx.assign(r),this.useDispersion){let e=this.dispersionNode?G(this.dispersionNode):nO;Bx.assign(e)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Y(this.clearcoatNormalNode):LD}setup(e){e.context.setupClearcoatNormal=()=>tw(this.setupClearcoatNormal(e),`NORMAL`,`vec3`),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}},lM=W(({normal:e,lightDirection:t,builder:n})=>{let r=J(e.dot(t).mul(.5).add(.5),0);if(n.material.gradientMap)return Y(UE(`gradientMap`,`texture`).context({getUV:()=>r}).r);{let e=r.fwidth().mul(.5);return AC(Y(.7),Y(1),PC(G(.7).sub(e.x),G(.7).add(e.x),r.x))}}),uM=class extends Wk{direct({lightDirection:e,lightColor:t,reflectedLight:n},r){let i=lM({normal:fE,lightDirection:e,builder:r}).mul(t);n.directDiffuse.addAssign(i.mul(Yk({diffuseColor:px.rgb})))}indirect(e){let{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(Yk({diffuseColor:px}))),r.indirectDiffuse.mulAssign(t)}},dM=new Yt,fM=class extends Ck{static get type(){return`MeshToonNodeMaterial`}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(dM),this.setValues(e)}setupLightingModel(){return new uM}},pM=W(()=>{let e=Y(cE.z,0,cE.x.negate()).normalize(),t=cE.cross(e);return J(e.dot(_E),t.dot(_E)).mul(.495).add(.5)}).once([`NORMAL`,`VERTEX`])().toVar(`matcapUV`),mM=new Tn,hM=class extends Ck{static get type(){return`MeshMatcapNodeMaterial`}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(mM),this.setValues(e)}setupVariants(e){let t=pM,n;n=e.material.matcap?UE(`matcap`,`texture`).context({getUV:()=>t}):Y(AC(.2,.8,t.y)),px.rgb.mulAssign(n.rgb)}},gM=Fb(class extends Hy{static get type(){return`RotateNode`}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){let{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)===`vec2`){let e=t.cos(),r=t.sin();return tx(e,r,r.negate(),e).mul(n)}else{let e=t,r=rx(Zb(1,0,0,0),Zb(0,YS(e.x),JS(e.x).negate(),0),Zb(0,JS(e.x),YS(e.x),0),Zb(0,0,0,1)),i=rx(Zb(YS(e.y),0,JS(e.y),0),Zb(0,1,0,0),Zb(JS(e.y).negate(),0,YS(e.y),0),Zb(0,0,0,1)),a=rx(Zb(YS(e.z),JS(e.z).negate(),0,0),Zb(JS(e.z),YS(e.z),0,0),Zb(0,0,1,0),Zb(0,0,0,1));return r.mul(i).mul(a).mul(Zb(n,1)).xyz}}}).setParameterLength(2),_M=new kr,vM=class extends Ck{static get type(){return`SpriteNodeMaterial`}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(_M),this.setValues(e)}setupPositionView(e){let{object:t,camera:n}=e,{positionNode:r,rotationNode:i,scaleNode:a,sizeAttenuation:o}=this,s=QT.mul(Y(r||0)),c=J(GT[0].xyz.length(),GT[1].xyz.length());a!==null&&(c=c.mul(J(a))),n.isPerspectiveCamera&&o===!1&&(c=c.mul(s.z.negate()));let l=nE.xy;if(t.center&&t.center.isVector2===!0){let e=mw(`center`,`vec2`,t);l=l.sub(e.sub(.5))}l=l.mul(c);let u=G(i||RD),d=gM(l,u);return Zb(s.xy.add(d),s.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}},yM=new Wt,bM=new Fe,xM=class extends vM{static get type(){return`PointsNodeMaterial`}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(yM),this.setValues(e)}setupPositionView(){let{positionNode:e}=this;return QT.mul(Y(e||rE)).xyz}setupVertexSprite(e){let{material:t,camera:n}=e,{rotationNode:r,scaleNode:i,sizeNode:a,sizeAttenuation:o}=this,s=super.setupVertex(e);if(t.isNodeMaterial!==!0)return s;let c=a===null?tO:J(a);c=c.mul(gT),n.isPerspectiveCamera&&o===!0&&(c=c.mul(SM.div(sE.z.negate()))),i&&i.isNode&&(c=c.mul(J(i)));let l=nE.xy;if(r&&r.isNode){let e=G(r);l=gM(l,e)}return l=l.mul(c),l=l.div(xT.div(2)),l=l.mul(s.w),s=s.add(Zb(l,0,0)),s}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}},SM=Jx(1).onFrameUpdate(function({renderer:e}){this.value=.5*e.getSize(bM).y}),CM=class extends Wk{constructor(){super(),this.shadowNode=G(1).toVar(`shadowMask`)}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){px.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(px.rgb)}},wM=new Ft,TM=class extends Ck{static get type(){return`ShadowNodeMaterial`}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(wM),this.setValues(e)}setupLightingModel(){return new CM}};dx(`vec3`),dx(`vec3`),dx(`vec3`);var EM=class{constructor(e,t,n){this.renderer=e,this.nodes=t,this.info=n,this._context=typeof self<`u`?self:null,this._animationLoop=null,this._requestId=null}start(){let e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,n),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}},DM=class{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let t=0;t<e.length-1;t++){let r=e[t];n.has(r)===!1&&n.set(r,new WeakMap),n=n.get(r)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}},OM=0;function kM(e){let t=Object.keys(e),n=Object.getPrototypeOf(e);for(;n;){let e=Object.getOwnPropertyDescriptors(n);for(let n in e)if(e[n]!==void 0){let r=e[n];r&&typeof r.get==`function`&&t.push(n)}n=Object.getPrototypeOf(n)}return t}var AM=class{constructor(e,t,n,r,i,a,o,s,c,l){this.id=OM++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=r,this.material=i,this.scene=a,this.camera=o,this.lightsNode=s,this.context=c,this.geometry=r.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=l,this.clippingContextCacheKey=l===null?``:l.cacheKey,this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener(`dispose`,this.onMaterialDispose),this.geometry.addEventListener(`dispose`,this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||=this._nodes.getForRender(this)}getMonitor(){return this._monitor||=this.getNodeBuilderState().observer}getBindings(){return this._bindings||=this.getNodeBuilderState().createBindings()}getBindingGroup(e){for(let t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;let e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],r=new Set,i={};for(let a of e){let e;if(a.node&&a.node.attribute?e=a.node.attribute:(e=t.getAttribute(a.name),i[a.name]=e.version),e===void 0)continue;n.push(e);let o=e.isInterleavedBufferAttribute?e.data:e;r.add(o)}return this.attributes=n,this.attributesId=i,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){let{object:e,material:t,geometry:n,group:r,drawRange:i}=this,a=this.drawParams||={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0},o=this.getIndex(),s=o!==null,c=1;if(n.isInstancedBufferGeometry===!0?c=n.instanceCount:e.count!==void 0&&(c=Math.max(0,e.count)),c===0)return null;if(a.instanceCount=c,e.isBatchedMesh===!0)return a;let l=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(l=2);let u=i.start*l,d=(i.start+i.count)*l;r!==null&&(u=Math.max(u,r.start*l),d=Math.min(d,(r.start+r.count)*l));let f=n.attributes.position,p=1/0;s?p=o.count:f!=null&&(p=f.count),u=Math.max(u,0),d=Math.min(d,p);let m=d-u;return m<0||m===1/0?null:(a.vertexCount=m,a.firstVertex=u,a)}getGeometryCacheKey(){let{geometry:e}=this,t=``;for(let n of Object.keys(e.attributes).sort()){let r=e.attributes[n];t+=n+`,`,r.data&&(t+=r.data.stride+`,`),r.offset&&(t+=r.offset+`,`),r.itemSize&&(t+=r.itemSize+`,`),r.normalized&&(t+=`n,`)}for(let n of Object.keys(e.morphAttributes).sort()){let r=e.morphAttributes[n];t+=`morph-`+n+`,`;for(let e=0,n=r.length;e<n;e++){let n=r[e];t+=n.id+`,`}}return e.index&&(t+=`index,`),t}getMaterialCacheKey(){let{object:e,material:t,renderer:n}=this,r=t.customProgramCacheKey();for(let e of kM(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(e))continue;let i=t[e],a;if(i!==null){let e=typeof i;e===`number`?a=i===0?`0`:`1`:e===`object`?(a=`{`,i.isTexture&&(a+=i.mapping,n.backend.isWebGPUBackend===!0&&(a+=i.magFilter,a+=i.minFilter,a+=i.wrapS,a+=i.wrapT,a+=i.wrapR)),a+=`}`):a=String(i)}else a=String(i);r+=a+`,`}return r+=this.clippingContextCacheKey+`,`,e.geometry&&(r+=this.getGeometryCacheKey()),e.skeleton&&(r+=e.skeleton.bones.length+`,`),e.isBatchedMesh&&(r+=e._matricesTexture.uuid+`,`,e._colorsTexture!==null&&(r+=e._colorsTexture.uuid+`,`)),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(r+=e.uuid+`,`),r+=e.receiveShadow+`,`,my(r)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){let e=this.attributesId;for(let t in e){let n=this.geometry.getAttribute(t);if(n===void 0||e[t]!==n.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=gy(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=gy(e,1)),e=gy(e,this.camera.id),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener(`dispose`,this.onMaterialDispose),this.geometry.removeEventListener(`dispose`,this.onGeometryDispose),this.onDispose()}},jM=[],MM=class{constructor(e,t,n,r,i,a){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=r,this.bindings=i,this.info=a,this.chainMaps={}}get(e,t,n,r,i,a,o,s){let c=this.getChainMap(s);jM[0]=e,jM[1]=t,jM[2]=a,jM[3]=i;let l=c.get(jM);return l===void 0?(l=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,r,i,a,o,s),c.set(jM,l)):(l.updateClipping(o),l.needsGeometryUpdate&&l.setGeometry(e.geometry),(l.version!==t.version||l.needsUpdate)&&(l.initialCacheKey===l.getCacheKey()?l.version=t.version:(l.dispose(),l=this.get(e,t,n,r,i,a,o,s)))),jM.length=0,l}getChainMap(e=`default`){return this.chainMaps[e]||(this.chainMaps[e]=new DM)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,r,i,a,o,s,c,l,u){let d=this.getChainMap(u),f=new AM(e,t,n,r,i,a,o,s,c,l);return f.onDispose=()=>{this.pipelines.delete(f),this.bindings.deleteForRender(f),this.nodes.delete(f),d.delete(f.getChainArray())},f}},NM=class{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}},PM={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},FM=16,IM=211,LM=212,RM=class extends NM{constructor(e){super(),this.backend=e}delete(e){let t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){let n=this.get(e);if(n.version===void 0)t===PM.VERTEX?this.backend.createAttribute(e):t===PM.INDEX?this.backend.createIndexAttribute(e):t===PM.STORAGE?this.backend.createStorageAttribute(e):t===PM.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{let t=this._getBufferAttribute(e);(n.version<t.version||t.usage===35048)&&(this.backend.updateAttribute(e),n.version=t.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}};function zM(e){return e.index===null?e.attributes.position.version:e.index.version}function BM(e){let t=[],n=e.index,r=e.attributes.position;if(n!==null){let e=n.array;for(let n=0,r=e.length;n<r;n+=3){let r=e[n+0],i=e[n+1],a=e[n+2];t.push(r,i,i,a,a,r)}}else{let e=r.array;for(let n=0,r=e.length/3-1;n<r;n+=3){let e=n+0,r=n+1,i=n+2;t.push(e,r,r,i,i,e)}}let i=new(ue(t)?ni:an)(t,1);return i.version=zM(e),i}var VM=class extends NM{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){let t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){let t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;let r=()=>{this.info.memory.geometries--;let n=t.index,i=e.getAttributes();n!==null&&this.attributes.delete(n);for(let e of i)this.attributes.delete(e);let a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener(`dispose`,r),this._geometryDisposeListeners.delete(t)};t.addEventListener(`dispose`,r),this._geometryDisposeListeners.set(t,r)}updateAttributes(e){let t=e.getAttributes();for(let e of t)e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute?this.updateAttribute(e,PM.STORAGE):this.updateAttribute(e,PM.VERTEX);let n=this.getIndex(e);n!==null&&this.updateAttribute(n,PM.INDEX);let r=e.geometry.indirect;r!==null&&this.updateAttribute(r,PM.INDIRECT)}updateAttribute(e,t){let n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){let{geometry:t,material:n}=e,r=t.index;if(n.wireframe===!0){let e=this.wireframes,n=e.get(t);n===void 0?(n=BM(t),e.set(t,n)):n.version!==zM(t)&&(this.attributes.delete(n),n=BM(t),e.set(t,n)),r=n}return r}dispose(){for(let[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener(`dispose`,t);this._geometryDisposeListeners.clear()}},HM=class{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):N(`WebGPUInfo: Unknown object type.`)}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}},UM=class{constructor(e){this.cacheKey=e,this.usedTimes=0}},WM=class extends UM{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}},GM=class extends UM{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}},KM=0,qM=class{constructor(e,t,n,r=null,i=null){this.id=KM++,this.code=e,this.stage=t,this.name=n,this.transforms=r,this.attributes=i,this.usedTimes=0}},JM=class extends NM{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){let{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){let i=r.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);let a=this.nodes.getForCompute(e),o=this.programs.compute.get(a.computeShader);o===void 0&&(i&&i.computeProgram.usedTimes===0&&this._releaseProgram(i.computeProgram),o=new qM(a.computeShader,`compute`,e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,o),n.createProgram(o));let s=this._getComputeCacheKey(e,o),c=this.caches.get(s);c===void 0&&(i&&i.usedTimes===0&&this._releasePipeline(i),c=this._getComputePipeline(e,o,s,t)),c.usedTimes++,o.usedTimes++,r.version=e.version,r.pipeline=c}return r.pipeline}getForRender(e,t=null){let{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){let i=r.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);let a=e.getNodeBuilderState(),o=e.material?e.material.name:``,s=this.programs.vertex.get(a.vertexShader);s===void 0&&(i&&i.vertexProgram.usedTimes===0&&this._releaseProgram(i.vertexProgram),s=new qM(a.vertexShader,`vertex`,o),this.programs.vertex.set(a.vertexShader,s),n.createProgram(s));let c=this.programs.fragment.get(a.fragmentShader);c===void 0&&(i&&i.fragmentProgram.usedTimes===0&&this._releaseProgram(i.fragmentProgram),c=new qM(a.fragmentShader,`fragment`,o),this.programs.fragment.set(a.fragmentShader,c),n.createProgram(c));let l=this._getRenderCacheKey(e,s,c),u=this.caches.get(l);u===void 0?(i&&i.usedTimes===0&&this._releasePipeline(i),u=this._getRenderPipeline(e,s,c,l,t)):e.pipeline=u,u.usedTimes++,s.usedTimes++,c.usedTimes++,r.pipeline=u}return r.pipeline}delete(e){let t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,r){n||=this._getComputeCacheKey(e,t);let i=this.caches.get(n);return i===void 0&&(i=new GM(n,t),this.caches.set(n,i),this.backend.createComputePipeline(i,r)),i}_getRenderPipeline(e,t,n,r,i){r||=this._getRenderCacheKey(e,t,n);let a=this.caches.get(r);return a===void 0&&(a=new WM(r,t,n),this.caches.set(r,a),e.pipeline=a,this.backend.createRenderPipeline(e,i)),a}_getComputeCacheKey(e,t){return e.id+`,`+t.id}_getRenderCacheKey(e,t,n){return t.id+`,`+n.id+`,`+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){let t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){let t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}},YM=class extends NM{constructor(e,t,n,r,i,a){super(),this.backend=e,this.textures=n,this.pipelines=i,this.attributes=r,this.nodes=t,this.info=a,this.pipelines.bindings=this}getForRender(e){let t=e.getBindings();for(let e of t){let n=this.get(e);n.bindGroup===void 0&&(this._init(e),this.backend.createBindings(e,t,0),n.bindGroup=e)}return t}getForCompute(e){let t=this.nodes.getForCompute(e).bindings;for(let e of t){let n=this.get(e);n.bindGroup===void 0&&(this._init(e),this.backend.createBindings(e,t,0),n.bindGroup=e)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){let t=this.nodes.getForCompute(e).bindings;for(let e of t)this.delete(e)}deleteForRender(e){let t=e.getBindings();for(let e of t)this.delete(e)}_updateBindings(e){for(let t of e)this._update(t,e)}_init(e){for(let t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){let e=t.attribute,n=e.isIndirectStorageBufferAttribute?PM.INDIRECT:PM.STORAGE;this.attributes.update(e,n)}}_update(e,t){let{backend:n}=this,r=!1,i=!0,a=0,o=0;for(let t of e.bindings)if(!(t.isNodeUniformsGroup&&this.nodes.updateGroup(t)===!1)){if(t.isStorageBuffer){let e=t.attribute,n=e.isIndirectStorageBufferAttribute?PM.INDIRECT:PM.STORAGE;this.attributes.update(e,n)}if(t.isUniformBuffer)t.update()&&n.updateBinding(t);else if(t.isSampledTexture){let e=t.update(),s=t.texture,c=this.textures.get(s);if(e&&(this.textures.updateTexture(s),t.generation!==c.generation&&(t.generation=c.generation,r=!0,i=!1)),n.get(s).externalTexture!==void 0||c.isDefaultTexture?i=!1:(a=a*10+s.id,o+=s.version),s.isStorageTexture===!0&&s.mipmapsAutoUpdate===!0){let e=this.get(s);t.store===!0?e.needsMipmap=!0:this.textures.needsMipmaps(s)&&e.needsMipmap===!0&&(this.backend.generateMipmaps(s),e.needsMipmap=!1)}}else if(t.isSampler&&t.update()){let e=this.textures.updateSampler(t.texture);t.samplerKey!==e&&(t.samplerKey=e,r=!0,i=!1)}}r===!0&&this.backend.updateBindings(e,t,i?a:0,o)}};function XM(e,t){return e.groupOrder===t.groupOrder?e.renderOrder===t.renderOrder?e.z===t.z?e.id-t.id:e.z-t.z:e.renderOrder-t.renderOrder:e.groupOrder-t.groupOrder}function ZM(e,t){return e.groupOrder===t.groupOrder?e.renderOrder===t.renderOrder?e.z===t.z?e.id-t.id:t.z-e.z:e.renderOrder-t.renderOrder:e.groupOrder-t.groupOrder}function QM(e){return(e.transmission>0||e.transmissionNode&&e.transmissionNode.isNode)&&e.side===2&&e.forceSinglePass===!1}var $M=class{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,r,i,a,o){let s=this.renderItems[this.renderItemsIndex];return s===void 0?(s={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:i,group:a,clippingContext:o},this.renderItems[this.renderItemsIndex]=s):(s.id=e.id,s.object=e,s.geometry=t,s.material=n,s.groupOrder=r,s.renderOrder=e.renderOrder,s.z=i,s.group=a,s.clippingContext=o),this.renderItemsIndex++,s}push(e,t,n,r,i,a,o){let s=this.getNextRenderItem(e,t,n,r,i,a,o);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(QM(n)&&this.transparentDoublePass.push(s),this.transparent.push(s)):this.opaque.push(s)}unshift(e,t,n,r,i,a,o){let s=this.getNextRenderItem(e,t,n,r,i,a,o);n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(QM(n)&&this.transparentDoublePass.unshift(s),this.transparent.unshift(s)):this.opaque.unshift(s)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||XM),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||ZM),this.transparent.length>1&&this.transparent.sort(t||ZM)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){let t=this.renderItems[e];if(t.id===null)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.groupOrder=null,t.renderOrder=null,t.z=null,t.group=null,t.clippingContext=null}}},eN=[],tN=class{constructor(e){this.lighting=e,this.lists=new DM}get(e,t){let n=this.lists;eN[0]=e,eN[1]=t;let r=n.get(eN);return r===void 0&&(r=new $M(this.lighting,e,t),n.set(eN,r)),eN.length=0,r}dispose(){this.lists=new DM}},nN=0,rN=class{constructor(){this.id=nN++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Je,this.scissor=!1,this.scissorValue=new Je,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return iN(this)}};function iN(e){let{textures:t,activeCubeFace:n,activeMipmapLevel:r}=e,i=[n,r];for(let e of t)i.push(e.id);return hy(i)}var aN=[],oN=new Se,sN=new T,cN=class{constructor(){this.chainMaps={}}get(e,t,n=null){aN[0]=e,aN[1]=t;let r;if(n===null)r=`default`;else{let e=n.texture.format;r=`${n.textures.length}:${e}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}let i=this._getChainMap(r),a=i.get(aN);return a===void 0&&(a=new rN,i.set(aN,a)),aN.length=0,n!==null&&(a.sampleCount=n.samples===0?1:n.samples),a}getForClear(e=null){return this.get(oN,sN,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new DM)}dispose(){this.chainMaps={}}},lN=new j,uN=class extends NM{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){let n=this.get(e),r=e.samples===0?1:e.samples,i=n.depthTextureMips||={},a=e.textures,o=this.getSize(a[0]),s=o.width>>t,c=o.height>>t,l=e.depthTexture||i[t],u=e.depthBuffer===!0||e.stencilBuffer===!0,d=!1;l===void 0&&u&&(l=new Mt,l.format=e.stencilBuffer?Lt:ye,l.type=e.stencilBuffer?mt:x,l.image.width=s,l.image.height=c,l.image.depth=o.depth,l.renderTarget=e,l.isArrayTexture=e.multiview===!0&&o.depth>1,i[t]=l),(n.width!==o.width||o.height!==n.height)&&(d=!0,l&&(l.needsUpdate=!0,l.image.width=s,l.image.height=c,l.image.depth=l.isArrayTexture?l.image.depth:1)),n.width=o.width,n.height=o.height,n.textures=a,n.depthTexture=l||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(d=!0,l&&(l.needsUpdate=!0),n.sampleCount=r);let f={sampleCount:r};if(e.isXRRenderTarget!==!0){for(let e=0;e<a.length;e++){let t=a[e];d&&(t.needsUpdate=!0),this.updateTexture(t,f)}l&&this.updateTexture(l,f)}n.initialized!==!0&&(n.initialized=!0,n.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener(`dispose`,n.onDispose))}updateTexture(e,t={}){let n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;let r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,i=this.backend;if(r&&n.initialized===!0&&i.destroyTexture(e),e.isFramebufferTexture){let t=this.renderer.getRenderTarget();t?e.type=t.texture.type:e.type=g}let{width:a,height:o,depth:s}=this.getSize(e);if(t.width=a,t.height=o,t.depth=s,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,a,o):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,r||e.isStorageTexture===!0||e.isExternalTexture===!0)i.createTexture(e,t),n.generation=e.version;else if(e.version>0){let r=e.image;if(r===void 0)P(`Renderer: Texture marked for update but image is undefined.`);else if(r.complete===!1)P(`Renderer: Texture marked for update but image is incomplete.`);else{if(e.images){let n=[];for(let t of e.images)n.push(t);t.images=n}else t.image=r;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(i.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&i.updateTexture(e,t);let a=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!a&&i.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else i.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;n.initialized!==!0&&(n.initialized=!0,n.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&Un.getTransfer(e.colorSpace)!==`srgb`&&P(`WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace.`),n.onDispose=()=>{this._destroyTexture(e)},e.addEventListener(`dispose`,n.onDispose)),n.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=lN){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),typeof HTMLVideoElement<`u`&&n instanceof HTMLVideoElement?(t.width=n.videoWidth||1,t.height=n.videoHeight||1,t.depth=1):typeof VideoFrame<`u`&&n instanceof VideoFrame?(t.width=n.displayWidth||1,t.height=n.displayHeight||1,t.depth=1):(t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let r;return r=e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture===!0?1:Math.floor(Math.log2(Math.max(t,n)))+1,r}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){let t=this.get(e),n=t.textures,r=t.depthTexture;e.removeEventListener(`dispose`,t.onDispose);for(let e=0;e<n.length;e++)this._destroyTexture(n[e]);r&&this._destroyTexture(r),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){let t=this.get(e);e.removeEventListener(`dispose`,t.onDispose);let n=t.isDefaultTexture;this.backend.destroyTexture(e,n),this.delete(e),this.info.memory.textures--}}},dN=class extends a{constructor(e,t,n,r=1){super(e,t,n),this.a=r}set(e,t,n,r=1){return this.a=r,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}},fN=class extends ux{static get type(){return`ParameterNode`}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){let n=this.getNodeType(e),r=e.getStructTypeNode(n),i;return r===null?(N(`TSL: Member "${t}" not found in struct "${n}".`),i=`float`):i=r.getMemberType(e,t),i}getHash(){return this.uuid}generate(){return this.name}},pN=(e,t)=>V(new fN(e,t)),mN=Fb(class extends zy{static get type(){return`StackNode`}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):`void`}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):`void`}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):`void`}addToStack(e){return e.isNode===!0?(this.nodes.push(e),this):(N(`TSL: Invalid node added to stack.`),this)}If(e,t){return this._currentCond=UC(e,new jb(t)),this.addToStack(this._currentCond)}ElseIf(e,t){let n=UC(e,new jb(t));return this._currentCond.elseNode=n,this._currentCond=n,this}Else(e){return this._currentCond.elseNode=new jb(e),this}Switch(e){return this._expressionNode=V(e),this}Case(...e){let t=[];if(e.length>=2)for(let n=0;n<e.length-1;n++)t.push(this._expressionNode.equal(V(e[n])));else N(`TSL: Invalid parameter length. Case() requires at least two parameters.`);let n=e[e.length-1],r=new jb(n),i=t[0];for(let e=1;e<t.length;e++)i=i.or(t[e]);let a=UC(i,r);return this._currentCond===null?(this._currentCond=a,this.addToStack(this._currentCond)):(this._currentCond.elseNode=a,this._currentCond=a,this)}Default(e){return this.Else(e),this}setup(e){let t=e.getNodeProperties(this),n=0;for(let r of this.getChildren())r.isVarNode&&r.intent===!0&&r.isAssign(e)!==!0||(t[`node`+ n++]=r);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){let n=zb();Rb(this),e.setActiveStack(this);let r=e.buildStage;for(let t of this.nodes)if(!(t.isVarNode&&t.intent===!0&&t.isAssign(e)!==!0)){if(r===`setup`)t.build(e);else if(r===`analyze`)t.build(e,this);else if(r===`generate`){let n=e.getDataFromNode(t,`any`).stages,r=n&&n[e.shaderStage];if(t.isVarNode&&r&&r.length===1&&r[0]&&r[0].isStackNode)continue;t.build(e,`void`)}}let i;return i=this.hasOutput?this.outputNode.build(e,...t):super.build(e,...t),Rb(n),e.removeActiveStack(this),i}}).setParameterLength(0,1);function hN(e){return Object.entries(e).map(([e,t])=>typeof t==`string`?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}var gN=class extends zy{static get type(){return`StructTypeNode`}constructor(e,t=null){super(`struct`),this.membersLayout=hN(e),this.name=t,this.isStructLayoutNode=!0}getLength(){let e=Float32Array.BYTES_PER_ELEMENT,t=0;for(let n of this.membersLayout){let r=n.type,i=Sy(r)*e,a=Cy(r),o=t%8,s=o%a,c=o+s;t+=s,c!==0&&8-c<i&&(t+=8-c),t+=i}return Math.ceil(t/8)*8/e}getMemberType(e,t){let n=this.membersLayout.find(e=>e.name===t);return n?n.type:`void`}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}},_N=class extends zy{static get type(){return`StructNode`}constructor(e,t){super(`vec3`),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}generate(e){let t=e.getVarFromNode(this),n=t.type,r=e.getPropertyName(t);return e.addLineFlowCode(`${r} = ${e.generateStruct(n,this.structTypeNode.membersLayout,this.values)}`,this),t.name}},vN=(e,t=null)=>{let n=new gN(e,t),r=(...t)=>{let r=null;if(t.length>0)if(t[0].isNode){r={};let n=Object.keys(e);for(let e=0;e<t.length;e++)r[n[e]]=t[e]}else r=t[0];return V(new _N(n,r))};return r.layout=n,r.isStruct=!0,r},yN=class extends zy{static get type(){return`OutputStructNode`}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){let t=e.getNodeProperties(this);if(t.membersLayout===void 0){let n=this.members,r=[];for(let t=0;t<n.length;t++){let i=`m`+t,a=n[t].getNodeType(e);r.push({name:i,type:a,index:t})}t.membersLayout=r,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){let t=e.getOutputStructName(),n=this.members,r=t===``?``:t+`.`;for(let t=0;t<n.length;t++){let i=n[t].build(e);e.addLineFlowCode(`${r}m${t} = ${i}`,this)}return t}},bN=Fb(yN);function xN(e,t){for(let n=0;n<e.length;n++)if(e[n].name===t)return n;return-1}var SN=Fb(class extends yN{static get type(){return`MRTNode`}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){return SN({...this.outputNodes,...e.outputNodes})}setup(e){let t=this.outputNodes,n=e.renderer.getRenderTarget(),r=[],i=n.textures;for(let e in t){let n=xN(i,e);r[n]=Zb(t[e])}return this.members=r,super.setup(e)}}),CN=class extends Hy{static get type(){return`BitcastNode`}constructor(e,t,n=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=n,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){let t=this.valueNode.getNodeType(e),n=e.getTypeLength(t);return e.getTypeFromLength(n,this.conversionType)}return this.conversionType}generate(e){let t=this.getNodeType(e),n=``;if(this.inputType!==null){let t=this.valueNode.getNodeType(e);n=e.getTypeLength(t)===1?this.inputType:e.changeComponentType(t,this.inputType)}else n=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,n)}( ${this.valueNode.build(e,n)} )`}},wN=U(CN).setParameterLength(2),TN=e=>new CN(e,`int`,`float`),EN=e=>new CN(e,`uint`,`float`),DN=e=>new CN(e,`float`,`int`),ON=e=>new CN(e,`float`,`uint`),kN=W(([e])=>{let t=e.toUint().mul(747796405).add(2891336453),n=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return n.shiftRight(22).bitXor(n).toFloat().mul(1/2**32)}),AN=(e,t)=>CC(iS(4,e.mul(rS(1,e))),t),jN=(e,t)=>e.lessThan(.5)?AN(e.mul(2),t).div(2):rS(1,AN(iS(rS(1,e),2),t).div(2)),MN=(e,t,n)=>CC(aS(CC(e,t),nS(CC(e,t),CC(rS(1,e),n))),1/t),NN=(e,t)=>JS(AS.mul(t.mul(e).sub(1))).div(AS.mul(t.mul(e).sub(1))),PN=W(([e])=>e.fract().sub(.5).abs()).setLayout({name:`tri`,type:`float`,inputs:[{name:`x`,type:`float`}]}),FN=W(([e])=>Y(PN(e.z.add(PN(e.y.mul(1)))),PN(e.z.add(PN(e.x.mul(1)))),PN(e.y.add(PN(e.x.mul(1)))))).setLayout({name:`tri3`,type:`vec3`,inputs:[{name:`p`,type:`vec3`}]}),IN=W(([e,t,n])=>{let r=Y(e).toVar(),i=G(1.4).toVar(),a=G(0).toVar(),o=Y(r).toVar();return DO({start:G(0),end:G(3),type:`float`,condition:`<=`},()=>{let e=Y(FN(o.mul(2))).toVar();r.addAssign(e.add(n.mul(G(.1).mul(t)))),o.mulAssign(1.8),i.mulAssign(1.5),r.mulAssign(1.2);let s=G(PN(r.z.add(PN(r.x.add(PN(r.y)))))).toVar();a.addAssign(s.div(i)),o.addAssign(.14)}),a}).setLayout({name:`triNoise3D`,type:`float`,inputs:[{name:`position`,type:`vec3`},{name:`speed`,type:`float`},{name:`time`,type:`float`}]}),LN=Fb(class extends zy{static get type(){return`FunctionOverloadingNode`}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){let t=this.parametersNodes,n=this._candidateFn;if(n===null){let r=null,i=-1;for(let n of this.functionNodes){let a=n.shaderNode.layout;if(a===null)throw Error(`FunctionOverloadingNode: FunctionNode must be a layout.`);let o=a.inputs;if(t.length===o.length){let a=0;for(let n=0;n<t.length;n++){let r=t[n],i=o[n];r.getNodeType(e)===i.type&&a++}a>i&&(r=n,i=a)}}this._candidateFn=n=r}return n}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}),RN=e=>(...t)=>LN(e,...t),zN=Jx(0).setGroup(Gx).onRenderUpdate(e=>e.time),BN=Jx(0).setGroup(Gx).onRenderUpdate(e=>e.deltaTime),VN=Jx(0,`uint`).setGroup(Gx).onRenderUpdate(e=>e.frameId),HN=(e=zN)=>e.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),UN=(e=zN)=>e.fract().round(),WN=(e=zN)=>e.add(.5).fract().mul(2).sub(1).abs(),GN=(e=zN)=>e.fract(),KN=W(([e,t,n=J(.5)])=>gM(e.sub(n),t).add(n)),qN=W(([e,t,n=J(.5)])=>{let r=e.sub(n),i=r.dot(r),a=i.mul(i).mul(t);return e.add(r.mul(a))}),JN=W(({position:e=null,horizontal:t=!0,vertical:n=!1})=>{let r;e===null?r=GT:(r=GT.toVar(),r[3][0]=e.x,r[3][1]=e.y,r[3][2]=e.z);let i=AT.mul(r);return kb(t)&&(i[0][0]=GT[0].length(),i[0][1]=0,i[0][2]=0),kb(n)&&(i[1][0]=0,i[1][1]=GT[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,OT.mul(i).mul(rE)}),YN=W(([e=null])=>{let t=ek();return ek(WO(e)).sub(t).lessThan(0).select(_T,e)}),XN=Fb(class extends zy{static get type(){return`SpriteSheetUVNode`}constructor(e,t=Yw(),n=G(0)){super(`vec2`),this.countNode=e,this.uvNode=t,this.frameNode=n}setup(){let{frameNode:e,uvNode:t,countNode:n}=this,{width:r,height:i}=n,a=e.mod(r.mul(i)).floor(),o=a.mod(r),s=i.sub(a.add(1).div(r).ceil()),c=n.reciprocal(),l=J(o,s);return t.add(l).mul(c)}}).setParameterLength(3),ZN=W(([e,t=null,n=null,r=G(1),i=rE,a=pE])=>{let o=a.abs().normalize();o=o.div(o.dot(Y(1)));let s=i.yz.mul(r),c=i.zx.mul(r),l=i.xy.mul(r),u=e.value,d=t===null?u:t.value,f=n===null?u:n.value;return nS(tT(u,s).mul(o.x),tT(d,c).mul(o.y),tT(f,l).mul(o.z))}),QN=(...e)=>ZN(...e),$N=new Tr,eP=new j,tP=new j,nP=new j,rP=new F,iP=new j(0,0,-1),aP=new Je,oP=new j,sP=new j,cP=new Je,lP=new Fe,uP=new p,dP=_T.flipX();uP.depthTexture=new Mt(1,1);var fP=!1,pP=class e extends $w{static get type(){return`ReflectorNode`}constructor(e={}){super(e.defaultTexture||uP.texture,dP),this._reflectorBaseNode=e.reflector||new mP(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw Error(`THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. `);this._depthNode=V(new e({defaultTexture:uP.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){let e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}},mP=class extends zy{static get type(){return`ReflectorBaseNode`}constructor(e,t={}){super();let{target:n=new je,resolutionScale:r=1,generateMipmaps:i=!1,bounces:a=!0,depth:o=!1,samples:s=0}=t;this.textureNode=e,this.target=n,this.resolutionScale=r,t.resolution!==void 0&&(be(`ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".`),this.resolutionScale=t.resolution),this.generateMipmaps=i,this.bounces=a,this.depth=o,this.samples=s,this.updateBeforeType=a?Ay.RENDER:Ay.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){let n=this.resolutionScale;t.getDrawingBufferSize(lP),e.setSize(Math.round(lP.width*n),Math.round(lP.height*n))}setup(e){return this._updateResolution(uP,e.renderer),super.setup(e)}dispose(){super.dispose();for(let e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new p(0,0,{type:_t,samples:this.samples}),this.generateMipmaps===!0&&(t.texture.minFilter=It,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new Mt),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&fP)return!1;fP=!0;let{scene:t,camera:n,renderer:r,material:i}=e,{target:a}=this,o=this.getVirtualCamera(n),s=this.getRenderTarget(o);r.getDrawingBufferSize(lP),this._updateResolution(s,r),tP.setFromMatrixPosition(a.matrixWorld),nP.setFromMatrixPosition(n.matrixWorld),rP.extractRotation(a.matrixWorld),eP.set(0,0,1),eP.applyMatrix4(rP),oP.subVectors(tP,nP);let c=oP.dot(eP)>0,l=!1;if(c===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){fP=!1;return}l=!0}oP.reflect(eP).negate(),oP.add(tP),rP.extractRotation(n.matrixWorld),iP.set(0,0,-1),iP.applyMatrix4(rP),iP.add(nP),sP.subVectors(tP,iP),sP.reflect(eP).negate(),sP.add(tP),o.coordinateSystem=n.coordinateSystem,o.position.copy(oP),o.up.set(0,1,0),o.up.applyMatrix4(rP),o.up.reflect(eP),o.lookAt(sP),o.near=n.near,o.far=n.far,o.updateMatrixWorld(),o.projectionMatrix.copy(n.projectionMatrix),$N.setFromNormalAndCoplanarPoint(eP,tP),$N.applyMatrix4(o.matrixWorldInverse),aP.set($N.normal.x,$N.normal.y,$N.normal.z,$N.constant);let u=o.projectionMatrix;cP.x=(Math.sign(aP.x)+u.elements[8])/u.elements[0],cP.y=(Math.sign(aP.y)+u.elements[9])/u.elements[5],cP.z=-1,cP.w=(1+u.elements[10])/u.elements[14],aP.multiplyScalar(1/aP.dot(cP)),u.elements[2]=aP.x,u.elements[6]=aP.y,u.elements[10]=r.coordinateSystem===2001?aP.z-0:aP.z+1-0,u.elements[14]=aP.w,this.textureNode.value=s.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=s.depthTexture),i.visible=!1;let d=r.getRenderTarget(),f=r.getMRT(),p=r.autoClear;r.setMRT(null),r.setRenderTarget(s),r.autoClear=!0;let m=t.name;t.name=(t.name||`Scene`)+` [ Reflector ]`,l?(r.clear(),this.hasOutput=!1):(r.render(t,o),this.hasOutput=!0),t.name=m,r.setMRT(f),r.setRenderTarget(d),r.autoClear=p,i.visible=!0,fP=!1,this.forceUpdate=!1}get resolution(){return be(`ReflectorNode: The "resolution" property has been renamed to "resolutionScale".`),this.resolutionScale}set resolution(e){be(`ReflectorNode: The "resolution" property has been renamed to "resolutionScale".`),this.resolutionScale=e}},hP=e=>V(new pP(e)),gP=new kt(-1,1,1,-1,0,1),_P=new class extends Xr{constructor(e=!1){super();let t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute(`position`,new vn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute(`uv`,new vn(t,2))}},vP=class extends tr{constructor(e=null){super(_P,e),this.camera=gP,this.isQuadMesh=!0}async renderAsync(e){be(`QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.`),await e.init(),e.render(this,gP)}render(e){e.render(this,gP)}},yP=new Fe,bP=class extends $w{static get type(){return`RTTNode`}constructor(e,t=null,n=null,r={type:_t}){let i=new p(t,n,r);super(i.texture,Yw()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=n,this.pixelRatio=1,this.renderTarget=i,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new vP(new Ck),this.updateBeforeType=Ay.RENDER}get autoResize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name=`RTT`,this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;let n=e*this.pixelRatio,r=t*this.pixelRatio;this.renderTarget.setSize(n,r),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){let t=e.getPixelRatio(),n=e.getSize(yP),r=Math.floor(n.width*t),i=Math.floor(n.height*t);(r!==this.renderTarget.width||i!==this.renderTarget.height)&&(this.renderTarget.setSize(r,i),this.textureNeedsUpdate=!0)}let t=`RTT`;this.node.name&&(t=this.node.name+` [ `+t+` ]`),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;let n=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(n)}clone(){let e=new $w(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}},xP=(e,...t)=>V(new bP(V(e),...t)),SP=(e,...t)=>e.isSampleNode||e.isTextureNode?e:e.isPassNode?e.getTextureNode():xP(e,...t),CP=W(([e,t,n],r)=>{let i;r.renderer.coordinateSystem===2001?(e=J(e.x,e.y.oneMinus()).mul(2).sub(1),i=Zb(Y(e,t),1)):i=Zb(Y(e.x,e.y.oneMinus(),t).mul(2).sub(1),1);let a=Zb(n.mul(i));return a.xyz.div(a.w)}),wP=W(([e,t])=>{let n=t.mul(Zb(e,1)),r=n.xy.div(n.w).mul(.5).add(.5).toVar();return J(r.x,r.y.oneMinus())}),TP=W(([e,t,n])=>{let r=Xw(rT(t)),i=Gb(e.mul(r)).toVar(),a=rT(t,i).toVar(),o=rT(t,i.sub(Gb(2,0))).toVar(),s=rT(t,i.sub(Gb(1,0))).toVar(),c=rT(t,i.add(Gb(1,0))).toVar(),l=rT(t,i.add(Gb(2,0))).toVar(),u=rT(t,i.add(Gb(0,2))).toVar(),d=rT(t,i.add(Gb(0,1))).toVar(),f=rT(t,i.sub(Gb(0,1))).toVar(),p=rT(t,i.sub(Gb(0,2))).toVar(),m=eC(rS(G(2).mul(s).sub(o),a)).toVar(),h=eC(rS(G(2).mul(c).sub(l),a)).toVar(),g=eC(rS(G(2).mul(d).sub(u),a)).toVar(),_=eC(rS(G(2).mul(f).sub(p),a)).toVar(),v=CP(e,a,n).toVar();return KS(SC(m.lessThan(h).select(v.sub(CP(e.sub(J(G(1).div(r.x),0)),s,n)),v.negate().add(CP(e.add(J(G(1).div(r.x),0)),c,n))),g.lessThan(_).select(v.sub(CP(e.add(J(0,G(1).div(r.y))),d,n)),v.negate().add(CP(e.sub(J(0,G(1).div(r.y))),f,n)))))}),EP=W(([e])=>qS(G(52.9829189).mul(qS(xC(e,J(.06711056,.00583715)))))).setLayout({name:`interleavedGradientNoise`,type:`float`,inputs:[{name:`position`,type:`vec2`}]}),DP=class extends zy{static get type(){return`SampleNode`}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(Yw())}sample(e){return this.callback(e)}},OP=(e,t=null)=>V(new DP(e,V(t))),kP=class e extends zy{static get type(){return`EventNode`}constructor(t,n){super(`void`),this.eventType=t,this.callback=n,t===e.OBJECT?this.updateType=Ay.OBJECT:t===e.MATERIAL?this.updateType=Ay.RENDER:t===e.BEFORE_OBJECT?this.updateBeforeType=Ay.OBJECT:t===e.BEFORE_MATERIAL&&(this.updateBeforeType=Ay.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}};kP.OBJECT=`object`,kP.MATERIAL=`material`,kP.BEFORE_OBJECT=`beforeObject`,kP.BEFORE_MATERIAL=`beforeMaterial`;var AP=(e,t)=>V(new kP(e,t)).toStack(),jP=e=>AP(kP.OBJECT,e),MP=e=>AP(kP.MATERIAL,e),NP=e=>AP(kP.BEFORE_OBJECT,e),PP=e=>AP(kP.BEFORE_MATERIAL,e),FP=class extends Qn{constructor(e,t,n=Float32Array){let r=ArrayBuffer.isView(e)?e:new n(e*t);super(r,t),this.isStorageInstancedBufferAttribute=!0}},IP=class extends h{constructor(e,t,n=Float32Array){let r=ArrayBuffer.isView(e)?e:new n(e*t);super(r,t),this.isStorageBufferAttribute=!0}},LP=(e,t=`float`)=>{let n,r;return t.isStruct===!0?(n=t.layout.getLength(),r=by(`float`)):(n=xy(t),r=by(t)),bO(new IP(e,n,r),t,e)},RP=(e,t=`float`)=>{let n,r;return t.isStruct===!0?(n=t.layout.getLength(),r=by(`float`)):(n=xy(t),r=by(t)),bO(new FP(e,n,r),t,e)},zP=H(class extends zy{static get type(){return`PointUVNode`}constructor(){super(`vec2`),this.isPointUVNode=!0}generate(){return`vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )`}}),BP=new Ir,VP=new F,HP=class e extends zy{static get type(){return`SceneNode`}constructor(t=e.BACKGROUND_BLURRINESS,n=null){super(),this.scope=t,this.scene=n}setup(t){let n=this.scope,r=this.scene===null?t.scene:this.scene,i;return n===e.BACKGROUND_BLURRINESS?i=BE(`backgroundBlurriness`,`float`,r):n===e.BACKGROUND_INTENSITY?i=BE(`backgroundIntensity`,`float`,r):n===e.BACKGROUND_ROTATION?i=Jx(`mat4`).setName(`backgroundRotation`).setGroup(Gx).onRenderUpdate(()=>{let e=r.background;return e!==null&&e.isTexture&&e.mapping!==300?(BP.copy(r.backgroundRotation),BP.x*=-1,BP.y*=-1,BP.z*=-1,VP.makeRotationFromEuler(BP)):VP.identity(),VP}):N(`SceneNode: Unknown scope:`,n),i}};HP.BACKGROUND_BLURRINESS=`backgroundBlurriness`,HP.BACKGROUND_INTENSITY=`backgroundIntensity`,HP.BACKGROUND_ROTATION=`backgroundRotation`;var UP=H(HP,HP.BACKGROUND_BLURRINESS),WP=H(HP,HP.BACKGROUND_INTENSITY),GP=H(HP,HP.BACKGROUND_ROTATION),KP=Fb(class extends $w{static get type(){return`StorageTextureNode`}constructor(e,t,n=null){super(e,t),this.storeNode=n,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=My.WRITE_ONLY}getInputType(){return`storageTexture`}setup(e){super.setup(e);let t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let n;return n=this.storeNode===null?super.generate(e,t):this.generateStore(e),n}toReadWrite(){return this.setAccess(My.READ_WRITE)}toReadOnly(){return this.setAccess(My.READ_ONLY)}toWriteOnly(){return this.setAccess(My.WRITE_ONLY)}generateStore(e){let{uvNode:t,storeNode:n,depthNode:r}=e.getNodeProperties(this),i=super.generate(e,`property`),a=t.build(e,this.value.is3DTexture===!0?`uvec3`:`uvec2`),o=n.build(e,`vec4`),s=r?r.build(e,`int`):null,c=e.generateTextureStore(e,i,a,s,o);e.addLineFlowCode(c,this)}clone(){let e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e}}).setParameterLength(1,3),qP=(e,t,n)=>{let r=KP(e,t,n);return n!==null&&r.toStack(),r},JP=W(({texture:e,uv:t})=>{let n=1e-4,r=Y().toVar();return Bb(t.x.lessThan(n),()=>{r.assign(Y(1,0,0))}).ElseIf(t.y.lessThan(n),()=>{r.assign(Y(0,1,0))}).ElseIf(t.z.lessThan(n),()=>{r.assign(Y(0,0,1))}).ElseIf(t.x.greaterThan(1-n),()=>{r.assign(Y(-1,0,0))}).ElseIf(t.y.greaterThan(1-n),()=>{r.assign(Y(0,-1,0))}).ElseIf(t.z.greaterThan(1-n),()=>{r.assign(Y(0,0,-1))}).Else(()=>{let n=.01,i=e.sample(t.add(Y(-n,0,0))).r.sub(e.sample(t.add(Y(n,0,0))).r),a=e.sample(t.add(Y(0,-n,0))).r.sub(e.sample(t.add(Y(0,n,0))).r),o=e.sample(t.add(Y(0,0,-n))).r.sub(e.sample(t.add(Y(0,0,n))).r);r.assign(Y(i,a,o))}),r.normalize()}),YP=Fb(class extends $w{static get type(){return`Texture3DNode`}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return`texture3D`}getDefaultUV(){return Y(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){let n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0)&&(t=this.sampler?t.flipY():t.setY(K(Xw(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?`vec3`:`ivec3`)}generateOffset(e,t){return t.build(e,`ivec3`)}normal(e){return JP({texture:this,uv:e})}}).setParameterLength(1,3),XP=class extends zE{static get type(){return`UserDataNode`}constructor(e,t,n=null){super(e,t,n),this.userData=n}updateReference(e){return this.reference=this.userData===null?e.object.userData:this.userData,this.reference}},ZP=(e,t,n)=>V(new XP(e,t,n)),QP=new WeakMap,$P=class extends Hy{static get type(){return`VelocityNode`}constructor(){super(`vec2`),this.projectionMatrix=null,this.updateType=Ay.OBJECT,this.updateAfterType=Ay.OBJECT,this.previousModelWorldMatrix=Jx(new F),this.previousProjectionMatrix=Jx(new F).setGroup(Gx),this.previousCameraViewMatrix=Jx(new F)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:n}){let r=tF(n);this.previousModelWorldMatrix.value.copy(r);let i=eF(t);i.frameId!==e&&(i.frameId=e,i.previousProjectionMatrix===void 0?(i.previousProjectionMatrix=new F,i.previousCameraViewMatrix=new F,i.currentProjectionMatrix=new F,i.currentCameraViewMatrix=new F,i.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),i.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(i.previousProjectionMatrix.copy(i.currentProjectionMatrix),i.previousCameraViewMatrix.copy(i.currentCameraViewMatrix)),i.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),i.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(i.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(i.previousCameraViewMatrix))}updateAfter({object:e}){tF(e).copy(e.matrixWorld)}setup(){let e=this.projectionMatrix===null?OT:Jx(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),n=e.mul(QT).mul(rE),r=this.previousProjectionMatrix.mul(t).mul(iE);return rS(n.xy.div(n.w),r.xy.div(r.w))}};function eF(e){let t=QP.get(e);return t===void 0&&(t={},QP.set(e,t)),t}function tF(e,t=0){let n=eF(e),r=n[t];return r===void 0&&(n[t]=r=new F,n[t].copy(e.matrixWorld)),r}var nF=H($P),rF=W(([e])=>sF(e.rgb)),iF=W(([e,t=G(1)])=>t.mix(sF(e.rgb),e.rgb)),aF=W(([e,t=G(1)])=>{let n=nS(e.r,e.g,e.b).div(3),r=e.r.max(e.g.max(e.b)),i=r.sub(n).mul(t).mul(-3);return AC(e.rgb,r,i)}),oF=W(([e,t=G(1)])=>{let n=Y(.57735,.57735,.57735),r=t.cos();return Y(e.rgb.mul(r).add(n.cross(e.rgb).mul(t.sin()).add(n.mul(xC(n,e.rgb).mul(r.oneMinus())))))}),sF=(e,t=Y(Un.getLuminanceCoefficients(new j)))=>xC(e,t),cF=W(([e,t=Y(1),n=Y(0),r=Y(1),a=G(1),o=Y(Un.getLuminanceCoefficients(new j,i))])=>{let s=e.rgb.dot(Y(o)),c=gC(e.rgb.mul(t).add(n),0).toVar(),l=c.pow(r).toVar();return Bb(c.r.greaterThan(0),()=>{c.r.assign(l.r)}),Bb(c.g.greaterThan(0),()=>{c.g.assign(l.g)}),Bb(c.b.greaterThan(0),()=>{c.b.assign(l.b)}),c.assign(s.add(c.sub(s).mul(a))),Zb(c.rgb,e.a)}),lF=Fb(class extends Hy{static get type(){return`PosterizeNode`}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){let{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}).setParameterLength(2),uF=new Fe,dF=class extends $w{static get type(){return`PassTextureNode`}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}},fF=class extends dF{static get type(){return`PassMultipleTextureNode`}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){let e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}},pF=class e extends Hy{static get type(){return`PassNode`}constructor(e,t,n,r={}){super(`vec4`),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;let i=new Mt;i.isRenderTargetTexture=!0,i.name=`depth`;let a=new p(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:_t,...r});a.texture.name=`output`,a.depthTexture=i,this.renderTarget=a,this._textures={output:a.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Jx(0),this._cameraFar=Jx(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Ay.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return P(`PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead.`),this.setResolutionScale(e)}getResolution(){return P(`PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead.`),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){let t=this._previousTextures[e];if(t!==void 0){let n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e=`output`){let t=this._textureNodes[e];return t===void 0&&(t=V(new fF(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e=`output`){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=V(new fF(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e=`depth`){let t=this._viewZNodes[e];if(t===void 0){let n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=YO(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(e=`depth`){let t=this._linearDepthNodes[e];if(t===void 0){let n=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(e);this._linearDepthNodes[e]=t=KO(i,n,r)}return t}async compileAsync(e){let t=e.getRenderTarget(),n=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(n)}setup({renderer:t}){return this.renderTarget.samples=this.options.samples===void 0?t.samples:this.options.samples,this.renderTarget.texture.type=t.getColorBufferType(),this.scope===e.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){let{renderer:t}=e,{scene:n}=this,r,i,a=t.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(i=1,r=t.xr.getCamera(),t.xr.updateCamera(r),uF.set(a.width,a.height)):(r=this.camera,i=t.getPixelRatio(),t.getSize(uF)),this._pixelRatio=i,this.setSize(uF.width,uF.height);let o=t.getRenderTarget(),s=t.getMRT(),c=t.autoClear,l=r.layers.mask;for(let e in this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask),this._previousTextures)this.toggleTexture(e);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0;let u=n.name;n.name=this.name?this.name:n.name,t.render(n,r),n.name=u,t.setRenderTarget(o),t.setMRT(s),t.autoClear=c,r.layers.mask=l}setSize(e,t){this._width=e,this._height=t;let n=Math.floor(this._width*this._pixelRatio*this._resolutionScale),r=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(n,r),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,n,r){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new Je),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,n,r),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,n,r){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new Je),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,n,r),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}};pF.COLOR=`color`,pF.DEPTH=`depth`;var mF=(e,t,n)=>V(new pF(pF.COLOR,e,t,n)),hF=(e,t)=>V(new dF(e,t)),gF=(e,t,n)=>V(new pF(pF.DEPTH,e,t,n)),_F=class extends pF{static get type(){return`ToonOutlinePassNode`}constructor(e,t,n,r,i){super(pF.COLOR,e,t),this.colorNode=n,this.thicknessNode=r,this.alphaNode=i,this._materialCache=new WeakMap,this.name=`Outline Pass`}updateBefore(e){let{renderer:t}=e,n=t.getRenderObjectFunction();t.setRenderObjectFunction((e,n,r,i,a,o,s,c)=>{if((a.isMeshToonMaterial||a.isMeshToonNodeMaterial)&&a.wireframe===!1){let l=this._getOutlineMaterial(a);t.renderObject(e,n,r,i,l,o,s,c)}t.renderObject(e,n,r,i,a,o,s,c)}),super.updateBefore(e),t.setRenderObjectFunction(n)}_createMaterial(){let e=new Ck;e.isMeshToonOutlineMaterial=!0,e.name=`Toon_Outline`,e.side=1;let t=pE.negate(),n=OT.mul(QT),r=G(1),i=n.mul(Zb(rE,1)),a=n.mul(Zb(rE.add(t),1)),o=KS(i.sub(a));return e.vertexNode=i.add(o.mul(this.thicknessNode).mul(i.w).mul(r)),e.colorNode=Zb(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}},vF=(e,t,n=new a(0,0,0),r=.003,i=1)=>V(new _F(e,t,V(n),V(r),V(i))),yF=W(([e,t])=>e.mul(t).clamp()).setLayout({name:`linearToneMapping`,type:`vec3`,inputs:[{name:`color`,type:`vec3`},{name:`exposure`,type:`float`}]}),bF=W(([e,t])=>(e=e.mul(t),e.div(e.add(1)).clamp())).setLayout({name:`reinhardToneMapping`,type:`vec3`,inputs:[{name:`color`,type:`vec3`},{name:`exposure`,type:`float`}]}),xF=W(([e,t])=>{e=e.mul(t),e=e.sub(.004).max(0);let n=e.mul(e.mul(6.2).add(.5)),r=e.mul(e.mul(6.2).add(1.7)).add(.06);return n.div(r).pow(2.2)}).setLayout({name:`cineonToneMapping`,type:`vec3`,inputs:[{name:`color`,type:`vec3`},{name:`exposure`,type:`float`}]}),SF=W(([e])=>{let t=e.mul(e.add(.0245786)).sub(90537e-9),n=e.mul(e.add(.432951).mul(.983729)).add(.238081);return t.div(n)}),CF=W(([e,t])=>{let n=nx(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=nx(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return e=e.mul(t).div(.6),e=n.mul(e),e=SF(e),e=r.mul(e),e.clamp()}).setLayout({name:`acesFilmicToneMapping`,type:`vec3`,inputs:[{name:`color`,type:`vec3`},{name:`exposure`,type:`float`}]}),wF=nx(Y(1.6605,-.1246,-.0182),Y(-.5876,1.1329,-.1006),Y(-.0728,-.0083,1.1187)),TF=nx(Y(.6274,.0691,.0164),Y(.3293,.9195,.088),Y(.0433,.0113,.8956)),EF=W(([e])=>{let t=Y(e).toVar(),n=Y(t.mul(t)).toVar(),r=Y(n.mul(n)).toVar();return G(15.5).mul(r.mul(n)).sub(iS(40.14,r.mul(t))).add(iS(31.96,r).sub(iS(6.868,n.mul(t))).add(iS(.4298,n).add(iS(.1191,t).sub(.00232))))}),DF=W(([e,t])=>{let n=Y(e).toVar(),r=nx(Y(.856627153315983,.137318972929847,.11189821299995),Y(.0951212405381588,.761241990602591,.0767994186031903),Y(.0482516061458583,.101439036467562,.811302368396859)),i=nx(Y(1.1271005818144368,-.1413297634984383,-.14132976349843826),Y(-.11060664309660323,1.157823702216272,-.11060664309660294),Y(-.016493938717834573,-.016493938717834257,1.2519364065950405)),a=G(-12.47393),o=G(4.026069);return n.mulAssign(t),n.assign(TF.mul(n)),n.assign(r.mul(n)),n.assign(gC(n,1e-10)),n.assign(VS(n)),n.assign(n.sub(a).div(o.sub(a))),n.assign(jC(n,0,1)),n.assign(EF(n)),n.assign(i.mul(n)),n.assign(CC(gC(Y(0),n),Y(2.2))),n.assign(wF.mul(n)),n.assign(jC(n,0,1)),n}).setLayout({name:`agxToneMapping`,type:`vec3`,inputs:[{name:`color`,type:`vec3`},{name:`exposure`,type:`float`}]}),OF=W(([e,t])=>{let n=G(.76),r=G(.15);e=e.mul(t);let i=hC(e.r,hC(e.g,e.b)),a=UC(i.lessThan(.08),i.sub(iS(6.25,i.mul(i))),.04);e.subAssign(a);let o=gC(e.r,gC(e.g,e.b));Bb(o.lessThan(n),()=>e);let s=rS(1,n),c=rS(1,s.mul(s).div(o.add(s.sub(n))));e.mulAssign(c.div(o));let l=rS(1,aS(1,r.mul(o.sub(c)).add(1)));return AC(e,Y(c),l)}).setLayout({name:`neutralToneMapping`,type:`vec3`,inputs:[{name:`color`,type:`vec3`},{name:`exposure`,type:`float`}]}),kF=class extends zy{static get type(){return`CodeNode`}constructor(e=``,t=[],n=``){super(`code`),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){let t=this.getIncludes(e);for(let n of t)n.build(e);let n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}},AF=Fb(kF).setParameterLength(1,3),jF=(e,t)=>AF(e,t,`js`),MF=(e,t)=>AF(e,t,`wgsl`),NF=(e,t)=>AF(e,t,`glsl`),PF=class extends kF{static get type(){return`FunctionNode`}constructor(e=``,t=[],n=``){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){let n=this.getNodeType(e);return e.getStructTypeNode(n).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){let t=e.getDataFromNode(this),n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);let n=this.getNodeFunction(e),r=n.name,i=n.type,a=e.getCodeFromNode(this,i);r!==``&&(a.name=r);let o=e.getPropertyName(a);return a.code=this.getNodeFunction(e).getCode(o)+`
`,t===`property`?o:e.format(`${o}()`,i,t)}},FF=(e,t=[],n=``)=>{for(let e=0;e<t.length;e++){let n=t[e];typeof n==`function`&&(t[e]=n.functionNode)}let r=V(new PF(e,t,n)),i=(...e)=>r.call(...e);return i.functionNode=r,i},IF=(e,t)=>FF(e,t,`glsl`),LF=(e,t)=>FF(e,t,`wgsl`),RF=Fb(class extends zy{static get type(){return`ScriptableValueNode`}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new pn,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType===`URL`&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:`change`}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:`refresh`})}getValue(){let e=this.value;if(e&&this._cache===null&&this.inputType===`URL`&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType===`URL`||this.inputType===`String`)&&typeof e.value==`string`||this.inputType===`Number`&&typeof e.value==`number`||this.inputType===`Vector2`&&e.value.isVector2||this.inputType===`Vector3`&&e.value.isVector3||this.inputType===`Vector4`&&e.value.isVector4||this.inputType===`Color`&&e.value.isColor||this.inputType===`Matrix3`&&e.value.isMatrix3||this.inputType===`Matrix4`&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):`float`}setup(){return this.value&&this.value.isNode?this.value:G()}serialize(e){super.serialize(e),this.value===null?e.value=null:this.inputType===`ArrayBuffer`?e.value=Dy(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(t=e.inputType===`ArrayBuffer`?Oy(e.value):e.inputType===`Texture`?e.meta.textures[e.value]:e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}).setParameterLength(1),zF=class extends Map{get(e,t=null,...n){if(this.has(e))return super.get(e);if(t!==null){let r=t(...n);return this.set(e,r),r}}},BF=class{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){let t=this.parameters[e];return t?t.getValue():null}},VF=new zF,HF=Fb(class extends zy{static get type(){return`ScriptableNode`}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new zF,this._output=RF(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:``}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(let t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(let t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){let n=this._outputs;return n[e]===void 0?n[e]=RF(t):n[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){let n=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),n[e]=t,n[e].getDefaultOutput().events.addEventListener(`refresh`,this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),n[e]=t,n[e].events.addEventListener(`refresh`,this.onRefresh)):n[e]===void 0?(n[e]=RF(t),n[e].events.addEventListener(`refresh`,this.onRefresh)):n[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener(`refresh`,this.onRefresh)),this}clearParameters(){for(let e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){let n=this.getObject()[e];if(typeof n==`function`)return n(...t)}async callAsync(e,...t){let n=this.getObject()[e];if(typeof n==`function`)return n.constructor.name===`AsyncFunction`?await n(...t):n(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e===null?this._refresh():this.getOutput(e).refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;let e=()=>this.refresh(),t=(e,t)=>this.setOutput(e,t),n=new BF(this),r=VF.get(`THREE`),i=VF.get(`TSL`);this._object=this.getMethod()(n,this._local,VF,e,t,r,i);let a=this._object.layout;if(a&&(a.cache===!1&&this._local.clear(),this._output.outputType=a.outputType||null,Array.isArray(a.elements)))for(let e of a.elements){let t=e.id||e.name;e.inputType&&(this.getParameter(t)===void 0&&this.setParameter(t,null),this.getParameter(t).inputType=e.inputType),e.outputType&&(this.getOutput(t)===void 0&&this.setOutput(t,null),this.getOutput(t).outputType=e.outputType)}return this._object}deserialize(e){for(let t in super.deserialize(e),this.parameters){let e=this.parameters[t];e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.addEventListener(`refresh`,this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){let e=this.getDefaultOutput().value;return e&&e.isNode?e:G()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;let e=[`parameters`,`local`,`global`,`refresh`,`setOutput`,`THREE`,`TSL`],t=[`layout`,`init`,`main`,`dispose`].join(`, `),n=`var `+t+`; var output = {};
`,r=`
return { ...output, `+t+` };`,i=n+this.codeNode.code+r;return this._method=Function(...e,i),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose==`function`&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){let t=[my(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(let n in this.parameters)t.push(this.parameters[n].getCacheKey(e));return hy(t)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call(`main`),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}).setParameterLength(1,2);function UF(e){let t,n=e.context.getViewZ;return n!==void 0&&(t=n(this)),(t||sE.z).negate()}var WF=W(([e,t],n)=>PC(e,t,UF(n))),GF=W(([e],t)=>{let n=UF(t);return e.mul(e,n,n).negate().exp().oneMinus()}),KF=W(([e,t])=>Zb(t.toFloat().mix(jx.rgb,e.toVec3()),jx.a));function qF(e,t,n){return P(`TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.`),KF(e,WF(t,n))}function JF(e,t){return P(`TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.`),KF(e,GF(t))}var YF=null,XF=null,ZF=Fb(class extends zy{static get type(){return`RangeNode`}constructor(e=G(),t=G()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){let t=this.getConstNode(this.minNode),n=this.getConstNode(this.maxNode),r=e.getTypeLength(wy(t.value)),i=e.getTypeLength(wy(n.value));return r>i?r:i}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):`float`}getConstNode(e){let t=null;if(e.traverse(e=>{e.isConstNode===!0&&(t=e)}),t===null)throw Error(`THREE.TSL: No "ConstNode" found in node graph.`);return t}setup(e){let t=e.object,n=null;if(t.count>1){let r=this.getConstNode(this.minNode),i=this.getConstNode(this.maxNode),a=r.value,o=i.value,s=e.getTypeLength(wy(a)),c=e.getTypeLength(wy(o));YF||=new Je,XF||=new Je,YF.setScalar(0),XF.setScalar(0),s===1?YF.setScalar(a):a.isColor?YF.set(a.r,a.g,a.b,1):YF.set(a.x,a.y,a.z||0,a.w||0),c===1?XF.setScalar(o):o.isColor?XF.set(o.r,o.g,o.b,1):XF.set(o.x,o.y,o.z||0,o.w||0);let l=4*t.count,u=new Float32Array(l);for(let e=0;e<l;e++){let t=e%4,n=YF.getComponent(t),r=XF.getComponent(t);u[e]=Bn.lerp(n,r,Math.random())}let d=this.getNodeType(e);if(t.count<=4096)n=cT(u,`vec4`,t.count).element(lO).convert(d);else{let t=new Qn(u,4);e.geometry.setAttribute(`__range`+this.id,t),n=Cw(t).convert(d)}}else n=G(0);return n}}).setParameterLength(2),QF=class extends zy{static get type(){return`ComputeBuiltinNode`}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){let n=this.getBuiltinName(e),r=this.getNodeType(e);return e.shaderStage===`compute`?e.format(n,r,t):(P(`ComputeBuiltinNode: Compute built-in value ${n} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(r))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}},$F=(e,t)=>V(new QF(e,t)),eI=$F(`numWorkgroups`,`uvec3`),tI=$F(`workgroupId`,`uvec3`),nI=$F(`globalId`,`uvec3`),rI=$F(`localId`,`uvec3`),iI=$F(`subgroupSize`,`uint`),aI=Fb(class extends zy{constructor(e){super(),this.scope=e}generate(e){let{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`\t// ${t}Barrier \n`):e.addLineFlowCode(`${t}Barrier()`,this)}}),oI=()=>aI(`workgroup`).toStack(),sI=()=>aI(`storage`).toStack(),cI=()=>aI(`texture`).toStack(),lI=class extends By{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let n,r=e.context.assign;if(n=super.generate(e),r!==!0){let r=this.getNodeType(e);n=e.format(n,r,t)}return n}},uI=class extends zy{constructor(e,t,n=0){super(t),this.bufferType=t,this.bufferCount=n,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=``}setName(e){return this.name=e,this}label(e){return P(`TSL: "label()" has been deprecated. Use "setName()" instead.`),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return V(new lI(this,e))}generate(e){let t=this.name===``?`${this.scope}Array_${this.id}`:this.name;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}},dI=(e,t)=>V(new uI(`Workgroup`,e,t)),fI=class extends zy{static get type(){return`AtomicFunctionNode`}constructor(e,t,n){super(`uint`),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){let t=e.getNodeProperties(this),n=t.parents,r=this.method,i=this.getNodeType(e),a=this.getInputType(e),o=this.pointerNode,s=this.valueNode,c=[];c.push(`&${o.build(e,a)}`),s!==null&&c.push(s.build(e,a));let l=`${e.getMethod(r,i)}( ${c.join(`, `)} )`;if(n&&n.length===1&&n[0].isStackNode===!0)e.addLineFlowCode(l,this);else return t.constNode===void 0&&(t.constNode=Iw(l,i).toConst()),t.constNode.build(e)}};fI.ATOMIC_LOAD=`atomicLoad`,fI.ATOMIC_STORE=`atomicStore`,fI.ATOMIC_ADD=`atomicAdd`,fI.ATOMIC_SUB=`atomicSub`,fI.ATOMIC_MAX=`atomicMax`,fI.ATOMIC_MIN=`atomicMin`,fI.ATOMIC_AND=`atomicAnd`,fI.ATOMIC_OR=`atomicOr`,fI.ATOMIC_XOR=`atomicXor`;var pI=Fb(fI),mI=(e,t,n)=>pI(e,t,n).toStack(),hI=e=>mI(fI.ATOMIC_LOAD,e,null),gI=(e,t)=>mI(fI.ATOMIC_STORE,e,t),_I=(e,t)=>mI(fI.ATOMIC_ADD,e,t),vI=(e,t)=>mI(fI.ATOMIC_SUB,e,t),yI=(e,t)=>mI(fI.ATOMIC_MAX,e,t),bI=(e,t)=>mI(fI.ATOMIC_MIN,e,t),xI=(e,t)=>mI(fI.ATOMIC_AND,e,t),SI=(e,t)=>mI(fI.ATOMIC_OR,e,t),CI=(e,t)=>mI(fI.ATOMIC_XOR,e,t),wI=class e extends Hy{static get type(){return`SubgroupFunctionNode`}constructor(e,t=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=n}getInputType(e){let t=this.aNode?this.aNode.getNodeType(e):null,n=this.bNode?this.bNode.getNodeType(e):null;return(e.isMatrix(t)?0:e.getTypeLength(t))>(e.isMatrix(n)?0:e.getTypeLength(n))?t:n}getNodeType(t){let n=this.method;return n===e.SUBGROUP_ELECT?`bool`:n===e.SUBGROUP_BALLOT?`uvec4`:this.getInputType(t)}generate(t,n){let r=this.method,i=this.getNodeType(t),a=this.getInputType(t),o=this.aNode,s=this.bNode,c=[];if(r===e.SUBGROUP_BROADCAST||r===e.SUBGROUP_SHUFFLE||r===e.QUAD_BROADCAST){let e=s.getNodeType(t);c.push(o.build(t,i),s.build(t,e===`float`?`int`:i))}else r===e.SUBGROUP_SHUFFLE_XOR||r===e.SUBGROUP_SHUFFLE_DOWN||r===e.SUBGROUP_SHUFFLE_UP?c.push(o.build(t,i),s.build(t,`uint`)):(o!==null&&c.push(o.build(t,a)),s!==null&&c.push(s.build(t,a)));let l=c.length===0?`()`:`( ${c.join(`, `)} )`;return t.format(`${t.getMethod(r,i)}${l}`,i,n)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}};wI.SUBGROUP_ELECT=`subgroupElect`,wI.SUBGROUP_BALLOT=`subgroupBallot`,wI.SUBGROUP_ADD=`subgroupAdd`,wI.SUBGROUP_INCLUSIVE_ADD=`subgroupInclusiveAdd`,wI.SUBGROUP_EXCLUSIVE_AND=`subgroupExclusiveAdd`,wI.SUBGROUP_MUL=`subgroupMul`,wI.SUBGROUP_INCLUSIVE_MUL=`subgroupInclusiveMul`,wI.SUBGROUP_EXCLUSIVE_MUL=`subgroupExclusiveMul`,wI.SUBGROUP_AND=`subgroupAnd`,wI.SUBGROUP_OR=`subgroupOr`,wI.SUBGROUP_XOR=`subgroupXor`,wI.SUBGROUP_MIN=`subgroupMin`,wI.SUBGROUP_MAX=`subgroupMax`,wI.SUBGROUP_ALL=`subgroupAll`,wI.SUBGROUP_ANY=`subgroupAny`,wI.SUBGROUP_BROADCAST_FIRST=`subgroupBroadcastFirst`,wI.QUAD_SWAP_X=`quadSwapX`,wI.QUAD_SWAP_Y=`quadSwapY`,wI.QUAD_SWAP_DIAGONAL=`quadSwapDiagonal`,wI.SUBGROUP_BROADCAST=`subgroupBroadcast`,wI.SUBGROUP_SHUFFLE=`subgroupShuffle`,wI.SUBGROUP_SHUFFLE_XOR=`subgroupShuffleXor`,wI.SUBGROUP_SHUFFLE_UP=`subgroupShuffleUp`,wI.SUBGROUP_SHUFFLE_DOWN=`subgroupShuffleDown`,wI.QUAD_BROADCAST=`quadBroadcast`;var TI=U(wI,wI.SUBGROUP_ELECT).setParameterLength(0),EI=U(wI,wI.SUBGROUP_BALLOT).setParameterLength(1),DI=U(wI,wI.SUBGROUP_ADD).setParameterLength(1),OI=U(wI,wI.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),kI=U(wI,wI.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),AI=U(wI,wI.SUBGROUP_MUL).setParameterLength(1),jI=U(wI,wI.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),MI=U(wI,wI.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),NI=U(wI,wI.SUBGROUP_AND).setParameterLength(1),PI=U(wI,wI.SUBGROUP_OR).setParameterLength(1),FI=U(wI,wI.SUBGROUP_XOR).setParameterLength(1),II=U(wI,wI.SUBGROUP_MIN).setParameterLength(1),LI=U(wI,wI.SUBGROUP_MAX).setParameterLength(1),RI=U(wI,wI.SUBGROUP_ALL).setParameterLength(0),zI=U(wI,wI.SUBGROUP_ANY).setParameterLength(0),BI=U(wI,wI.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),VI=U(wI,wI.QUAD_SWAP_X).setParameterLength(1),HI=U(wI,wI.QUAD_SWAP_Y).setParameterLength(1),UI=U(wI,wI.QUAD_SWAP_DIAGONAL).setParameterLength(1),WI=U(wI,wI.SUBGROUP_BROADCAST).setParameterLength(2),GI=U(wI,wI.SUBGROUP_SHUFFLE).setParameterLength(2),KI=U(wI,wI.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),qI=U(wI,wI.SUBGROUP_SHUFFLE_UP).setParameterLength(2),JI=U(wI,wI.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),YI=U(wI,wI.QUAD_BROADCAST).setParameterLength(1),XI;function ZI(e){XI||=new WeakMap;let t=XI.get(e);return t===void 0&&XI.set(e,t={}),t}function QI(e){let t=ZI(e);return t.shadowMatrix||=Jx(`mat4`).setGroup(Gx).onRenderUpdate(t=>((e.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(e.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(e.shadow.camera.coordinateSystem=t.camera.coordinateSystem,e.shadow.camera.updateProjectionMatrix()),e.shadow.updateMatrices(e)),e.shadow.matrix))}function $I(e,t=aE){let n=QI(e).mul(t);return n.xyz.div(n.w)}function eL(e){let t=ZI(e);return t.position||=Jx(new j).setGroup(Gx).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(e.matrixWorld))}function tL(e){let t=ZI(e);return t.targetPosition||=Jx(new j).setGroup(Gx).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(e.target.matrixWorld))}function nL(e){let t=ZI(e);return t.viewPosition||=Jx(new j).setGroup(Gx).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new j,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)})}var rL=e=>AT.transformDirection(eL(e).sub(tL(e))),iL=e=>e.sort((e,t)=>e.id-t.id),aL=(e,t)=>{for(let n of t)if(n.isAnalyticLightNode&&n.light.id===e)return n;return null},oL=new WeakMap,sL=[],cL=class extends zy{static get type(){return`LightsNode`}constructor(){super(`vec3`),this.totalDiffuseNode=dx(`vec3`,`totalDiffuse`),this.totalSpecularNode=dx(`vec3`,`totalSpecular`),this.outgoingLightNode=dx(`vec3`,`outgoingLight`),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){let e=this._lights;for(let t=0;t<e.length;t++){let n=e[t];if(sL.push(n.id),sL.push(n.castShadow?1:0),n.isSpotLight===!0){let e=n.map===null?-1:n.map.id,t=n.colorNode?n.colorNode.getCacheKey():-1;sL.push(e,t)}}let t=hy(sL);return sL.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);let t=[];for(let e of this._lightNodes)t.push(e.getHash());this._lightNodesHash=`lights-`+t.join(`,`)}return this._lightNodesHash}analyze(e){let t=e.getNodeProperties(this);for(let n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){let t=[],n=this._lightNodes,r=iL(this._lights),i=e.renderer.library;for(let e of r)if(e.isNode)t.push(V(e));else{let r=null;if(n!==null&&(r=aL(e.id,n)),r===null){let n=i.getLightNodeClass(e.constructor);if(n===null){P(`LightsNode.setupNodeLights: Light node not found for ${e.constructor.name}`);continue}let r=null;oL.has(e)?r=oL.get(e):(r=V(new n(e)),oL.set(e,r)),t.push(r)}}this._lightNodes=t}setupDirectLight(e,t,n){let{lightingModel:r,reflectedLight:i}=e.context;r.direct({...n,lightNode:t,reflectedLight:i},e)}setupDirectRectAreaLight(e,t,n){let{lightingModel:r,reflectedLight:i}=e.context;r.directRectArea({...n,lightNode:t,reflectedLight:i},e)}setupLights(e,t){for(let n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){let t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode,r=e.context,i=r.lightingModel,a=e.getNodeProperties(this);if(i){let{totalDiffuseNode:t,totalSpecularNode:o}=this;r.outgoingLight=n,a.nodes=e.addStack().nodes,i.start(e);let{backdrop:s,backdropAlpha:c}=r,{directDiffuse:l,directSpecular:u,indirectDiffuse:d,indirectSpecular:f}=r.reflectedLight,p=l.add(d);s!==null&&(p=Y(c===null?s:c.mix(p,s))),t.assign(p),o.assign(u.add(f)),n.assign(t.add(o)),i.finish(e),n=n.bypass(e.removeStack())}else a.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}},lL=(e=[])=>V(new cL).setLights(e),uL=class extends zy{static get type(){return`ShadowBaseNode`}constructor(e){super(),this.light=e,this.updateBeforeType=Ay.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){dL.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||aE)}},dL=dx(`vec3`,`shadowPositionWorld`);function fL(e,t={}){return t.toneMapping=e.toneMapping,t.toneMappingExposure=e.toneMappingExposure,t.outputColorSpace=e.outputColorSpace,t.renderTarget=e.getRenderTarget(),t.activeCubeFace=e.getActiveCubeFace(),t.activeMipmapLevel=e.getActiveMipmapLevel(),t.renderObjectFunction=e.getRenderObjectFunction(),t.pixelRatio=e.getPixelRatio(),t.mrt=e.getMRT(),t.clearColor=e.getClearColor(t.clearColor||new a),t.clearAlpha=e.getClearAlpha(),t.autoClear=e.autoClear,t.scissorTest=e.getScissorTest(),t}function pL(e,t){return t=fL(e,t),e.setMRT(null),e.setRenderObjectFunction(null),e.setClearColor(0,1),e.autoClear=!0,t}function mL(e,t){e.toneMapping=t.toneMapping,e.toneMappingExposure=t.toneMappingExposure,e.outputColorSpace=t.outputColorSpace,e.setRenderTarget(t.renderTarget,t.activeCubeFace,t.activeMipmapLevel),e.setRenderObjectFunction(t.renderObjectFunction),e.setPixelRatio(t.pixelRatio),e.setMRT(t.mrt),e.setClearColor(t.clearColor,t.clearAlpha),e.autoClear=t.autoClear,e.setScissorTest(t.scissorTest)}function hL(e,t={}){return t.background=e.background,t.backgroundNode=e.backgroundNode,t.overrideMaterial=e.overrideMaterial,t}function gL(e,t){return t=hL(e,t),e.background=null,e.backgroundNode=null,e.overrideMaterial=null,t}function _L(e,t){e.background=t.background,e.backgroundNode=t.backgroundNode,e.overrideMaterial=t.overrideMaterial}function vL(e,t,n){return n=pL(e,n),n=gL(t,n),n}function yL(e,t,n){mL(e,n),_L(t,n)}var bL=new WeakMap,xL=W(({depthTexture:e,shadowCoord:t,depthLayer:n})=>{let r=tT(e,t.xy).setName(`t_basic`);return e.isArrayTexture&&(r=r.depth(n)),r.compare(t.z)}),SL=W(({depthTexture:e,shadowCoord:t,shadow:n,depthLayer:r})=>{let i=(t,n)=>{let i=tT(e,t);return e.isArrayTexture&&(i=i.depth(r)),i.compare(n)},a=BE(`mapSize`,`vec2`,n).setGroup(Gx),o=BE(`radius`,`float`,n).setGroup(Gx),s=J(1).div(a),c=s.x.negate().mul(o),l=s.y.negate().mul(o),u=s.x.mul(o),d=s.y.mul(o),f=c.div(2),p=l.div(2),m=u.div(2),h=d.div(2);return nS(i(t.xy.add(J(c,l)),t.z),i(t.xy.add(J(0,l)),t.z),i(t.xy.add(J(u,l)),t.z),i(t.xy.add(J(f,p)),t.z),i(t.xy.add(J(0,p)),t.z),i(t.xy.add(J(m,p)),t.z),i(t.xy.add(J(c,0)),t.z),i(t.xy.add(J(f,0)),t.z),i(t.xy,t.z),i(t.xy.add(J(m,0)),t.z),i(t.xy.add(J(u,0)),t.z),i(t.xy.add(J(f,h)),t.z),i(t.xy.add(J(0,h)),t.z),i(t.xy.add(J(m,h)),t.z),i(t.xy.add(J(c,d)),t.z),i(t.xy.add(J(0,d)),t.z),i(t.xy.add(J(u,d)),t.z)).mul(1/17)}),CL=W(({depthTexture:e,shadowCoord:t,shadow:n,depthLayer:r})=>{let i=(t,n)=>{let i=tT(e,t);return e.isArrayTexture&&(i=i.depth(r)),i.compare(n)},a=BE(`mapSize`,`vec2`,n).setGroup(Gx),o=J(1).div(a),s=o.x,c=o.y,l=t.xy,u=qS(l.mul(a).add(.5));return l.subAssign(u.mul(o)),nS(i(l,t.z),i(l.add(J(s,0)),t.z),i(l.add(J(0,c)),t.z),i(l.add(o),t.z),AC(i(l.add(J(s.negate(),0)),t.z),i(l.add(J(s.mul(2),0)),t.z),u.x),AC(i(l.add(J(s.negate(),c)),t.z),i(l.add(J(s.mul(2),c)),t.z),u.x),AC(i(l.add(J(0,c.negate())),t.z),i(l.add(J(0,c.mul(2))),t.z),u.y),AC(i(l.add(J(s,c.negate())),t.z),i(l.add(J(s,c.mul(2))),t.z),u.y),AC(AC(i(l.add(J(s.negate(),c.negate())),t.z),i(l.add(J(s.mul(2),c.negate())),t.z),u.x),AC(i(l.add(J(s.negate(),c.mul(2))),t.z),i(l.add(J(s.mul(2),c.mul(2))),t.z),u.x),u.y)).mul(1/9)}),wL=W(({depthTexture:e,shadowCoord:t,depthLayer:n})=>{let r=G(1).toVar(),i=tT(e).sample(t.xy);e.isArrayTexture&&(i=i.depth(n)),i=i.rg;let a=_C(t.z,i.x);return Bb(a.notEqual(G(1)),()=>{let e=t.z.sub(i.x),n=gC(0,i.y.mul(i.y)),o=n.div(n.add(e.mul(e)));o=jC(rS(o,.3).div(.6499999999999999)),r.assign(jC(gC(a,o)))}),r}),TL=W(([e,t,n])=>{let r=aE.sub(e).length();return r=r.sub(t).div(n.sub(t)),r=r.saturate(),r}),EL=e=>{let t=e.shadow.camera,n=BE(`near`,`float`,t).setGroup(Gx),r=BE(`far`,`float`,t).setGroup(Gx);return TL(zT(e),n,r)},DL=e=>{let t=bL.get(e);if(t===void 0){let n=e.isPointLight?EL(e):null;t=new Ck,t.colorNode=Zb(0,0,0,1),t.depthNode=n,t.isShadowPassMaterial=!0,t.name=`ShadowMaterial`,t.fog=!1,bL.set(e,t)}return t},OL=new DM,kL=[],AL=(e,t,n,r)=>{kL[0]=e,kL[1]=t;let i=OL.get(kL);return(i===void 0||i.shadowType!==n||i.useVelocity!==r)&&(i=(i,a,o,s,c,l,...u)=>{(i.castShadow===!0||i.receiveShadow&&n===3)&&(r&&(Ey(i).useVelocity=!0),i.onBeforeShadow(e,i,o,t.camera,s,a.overrideMaterial,l),e.renderObject(i,a,o,s,c,l,...u),i.onAfterShadow(e,i,o,t.camera,s,a.overrideMaterial,l))},i.shadowType=n,i.useVelocity=r,OL.set(kL,i)),kL[0]=null,kL[1]=null,i},jL=W(({samples:e,radius:t,size:n,shadowPass:r,depthLayer:i})=>{let a=G(0).toVar(`meanVertical`),o=G(0).toVar(`squareMeanVertical`),s=e.lessThanEqual(G(1)).select(G(0),G(2).div(e.sub(1))),c=e.lessThanEqual(G(1)).select(G(0),G(-1));return DO({start:K(0),end:K(e),type:`int`,condition:`<`},({i:e})=>{let l=c.add(G(e).mul(s)),u=r.sample(nS(yT.xy,J(0,l).mul(t)).div(n));r.value.isArrayTexture&&(u=u.depth(i)),u=u.x,a.addAssign(u),o.addAssign(u.mul(u))}),a.divAssign(e),o.divAssign(e),J(a,HS(o.sub(a.mul(a))))}),ML=W(({samples:e,radius:t,size:n,shadowPass:r,depthLayer:i})=>{let a=G(0).toVar(`meanHorizontal`),o=G(0).toVar(`squareMeanHorizontal`),s=e.lessThanEqual(G(1)).select(G(0),G(2).div(e.sub(1))),c=e.lessThanEqual(G(1)).select(G(0),G(-1));return DO({start:K(0),end:K(e),type:`int`,condition:`<`},({i:e})=>{let l=c.add(G(e).mul(s)),u=r.sample(nS(yT.xy,J(l,0).mul(t)).div(n));r.value.isArrayTexture&&(u=u.depth(i)),a.addAssign(u.x),o.addAssign(nS(u.y.mul(u.y),u.x.mul(u.x)))}),a.divAssign(e),o.divAssign(e),J(a,HS(o.sub(a.mul(a))))}),NL=[xL,SL,CL,wL],PL,FL=new vP,IL=class extends uL{static get type(){return`ShadowNode`}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:i,depthLayer:a}){let o=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),s=t({depthTexture:n,shadowCoord:r,shadow:i,depthLayer:a});return o.select(s,G(1))}setupShadowCoord(e,t){let{shadow:n}=this,{renderer:r}=e,i=BE(`bias`,`float`,n).setGroup(Gx),a=t,o;if(n.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)a=a.xyz.div(a.w),o=a.z,r.coordinateSystem===2001&&(o=o.mul(2).sub(1));else{let e=a.w;a=a.xy.div(e);let t=BE(`near`,`float`,n.camera).setGroup(Gx),r=BE(`far`,`float`,n.camera).setGroup(Gx);o=XO(e.negate(),t,r)}return a=Y(a.x,a.y.oneMinus(),o.add(i)),a}getShadowFilterFn(e){return NL[e]}setupRenderTarget(e,t){let n=new Mt(e.mapSize.width,e.mapSize.height);n.name=`ShadowDepthTexture`,n.compareFunction=513;let r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name=`ShadowMap`,r.texture.type=e.mapType,r.depthTexture=n,{shadowMap:r,depthTexture:n}}setupShadow(e){let{renderer:t,camera:n}=e,{light:r,shadow:i}=this,a=t.shadowMap.type,{depthTexture:o,shadowMap:s}=this.setupRenderTarget(i,e);if(i.camera.coordinateSystem=n.coordinateSystem,i.camera.updateProjectionMatrix(),a===3&&i.isPointLightShadow!==!0){o.compareFunction=null,s.depth>1?(s._vsmShadowMapVertical||(s._vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Ve,type:_t,depth:s.depth,depthBuffer:!1}),s._vsmShadowMapVertical.texture.name=`VSMVertical`),this.vsmShadowMapVertical=s._vsmShadowMapVertical,s._vsmShadowMapHorizontal||(s._vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Ve,type:_t,depth:s.depth,depthBuffer:!1}),s._vsmShadowMapHorizontal.texture.name=`VSMHorizontal`),this.vsmShadowMapHorizontal=s._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Ve,type:_t,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Ve,type:_t,depthBuffer:!1}));let t=tT(o);o.isArrayTexture&&(t=t.depth(this.depthLayer));let n=tT(this.vsmShadowMapVertical.texture);o.isArrayTexture&&(n=n.depth(this.depthLayer));let r=BE(`blurSamples`,`float`,i).setGroup(Gx),a=BE(`radius`,`float`,i).setGroup(Gx),c=BE(`mapSize`,`vec2`,i).setGroup(Gx),l=this.vsmMaterialVertical||=new Ck;l.fragmentNode=jL({samples:r,radius:a,size:c,shadowPass:t,depthLayer:this.depthLayer}).context(e.getSharedContext()),l.name=`VSMVertical`,l=this.vsmMaterialHorizontal||=new Ck,l.fragmentNode=ML({samples:r,radius:a,size:c,shadowPass:n,depthLayer:this.depthLayer}).context(e.getSharedContext()),l.name=`VSMHorizontal`}let c=BE(`intensity`,`float`,i).setGroup(Gx),l=BE(`normalBias`,`float`,i).setGroup(Gx),u=QI(r).mul(dL.add(vE.mul(l))),d=this.setupShadowCoord(e,u),f=i.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(f===null)throw Error(`THREE.WebGPURenderer: Shadow map type not supported yet.`);let p=a===3&&i.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:o,m=this.setupShadowFilter(e,{filterFn:f,shadowTexture:s.texture,depthTexture:p,shadowCoord:d,shadow:i,depthLayer:this.depthLayer}),h=tT(s.texture,d);o.isArrayTexture&&(h=h.depth(this.depthLayer));let g=AC(1,m.rgb.mix(h,1),c.mul(h.a)).toVar();this.shadowMap=s,this.shadow.map=s;let _=`${this.light.type} Shadow [ ${this.light.name||`ID: `+this.light.id} ]`;return g.toInspector(`${_} / Color`,()=>tT(this.shadowMap.texture)).toInspector(`${_} / Depth`,()=>rT(this.shadowMap.depthTexture,Yw().mul(Xw(tT(this.shadowMap.depthTexture)))).x.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return W(()=>{let t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let n=this._node;return this.setupShadowPosition(e),n===null&&(this._node=n=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&P(`NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.`),e.material.receivedShadowNode&&(n=e.material.receivedShadowNode(n)),n})()}renderShadow(e){let{shadow:t,shadowMap:n,light:r}=this,{renderer:i,scene:a}=e;t.updateMatrices(r),n.setSize(t.mapSize.width,t.mapSize.height,n.depth);let o=a.name;a.name=`Shadow Map [ ${r.name||`ID: `+r.id} ]`,i.render(a,t.camera),a.name=o}updateShadow(e){let{shadowMap:t,light:n,shadow:r}=this,{renderer:i,scene:a,camera:o}=e,s=i.shadowMap.type;this._depthVersionCached=t.depthTexture.version;let c=r.camera.layers.mask;r.camera.layers.mask&4294967294||(r.camera.layers.mask=o.layers.mask);let l=i.getRenderObjectFunction(),u=i.getMRT(),d=u?u.has(`velocity`):!1;PL=vL(i,a,PL),a.overrideMaterial=DL(n),i.setRenderObjectFunction(AL(i,r,s,d)),i.setClearColor(0,0),i.setRenderTarget(t),this.renderShadow(e),i.setRenderObjectFunction(l),s===3&&r.isPointLightShadow!==!0&&this.vsmPass(i),r.camera.layers.mask=c,yL(i,a,PL)}vsmPass(e){let{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),FL.material=this.vsmMaterialVertical,FL.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),FL.material=this.vsmMaterialHorizontal,FL.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,this.shadowMap&&=(this.shadowMap.dispose(),null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){let{shadow:t}=this,n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}},LL=(e,t)=>V(new IL(e,t)),RL=new a,zL=W(([e,t])=>{let n=e.toVar(),r=eC(n),i=aS(1,gC(r.x,gC(r.y,r.z)));r.mulAssign(i),n.mulAssign(i.mul(t.mul(2).oneMinus()));let a=J(n.xy).toVar(),o=t.mul(1.5).oneMinus();return Bb(r.z.greaterThanEqual(o),()=>{Bb(n.z.greaterThan(0),()=>{a.x.assign(rS(4,n.x))})}).ElseIf(r.x.greaterThanEqual(o),()=>{let e=tC(n.x);a.x.assign(n.z.mul(e).add(e.mul(2)))}).ElseIf(r.y.greaterThanEqual(o),()=>{let e=tC(n.y);a.x.assign(n.x.add(e.mul(2)).add(2)),a.y.assign(n.z.mul(e).sub(2))}),J(.125,.25).mul(a).add(J(.375,.75)).flipY()}).setLayout({name:`cubeToUV`,type:`vec2`,inputs:[{name:`pos`,type:`vec3`},{name:`texelSizeY`,type:`float`}]}),BL=W(({depthTexture:e,bd3D:t,dp:n,texelSize:r})=>tT(e,zL(t,r.y)).compare(n)),VL=W(({depthTexture:e,bd3D:t,dp:n,texelSize:r,shadow:i})=>{let a=BE(`radius`,`float`,i).setGroup(Gx),o=J(-1,1).mul(a).mul(r.y);return tT(e,zL(t.add(o.xyy),r.y)).compare(n).add(tT(e,zL(t.add(o.yyy),r.y)).compare(n)).add(tT(e,zL(t.add(o.xyx),r.y)).compare(n)).add(tT(e,zL(t.add(o.yyx),r.y)).compare(n)).add(tT(e,zL(t,r.y)).compare(n)).add(tT(e,zL(t.add(o.xxy),r.y)).compare(n)).add(tT(e,zL(t.add(o.yxy),r.y)).compare(n)).add(tT(e,zL(t.add(o.xxx),r.y)).compare(n)).add(tT(e,zL(t.add(o.yxx),r.y)).compare(n)).mul(1/9)}),HL=W(({filterFn:e,depthTexture:t,shadowCoord:n,shadow:r})=>{let i=n.xyz.toVar(),a=i.length(),o=Jx(`float`).setGroup(Gx).onRenderUpdate(()=>r.camera.near),s=Jx(`float`).setGroup(Gx).onRenderUpdate(()=>r.camera.far),c=BE(`bias`,`float`,r).setGroup(Gx),l=Jx(r.mapSize).setGroup(Gx),u=G(1).toVar();return Bb(a.sub(s).lessThanEqual(0).and(a.sub(o).greaterThanEqual(0)),()=>{let n=a.sub(o).div(s.sub(o)).toVar();n.addAssign(c);let d=i.normalize(),f=J(1).div(l.mul(J(4,2)));u.assign(e({depthTexture:t,bd3D:d,dp:n,texelSize:f,shadow:r}))}),u}),UL=new Je,WL=new Fe,GL=new Fe,KL=class extends IL{static get type(){return`PointShadowNode`}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===0?BL:VL}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:i,shadow:a}){return HL({filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:i,shadow:a})}renderShadow(e){let{shadow:t,shadowMap:n,light:r}=this,{renderer:i,scene:a}=e,o=t.getFrameExtents();GL.copy(t.mapSize),GL.multiply(o),n.setSize(GL.width,GL.height),WL.copy(t.mapSize);let s=i.autoClear,c=i.getClearColor(RL),l=i.getClearAlpha();i.autoClear=!1,i.setClearColor(t.clearColor,t.clearAlpha),i.clear();let u=t.getViewportCount();for(let e=0;e<u;e++){let o=t.getViewport(e),s=WL.x*o.x,c=GL.y-WL.y-WL.y*o.y;UL.set(s,c,WL.x*o.z,WL.y*o.w),n.viewport.copy(UL),t.updateMatrices(r,e);let l=a.name;a.name=`Point Light Shadow [ ${r.name||`ID: `+r.id} ] - Face ${e+1}`,i.render(a,t.camera),a.name=l}i.autoClear=s,i.setClearColor(c,l)}},qL=(e,t)=>V(new KL(e,t)),JL=class extends FO{static get type(){return`AnalyticLightNode`}constructor(e=null){super(),this.light=e,this.color=new a,this.colorNode=e&&e.colorNode||Jx(this.color).setGroup(Gx),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Ay.FRAME}getHash(){return this.light.uuid}getLightVector(e){return nL(this.light).sub(e.context.positionView||sE)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return LL(this.light)}setupShadow(e){let{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){let e=this.light.shadow.shadowNode,t;t=e===void 0?this.setupShadowNode():V(e),this.shadowNode=t,this.shadowColorNode=n=this.colorNode.mul(t),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);let t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){let{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}},YL=W(({lightDistance:e,cutoffDistance:t,decayExponent:n})=>{let r=e.pow(n).max(.01).reciprocal();return t.greaterThan(0).select(r.mul(e.div(t).pow4().oneMinus().clamp().pow2()),r)}),XL=({color:e,lightVector:t,cutoffDistance:n,decayExponent:r})=>{let i=t.normalize(),a=YL({lightDistance:t.length(),cutoffDistance:n,decayExponent:r});return{lightDirection:i,lightColor:e.mul(a)}},ZL=class extends JL{static get type(){return`PointLightNode`}constructor(e=null){super(e),this.cutoffDistanceNode=Jx(0).setGroup(Gx),this.decayExponentNode=Jx(2).setGroup(Gx)}update(e){let{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return qL(this.light)}setupDirect(e){return XL({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}},QL=W(([e=Yw()])=>{let t=e.mul(2),n=t.x.floor(),r=t.y.floor();return n.add(r).mod(2).sign()}),$L=W(([e=Yw()],{renderer:t,material:n})=>{let r=kC(e.mul(2).sub(1)),i;if(n.alphaToCoverage&&t.currentSamples>0){let e=G(r.fwidth()).toVar();i=PC(e.oneMinus(),e.add(1),r).oneMinus()}else i=UC(r.greaterThan(1),0,1);return i}),eR=W(([e,t,n])=>{let r=G(n).toVar(),i=G(t).toVar();return UC(Wb(e).toVar(),i,r)}).setLayout({name:`mx_select`,type:`float`,inputs:[{name:`b`,type:`bool`},{name:`t`,type:`float`},{name:`f`,type:`float`}]}),tR=W(([e,t])=>{let n=Wb(t).toVar(),r=G(e).toVar();return UC(n,r.negate(),r)}).setLayout({name:`mx_negate_if`,type:`float`,inputs:[{name:`val`,type:`float`},{name:`b`,type:`bool`}]}),nR=W(([e])=>K(WS(G(e).toVar()))).setLayout({name:`mx_floor`,type:`int`,inputs:[{name:`x`,type:`float`}]}),rR=W(([e,t])=>{let n=G(e).toVar();return t.assign(nR(n)),n.sub(G(t))}),iR=RN([W(([e,t,n,r,i,a])=>{let o=G(a).toVar(),s=G(i).toVar(),c=G(r).toVar(),l=G(n).toVar(),u=G(t).toVar(),d=G(e).toVar(),f=G(rS(1,s)).toVar();return rS(1,o).mul(d.mul(f).add(u.mul(s))).add(o.mul(l.mul(f).add(c.mul(s))))}).setLayout({name:`mx_bilerp_0`,type:`float`,inputs:[{name:`v0`,type:`float`},{name:`v1`,type:`float`},{name:`v2`,type:`float`},{name:`v3`,type:`float`},{name:`s`,type:`float`},{name:`t`,type:`float`}]}),W(([e,t,n,r,i,a])=>{let o=G(a).toVar(),s=G(i).toVar(),c=Y(r).toVar(),l=Y(n).toVar(),u=Y(t).toVar(),d=Y(e).toVar(),f=G(rS(1,s)).toVar();return rS(1,o).mul(d.mul(f).add(u.mul(s))).add(o.mul(l.mul(f).add(c.mul(s))))}).setLayout({name:`mx_bilerp_1`,type:`vec3`,inputs:[{name:`v0`,type:`vec3`},{name:`v1`,type:`vec3`},{name:`v2`,type:`vec3`},{name:`v3`,type:`vec3`},{name:`s`,type:`float`},{name:`t`,type:`float`}]})]),aR=RN([W(([e,t,n,r,i,a,o,s,c,l,u])=>{let d=G(u).toVar(),f=G(l).toVar(),p=G(c).toVar(),m=G(s).toVar(),h=G(o).toVar(),g=G(a).toVar(),_=G(i).toVar(),v=G(r).toVar(),y=G(n).toVar(),b=G(t).toVar(),x=G(e).toVar(),S=G(rS(1,p)).toVar(),C=G(rS(1,f)).toVar();return G(rS(1,d)).toVar().mul(C.mul(x.mul(S).add(b.mul(p))).add(f.mul(y.mul(S).add(v.mul(p))))).add(d.mul(C.mul(_.mul(S).add(g.mul(p))).add(f.mul(h.mul(S).add(m.mul(p))))))}).setLayout({name:`mx_trilerp_0`,type:`float`,inputs:[{name:`v0`,type:`float`},{name:`v1`,type:`float`},{name:`v2`,type:`float`},{name:`v3`,type:`float`},{name:`v4`,type:`float`},{name:`v5`,type:`float`},{name:`v6`,type:`float`},{name:`v7`,type:`float`},{name:`s`,type:`float`},{name:`t`,type:`float`},{name:`r`,type:`float`}]}),W(([e,t,n,r,i,a,o,s,c,l,u])=>{let d=G(u).toVar(),f=G(l).toVar(),p=G(c).toVar(),m=Y(s).toVar(),h=Y(o).toVar(),g=Y(a).toVar(),_=Y(i).toVar(),v=Y(r).toVar(),y=Y(n).toVar(),b=Y(t).toVar(),x=Y(e).toVar(),S=G(rS(1,p)).toVar(),C=G(rS(1,f)).toVar();return G(rS(1,d)).toVar().mul(C.mul(x.mul(S).add(b.mul(p))).add(f.mul(y.mul(S).add(v.mul(p))))).add(d.mul(C.mul(_.mul(S).add(g.mul(p))).add(f.mul(h.mul(S).add(m.mul(p))))))}).setLayout({name:`mx_trilerp_1`,type:`vec3`,inputs:[{name:`v0`,type:`vec3`},{name:`v1`,type:`vec3`},{name:`v2`,type:`vec3`},{name:`v3`,type:`vec3`},{name:`v4`,type:`vec3`},{name:`v5`,type:`vec3`},{name:`v6`,type:`vec3`},{name:`v7`,type:`vec3`},{name:`s`,type:`float`},{name:`t`,type:`float`},{name:`r`,type:`float`}]})]),oR=RN([W(([e,t,n])=>{let r=G(n).toVar(),i=G(t).toVar(),a=q(q(e).toVar().bitAnd(q(7))).toVar(),o=G(eR(a.lessThan(q(4)),i,r)).toVar(),s=G(iS(2,eR(a.lessThan(q(4)),r,i))).toVar();return tR(o,Wb(a.bitAnd(q(1)))).add(tR(s,Wb(a.bitAnd(q(2)))))}).setLayout({name:`mx_gradient_float_0`,type:`float`,inputs:[{name:`hash`,type:`uint`},{name:`x`,type:`float`},{name:`y`,type:`float`}]}),W(([e,t,n,r])=>{let i=G(r).toVar(),a=G(n).toVar(),o=G(t).toVar(),s=q(q(e).toVar().bitAnd(q(15))).toVar(),c=G(eR(s.lessThan(q(8)),o,a)).toVar(),l=G(eR(s.lessThan(q(4)),a,eR(s.equal(q(12)).or(s.equal(q(14))),o,i))).toVar();return tR(c,Wb(s.bitAnd(q(1)))).add(tR(l,Wb(s.bitAnd(q(2)))))}).setLayout({name:`mx_gradient_float_1`,type:`float`,inputs:[{name:`hash`,type:`uint`},{name:`x`,type:`float`},{name:`y`,type:`float`},{name:`z`,type:`float`}]})]),sR=RN([W(([e,t,n])=>{let r=G(n).toVar(),i=G(t).toVar(),a=Yb(e).toVar();return Y(oR(a.x,i,r),oR(a.y,i,r),oR(a.z,i,r))}).setLayout({name:`mx_gradient_vec3_0`,type:`vec3`,inputs:[{name:`hash`,type:`uvec3`},{name:`x`,type:`float`},{name:`y`,type:`float`}]}),W(([e,t,n,r])=>{let i=G(r).toVar(),a=G(n).toVar(),o=G(t).toVar(),s=Yb(e).toVar();return Y(oR(s.x,o,a,i),oR(s.y,o,a,i),oR(s.z,o,a,i))}).setLayout({name:`mx_gradient_vec3_1`,type:`vec3`,inputs:[{name:`hash`,type:`uvec3`},{name:`x`,type:`float`},{name:`y`,type:`float`},{name:`z`,type:`float`}]})]),cR=W(([e])=>iS(.6616,G(e).toVar())).setLayout({name:`mx_gradient_scale2d_0`,type:`float`,inputs:[{name:`v`,type:`float`}]}),lR=W(([e])=>iS(.982,G(e).toVar())).setLayout({name:`mx_gradient_scale3d_0`,type:`float`,inputs:[{name:`v`,type:`float`}]}),uR=RN([cR,W(([e])=>iS(.6616,Y(e).toVar())).setLayout({name:`mx_gradient_scale2d_1`,type:`vec3`,inputs:[{name:`v`,type:`vec3`}]})]),dR=RN([lR,W(([e])=>iS(.982,Y(e).toVar())).setLayout({name:`mx_gradient_scale3d_1`,type:`vec3`,inputs:[{name:`v`,type:`vec3`}]})]),fR=W(([e,t])=>{let n=K(t).toVar(),r=q(e).toVar();return r.shiftLeft(n).bitOr(r.shiftRight(K(32).sub(n)))}).setLayout({name:`mx_rotl32`,type:`uint`,inputs:[{name:`x`,type:`uint`},{name:`k`,type:`int`}]}),pR=W(([e,t,n])=>{e.subAssign(n),e.bitXorAssign(fR(n,K(4))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(fR(e,K(6))),e.addAssign(n),n.subAssign(t),n.bitXorAssign(fR(t,K(8))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(fR(n,K(16))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(fR(e,K(19))),e.addAssign(n),n.subAssign(t),n.bitXorAssign(fR(t,K(4))),t.addAssign(e)}),mR=W(([e,t,n])=>{let r=q(n).toVar(),i=q(t).toVar(),a=q(e).toVar();return r.bitXorAssign(i),r.subAssign(fR(i,K(14))),a.bitXorAssign(r),a.subAssign(fR(r,K(11))),i.bitXorAssign(a),i.subAssign(fR(a,K(25))),r.bitXorAssign(i),r.subAssign(fR(i,K(16))),a.bitXorAssign(r),a.subAssign(fR(r,K(4))),i.bitXorAssign(a),i.subAssign(fR(a,K(14))),r.bitXorAssign(i),r.subAssign(fR(i,K(24))),r}).setLayout({name:`mx_bjfinal`,type:`uint`,inputs:[{name:`a`,type:`uint`},{name:`b`,type:`uint`},{name:`c`,type:`uint`}]}),hR=W(([e])=>G(q(e).toVar()).div(G(q(K(4294967295))))).setLayout({name:`mx_bits_to_01`,type:`float`,inputs:[{name:`bits`,type:`uint`}]}),gR=W(([e])=>{let t=G(e).toVar();return t.mul(t).mul(t).mul(t.mul(t.mul(6).sub(15)).add(10))}).setLayout({name:`mx_fade`,type:`float`,inputs:[{name:`t`,type:`float`}]}),_R=RN([W(([e])=>{let t=K(e).toVar(),n=q(q(1)).toVar(),r=q(q(K(3735928559)).add(n.shiftLeft(q(2))).add(q(13))).toVar();return mR(r.add(q(t)),r,r)}).setLayout({name:`mx_hash_int_0`,type:`uint`,inputs:[{name:`x`,type:`int`}]}),W(([e,t])=>{let n=K(t).toVar(),r=K(e).toVar(),i=q(q(2)).toVar(),a=q().toVar(),o=q().toVar(),s=q().toVar();return a.assign(o.assign(s.assign(q(K(3735928559)).add(i.shiftLeft(q(2))).add(q(13))))),a.addAssign(q(r)),o.addAssign(q(n)),mR(a,o,s)}).setLayout({name:`mx_hash_int_1`,type:`uint`,inputs:[{name:`x`,type:`int`},{name:`y`,type:`int`}]}),W(([e,t,n])=>{let r=K(n).toVar(),i=K(t).toVar(),a=K(e).toVar(),o=q(q(3)).toVar(),s=q().toVar(),c=q().toVar(),l=q().toVar();return s.assign(c.assign(l.assign(q(K(3735928559)).add(o.shiftLeft(q(2))).add(q(13))))),s.addAssign(q(a)),c.addAssign(q(i)),l.addAssign(q(r)),mR(s,c,l)}).setLayout({name:`mx_hash_int_2`,type:`uint`,inputs:[{name:`x`,type:`int`},{name:`y`,type:`int`},{name:`z`,type:`int`}]}),W(([e,t,n,r])=>{let i=K(r).toVar(),a=K(n).toVar(),o=K(t).toVar(),s=K(e).toVar(),c=q(q(4)).toVar(),l=q().toVar(),u=q().toVar(),d=q().toVar();return l.assign(u.assign(d.assign(q(K(3735928559)).add(c.shiftLeft(q(2))).add(q(13))))),l.addAssign(q(s)),u.addAssign(q(o)),d.addAssign(q(a)),pR(l,u,d),l.addAssign(q(i)),mR(l,u,d)}).setLayout({name:`mx_hash_int_3`,type:`uint`,inputs:[{name:`x`,type:`int`},{name:`y`,type:`int`},{name:`z`,type:`int`},{name:`xx`,type:`int`}]}),W(([e,t,n,r,i])=>{let a=K(i).toVar(),o=K(r).toVar(),s=K(n).toVar(),c=K(t).toVar(),l=K(e).toVar(),u=q(q(5)).toVar(),d=q().toVar(),f=q().toVar(),p=q().toVar();return d.assign(f.assign(p.assign(q(K(3735928559)).add(u.shiftLeft(q(2))).add(q(13))))),d.addAssign(q(l)),f.addAssign(q(c)),p.addAssign(q(s)),pR(d,f,p),d.addAssign(q(o)),f.addAssign(q(a)),mR(d,f,p)}).setLayout({name:`mx_hash_int_4`,type:`uint`,inputs:[{name:`x`,type:`int`},{name:`y`,type:`int`},{name:`z`,type:`int`},{name:`xx`,type:`int`},{name:`yy`,type:`int`}]})]),vR=RN([W(([e,t])=>{let n=K(t).toVar(),r=q(_R(K(e).toVar(),n)).toVar(),i=Yb().toVar();return i.x.assign(r.bitAnd(K(255))),i.y.assign(r.shiftRight(K(8)).bitAnd(K(255))),i.z.assign(r.shiftRight(K(16)).bitAnd(K(255))),i}).setLayout({name:`mx_hash_vec3_0`,type:`uvec3`,inputs:[{name:`x`,type:`int`},{name:`y`,type:`int`}]}),W(([e,t,n])=>{let r=K(n).toVar(),i=K(t).toVar(),a=q(_R(K(e).toVar(),i,r)).toVar(),o=Yb().toVar();return o.x.assign(a.bitAnd(K(255))),o.y.assign(a.shiftRight(K(8)).bitAnd(K(255))),o.z.assign(a.shiftRight(K(16)).bitAnd(K(255))),o}).setLayout({name:`mx_hash_vec3_1`,type:`uvec3`,inputs:[{name:`x`,type:`int`},{name:`y`,type:`int`},{name:`z`,type:`int`}]})]),yR=RN([W(([e])=>{let t=J(e).toVar(),n=K().toVar(),r=K().toVar(),i=G(rR(t.x,n)).toVar(),a=G(rR(t.y,r)).toVar(),o=G(gR(i)).toVar(),s=G(gR(a)).toVar();return uR(G(iR(oR(_R(n,r),i,a),oR(_R(n.add(K(1)),r),i.sub(1),a),oR(_R(n,r.add(K(1))),i,a.sub(1)),oR(_R(n.add(K(1)),r.add(K(1))),i.sub(1),a.sub(1)),o,s)).toVar())}).setLayout({name:`mx_perlin_noise_float_0`,type:`float`,inputs:[{name:`p`,type:`vec2`}]}),W(([e])=>{let t=Y(e).toVar(),n=K().toVar(),r=K().toVar(),i=K().toVar(),a=G(rR(t.x,n)).toVar(),o=G(rR(t.y,r)).toVar(),s=G(rR(t.z,i)).toVar(),c=G(gR(a)).toVar(),l=G(gR(o)).toVar(),u=G(gR(s)).toVar();return dR(G(aR(oR(_R(n,r,i),a,o,s),oR(_R(n.add(K(1)),r,i),a.sub(1),o,s),oR(_R(n,r.add(K(1)),i),a,o.sub(1),s),oR(_R(n.add(K(1)),r.add(K(1)),i),a.sub(1),o.sub(1),s),oR(_R(n,r,i.add(K(1))),a,o,s.sub(1)),oR(_R(n.add(K(1)),r,i.add(K(1))),a.sub(1),o,s.sub(1)),oR(_R(n,r.add(K(1)),i.add(K(1))),a,o.sub(1),s.sub(1)),oR(_R(n.add(K(1)),r.add(K(1)),i.add(K(1))),a.sub(1),o.sub(1),s.sub(1)),c,l,u)).toVar())}).setLayout({name:`mx_perlin_noise_float_1`,type:`float`,inputs:[{name:`p`,type:`vec3`}]})]),bR=RN([W(([e])=>{let t=J(e).toVar(),n=K().toVar(),r=K().toVar(),i=G(rR(t.x,n)).toVar(),a=G(rR(t.y,r)).toVar(),o=G(gR(i)).toVar(),s=G(gR(a)).toVar();return uR(Y(iR(sR(vR(n,r),i,a),sR(vR(n.add(K(1)),r),i.sub(1),a),sR(vR(n,r.add(K(1))),i,a.sub(1)),sR(vR(n.add(K(1)),r.add(K(1))),i.sub(1),a.sub(1)),o,s)).toVar())}).setLayout({name:`mx_perlin_noise_vec3_0`,type:`vec3`,inputs:[{name:`p`,type:`vec2`}]}),W(([e])=>{let t=Y(e).toVar(),n=K().toVar(),r=K().toVar(),i=K().toVar(),a=G(rR(t.x,n)).toVar(),o=G(rR(t.y,r)).toVar(),s=G(rR(t.z,i)).toVar(),c=G(gR(a)).toVar(),l=G(gR(o)).toVar(),u=G(gR(s)).toVar();return dR(Y(aR(sR(vR(n,r,i),a,o,s),sR(vR(n.add(K(1)),r,i),a.sub(1),o,s),sR(vR(n,r.add(K(1)),i),a,o.sub(1),s),sR(vR(n.add(K(1)),r.add(K(1)),i),a.sub(1),o.sub(1),s),sR(vR(n,r,i.add(K(1))),a,o,s.sub(1)),sR(vR(n.add(K(1)),r,i.add(K(1))),a.sub(1),o,s.sub(1)),sR(vR(n,r.add(K(1)),i.add(K(1))),a,o.sub(1),s.sub(1)),sR(vR(n.add(K(1)),r.add(K(1)),i.add(K(1))),a.sub(1),o.sub(1),s.sub(1)),c,l,u)).toVar())}).setLayout({name:`mx_perlin_noise_vec3_1`,type:`vec3`,inputs:[{name:`p`,type:`vec3`}]})]),xR=RN([W(([e])=>hR(_R(K(nR(G(e).toVar())).toVar()))).setLayout({name:`mx_cell_noise_float_0`,type:`float`,inputs:[{name:`p`,type:`float`}]}),W(([e])=>{let t=J(e).toVar();return hR(_R(K(nR(t.x)).toVar(),K(nR(t.y)).toVar()))}).setLayout({name:`mx_cell_noise_float_1`,type:`float`,inputs:[{name:`p`,type:`vec2`}]}),W(([e])=>{let t=Y(e).toVar();return hR(_R(K(nR(t.x)).toVar(),K(nR(t.y)).toVar(),K(nR(t.z)).toVar()))}).setLayout({name:`mx_cell_noise_float_2`,type:`float`,inputs:[{name:`p`,type:`vec3`}]}),W(([e])=>{let t=Zb(e).toVar();return hR(_R(K(nR(t.x)).toVar(),K(nR(t.y)).toVar(),K(nR(t.z)).toVar(),K(nR(t.w)).toVar()))}).setLayout({name:`mx_cell_noise_float_3`,type:`float`,inputs:[{name:`p`,type:`vec4`}]})]),SR=RN([W(([e])=>{let t=K(nR(G(e).toVar())).toVar();return Y(hR(_R(t,K(0))),hR(_R(t,K(1))),hR(_R(t,K(2))))}).setLayout({name:`mx_cell_noise_vec3_0`,type:`vec3`,inputs:[{name:`p`,type:`float`}]}),W(([e])=>{let t=J(e).toVar(),n=K(nR(t.x)).toVar(),r=K(nR(t.y)).toVar();return Y(hR(_R(n,r,K(0))),hR(_R(n,r,K(1))),hR(_R(n,r,K(2))))}).setLayout({name:`mx_cell_noise_vec3_1`,type:`vec3`,inputs:[{name:`p`,type:`vec2`}]}),W(([e])=>{let t=Y(e).toVar(),n=K(nR(t.x)).toVar(),r=K(nR(t.y)).toVar(),i=K(nR(t.z)).toVar();return Y(hR(_R(n,r,i,K(0))),hR(_R(n,r,i,K(1))),hR(_R(n,r,i,K(2))))}).setLayout({name:`mx_cell_noise_vec3_2`,type:`vec3`,inputs:[{name:`p`,type:`vec3`}]}),W(([e])=>{let t=Zb(e).toVar(),n=K(nR(t.x)).toVar(),r=K(nR(t.y)).toVar(),i=K(nR(t.z)).toVar(),a=K(nR(t.w)).toVar();return Y(hR(_R(n,r,i,a,K(0))),hR(_R(n,r,i,a,K(1))),hR(_R(n,r,i,a,K(2))))}).setLayout({name:`mx_cell_noise_vec3_3`,type:`vec3`,inputs:[{name:`p`,type:`vec4`}]})]),CR=W(([e,t,n,r])=>{let i=G(r).toVar(),a=G(n).toVar(),o=K(t).toVar(),s=Y(e).toVar(),c=G(0).toVar(),l=G(1).toVar();return DO(o,()=>{c.addAssign(l.mul(yR(s))),l.mulAssign(i),s.mulAssign(a)}),c}).setLayout({name:`mx_fractal_noise_float`,type:`float`,inputs:[{name:`p`,type:`vec3`},{name:`octaves`,type:`int`},{name:`lacunarity`,type:`float`},{name:`diminish`,type:`float`}]}),wR=W(([e,t,n,r])=>{let i=G(r).toVar(),a=G(n).toVar(),o=K(t).toVar(),s=Y(e).toVar(),c=Y(0).toVar(),l=G(1).toVar();return DO(o,()=>{c.addAssign(l.mul(bR(s))),l.mulAssign(i),s.mulAssign(a)}),c}).setLayout({name:`mx_fractal_noise_vec3`,type:`vec3`,inputs:[{name:`p`,type:`vec3`},{name:`octaves`,type:`int`},{name:`lacunarity`,type:`float`},{name:`diminish`,type:`float`}]}),TR=W(([e,t,n,r])=>{let i=G(r).toVar(),a=G(n).toVar(),o=K(t).toVar(),s=Y(e).toVar();return J(CR(s,o,a,i),CR(s.add(Y(K(19),K(193),K(17))),o,a,i))}).setLayout({name:`mx_fractal_noise_vec2`,type:`vec2`,inputs:[{name:`p`,type:`vec3`},{name:`octaves`,type:`int`},{name:`lacunarity`,type:`float`},{name:`diminish`,type:`float`}]}),ER=W(([e,t,n,r])=>{let i=G(r).toVar(),a=G(n).toVar(),o=K(t).toVar(),s=Y(e).toVar();return Zb(Y(wR(s,o,a,i)).toVar(),G(CR(s.add(Y(K(19),K(193),K(17))),o,a,i)).toVar())}).setLayout({name:`mx_fractal_noise_vec4`,type:`vec4`,inputs:[{name:`p`,type:`vec3`},{name:`octaves`,type:`int`},{name:`lacunarity`,type:`float`},{name:`diminish`,type:`float`}]}),DR=RN([W(([e,t,n,r,i,a,o])=>{let s=K(o).toVar(),c=G(a).toVar(),l=K(i).toVar(),u=K(r).toVar(),d=K(n).toVar(),f=K(t).toVar(),p=J(e).toVar(),m=Y(SR(J(f.add(u),d.add(l)))).toVar(),h=J(m.x,m.y).toVar();h.subAssign(.5),h.mulAssign(c),h.addAssign(.5);let g=J(J(J(G(f),G(d)).add(h)).toVar().sub(p)).toVar();return Bb(s.equal(K(2)),()=>eC(g.x).add(eC(g.y))),Bb(s.equal(K(3)),()=>gC(eC(g.x),eC(g.y))),xC(g,g)}).setLayout({name:`mx_worley_distance_0`,type:`float`,inputs:[{name:`p`,type:`vec2`},{name:`x`,type:`int`},{name:`y`,type:`int`},{name:`xoff`,type:`int`},{name:`yoff`,type:`int`},{name:`jitter`,type:`float`},{name:`metric`,type:`int`}]}),W(([e,t,n,r,i,a,o,s,c])=>{let l=K(c).toVar(),u=G(s).toVar(),d=K(o).toVar(),f=K(a).toVar(),p=K(i).toVar(),m=K(r).toVar(),h=K(n).toVar(),g=K(t).toVar(),_=Y(e).toVar(),v=Y(SR(Y(g.add(p),h.add(f),m.add(d)))).toVar();v.subAssign(.5),v.mulAssign(u),v.addAssign(.5);let y=Y(Y(Y(G(g),G(h),G(m)).add(v)).toVar().sub(_)).toVar();return Bb(l.equal(K(2)),()=>eC(y.x).add(eC(y.y)).add(eC(y.z))),Bb(l.equal(K(3)),()=>gC(eC(y.x),eC(y.y),eC(y.z))),xC(y,y)}).setLayout({name:`mx_worley_distance_1`,type:`float`,inputs:[{name:`p`,type:`vec3`},{name:`x`,type:`int`},{name:`y`,type:`int`},{name:`z`,type:`int`},{name:`xoff`,type:`int`},{name:`yoff`,type:`int`},{name:`zoff`,type:`int`},{name:`jitter`,type:`float`},{name:`metric`,type:`int`}]})]),OR=W(([e,t,n])=>{let r=K(n).toVar(),i=G(t).toVar(),a=J(e).toVar(),o=K().toVar(),s=K().toVar(),c=J(rR(a.x,o),rR(a.y,s)).toVar(),l=G(1e6).toVar();return DO({start:-1,end:K(1),name:`x`,condition:`<=`},({x:e})=>{DO({start:-1,end:K(1),name:`y`,condition:`<=`},({y:t})=>{let n=G(DR(c,e,t,o,s,i,r)).toVar();l.assign(hC(l,n))})}),Bb(r.equal(K(0)),()=>{l.assign(HS(l))}),l}).setLayout({name:`mx_worley_noise_float_0`,type:`float`,inputs:[{name:`p`,type:`vec2`},{name:`jitter`,type:`float`},{name:`metric`,type:`int`}]}),kR=W(([e,t,n])=>{let r=K(n).toVar(),i=G(t).toVar(),a=J(e).toVar(),o=K().toVar(),s=K().toVar(),c=J(rR(a.x,o),rR(a.y,s)).toVar(),l=J(1e6,1e6).toVar();return DO({start:-1,end:K(1),name:`x`,condition:`<=`},({x:e})=>{DO({start:-1,end:K(1),name:`y`,condition:`<=`},({y:t})=>{let n=G(DR(c,e,t,o,s,i,r)).toVar();Bb(n.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(n)}).ElseIf(n.lessThan(l.y),()=>{l.y.assign(n)})})}),Bb(r.equal(K(0)),()=>{l.assign(HS(l))}),l}).setLayout({name:`mx_worley_noise_vec2_0`,type:`vec2`,inputs:[{name:`p`,type:`vec2`},{name:`jitter`,type:`float`},{name:`metric`,type:`int`}]}),AR=W(([e,t,n])=>{let r=K(n).toVar(),i=G(t).toVar(),a=J(e).toVar(),o=K().toVar(),s=K().toVar(),c=J(rR(a.x,o),rR(a.y,s)).toVar(),l=Y(1e6,1e6,1e6).toVar();return DO({start:-1,end:K(1),name:`x`,condition:`<=`},({x:e})=>{DO({start:-1,end:K(1),name:`y`,condition:`<=`},({y:t})=>{let n=G(DR(c,e,t,o,s,i,r)).toVar();Bb(n.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(n)}).ElseIf(n.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(n)}).ElseIf(n.lessThan(l.z),()=>{l.z.assign(n)})})}),Bb(r.equal(K(0)),()=>{l.assign(HS(l))}),l}).setLayout({name:`mx_worley_noise_vec3_0`,type:`vec3`,inputs:[{name:`p`,type:`vec2`},{name:`jitter`,type:`float`},{name:`metric`,type:`int`}]}),jR=RN([OR,W(([e,t,n])=>{let r=K(n).toVar(),i=G(t).toVar(),a=Y(e).toVar(),o=K().toVar(),s=K().toVar(),c=K().toVar(),l=Y(rR(a.x,o),rR(a.y,s),rR(a.z,c)).toVar(),u=G(1e6).toVar();return DO({start:-1,end:K(1),name:`x`,condition:`<=`},({x:e})=>{DO({start:-1,end:K(1),name:`y`,condition:`<=`},({y:t})=>{DO({start:-1,end:K(1),name:`z`,condition:`<=`},({z:n})=>{let a=G(DR(l,e,t,n,o,s,c,i,r)).toVar();u.assign(hC(u,a))})})}),Bb(r.equal(K(0)),()=>{u.assign(HS(u))}),u}).setLayout({name:`mx_worley_noise_float_1`,type:`float`,inputs:[{name:`p`,type:`vec3`},{name:`jitter`,type:`float`},{name:`metric`,type:`int`}]})]),MR=RN([kR,W(([e,t,n])=>{let r=K(n).toVar(),i=G(t).toVar(),a=Y(e).toVar(),o=K().toVar(),s=K().toVar(),c=K().toVar(),l=Y(rR(a.x,o),rR(a.y,s),rR(a.z,c)).toVar(),u=J(1e6,1e6).toVar();return DO({start:-1,end:K(1),name:`x`,condition:`<=`},({x:e})=>{DO({start:-1,end:K(1),name:`y`,condition:`<=`},({y:t})=>{DO({start:-1,end:K(1),name:`z`,condition:`<=`},({z:n})=>{let a=G(DR(l,e,t,n,o,s,c,i,r)).toVar();Bb(a.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(a)}).ElseIf(a.lessThan(u.y),()=>{u.y.assign(a)})})})}),Bb(r.equal(K(0)),()=>{u.assign(HS(u))}),u}).setLayout({name:`mx_worley_noise_vec2_1`,type:`vec2`,inputs:[{name:`p`,type:`vec3`},{name:`jitter`,type:`float`},{name:`metric`,type:`int`}]})]),NR=RN([AR,W(([e,t,n])=>{let r=K(n).toVar(),i=G(t).toVar(),a=Y(e).toVar(),o=K().toVar(),s=K().toVar(),c=K().toVar(),l=Y(rR(a.x,o),rR(a.y,s),rR(a.z,c)).toVar(),u=Y(1e6,1e6,1e6).toVar();return DO({start:-1,end:K(1),name:`x`,condition:`<=`},({x:e})=>{DO({start:-1,end:K(1),name:`y`,condition:`<=`},({y:t})=>{DO({start:-1,end:K(1),name:`z`,condition:`<=`},({z:n})=>{let a=G(DR(l,e,t,n,o,s,c,i,r)).toVar();Bb(a.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(a)}).ElseIf(a.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(a)}).ElseIf(a.lessThan(u.z),()=>{u.z.assign(a)})})})}),Bb(r.equal(K(0)),()=>{u.assign(HS(u))}),u}).setLayout({name:`mx_worley_noise_vec3_1`,type:`vec3`,inputs:[{name:`p`,type:`vec3`},{name:`jitter`,type:`float`},{name:`metric`,type:`int`}]})]),PR=W(([e,t,n,r,i,a,o,s,c,l,u])=>{let d=K(e).toVar(),f=J(t).toVar(),p=J(n).toVar(),m=J(r).toVar(),h=G(i).toVar(),g=G(a).toVar(),_=G(o).toVar(),v=Wb(s).toVar(),y=K(c).toVar(),b=G(l).toVar(),x=G(u).toVar(),S=f.mul(p).add(m),C=G(0).toVar();return Bb(d.equal(K(0)),()=>{C.assign(bR(S))}),Bb(d.equal(K(1)),()=>{C.assign(SR(S))}),Bb(d.equal(K(2)),()=>{C.assign(NR(S,h,K(0)))}),Bb(d.equal(K(3)),()=>{C.assign(wR(Y(S,0),y,b,x))}),C.assign(C.mul(_.sub(g)).add(g)),Bb(v,()=>{C.assign(jC(C,g,_))}),C}).setLayout({name:`mx_unifiednoise2d`,type:`float`,inputs:[{name:`noiseType`,type:`int`},{name:`texcoord`,type:`vec2`},{name:`freq`,type:`vec2`},{name:`offset`,type:`vec2`},{name:`jitter`,type:`float`},{name:`outmin`,type:`float`},{name:`outmax`,type:`float`},{name:`clampoutput`,type:`bool`},{name:`octaves`,type:`int`},{name:`lacunarity`,type:`float`},{name:`diminish`,type:`float`}]}),FR=W(([e,t,n,r,i,a,o,s,c,l,u])=>{let d=K(e).toVar(),f=Y(t).toVar(),p=Y(n).toVar(),m=Y(r).toVar(),h=G(i).toVar(),g=G(a).toVar(),_=G(o).toVar(),v=Wb(s).toVar(),y=K(c).toVar(),b=G(l).toVar(),x=G(u).toVar(),S=f.mul(p).add(m),C=G(0).toVar();return Bb(d.equal(K(0)),()=>{C.assign(bR(S))}),Bb(d.equal(K(1)),()=>{C.assign(SR(S))}),Bb(d.equal(K(2)),()=>{C.assign(NR(S,h,K(0)))}),Bb(d.equal(K(3)),()=>{C.assign(wR(S,y,b,x))}),C.assign(C.mul(_.sub(g)).add(g)),Bb(v,()=>{C.assign(jC(C,g,_))}),C}).setLayout({name:`mx_unifiednoise3d`,type:`float`,inputs:[{name:`noiseType`,type:`int`},{name:`position`,type:`vec3`},{name:`freq`,type:`vec3`},{name:`offset`,type:`vec3`},{name:`jitter`,type:`float`},{name:`outmin`,type:`float`},{name:`outmax`,type:`float`},{name:`clampoutput`,type:`bool`},{name:`octaves`,type:`int`},{name:`lacunarity`,type:`float`},{name:`diminish`,type:`float`}]}),IR=W(([e])=>{let t=e.y,n=e.z,r=Y().toVar();return Bb(t.lessThan(1e-4),()=>{r.assign(Y(n,n,n))}).Else(()=>{let i=e.x;i=i.sub(WS(i)).mul(6).toVar();let a=K(lC(i)),o=i.sub(G(a)),s=n.mul(t.oneMinus()),c=n.mul(t.mul(o).oneMinus()),l=n.mul(t.mul(o.oneMinus()).oneMinus());Bb(a.equal(K(0)),()=>{r.assign(Y(n,l,s))}).ElseIf(a.equal(K(1)),()=>{r.assign(Y(c,n,s))}).ElseIf(a.equal(K(2)),()=>{r.assign(Y(s,n,l))}).ElseIf(a.equal(K(3)),()=>{r.assign(Y(s,c,n))}).ElseIf(a.equal(K(4)),()=>{r.assign(Y(l,s,n))}).Else(()=>{r.assign(Y(n,s,c))})}),r}).setLayout({name:`mx_hsvtorgb`,type:`vec3`,inputs:[{name:`hsv`,type:`vec3`}]}),LR=W(([e])=>{let t=Y(e).toVar(),n=G(t.x).toVar(),r=G(t.y).toVar(),i=G(t.z).toVar(),a=G(hC(n,hC(r,i))).toVar(),o=G(gC(n,gC(r,i))).toVar(),s=G(o.sub(a)).toVar(),c=G().toVar(),l=G().toVar(),u=G().toVar();return u.assign(o),Bb(o.greaterThan(0),()=>{l.assign(s.div(o))}).Else(()=>{l.assign(0)}),Bb(l.lessThanEqual(0),()=>{c.assign(0)}).Else(()=>{Bb(n.greaterThanEqual(o),()=>{c.assign(r.sub(i).div(s))}).ElseIf(r.greaterThanEqual(o),()=>{c.assign(nS(2,i.sub(n).div(s)))}).Else(()=>{c.assign(nS(4,n.sub(r).div(s)))}),c.mulAssign(1/6),Bb(c.lessThan(0),()=>{c.addAssign(1)})}),Y(c,l,u)}).setLayout({name:`mx_rgbtohsv`,type:`vec3`,inputs:[{name:`c`,type:`vec3`}]}),RR=W(([e])=>{let t=Y(e).toVar(),n=Xb(uS(t,Y(.04045))).toVar();return AC(Y(t.div(12.92)).toVar(),Y(CC(gC(t.add(Y(.055)),Y(0)).div(1.055),Y(2.4))).toVar(),n)}).setLayout({name:`mx_srgb_texture_to_lin_rec709`,type:`vec3`,inputs:[{name:`color`,type:`vec3`}]}),zR=(e,t)=>{e=G(e),t=G(t);let n=J(t.dFdx(),t.dFdy()).length().mul(.7071067811865476);return PC(e.sub(n),e.add(n),t)},BR=(e,t,n,r)=>AC(e,t,n[r].clamp()),VR=(e,t,n=Yw())=>BR(e,t,n,`x`),HR=(e,t,n=Yw())=>BR(e,t,n,`y`),UR=(e,t,n,r,i=Yw())=>{let a=i.x.clamp(),o=i.y.clamp();return AC(AC(e,t,a),AC(n,r,a),o)},WR=(e,t,n,r,i)=>AC(e,t,zR(n,r[i])),GR=(e,t,n,r=Yw())=>WR(e,t,n,r,`x`),KR=(e,t,n,r=Yw())=>WR(e,t,n,r,`y`),qR=(e=1,t=0,n=Yw())=>n.mul(e).add(t),JR=(e,t=1)=>(e=G(e),e.abs().pow(t).mul(e.sign())),YR=(e,t=1,n=.5)=>G(e).sub(n).mul(t).add(n),XR=(e=Yw(),t=1,n=0)=>yR(e.convert(`vec2|vec3`)).mul(t).add(n),ZR=(e=Yw(),t=1,n=0)=>bR(e.convert(`vec2|vec3`)).mul(t).add(n),QR=(e=Yw(),t=1,n=0)=>(e=e.convert(`vec2|vec3`),Zb(bR(e),yR(e.add(J(19,73)))).mul(t).add(n)),$R=(e,t=Yw(),n=J(1,1),r=J(0,0),i=1,a=0,o=1,s=!1,c=1,l=2,u=.5)=>PR(e,t.convert(`vec2|vec3`),n,r,i,a,o,s,c,l,u),ez=(e,t=Yw(),n=J(1,1),r=J(0,0),i=1,a=0,o=1,s=!1,c=1,l=2,u=.5)=>FR(e,t.convert(`vec2|vec3`),n,r,i,a,o,s,c,l,u),tz=(e=Yw(),t=1)=>jR(e.convert(`vec2|vec3`),t,K(1)),nz=(e=Yw(),t=1)=>MR(e.convert(`vec2|vec3`),t,K(1)),rz=(e=Yw(),t=1)=>NR(e.convert(`vec2|vec3`),t,K(1)),iz=(e=Yw())=>xR(e.convert(`vec2|vec3`)),az=(e=Yw(),t=3,n=2,r=.5,i=1)=>CR(e,K(t),n,r).mul(i),oz=(e=Yw(),t=3,n=2,r=.5,i=1)=>TR(e,K(t),n,r).mul(i),sz=(e=Yw(),t=3,n=2,r=.5,i=1)=>wR(e,K(t),n,r).mul(i),cz=(e=Yw(),t=3,n=2,r=.5,i=1)=>ER(e,K(t),n,r).mul(i),lz=(e,t=G(0))=>nS(e,t),uz=(e,t=G(0))=>rS(e,t),dz=(e,t=G(1))=>iS(e,t),fz=(e,t=G(1))=>aS(e,t),pz=(e,t=G(1))=>oS(e,t),mz=(e,t=G(1))=>CC(e,t),hz=(e=G(0),t=G(1))=>$S(e,t),gz=()=>zN,_z=()=>VN,vz=(e,t=G(1))=>rS(t,e),yz=(e,t,n,r)=>e.greaterThan(t).mix(n,r),bz=(e,t,n,r)=>e.greaterThanEqual(t).mix(n,r),xz=(e,t,n,r)=>e.equal(t).mix(n,r),Sz=(e,t=null)=>{if(typeof t==`string`){let n={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},r=t.replace(/^out/,``).toLowerCase();if(n[r]!==void 0)return e.element(n[r])}if(typeof t==`number`)return e.element(t);if(typeof t==`string`&&t.length===1){let n={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(n[t]!==void 0)return e.element(n[t])}return e},Cz=(e,t=J(.5,.5),n=J(1,1),r=G(0),i=J(0,0))=>{let a=e;if(t&&(a=a.sub(t)),n&&(a=a.mul(n)),r){let e=r.mul(Math.PI/180),t=e.cos(),n=e.sin();a=J(a.x.mul(t).sub(a.y.mul(n)),a.x.mul(n).add(a.y.mul(t)))}return t&&(a=a.add(t)),i&&(a=a.add(i)),a},wz=(e,t)=>{e=J(e),t=G(t);let n=t.mul(Math.PI/180);return gM(e,n)},Tz=(e,t,n)=>{e=Y(e),t=G(t),n=Y(n);let r=t.mul(Math.PI/180),i=n.normalize(),a=r.cos(),o=r.sin(),s=G(1).sub(a);return e.mul(a).add(i.cross(e).mul(o)).add(i.mul(i.dot(e)).mul(s))},Ez=(e,t)=>(e=Y(e),t=G(t),bD(e,t)),Dz=W(([e,t,n])=>{let r=KS(e).toVar(),i=rS(G(.5).mul(t.sub(n)),aE).div(r).toVar(),a=rS(G(-.5).mul(t.sub(n)),aE).div(r).toVar(),o=Y().toVar();o.x=r.x.greaterThan(G(0)).select(i.x,a.x),o.y=r.y.greaterThan(G(0)).select(i.y,a.y),o.z=r.z.greaterThan(G(0)).select(i.z,a.z);let s=hC(o.x,o.y,o.z).toVar();return aE.add(r.mul(s)).toVar().sub(n)}),Oz=W(([e,t])=>{let n=e.x,r=e.y,i=e.z,a=t.element(0).mul(.886227);return a=a.add(t.element(1).mul(2*.511664).mul(r)),a=a.add(t.element(2).mul(2*.511664).mul(i)),a=a.add(t.element(3).mul(2*.511664).mul(n)),a=a.add(t.element(4).mul(2*.429043).mul(n).mul(r)),a=a.add(t.element(5).mul(2*.429043).mul(r).mul(i)),a=a.add(t.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),a=a.add(t.element(7).mul(2*.429043).mul(n).mul(i)),a=a.add(t.element(8).mul(.429043).mul(iS(n,n).sub(iS(r,r)))),a}),Q=Object.freeze({__proto__:null,BRDF_GGX:dA,BRDF_Lambert:Yk,BasicPointShadowFilter:BL,BasicShadowFilter:xL,Break:kO,Const:QC,Continue:OO,DFGApprox:mA,D_GGX:cA,Discard:Lw,EPSILON:OS,F_Schlick:Jk,Fn:W,HALF_PI:NS,INFINITY:kS,If:Bb,Loop:DO,NodeAccess:My,NodeShaderStage:ky,NodeType:jy,NodeUpdateType:Ay,OnBeforeMaterialUpdate:PP,OnBeforeObjectUpdate:NP,OnMaterialUpdate:MP,OnObjectUpdate:jP,PCFShadowFilter:SL,PCFSoftShadowFilter:CL,PI:AS,PI2:jS,PointShadowFilter:VL,Return:Rw,Schlick_to_F0:_A,ScriptableNodeResources:VF,ShaderNode:jb,Stack:Hb,Switch:Vb,TBNViewMatrix:pD,TWO_PI:MS,VSMShadowFilter:wL,V_GGX_SmithCorrelated:oA,Var:ZC,VarIntent:$C,abs:eC,acesFilmicToneMapping:CF,acos:QS,add:nS,addMethodChaining:B,addNodeElement:Kw,agxToneMapping:DF,all:PS,alphaT:wx,and:pS,anisotropy:Tx,anisotropyB:Dx,anisotropyT:Ex,any:FS,append:lx,array:Xx,arrayBuffer:ax,asin:ZS,assign:Zx,atan:$S,atan2:BC,atomicAdd:_I,atomicAnd:xI,atomicFunc:mI,atomicLoad:hI,atomicMax:yI,atomicMin:bI,atomicOr:SI,atomicStore:gI,atomicSub:vI,atomicXor:CI,attenuationColor:zx,attenuationDistance:Rx,attribute:Jw,attributeArray:LP,backgroundBlurriness:UP,backgroundIntensity:WP,backgroundRotation:GP,batch:_O,bentNormalView:gD,billboarding:JN,bitAnd:_S,bitNot:vS,bitOr:yS,bitXor:bS,bitangentGeometry:lD,bitangentLocal:uD,bitangentView:dD,bitangentWorld:fD,bitcast:wN,blendBurn:fk,blendColor:gk,blendDodge:pk,blendOverlay:hk,blendScreen:mk,blur:vj,bool:Wb,buffer:cT,bufferAttribute:xw,builtin:fT,bumpMap:bD,burn:yk,bvec2:qb,bvec3:Xb,bvec4:ex,bypass:jw,cache:Aw,call:$x,cameraFar:DT,cameraIndex:TT,cameraNear:ET,cameraNormalMatrix:MT,cameraPosition:NT,cameraProjectionMatrix:OT,cameraProjectionMatrixInverse:kT,cameraViewMatrix:AT,cameraViewport:PT,cameraWorldMatrix:jT,cbrt:OC,cdl:cF,ceil:GS,checker:QL,cineonToneMapping:xF,clamp:jC,clearcoat:_x,clearcoatNormalView:yE,clearcoatRoughness:vx,code:AF,color:Ub,colorSpaceToWorking:uw,colorToDirection:jk,compute:Dw,computeKernel:Ew,computeSkinning:TO,context:GC,convert:sx,convertColorSpace:dw,convertToTexture:SP,cos:YS,cross:SC,cubeTexture:IE,cubeTextureBase:FE,cubeToUV:zL,dFdx:aC,dFdy:oC,dashSize:Mx,debug:Hw,decrement:ES,decrementBefore:wS,defaultBuildStages:Py,defaultShaderStages:Ny,defined:kb,degrees:LS,deltaTime:BN,densityFog:JF,densityFogFactor:GF,depth:$O,depthPass:gF,determinant:fC,difference:bC,diffuseColor:px,directPointLight:XL,directionToColor:Ak,directionToFaceDirection:dE,dispersion:Bx,distance:yC,div:aS,dodge:bk,dot:xC,drawIndex:pO,dynamicBufferAttribute:Sw,element:ox,emissive:mx,equal:sS,equals:mC,equirectUV:Pk,exp:RS,exp2:zS,expression:Iw,faceDirection:uE,faceForward:FC,faceforward:VC,float:G,floatBitsToInt:TN,floatBitsToUint:EN,floor:WS,fog:KF,fract:qS,frameGroup:Wx,frameId:VN,frontFacing:lE,fwidth:uC,gain:jN,gapSize:Nx,getConstNodeType:Ab,getCurrentStack:zb,getDirection:mj,getDistanceAttenuation:YL,getGeometryRoughness:iA,getNormalFromDepth:TP,getParallaxCorrectNormal:Dz,getRoughness:aA,getScreenPosition:wP,getShIrradianceAt:Oz,getShadowMaterial:DL,getShadowRenderObjectFunction:AL,getTextureIndex:xN,getViewPosition:CP,ggxConvolution:Sj,globalId:nI,glsl:NF,glslFn:IF,grayscale:rF,greaterThan:uS,greaterThanEqual:fS,hash:kN,highpModelNormalViewMatrix:tE,highpModelViewMatrix:eE,hue:oF,increment:TS,incrementBefore:CS,inspector:Gw,instance:hO,instanceIndex:lO,instancedArray:RP,instancedBufferAttribute:Cw,instancedDynamicBufferAttribute:ww,instancedMesh:gO,int:K,intBitsToFloat:DN,interleavedGradientNoise:EP,inverse:pC,inverseSqrt:US,inversesqrt:HC,invocationLocalIndex:fO,invocationSubgroupIndex:dO,ior:Fx,iridescence:xx,iridescenceIOR:Sx,iridescenceThickness:Cx,isolate:kw,ivec2:Gb,ivec3:Jb,ivec4:Qb,js:jF,label:JC,length:nC,lengthSq:kC,lessThan:lS,lessThanEqual:dS,lightPosition:eL,lightProjectionUV:$I,lightShadowMatrix:QI,lightTargetDirection:rL,lightTargetPosition:tL,lightViewPosition:nL,lightingContext:LO,lights:lL,linearDepth:ek,linearToneMapping:yF,localId:rI,log:BS,log2:VS,logarithmicDepthToViewZ:ZO,luminance:sF,mat2:tx,mat3:nx,mat4:rx,matcapUV:pM,materialAO:iO,materialAlphaTest:SD,materialAnisotropy:VD,materialAnisotropyVector:aO,materialAttenuationColor:YD,materialAttenuationDistance:JD,materialClearcoat:FD,materialClearcoatNormal:LD,materialClearcoatRoughness:ID,materialColor:CD,materialDispersion:nO,materialEmissive:TD,materialEnvIntensity:OE,materialEnvRotation:kE,materialIOR:qD,materialIridescence:HD,materialIridescenceIOR:UD,materialIridescenceThickness:WD,materialLightMap:rO,materialLineDashOffset:eO,materialLineDashSize:ZD,materialLineGapSize:QD,materialLineScale:XD,materialLineWidth:$D,materialMetalness:ND,materialNormal:PD,materialOpacity:ED,materialPointSize:tO,materialReference:UE,materialReflectivity:jD,materialRefractionRatio:DE,materialRotation:RD,materialRoughness:MD,materialSheen:zD,materialSheenRoughness:BD,materialShininess:wD,materialSpecular:DD,materialSpecularColor:kD,materialSpecularIntensity:OD,materialSpecularStrength:AD,materialThickness:KD,materialTransmission:GD,max:gC,maxMipLevel:Zw,mediumpModelViewMatrix:$T,metalness:gx,min:hC,mix:AC,mixElement:LC,mod:oS,modInt:DS,modelDirection:WT,modelNormalMatrix:XT,modelPosition:KT,modelRadius:YT,modelScale:qT,modelViewMatrix:QT,modelViewPosition:JT,modelViewProjection:oO,modelWorldMatrix:GT,modelWorldMatrixInverse:ZT,morphReference:PO,mrt:SN,mul:iS,mx_aastep:zR,mx_add:lz,mx_atan2:hz,mx_cell_noise_float:iz,mx_contrast:YR,mx_divide:fz,mx_fractal_noise_float:az,mx_fractal_noise_vec2:oz,mx_fractal_noise_vec3:sz,mx_fractal_noise_vec4:cz,mx_frame:_z,mx_heighttonormal:Ez,mx_hsvtorgb:IR,mx_ifequal:xz,mx_ifgreater:yz,mx_ifgreatereq:bz,mx_invert:vz,mx_modulo:pz,mx_multiply:dz,mx_noise_float:XR,mx_noise_vec3:ZR,mx_noise_vec4:QR,mx_place2d:Cz,mx_power:mz,mx_ramp4:UR,mx_ramplr:VR,mx_ramptb:HR,mx_rgbtohsv:LR,mx_rotate2d:wz,mx_rotate3d:Tz,mx_safepower:JR,mx_separate:Sz,mx_splitlr:GR,mx_splittb:KR,mx_srgb_texture_to_lin_rec709:RR,mx_subtract:uz,mx_timer:gz,mx_transform_uv:qR,mx_unifiednoise2d:$R,mx_unifiednoise3d:ez,mx_worley_noise_float:tz,mx_worley_noise_vec2:nz,mx_worley_noise_vec3:rz,negate:rC,neutralToneMapping:OF,nodeArray:Pb,nodeImmutable:H,nodeObject:V,nodeObjectIntent:Mb,nodeObjects:Nb,nodeProxy:Fb,nodeProxyIntent:U,normalFlat:mE,normalGeometry:fE,normalLocal:pE,normalMap:_D,normalView:_E,normalViewGeometry:hE,normalWorld:vE,normalWorldGeometry:gE,normalize:KS,not:hS,notEqual:cS,numWorkgroups:eI,objectDirection:LT,objectGroup:Kx,objectPosition:zT,objectRadius:HT,objectScale:BT,objectViewPosition:VT,objectWorldMatrix:RT,oneMinus:iC,or:mS,orthographicDepthToViewZ:qO,oscSawtooth:GN,oscSine:HN,oscSquare:UN,oscTriangle:WN,output:jx,outputStruct:bN,overlay:Sk,overloadingFn:RN,parabola:AN,parallaxDirection:mD,parallaxUV:hD,parameter:pN,pass:mF,passTexture:hF,pcurve:MN,perspectiveDepthToViewZ:YO,pmremTexture:eM,pointShadow:qL,pointUV:zP,pointWidth:Px,positionGeometry:nE,positionLocal:rE,positionPrevious:iE,positionView:sE,positionViewDirection:cE,positionWorld:aE,positionWorldDirection:oE,posterize:lF,pow:CC,pow2:wC,pow3:TC,pow4:EC,premultiplyAlpha:_k,property:dx,quadBroadcast:YI,quadSwapDiagonal:UI,quadSwapX:VI,quadSwapY:HI,radians:IS,rand:IC,range:ZF,rangeFog:qF,rangeFogFactor:WF,reciprocal:cC,reference:BE,referenceBuffer:VE,reflect:vC,reflectVector:ME,reflectView:AE,reflector:hP,refract:NC,refractVector:NE,refractView:jE,reinhardToneMapping:bF,remap:Nw,remapClamp:Pw,renderGroup:Gx,renderOutput:Bw,rendererReference:gw,rotate:gM,rotateUV:KN,roughness:hx,round:sC,rtt:xP,sRGBTransferEOTF:iw,sRGBTransferOETF:aw,sample:OP,sampler:aT,samplerComparison:oT,saturate:MC,saturation:iF,screen:xk,screenCoordinate:yT,screenDPR:gT,screenSize:vT,screenUV:_T,scriptable:HF,scriptableValue:RF,select:UC,setCurrentStack:Rb,setName:qC,shaderStages:Fy,shadow:LL,shadowPositionWorld:dL,shapeCircle:$L,sharedUniformGroup:Ux,sheen:yx,sheenRoughness:bx,shiftLeft:xS,shiftRight:SS,shininess:Ax,sign:tC,sin:JS,sinc:NN,skinning:wO,smoothstep:PC,smoothstepElement:RC,specularColor:Ox,specularF90:kx,spherizeUV:qN,split:cx,spritesheetUV:XN,sqrt:HS,stack:mN,step:_C,stepElement:zC,storage:bO,storageBarrier:sI,storageObject:xO,storageTexture:KP,string:ix,struct:vN,sub:rS,subBuild:tw,subgroupAdd:DI,subgroupAll:RI,subgroupAnd:NI,subgroupAny:zI,subgroupBallot:EI,subgroupBroadcast:WI,subgroupBroadcastFirst:BI,subgroupElect:TI,subgroupExclusiveAdd:kI,subgroupExclusiveMul:MI,subgroupInclusiveAdd:OI,subgroupInclusiveMul:jI,subgroupIndex:uO,subgroupMax:LI,subgroupMin:II,subgroupMul:AI,subgroupOr:PI,subgroupShuffle:GI,subgroupShuffleDown:JI,subgroupShuffleUp:qI,subgroupShuffleXor:KI,subgroupSize:iI,subgroupXor:FI,tan:XS,tangentGeometry:iD,tangentLocal:aD,tangentView:oD,tangentWorld:sD,texture:tT,texture3D:YP,textureBarrier:cI,textureBicubic:IA,textureBicubicLevel:FA,textureCubeUV:hj,textureLevel:iT,textureLoad:rT,textureSize:Xw,textureStore:qP,thickness:Lx,time:zN,toneMapping:vw,toneMappingExposure:yw,toonOutlinePass:vF,transformDirection:DC,transformNormal:bE,transformNormalToView:xE,transformedClearcoatNormalView:wE,transformedNormalView:SE,transformedNormalWorld:CE,transmission:Ix,transpose:dC,triNoise3D:IN,triplanarTexture:QN,triplanarTextures:ZN,trunc:lC,uint:q,uintBitsToFloat:ON,uniform:Jx,uniformArray:dT,uniformCubeTexture:LE,uniformFlow:KC,uniformGroup:Hx,uniformTexture:nT,unpremultiplyAlpha:vk,userData:ZP,uv:Yw,uvec2:Kb,uvec3:Yb,uvec4:$b,varying:nw,varyingProperty:fx,vec2:J,vec3:Y,vec4:Zb,vectorComponents:Iy,velocity:nF,vertexColor:dk,vertexIndex:cO,vertexStage:rw,vibrance:aF,viewZToLogarithmicDepth:XO,viewZToOrthographicDepth:KO,viewZToPerspectiveDepth:JO,viewport:bT,viewportCoordinate:ST,viewportDepthTexture:WO,viewportLinearDepth:tk,viewportMipTexture:HO,viewportResolution:wT,viewportSafeUV:YN,viewportSharedTexture:kk,viewportSize:xT,viewportTexture:VO,viewportUV:CT,wgsl:MF,wgslFn:LF,workgroupArray:dI,workgroupBarrier:oI,workgroupId:tI,workingToColorSpace:lw,xor:gS}),kz=new dN,Az=class extends NM{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){let r=this.renderer,i=this.nodes.getBackgroundNode(e)||e.background,a=!1;if(i===null)r._clearColor.getRGB(kz),kz.a=r._clearColor.a;else if(i.isColor===!0)i.getRGB(kz),kz.a=1,a=!0;else if(i.isNode===!0){let n=this.get(e),a=i;kz.copy(r._clearColor);let o=n.backgroundMesh;if(o===void 0){let e=GC(Zb(a).mul(WP),{getUV:()=>GP.mul(gE),getTextureLevel:()=>UP}),t=oO;t=t.setZ(t.w);let r=new Ck;r.name=`Background.material`,r.side=1,r.depthTest=!1,r.depthWrite=!1,r.allowOverride=!1,r.fog=!1,r.lights=!1,r.vertexNode=t,r.colorNode=e,n.backgroundMeshNode=e,n.backgroundMesh=o=new tr(new yn(1,32,32),r),o.frustumCulled=!1,o.name=`Background.mesh`,o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)};function s(){i.removeEventListener(`dispose`,s),o.material.dispose(),o.geometry.dispose()}i.addEventListener(`dispose`,s)}let s=a.getCacheKey();n.backgroundCacheKey!==s&&(n.backgroundMeshNode.node=Zb(a).mul(WP),n.backgroundMeshNode.needsUpdate=!0,o.material.needsUpdate=!0,n.backgroundCacheKey=s),t.unshift(o,o.geometry,o.material,0,0,null,null)}else N(`Renderer: Unsupported background configuration.`,i);let o=r.xr.getEnvironmentBlendMode();if(o===`additive`?kz.set(0,0,0,1):o===`alpha-blend`&&kz.set(0,0,0,0),r.autoClear===!0||a===!0){let e=n.clearColorValue;e.r=kz.r,e.g=kz.g,e.b=kz.b,e.a=kz.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=r.autoClearColor===!0,n.clearDepth=r.autoClearDepth===!0,n.clearStencil=r.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}},jz=0,Mz=class{constructor(e=``,t=[],n=0,r=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=r,this.id=jz++}},Nz=class{constructor(e,t,n,r,i,a,o,s,c,l=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=l,this.nodeAttributes=r,this.bindings=i,this.updateNodes=a,this.updateBeforeNodes=o,this.updateAfterNodes=s,this.observer=c,this.usedTimes=0}createBindings(){let e=[];for(let t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){let n=new Mz(t.name,[],t.index,t.bindingsReference);e.push(n);for(let e of t.bindings)n.bindings.push(e.clone())}else e.push(t);return e}},Pz=class{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}},Fz=class{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}},Iz=class{constructor(e,t,n=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=r}},Lz=class extends Iz{constructor(e,t,n=null,r=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=r}},Rz=class{constructor(e,t,n=``){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,`isNodeCode`,{value:!0})}},zz=0,Bz=class{constructor(e=null){this.id=zz++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}},Vz=class{constructor(e,t){this.name=e,this.members=t,this.output=!1}},Hz=class{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}},Uz=class extends Hz{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}},Wz=class extends Hz{constructor(e,t=new Fe){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}},Gz=class extends Hz{constructor(e,t=new j){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}},Kz=class extends Hz{constructor(e,t=new Je){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}},qz=class extends Hz{constructor(e,t=new a){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}},Jz=class extends Hz{constructor(e,t=new en){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}},Yz=class extends Hz{constructor(e,t=new gr){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}},Xz=class extends Hz{constructor(e,t=new F){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}},Zz=class extends Uz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},Qz=class extends Wz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},$z=class extends Gz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},eB=class extends Kz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},tB=class extends qz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},nB=class extends Jz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},rB=class extends Yz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},iB=class extends Xz{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},aB=0,oB=new WeakMap,sB=new Map([[Int8Array,`int`],[Int16Array,`int`],[Int32Array,`int`],[Uint8Array,`uint`],[Uint16Array,`uint`],[Uint32Array,`uint`],[Float32Array,`float`]]),cB=e=>/e/g.test(e)?String(e).replace(/\+/g,``):(e=Number(e),e+(e%1?``:`.0`)),lB=class{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:``,fragment:``,compute:``},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:``},this.chaining=[],this.stack=mN(),this.stacks=[],this.tab=`	`,this.currentFunctionNode=null,this.context={material:this.material},this.cache=new Bz,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,`id`,{value:aB++})}isOpaque(){let e=this.material;return e.transparent===!1&&e.blending===1&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=oB.get(this.renderer);return e===void 0&&(e=new DM,oB.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new p(e,t,n)}createCubeRenderTarget(e,t){return new Fk(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){let n=this.getBindGroupsCache(),r=[],i=!0;for(let e of t)r.push(e),i&&=e.groupNode.shared!==!0;let a;return i?(a=n.get(r),a===void 0&&(a=new Mz(e,r,this.bindingsIndexes[e].group,r),n.set(r,a))):a=new Mz(e,r,this.bindingsIndexes[e].group,r),a}getBindGroupArray(e,t){let n=this.bindings[t],r=n[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){let t={},n=this.bindings;for(let e of Fy)for(let r in n[e]){let i=n[e][r];(t[r]||(t[r]=[])).push(...i)}for(let n in e=[],t){let r=t[n],i=this._getBindGroup(n,r);e.push(i)}this.bindGroups=e}return e}sortBindingGroups(){let e=this.getBindings();e.sort((e,t)=>e.bindings[0].groupNode.order-t.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){let n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(let e of this.nodes)e.getUpdateType()!==Ay.NONE&&this.updateNodes.push(e);for(let e of this.sequentialNodes){let t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==Ay.NONE&&this.updateBeforeNodes.push(e),n!==Ay.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===1006||e.magFilter===1007||e.magFilter===1005||e.magFilter===1008||e.minFilter===1006||e.minFilter===1007||e.minFilter===1005||e.minFilter===1008}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw Error(`NodeBuilder: Invalid node chaining!`)}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){let t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){let n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new Bz(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){P(`Abstract function.`)}getInstanceIndex(){P(`Abstract function.`)}getDrawIndex(){P(`Abstract function.`)}getFrontFacing(){P(`Abstract function.`)}getFragCoord(){P(`Abstract function.`)}isFlipY(){return!1}increaseUsage(e){let t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){P(`Abstract function.`)}generateTextureLod(){P(`Abstract function.`)}generateArrayDeclaration(e,t){return this.getType(e)+`[ `+t+` ]`}generateArray(e,t,n=null){let r=this.generateArrayDeclaration(e,t)+`( `;for(let i=0;i<t;i++){let a=n?n[i]:null;a===null?r+=this.generateConst(e):r+=a.build(this,e),i<t-1&&(r+=`, `)}return r+=` )`,r}generateStruct(e,t,n=null){let r=[];for(let e of t){let{name:t,type:i}=e;n&&n[t]&&n[t].isNode?r.push(n[t].build(this,i)):r.push(this.generateConst(i))}return e+`( `+r.join(`, `)+` )`}generateConst(e,t=null){if(t===null&&(e===`float`||e===`int`||e===`uint`?t=0:e===`bool`?t=!1:e===`color`?t=new a:e===`vec2`?t=new Fe:e===`vec3`?t=new j:e===`vec4`&&(t=new Je)),e===`float`)return cB(t);if(e===`int`)return`${Math.round(t)}`;if(e===`uint`)return t>=0?`${Math.round(t)}u`:`0u`;if(e===`bool`)return t?`true`:`false`;if(e===`color`)return`${this.getType(`vec3`)}( ${cB(t.r)}, ${cB(t.g)}, ${cB(t.b)} )`;let n=this.getTypeLength(e),r=this.getComponentType(e),i=e=>this.generateConst(r,e);if(n===2)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)} )`;if(n===3)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)} )`;if(n===4&&e!==`mat2`)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)}, ${i(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(i).join(`, `)} )`;if(n>4)return`${this.getType(e)}()`;throw Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e===`color`?`vec3`:e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){let n=this.attributes;for(let t of n)if(t.name===e)return t;let r=new Pz(e,t);return this.registerDeclaration(r),n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e===`void`||e===`property`||e===`sampler`||e===`samplerComparison`||e===`texture`||e===`cubeTexture`||e===`storageTexture`||e===`depthTexture`||e===`texture3D`}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){let t=e.type;if(e.isDataTexture){if(t===1013)return`int`;if(t===1014)return`uint`}return`float`}getElementType(e){return e===`mat2`?`vec2`:e===`mat3`?`vec3`:e===`mat4`?`vec4`:this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e===`float`||e===`bool`||e===`int`||e===`uint`)return e;let t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]===`b`?`bool`:t[1]===`i`?`int`:t[1]===`u`?`uint`:`float`}getVectorType(e){return e===`color`?`vec3`:e===`texture`||e===`cubeTexture`||e===`storageTexture`||e===`texture3D`?`vec4`:e}getTypeFromLength(e,t=`float`){if(e===1)return t;let n=yy(e),r=t===`float`?``:t[0];return/mat2/.test(t)===!0&&(n=n.replace(`vec`,`mat`)),r+n}getTypeFromArray(e){return sB.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);let n=t.array,r=e.itemSize,i=e.normalized,a;return!(e instanceof I)&&i!==!0&&(a=this.getTypeFromArray(n)),this.getTypeFromLength(r,a)}getTypeLength(e){let t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n===null?t===`float`||t===`bool`||t===`int`||t===`uint`?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0:Number(n[1])}getVectorFromMatrix(e){return e.replace(`mat`,`vec`)}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){let t=this.getComponentType(e);return t===`int`||t===`uint`?e:this.changeComponentType(e,`int`)}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw Error(`NodeBuilder: Invalid active stack removal.`)}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=mN(this.stack);let e=zb();return this.stacks.push(e),Rb(this.stack),this.stack}removeStack(){let e=this.stack;for(let t of e.nodes){let n=this.getDataFromNode(t);n.stack=e}return this.stack=e.parent,Rb(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let r=n.getData(e);r===void 0&&(r={},n.setData(e,r)),r[t]===void 0&&(r[t]={});let i=r[t],a=r.any?r.any.subBuilds:null,o=this.getClosestSubBuild(a);return o&&(i.subBuildsCache===void 0&&(i.subBuildsCache={}),i=i.subBuildsCache[o]||(i.subBuildsCache[o]={}),i.subBuilds=a),i}getNodeProperties(e,t=`any`){let n=this.getDataFromNode(e,t);return n.properties||={outputNode:null}}getBufferAttributeFromNode(e,t){let n=this.getDataFromNode(e),r=n.bufferAttribute;return r===void 0&&(r=new Pz(`nodeAttribute`+ this.uniforms.index++,t,e),this.bufferAttributes.push(r),n.bufferAttribute=r),r}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,n=null,r=this.shaderStage){let i=this.getDataFromNode(e,r,this.globalCache),a=i.structType;if(a===void 0){let o=this.structs.index++;n===null&&(n=`StructType`+o),a=new Vz(n,t),this.structs[r].push(a),this.types[r][n]=e,i.structType=a}return a}getOutputStructTypeFromNode(e,t){let n=this.getStructTypeFromNode(e,t,`OutputType`,`fragment`);return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,r=null){let i=this.getDataFromNode(e,n,this.globalCache),a=i.uniform;if(a===void 0){let o=this.uniforms.index++;a=new Fz(r||`nodeUniform`+o,t,e),this.uniforms[n].push(a),this.registerDeclaration(a),i.uniform=a}return a}getVarFromNode(e,t=null,n=e.getNodeType(this),r=this.shaderStage,i=!1){let a=this.getDataFromNode(e,r),o=this.getSubBuildProperty(`variable`,a.subBuilds),s=a[o];if(s===void 0){let c=i?`_const`:`_var`,l=this.vars[r]||(this.vars[r]=[]),u=this.vars[c]||(this.vars[c]=0);t===null&&(t=(i?`nodeConst`:`nodeVar`)+u,this.vars[c]++),o!==`variable`&&(t=this.getSubBuildProperty(t,a.subBuilds));let d=e.getArrayCount(this);s=new Iz(t,n,i,d),i||l.push(s),this.registerDeclaration(s),a[o]=s}return s}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(let t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this),r=null,i=null){let a=this.getDataFromNode(e,`any`),o=this.getSubBuildProperty(`varying`,a.subBuilds),s=a[o];if(s===void 0){let e=this.varyings,c=e.length;t===null&&(t=`nodeVarying`+c),o!==`varying`&&(t=this.getSubBuildProperty(t,a.subBuilds)),s=new Lz(t,n,r,i),e.push(s),this.registerDeclaration(s),a[o]=s}return s}registerDeclaration(e){let t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e),i=1,a=r;for(;n[a]!==void 0;)a=r+`_`+ i++;i>1&&(e.name=a,P(`TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${a}'.`)),n[a]=e}getCodeFromNode(e,t,n=this.shaderStage){let r=this.getDataFromNode(e),i=r.code;if(i===void 0){let e=this.codes[n]||(this.codes[n]=[]),a=e.length;i=new Rz(`nodeCode`+a,t),e.push(i),r.code=i}return i}addFlowCodeHierarchy(e,t){let{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e),i=!0,a=t;for(;a;){if(r.get(a)===!0){i=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(i)for(let e of n)this.addLineFlowCode(e)}addLineFlowCodeBlock(e,t,n){let r=this.getDataFromNode(e),i=r.flowCodes||=[],a=r.flowCodeBlock||=new WeakMap;i.push(t),a.set(n,!0)}addLineFlowCode(e,t=null){return e===``?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e+=`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+=`	`,this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){let t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){let t=new PF,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){let t=e.layout,n={[Symbol.iterator](){let e=0,t=Object.values(this);return{next:()=>({value:t[e],done:e++>=t.length})}}};for(let e of t.inputs)n[e.name]=new fN(e.type,e.name);e.layout=null;let r=e.call(n),i=this.flowStagesNode(r,t.type);return e.layout=t,i}flowBuildStage(e,t,n=null){let r=this.getBuildStage();this.setBuildStage(t);let i=e.build(this,n);return this.setBuildStage(r),i}flowStagesNode(e,t=null){let n=this.flow,r=this.vars,i=this.declarations,a=this.cache,o=this.buildStage,s=this.stack,c={code:``};this.flow=c,this.vars={},this.declarations={},this.cache=new Bz,this.stack=mN();for(let n of Py)this.setBuildStage(n),c.result=e.build(this,t);return c.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.declarations=i,this.cache=a,this.stack=s,this.setBuildStage(o),c}getFunctionOperator(){return null}buildFunctionCode(){P(`Abstract function.`)}flowChildNode(e,t=null){let n=this.flow,r={code:``};return this.flow=r,r.result=e.build(this,t),this.flow=n,r}flowNodeFromShaderStage(e,t,n=null,r=null){let i=this.tab,a=this.cache,o=this.shaderStage,s=this.context;this.setShaderStage(e);let c={...this.context};delete c.nodeBlock,this.cache=this.globalCache,this.tab=`	`,this.context=c;let l=null;if(this.buildStage===`generate`){let i=this.flowChildNode(t,n);r!==null&&(i.code+=`${this.tab+r} = ${i.result};\n`),this.flowCode[e]=this.flowCode[e]+i.code,l=i}else l=t.build(this);return this.setShaderStage(o),this.cache=a,this.tab=i,this.context=s,l}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){P(`Abstract function.`)}getVaryings(){P(`Abstract function.`)}getVar(e,t,n=null){return`${n===null?this.getType(e):this.generateArrayDeclaration(e,n)} ${t}`}getVars(e){let t=``,n=this.vars[e];if(n!==void 0)for(let e of n)t+=`${this.getVar(e.type,e.name)}; `;return t}getUniforms(){P(`Abstract function.`)}getCodes(e){let t=this.codes[e],n=``;if(t!==void 0)for(let e of t)n+=e.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){P(`Abstract function.`)}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(t=e&&e.isNode?e.isShaderCallNodeInternal?e.shaderNode.subBuilds:e.isStackNode?[e.subBuild]:this.getDataFromNode(e,`any`).subBuilds:e instanceof Set?[...e]:e,!t)return null;let n=this.subBuildLayers;for(let e=t.length-1;e>=0;e--){let r=t[e];if(n.includes(r))return r}return null}getSubBuildOutput(e){return this.getSubBuildProperty(`outputNode`,e)}getSubBuildProperty(e=``,t=null){let n;n=t===null?this.subBuildFn:this.getClosestSubBuild(t);let r;return r=n?e?n+`_`+e:n:e,r}build(){let{object:e,material:t,renderer:n}=this;if(t!==null){let e=n.library.fromMaterial(t);e===null&&(N(`NodeMaterial: Material "${t.type}" is not compatible.`),e=new Ck),e.build(this)}else this.addFlow(`compute`,e);for(let e of Py){this.setBuildStage(e),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage(`vertex`,this.context.vertex);for(let t of Fy){this.setShaderStage(t);let n=this.flowNodes[t];for(let t of n)e===`generate`?this.flowNode(t):t.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t===`float`||t===`int`||t===`uint`)return new Zz(e);if(t===`vec2`||t===`ivec2`||t===`uvec2`)return new Qz(e);if(t===`vec3`||t===`ivec3`||t===`uvec3`)return new $z(e);if(t===`vec4`||t===`ivec4`||t===`uvec4`)return new eB(e);if(t===`color`)return new tB(e);if(t===`mat2`)return new nB(e);if(t===`mat3`)return new rB(e);if(t===`mat4`)return new iB(e);throw Error(`Uniform "${t}" not declared.`)}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;let r=this.getTypeLength(t),i=this.getTypeLength(n);return r===16&&i===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:r===9&&i===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||i>4||i===0?e:r===i?`${this.getType(n)}( ${e} )`:r>i?(e=n===`bool`?`all( ${e} )`:`${e}.${`xyz`.slice(0,i)}`,this.format(e,this.getTypeFromLength(i,this.getComponentType(t)),n)):i===4&&r>1?`${this.getType(n)}( ${this.format(e,t,`vec3`)}, 1.0 )`:r===2?`${this.getType(n)}( ${this.format(e,t,`vec2`)}, 0.0 )`:(r===1&&i>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r181 - Node System
`}},uB=class{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderId:0,frameId:0},e.set(t,n)),n}updateBeforeNode(e){let t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===Ay.FRAME){let t=this._getMaps(this.updateBeforeMap,n);t.frameId!==this.frameId&&e.updateBefore(this)!==!1&&(t.frameId=this.frameId)}else if(t===Ay.RENDER){let t=this._getMaps(this.updateBeforeMap,n);t.renderId!==this.renderId&&e.updateBefore(this)!==!1&&(t.renderId=this.renderId)}else t===Ay.OBJECT&&e.updateBefore(this)}updateAfterNode(e){let t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===Ay.FRAME){let t=this._getMaps(this.updateAfterMap,n);t.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(t.frameId=this.frameId)}else if(t===Ay.RENDER){let t=this._getMaps(this.updateAfterMap,n);t.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(t.renderId=this.renderId)}else t===Ay.OBJECT&&e.updateAfter(this)}updateNode(e){let t=e.getUpdateType(),n=e.updateReference(this);if(t===Ay.FRAME){let t=this._getMaps(this.updateMap,n);t.frameId!==this.frameId&&e.update(this)!==!1&&(t.frameId=this.frameId)}else if(t===Ay.RENDER){let t=this._getMaps(this.updateMap,n);t.renderId!==this.renderId&&e.update(this)!==!1&&(t.renderId=this.renderId)}else t===Ay.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}},dB=class{constructor(e,t,n=null,r=``,i=!1){this.type=e,this.name=t,this.count=n,this.qualifier=r,this.isConst=i}};dB.isNodeFunctionInput=!0;var fB=class extends JL{static get type(){return`DirectionalLightNode`}constructor(e=null){super(e)}setupDirect(){let e=this.colorNode;return{lightDirection:rL(this.light),lightColor:e}}},pB=new F,mB=new F,hB=null,gB=class extends JL{static get type(){return`RectAreaLightNode`}constructor(e=null){super(e),this.halfHeight=Jx(new j).setGroup(Gx),this.halfWidth=Jx(new j).setGroup(Gx),this.updateType=Ay.RENDER}update(e){super.update(e);let{light:t}=this,n=e.camera.matrixWorldInverse;mB.identity(),pB.copy(t.matrixWorld),pB.premultiply(n),mB.extractRotation(pB),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(mB),this.halfHeight.value.applyMatrix4(mB)}setupDirectRectArea(e){let t,n;e.isAvailable(`float32Filterable`)?(t=tT(hB.LTC_FLOAT_1),n=tT(hB.LTC_FLOAT_2)):(t=tT(hB.LTC_HALF_1),n=tT(hB.LTC_HALF_2));let{colorNode:r,light:i}=this;return{lightColor:r,lightPosition:nL(i),halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){hB=e}},_B=class extends JL{static get type(){return`SpotLightNode`}constructor(e=null){super(e),this.coneCosNode=Jx(0).setGroup(Gx),this.penumbraCosNode=Jx(0).setGroup(Gx),this.cutoffDistanceNode=Jx(0).setGroup(Gx),this.decayExponentNode=Jx(0).setGroup(Gx),this.colorNode=Jx(this.color).setGroup(Gx)}update(e){super.update(e);let{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){let{coneCosNode:n,penumbraCosNode:r}=this;return PC(n,r,t)}getLightCoord(e){let t=e.getNodeProperties(this),n=t.projectionUV;return n===void 0&&(n=$I(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){let{colorNode:t,cutoffDistanceNode:n,decayExponentNode:r,light:i}=this,a=this.getLightVector(e),o=a.normalize(),s=o.dot(rL(i)),c=this.getSpotAttenuation(e,s),l=YL({lightDistance:a.length(),cutoffDistance:n,decayExponent:r}),u=t.mul(c).mul(l),d,f;return i.colorNode?(f=this.getLightCoord(e),d=i.colorNode(f)):i.map&&(f=this.getLightCoord(e),d=tT(i.map,f.xy).onRenderUpdate(()=>i.map)),d&&(u=f.mul(2).sub(1).abs().lessThan(1).all().select(u.mul(d),u)),{lightColor:u,lightDirection:o}}},vB=class extends _B{static get type(){return`IESSpotLightNode`}getSpotAttenuation(e,t){let n=this.light.iesMap,r=null;return r=n&&n.isTexture===!0?tT(n,J(t.acos().mul(1/Math.PI),0),0).r:super.getSpotAttenuation(t),r}},yB=W(([e,t])=>{let n=e.abs().sub(t);return nC(gC(n,0)).add(hC(gC(n.x,n.y),0))}),bB=class extends _B{static get type(){return`ProjectorLightNode`}update(e){super.update(e);let t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let e=1;t.map!==null&&(e=t.map.width/t.map.height),t.shadow.aspect=e}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){let t=G(0),n=this.penumbraCosNode,r=QI(this.light).mul(e.context.positionWorld||aE);return Bb(r.w.greaterThan(0),()=>{let e=yB(r.xyz.div(r.w).xy.sub(J(.5)),J(.5)),i=aS(-1,rS(1,QS(n)).sub(1));t.assign(MC(e.mul(-2).mul(i)))}),t}},xB=class extends JL{static get type(){return`AmbientLightNode`}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}},SB=class extends JL{static get type(){return`HemisphereLightNode`}constructor(e=null){super(e),this.lightPositionNode=eL(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Jx(new a).setGroup(Gx)}update(e){let{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){let{colorNode:t,groundColorNode:n,lightDirectionNode:r}=this,i=AC(n,t,vE.dot(r).mul(.5).add(.5));e.context.irradiance.addAssign(i)}},CB=class extends JL{static get type(){return`LightProbeNode`}constructor(e=null){super(e);let t=[];for(let e=0;e<9;e++)t.push(new j);this.lightProbe=dT(t)}update(e){let{light:t}=this;super.update(e);for(let e=0;e<9;e++)this.lightProbe.array[e].copy(t.sh.coefficients[e]).multiplyScalar(t.intensity)}setup(e){let t=Oz(vE,this.lightProbe);e.context.irradiance.addAssign(t)}},wB=class{parseFunction(){P(`Abstract function.`)}},TB=class{constructor(e,t,n=``,r=``){this.type=e,this.inputs=t,this.name=n,this.precision=r}getCode(){P(`Abstract function.`)}};TB.isNodeFunction=!0;var EB=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,DB=/[a-z_0-9]+/gi,OB=`#pragma main`,kB=e=>{e=e.trim();let t=e.indexOf(OB),n=t===-1?e:e.slice(t+12),r=n.match(EB);if(r!==null&&r.length===5){let i=r[4],a=[],o=null;for(;(o=DB.exec(i))!==null;)a.push(o);let s=[],c=0;for(;c<a.length;){let e=a[c][0]===`const`;e===!0&&c++;let t=a[c][0];t===`in`||t===`out`||t===`inout`?c++:t=``;let n=a[c++][0],r=Number.parseInt(a[c][0]);Number.isNaN(r)===!1?c++:r=null;let i=a[c++][0];s.push(new dB(n,i,r,t,e))}let l=n.substring(r[0].length),u=r[3]===void 0?``:r[3];return{type:r[2],inputs:s,name:u,precision:r[1]===void 0?``:r[1],inputsCode:i,blockCode:l,headerCode:t===-1?``:e.slice(0,t)}}else throw Error(`FunctionNode: Function is not a GLSL code.`)},AB=class extends TB{constructor(e){let{type:t,inputs:n,name:r,precision:i,inputsCode:a,blockCode:o,headerCode:s}=kB(e);super(t,n,r,i),this.inputsCode=a,this.blockCode=o,this.headerCode=s}getCode(e=this.name){let t,n=this.blockCode;if(n!==``){let{type:r,inputsCode:i,headerCode:a,precision:o}=this,s=`${r} ${e} ( ${i.trim()} )`;o!==``&&(s=`${o} ${s}`),t=a+s+n}else t=``;return t}},jB=class extends wB{parseFunction(e){return new AB(e)}},MB=new WeakMap,NB=[],PB=[],FB=class extends NM{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new uB,this.nodeBuilderCache=new Map,this.callHashCache=new DM,this.groupsData=new DM,this.cacheLib={}}updateGroup(e){let t=e.groupNode,n=t.name;if(n===Kx.name)return!0;if(n===Gx.name){let t=this.get(e),n=this.nodeFrame.renderId;return t.renderId===n?!1:(t.renderId=n,!0)}if(n===Wx.name){let t=this.get(e),n=this.nodeFrame.frameId;return t.frameId===n?!1:(t.frameId=n,!0)}NB[0]=t,NB[1]=e;let r=this.groupsData.get(NB);return r===void 0&&this.groupsData.set(NB,r={}),NB.length=0,r.version===t.version?!1:(r.version=t.version,!0)}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){let t=this.get(e),n=t.nodeBuilderState;if(n===void 0){let{nodeBuilderCache:r}=this,i=this.getForRenderCacheKey(e);if(n=r.get(i),n===void 0){let t=t=>{let n=this.backend.createNodeBuilder(e.object,this.renderer);return n.scene=e.scene,n.material=t,n.camera=e.camera,n.context.material=t,n.lightsNode=e.lightsNode,n.environmentNode=this.getEnvironmentNode(e.scene),n.fogNode=this.getFogNode(e.scene),n.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&n.enableMultiview(),n},a=t(e.material);try{a.build()}catch(e){a=t(new Ck),a.build(),N(`TSL: `+e)}n=this._createNodeBuilderState(a),r.set(i,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){let t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){let t=this.get(e),n=t.nodeBuilderState;if(n===void 0){let r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new Nz(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{let n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{let n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){NB[0]=e,NB[1]=t;let n=this.renderer.info.calls,r=this.callHashCache.get(NB)||{};if(r.callId!==n){let i=this.getEnvironmentNode(e),a=this.getFogNode(e);t&&PB.push(t.getCacheKey(!0)),i&&PB.push(i.getCacheKey()),a&&PB.push(a.getCacheKey()),PB.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),PB.push(this.renderer.shadowMap.enabled?1:0),PB.push(this.renderer.shadowMap.type),r.callId=n,r.cacheKey=hy(PB),this.callHashCache.set(NB,r),PB.length=0}return NB.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){let t=this.get(e),n=e.background;if(n){let r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;(t.background!==n||r)&&(t.backgroundNode=this.getCacheNode(`background`,n,()=>{if(n.isCubeTexture===!0||n.mapping===303||n.mapping===304||n.mapping===306){if(e.backgroundBlurriness>0||n.mapping===306)return eM(n);{let e;return e=n.isCubeTexture===!0?IE(n):tT(n),Vk(e)}}else if(n.isTexture===!0)return tT(n,_T.flipY()).setUpdateMatrix(!0);else n.isColor!==!0&&N(`WebGPUNodes: Unsupported background configuration.`,n)},r),t.background=n,t.backgroundBlurriness=e.backgroundBlurriness)}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,r=!1){let i=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap),a=i.get(t);return(a===void 0||r)&&(a=n(),i.set(t,a)),a}updateFog(e){let t=this.get(e),n=e.fog;n?t.fog!==n&&(t.fogNode=this.getCacheNode(`fog`,n,()=>{if(n.isFogExp2)return KF(BE(`color`,`color`,n).setGroup(Gx),GF(BE(`density`,`float`,n).setGroup(Gx)));if(n.isFog)return KF(BE(`color`,`color`,n).setGroup(Gx),WF(BE(`near`,`float`,n).setGroup(Gx),BE(`far`,`float`,n).setGroup(Gx)));N(`Renderer: Unsupported fog configuration.`,n)}),t.fog=n):(delete t.fogNode,delete t.fog)}updateEnvironment(e){let t=this.get(e),n=e.environment;n?t.environment!==n&&(t.environmentNode=this.getCacheNode(`environment`,n,()=>{if(n.isCubeTexture===!0)return IE(n);if(n.isTexture===!0)return tT(n);N(`Nodes: Unsupported environment configuration.`,n)}),t.environment=n):t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,r=null,i=null){let a=this.nodeFrame;return a.renderer=e,a.scene=t,a.object=n,a.camera=r,a.material=i,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){let e=this.renderer;return e.toneMapping+`,`+e.currentColorSpace+`,`+e.xr.isPresenting}hasOutputChange(e){return MB.get(e)!==this.getOutputCacheKey()}getOutputNode(e){let t=this.renderer,n=this.getOutputCacheKey(),r=e.isArrayTexture?YP(e,Y(_T,fT(`gl_ViewID_OVR`))).renderOutput(t.toneMapping,t.currentColorSpace):tT(e,_T).renderOutput(t.toneMapping,t.currentColorSpace);return MB.set(e,n),r}updateBefore(e){let t=e.getNodeBuilderState();for(let n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){let t=e.getNodeBuilderState();for(let n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){let t=this.getNodeFrame(),n=this.getForCompute(e);for(let e of n.updateNodes)t.updateNode(e)}updateForRender(e){let t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(let e of n.updateNodes)t.updateNode(e)}needsRefresh(e){let t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new uB,this.nodeBuilderCache=new Map,this.cacheLib={}}},IB=new Tr,LB=class e{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey=``,this.shadowPass=!1,this.viewNormalMatrix=new gr,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){let r=e.length;for(let i=0;i<r;i++){IB.copy(e[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);let r=t[n+i],a=IB.normal;r.x=-a.x,r.y=-a.y,r.z=-a.z,r.w=IB.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);let r=t.clippingPlanes,i=r.length,a,o;if(this.clipIntersection?(a=this.intersectionPlanes,o=e.intersectionPlanes.length):(a=this.unionPlanes,o=e.unionPlanes.length),a.length!==o+i){a.length=o+i;for(let e=0;e<i;e++)a[o+e]=new Je;n=!0}this.projectPlanes(r,a,o),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(t){if(this.shadowPass&&!t.clipShadows)return this;let n=this.clippingGroupContexts.get(t);return n===void 0&&(n=new e(this),this.clippingGroupContexts.set(t,n)),n.update(this,t),n}get unionClippingCount(){return this.unionPlanes.length}},RB=class{constructor(e,t){this.bundleGroup=e,this.camera=t}},zB=[],BB=class{constructor(){this.bundles=new DM}get(e,t){let n=this.bundles;zB[0]=e,zB[1]=t;let r=n.get(zB);return r===void 0&&(r=new RB(e,t),n.set(zB,r)),zB.length=0,r}dispose(){this.bundles=new DM}},VB=class{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null,n=this.getMaterialNodeClass(e.type);if(n!==null)for(let r in t=new n,e)t[r]=e[r];return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){P(`Redefinition of node ${t}`);return}if(typeof e!=`function`)throw Error(`Node class ${e.name} is not a class.`);if(typeof t==`function`||typeof t==`object`)throw Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){P(`Redefinition of node ${t.name}`);return}if(typeof e!=`function`)throw Error(`Node class ${e.name} is not a class.`);if(typeof t!=`function`)throw Error(`Base class ${t.name} is not a class.`);n.set(t,e)}},HB=new cL,UB=[],WB=class extends DM{constructor(){super()}createNode(e=[]){return new cL().setLights(e)}getNode(e,t){if(e.isQuadMesh)return HB;UB[0]=e,UB[1]=t;let n=this.get(UB);return n===void 0&&(n=this.createNode(),this.set(UB,n)),UB.length=0,n}},GB=class extends p{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}},KB=new j,qB=new j,JB=class extends pn{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Ee,this._cameraL.viewport=new Je,this._cameraR=new Ee,this._cameraR.viewport=new Je,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new L,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<`u`,this._frameBufferTargets=null,this._createXRLayer=tV.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Fe,this._onSessionEvent=QB.bind(this),this._onSessionEnd=$B.bind(this),this._onInputSourcesChange=eV.bind(this),this._onAnimationFrame=nV.bind(this),this._referenceSpace=null,this._referenceSpaceType=`local-floor`,this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&`createProjectionLayer`in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&P(`XRManager: Cannot change framebuffer scale while presenting.`)}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&P(`XRManager: Cannot change reference space type while presenting.`)}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,r,i,a,o,s={}){let c=new xe(e,t),l=new GB(i,a,{format:jr,type:g,depthTexture:new Mt(i,a,s.stencil?mt:x,void 0,void 0,void 0,void 0,void 0,void 0,s.stencil?Lt:ye),stencilBuffer:s.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});l._autoAllocateDepthBuffer=!0;let u=new Wr({color:16777215,side:0});u.map=l.texture,u.map.offset.y=1,u.map.repeat.y=-1;let d=new tr(c,u);d.position.copy(n),d.quaternion.copy(r);let f={type:`quad`,width:e,height:t,translation:n,quaternion:r,pixelwidth:i,pixelheight:a,plane:d,material:u,rendercall:o,renderTarget:l};if(this._layers.push(f),this._session!==null){f.plane.material=new Wr({color:16777215,side:0}),f.plane.material.blending=5,f.plane.material.blendEquation=100,f.plane.material.blendSrc=200,f.plane.material.blendDst=200,f.xrlayer=this._createXRLayer(f);let e=this._session.renderState.layers;e.unshift(f.xrlayer),this._session.updateRenderState({layers:e})}else l.isXRRenderTarget=!1;return d}createCylinderLayer(e,t,n,r,i,a,o,s,c={}){let l=new vt(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),u=new GB(a,o,{format:jr,type:g,depthTexture:new Mt(a,o,c.stencil?mt:x,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?Lt:ye),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});u._autoAllocateDepthBuffer=!0;let d=new Wr({color:16777215,side:1});d.map=u.texture,d.map.offset.y=1,d.map.repeat.y=-1;let f=new tr(l,d);f.position.copy(r),f.quaternion.copy(i);let p={type:`cylinder`,radius:e,centralAngle:t,aspectratio:n,translation:r,quaternion:i,pixelwidth:a,pixelheight:o,plane:f,material:d,rendercall:s,renderTarget:u};if(this._layers.push(p),this._session!==null){p.plane.material=new Wr({color:16777215,side:1}),p.plane.material.blending=5,p.plane.material.blendEquation=100,p.plane.material.blendSrc=200,p.plane.material.blendDst=200,p.xrlayer=this._createXRLayer(p);let e=this._session.renderState.layers;e.unshift(p.xrlayer),this._session.updateRenderState({layers:e})}else u.isXRRenderTarget=!1;return f}renderLayers(){let e=new j,t=new et,n=this._renderer,r=this.isPresenting,i=n.getOutputRenderTarget(),a=n._frameBufferTarget;this.isPresenting=!1;let o=new Fe;n.getSize(o);let s=n._quad;for(let r of this._layers)if(r.renderTarget.isXRRenderTarget=this._session!==null,r.renderTarget._hasExternalTextures=r.renderTarget.isXRRenderTarget,r.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){r.xrlayer.transform=new XRRigidTransform(r.plane.getWorldPosition(e),r.plane.getWorldQuaternion(t));let i=this._glBinding.getSubImage(r.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(r.renderTarget,i.colorTexture,void 0),n._setXRLayerSize(r.renderTarget.width,r.renderTarget.height),n.setOutputRenderTarget(r.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||=new WeakMap;let{frameBufferTarget:a,quad:o}=this._frameBufferTargets.get(r.renderTarget)||{frameBufferTarget:null,quad:null};a?(n._frameBufferTarget=a,n._quad=o):(n._quad=new vP(new Ck),this._frameBufferTargets.set(r.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),r.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(r.renderTarget),r.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(i),n._frameBufferTarget=a,n._setXRLayerSize(o.x,o.y),n._quad=s,this.isPresenting=r}getSession(){return this._session}async setSession(e){let t=this._renderer,n=t.backend;this._gl=t.getContext();let r=this._gl,i=r.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw Error(`THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.`);if(e.addEventListener(`select`,this._onSessionEvent),e.addEventListener(`selectstart`,this._onSessionEvent),e.addEventListener(`selectend`,this._onSessionEvent),e.addEventListener(`squeeze`,this._onSessionEvent),e.addEventListener(`squeezestart`,this._onSessionEvent),e.addEventListener(`squeezeend`,this._onSessionEvent),e.addEventListener(`end`,this._onSessionEnd),e.addEventListener(`inputsourceschange`,this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let n=null,a=null,o=null;t.depth&&(o=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,n=t.stencil?Lt:ye,a=t.stencil?mt:x);let s={colorFormat:r.RGBA8,depthFormat:o,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature(`OVR_multiview2`)&&(s.textureType=`texture-array`,this._useMultiview=!0),this._glBinding=this.getBinding();let c=this._glBinding.createProjectionLayer(s),l=[c];this._glProjLayer=c,t.setPixelRatio(1),t._setXRLayerSize(c.textureWidth,c.textureHeight);let u=this._useMultiview?2:1,d=new Mt(c.textureWidth,c.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n,u);if(this._xrRenderTarget=new GB(c.textureWidth,c.textureHeight,{format:jr,type:g,colorSpace:t.outputColorSpace,depthTexture:d,stencilBuffer:t.stencil,samples:i.antialias?4:0,resolveDepthBuffer:c.ignoreDepthValues===!1,resolveStencilBuffer:c.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes(`layers`),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(let e of this._layers)e.plane.material=new Wr({color:16777215,side:e.type===`cylinder`?1:0}),e.plane.material.blending=5,e.plane.material.blendEquation=100,e.plane.material.blendSrc=200,e.plane.material.blendDst=200,e.xrlayer=this._createXRLayer(e),l.unshift(e.xrlayer);e.updateRenderState({layers:l})}else{let n={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},i=new XRWebGLLayer(e,r,n);this._glBaseLayer=i,e.updateRenderState({baseLayer:i}),t.setPixelRatio(1),t._setXRLayerSize(i.framebufferWidth,i.framebufferHeight),this._xrRenderTarget=new GB(i.framebufferWidth,i.framebufferHeight,{format:jr,type:g,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:i.ignoreDepthValues===!1,resolveStencilBuffer:i.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:`sessionstart`})}}updateCamera(e){let t=this._session;if(t===null)return;let n=e.near,r=e.far,i=this._cameraXR,a=this._cameraL,o=this._cameraR;i.near=o.near=a.near=n,i.far=o.far=a.far=r,i.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==i.near||this._currentDepthFar!==i.far)&&(t.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),i.layers.mask=e.layers.mask|6,a.layers.mask=i.layers.mask&3,o.layers.mask=i.layers.mask&5;let s=e.parent,c=i.cameras;XB(i,s);for(let e=0;e<c.length;e++)XB(c[e],s);c.length===2?YB(i,a,o):i.projectionMatrix.copy(a.projectionMatrix),ZB(e,i,s)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new it,this._controllers[e]=t),t}};function YB(e,t,n){KB.setFromMatrixPosition(t.matrixWorld),qB.setFromMatrixPosition(n.matrixWorld);let r=KB.distanceTo(qB),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),c=(i[9]+1)/i[5],l=(i[9]-1)/i[5],u=(i[8]-1)/i[0],d=(a[8]+1)/a[0],f=o*u,p=o*d,m=r/(-u+d),h=m*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(h),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),i[10]===-1)e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{let t=o+m,n=s+m,i=f-h,a=p+(r-h),u=c*s/n*t,d=l*s/n*t;e.projectionMatrix.makePerspective(i,a,u,d,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}function XB(e,t){t===null?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}function ZB(e,t,r){r===null?e.matrix.copy(t.matrixWorld):(e.matrix.copy(r.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=n*2*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}function QB(e){let t=this._controllerInputSources.indexOf(e.inputSource);if(t===-1)return;let n=this._controllers[t];if(n!==void 0){let t=this.getReferenceSpace();n.update(e.inputSource,e.frame,t),n.dispatchEvent({type:e.type,data:e.inputSource})}}function $B(){let e=this._session,t=this._renderer;e.removeEventListener(`select`,this._onSessionEvent),e.removeEventListener(`selectstart`,this._onSessionEvent),e.removeEventListener(`selectend`,this._onSessionEvent),e.removeEventListener(`squeeze`,this._onSessionEvent),e.removeEventListener(`squeezestart`,this._onSessionEvent),e.removeEventListener(`squeezeend`,this._onSessionEvent),e.removeEventListener(`end`,this._onSessionEnd),e.removeEventListener(`inputsourceschange`,this._onInputSourcesChange);for(let e=0;e<this._controllers.length;e++){let t=this._controllerInputSources[e];t!==null&&(this._controllerInputSources[e]=null,this._controllers[e].disconnect(t))}if(this._currentDepthNear=null,this._currentDepthFar=null,t._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(let e of this._layers)e.renderTarget=new GB(e.pixelwidth,e.pixelheight,{format:jr,type:g,depthTexture:new Mt(e.pixelwidth,e.pixelheight,e.stencilBuffer?mt:x,void 0,void 0,void 0,void 0,void 0,void 0,e.stencilBuffer?Lt:ye),stencilBuffer:e.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),e.renderTarget.isXRRenderTarget=!1,e.plane.material=e.material,e.material.map=e.renderTarget.texture,e.material.map.offset.y=1,e.material.map.repeat.y=-1,delete e.xrlayer;this.isPresenting=!1,this._useMultiview=!1,t._animation.stop(),t._animation.setAnimationLoop(this._currentAnimationLoop),t._animation.setContext(this._currentAnimationContext),t._animation.start(),t.setPixelRatio(this._currentPixelRatio),t.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:`sessionend`})}function eV(e){let t=this._controllers,n=this._controllerInputSources;for(let r=0;r<e.removed.length;r++){let i=e.removed[r],a=n.indexOf(i);a>=0&&(n[a]=null,t[a].disconnect(i))}for(let r=0;r<e.added.length;r++){let i=e.added[r],a=n.indexOf(i);if(a===-1){for(let e=0;e<t.length;e++)if(e>=n.length){n.push(i),a=e;break}else if(n[e]===null){n[e]=i,a=e;break}if(a===-1)break}let o=t[a];o&&o.connect(i)}}function tV(e){return e.type===`quad`?this._glBinding.createQuadLayer({transform:new XRRigidTransform(e.translation,e.quaternion),width:e.width/2,height:e.height/2,space:this._referenceSpace,viewPixelWidth:e.pixelwidth,viewPixelHeight:e.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(e.translation,e.quaternion),radius:e.radius,centralAngle:e.centralAngle,aspectRatio:e.aspectRatio,space:this._referenceSpace,viewPixelWidth:e.pixelwidth,viewPixelHeight:e.pixelheight,clearOnAccess:!1})}function nV(e,t){if(t===void 0)return;let n=this._cameraXR,r=this._renderer,i=r.backend,a=this._glBaseLayer,o=this.getReferenceSpace(),s=t.getViewerPose(o);if(this._xrFrame=t,s!==null){let e=s.views;this._glBaseLayer!==null&&i.setXRTarget(a.framebuffer);let t=!1;e.length!==n.cameras.length&&(n.cameras.length=0,t=!0);for(let r=0;r<e.length;r++){let o=e[r],s;if(this._supportsLayers===!0){let e=this._glBinding.getViewSubImage(this._glProjLayer,o);s=e.viewport,r===0&&i.setXRRenderTargetTextures(this._xrRenderTarget,e.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:e.depthStencilTexture)}else s=a.getViewport(o);let c=this._cameras[r];c===void 0&&(c=new Ee,c.layers.enable(r),c.viewport=new Je,this._cameras[r]=c),c.matrix.fromArray(o.transform.matrix),c.matrix.decompose(c.position,c.quaternion,c.scale),c.projectionMatrix.fromArray(o.projectionMatrix),c.projectionMatrixInverse.copy(c.projectionMatrix).invert(),c.viewport.set(s.x,s.y,s.width,s.height),r===0&&(n.matrix.copy(c.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)),t===!0&&n.cameras.push(c)}r.setOutputRenderTarget(this._xrRenderTarget)}for(let e=0;e<this._controllers.length;e++){let n=this._controllerInputSources[e],r=this._controllers[e];n!==null&&r!==void 0&&r.update(n,t,o)}this._currentAnimationLoop&&this._currentAnimationLoop(e,t),t.detectedPlanes&&this.dispatchEvent({type:`planesdetected`,data:t}),this._xrFrame=null}var rV=class extends pn{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Je(0,0,this._width,this._height),this._scissor=new Je(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new cr,this.depthTexture=new Mt}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+`px`,this.domElement.style.height=t+`px`),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){let t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,r){let i=this._scissor;e.isVector4?i.copy(e):i.set(e,t,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,r,i=0,a=1){let o=this._viewport;e.isVector4?o.copy(e):o.set(e,t,n,r),o.minDepth=i,o.maxDepth=a}_dispatchResize(){this.dispatchEvent({type:`resize`})}dispose(){this.dispatchEvent({type:`dispose`})}},iV=new Se,aV=new Fe,oV=new Je,sV=new Mn,cV=new Zt,lV=new F,uV=new Je,dV=class{constructor(e,t={}){this.isRenderer=!0;let{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:i=!0,stencil:a=!1,antialias:o=!1,samples:s=0,getFallback:c=null,colorBufferType:l=_t,multiview:u=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=De,this.toneMapping=0,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=i,this.stencil=a,this.info=new HM,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new VB,this.lighting=new WB,this._samples=s||o===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new rV(e.getDomElement()),this._canvasTarget.addEventListener(`resize`,this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new Uw,this._inspector.setRenderer(this),this._getFallback=c,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new vP(new Ck),this._quad.name=`Output Color Transform`,this._quad.material.name=`outputColorTransform`,this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null,this._clearColor=new dN(0,0,0,this.alpha===!0?0:1),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=l,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:1},this.xr=new JB(this,u),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(e,t,n)=>{await this.compileAsync(e,t);let r=this._renderLists.get(e,t),i=this._renderContexts.get(e,t,this._renderTarget),a=e.overrideMaterial||n.material,{fragmentShader:o,vertexShader:s}=this._objects.get(n,a,e,t,r.lightsNode,i,i.clippingContext).getNodeBuilderState();return{fragmentShader:o,vertexShader:s}}}}async init(){return this._initPromise===null&&(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(e){if(this._getFallback!==null)try{this.backend=n=this._getFallback(e),await n.init(this)}catch(e){t(e);return}else{t(e);return}}this._nodes=new FB(this,n),this._animation=new EM(this,this._nodes,this.info),this._attributes=new RM(n),this._background=new Az(this,this._nodes),this._geometries=new VM(this._attributes,this.info),this._textures=new uN(this,n,this.info),this._pipelines=new JM(n,this._nodes),this._bindings=new YM(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new MM(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new tN(this.lighting),this._bundles=new BB,this._renderContexts=new cN,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)})),this._initPromise}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();let r=this._nodes.nodeFrame,i=r.renderId,a=this._currentRenderContext,o=this._currentRenderObjectFunction,s=this._compilationPromises,c=e.isScene===!0?e:iV;n===null&&(n=e);let l=this._renderTarget,u=this._renderContexts.get(n,t,l),d=this._activeMipmapLevel,f=[];this._currentRenderContext=u,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=f,r.renderId++,r.update(),u.depth=this.depth,u.stencil=this.stencil,u.clippingContext||=new LB,u.clippingContext.updateGlobal(c,t),c.onBeforeRender(this,e,t,l);let p=this._renderLists.get(e,t);if(p.begin(),this._projectObject(e,t,0,p,u.clippingContext),n!==e&&n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&p.pushLight(e)}),p.finish(),l!==null){this._textures.updateRenderTarget(l,d);let e=this._textures.get(l);u.textures=e.textures,u.depthTexture=e.depthTexture}else u.textures=null,u.depthTexture=null;this._background.update(c,p,u);let m=p.opaque,h=p.transparent,g=p.transparentDoublePass,_=p.lightsNode;this.opaque===!0&&m.length>0&&this._renderObjects(m,t,c,_),this.transparent===!0&&h.length>0&&this._renderTransparents(h,g,t,c,_),r.renderId=i,this._currentRenderContext=a,this._currentRenderObjectFunction=o,this._compilationPromises=s,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(f)}async renderAsync(e,t){be(`Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.`),await this.init(),this.render(e,t)}async waitForGPU(){N(`Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.`)}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){e===!0?(this.overrideNodes.modelViewMatrix=eE,this.overrideNodes.modelNormalViewMatrix=tE):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===eE&&this.overrideNodes.modelNormalViewMatrix===tE}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:\n\nMessage: ${e.message}`;e.reason&&(t+=`\nReason: ${e.reason}`),N(t),this._isDeviceLost=!0}_renderBundle(e,t,n){let{bundleGroup:r,camera:i,renderList:a}=e,o=this._currentRenderContext,s=this._bundles.get(r,i),c=this.backend.get(s);c.renderContexts===void 0&&(c.renderContexts=new Set);let l=r.version!==c.version,u=c.renderContexts.has(o)===!1||l;if(c.renderContexts.add(o),u){this.backend.beginBundle(o),(c.renderObjects===void 0||l)&&(c.renderObjects=[]),this._currentRenderBundle=s;let{transparentDoublePass:e,transparent:u,opaque:d}=a;this.opaque===!0&&d.length>0&&this._renderObjects(d,i,t,n),this.transparent===!0&&u.length>0&&this._renderTransparents(u,e,i,t,n),this._currentRenderBundle=null,this.backend.finishBundle(o,s),c.version=r.version}else{let{renderObjects:e}=c;for(let t=0,n=e.length;t<n;t++){let n=e[t];this._nodes.needsRefresh(n)&&(this._nodes.updateBefore(n),this._nodes.updateForRender(n),this._bindings.updateForRender(n),this._nodes.updateAfter(n))}}this.backend.addBundle(o,s)}render(e,t){if(this._initialized===!1)throw Error(`Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.`);this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){let{currentToneMapping:e,currentColorSpace:t}=this,n=e!==0,r=t!==Un.workingColorSpace;if(n===!1&&r===!1)return null;let{width:i,height:a}=this.getDrawingBufferSize(aV),{depth:o,stencil:s}=this,c=this._frameBufferTarget;c===null&&(c=new p(i,a,{depthBuffer:o,stencilBuffer:s,type:this._colorBufferType,format:jr,colorSpace:Un.workingColorSpace,generateMipmaps:!1,minFilter:Vt,magFilter:Vt,samples:this.samples}),c.isPostProcessingRenderTarget=!0,this._frameBufferTarget=c);let l=this.getOutputRenderTarget();c.depthBuffer=o,c.stencilBuffer=s,l===null?c.setSize(i,a,1):c.setSize(l.width,l.height,l.depth);let u=this._canvasTarget;return c.viewport.copy(u._viewport),c.scissor.copy(u._scissor),c.viewport.multiplyScalar(u._pixelRatio),c.scissor.multiplyScalar(u._pixelRatio),c.scissorTest=u._scissorTest,c.multiview=l===null?!1:l.multiview,c.resolveDepthBuffer=l===null?!0:l.resolveDepthBuffer,c._autoAllocateDepthBuffer=l===null?!1:l._autoAllocateDepthBuffer,c}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;let r=n?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,a=i.renderId,o=this._currentRenderContext,s=this._currentRenderObjectFunction,c=e.isScene===!0?e:iV,l=this._renderTarget||this._outputRenderTarget,u=this._activeCubeFace,d=this._activeMipmapLevel,f;r===null?f=l:(f=r,this.setRenderTarget(f));let p=this._renderContexts.get(e,t,f);this._currentRenderContext=p,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls,this.backend.updateTimeStampUID(p),this.inspector.beginRender(this.backend.getTimestampUID(p),e,t,f);let m=this.coordinateSystem,h=this.xr;if(t.coordinateSystem!==m&&h.isPresenting===!1&&(t.coordinateSystem=m,t.updateProjectionMatrix(),t.isArrayCamera))for(let e of t.cameras)e.coordinateSystem=m,e.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),h.enabled===!0&&h.isPresenting===!0&&(h.cameraAutoUpdate===!0&&h.updateCamera(t),t=h.getCamera());let g=this._canvasTarget,_=g._viewport,v=g._scissor,y=g._pixelRatio;f!==null&&(_=f.viewport,v=f.scissor,y=1),this.getDrawingBufferSize(aV),oV.set(0,0,aV.width,aV.height);let b=_.minDepth===void 0?0:_.minDepth,x=_.maxDepth===void 0?1:_.maxDepth;p.viewportValue.copy(_).multiplyScalar(y).floor(),p.viewportValue.width>>=d,p.viewportValue.height>>=d,p.viewportValue.minDepth=b,p.viewportValue.maxDepth=x,p.viewport=p.viewportValue.equals(oV)===!1,p.scissorValue.copy(v).multiplyScalar(y).floor(),p.scissor=g._scissorTest&&p.scissorValue.equals(oV)===!1,p.scissorValue.width>>=d,p.scissorValue.height>>=d,p.clippingContext||=new LB,p.clippingContext.updateGlobal(c,t),c.onBeforeRender(this,e,t,f);let S=t.isArrayCamera?cV:sV;t.isArrayCamera||(lV.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),S.setFromProjectionMatrix(lV,t.coordinateSystem,t.reversedDepth));let C=this._renderLists.get(e,t);if(C.begin(),this._projectObject(e,t,0,C,p.clippingContext),C.finish(),this.sortObjects===!0&&C.sort(this._opaqueSort,this._transparentSort),f!==null){this._textures.updateRenderTarget(f,d);let e=this._textures.get(f);p.textures=e.textures,p.depthTexture=e.depthTexture,p.width=e.width,p.height=e.height,p.renderTarget=f,p.depth=f.depthBuffer,p.stencil=f.stencilBuffer}else p.textures=null,p.depthTexture=null,p.width=aV.width,p.height=aV.height,p.depth=this.depth,p.stencil=this.stencil;p.width>>=d,p.height>>=d,p.activeCubeFace=u,p.activeMipmapLevel=d,p.occlusionQueryCount=C.occlusionQueryCount,p.scissorValue.max(uV.set(0,0,0,0)),p.scissorValue.x+p.scissorValue.width>p.width&&(p.scissorValue.width=Math.max(p.width-p.scissorValue.x,0)),p.scissorValue.y+p.scissorValue.height>p.height&&(p.scissorValue.height=Math.max(p.height-p.scissorValue.y,0)),this._background.update(c,C,p),p.camera=t,this.backend.beginRender(p);let{bundles:w,lightsNode:T,transparentDoublePass:E,transparent:D,opaque:O}=C;return w.length>0&&this._renderBundles(w,c,T),this.opaque===!0&&O.length>0&&this._renderObjects(O,t,c,T),this.transparent===!0&&D.length>0&&this._renderTransparents(D,E,t,c,T),this.backend.finishRender(p),i.renderId=a,this._currentRenderContext=o,this._currentRenderObjectFunction=s,r!==null&&(this.setRenderTarget(l,u,d),this._renderOutput(f)),c.onAfterRender(this,e,t,f),this.inspector.finishRender(this.backend.getTimestampUID(p)),p}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){let t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);let n=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,n)}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,n)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,n,r){this._canvasTarget.setScissor(e,t,n,r)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,n,r,i=0,a=1){this._canvasTarget.setViewport(e,t,n,r,i,a)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){let t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)throw Error(`Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.`);let r=this._renderTarget||this._getFrameBufferTarget(),i=null;if(r!==null){this._textures.updateRenderTarget(r);let e=this._textures.get(r);i=this._renderContexts.getForClear(r),i.textures=e.textures,i.depthTexture=e.depthTexture,i.width=e.width,i.height=e.height,i.renderTarget=r,i.depth=r.depthBuffer,i.stencil=r.stencilBuffer,i.clearColorValue=this.backend.getClearColor(),i.activeCubeFace=this.getActiveCubeFace(),i.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,i),r!==null&&this._renderTarget===null&&this._renderOutput(r)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){be(`Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.`),await this.init(),this.clear(e,t,n)}async clearColorAsync(){be(`Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.`),this.clear(!0,!1,!1)}async clearDepthAsync(){be(`Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.`),this.clear(!1,!0,!1)}async clearStencilAsync(){be(`Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.`),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){let e=this.currentToneMapping!==0,t=this.currentColorSpace!==Un.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget===null?this.needsFrameBufferTarget&&(e=0):e=this._renderTarget.samples,e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:0}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:Un.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener(`resize`,this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener(`resize`,this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return P(`Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead.`),this.computeAsync(e,t);let n=this._nodes.nodeFrame,r=n.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,n.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);let i=this.backend,a=this._pipelines,o=this._bindings,s=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw Error(`THREE.Renderer: .compute() expects a ComputeNode.`);i.beginCompute(e);for(let n of c){if(a.has(n)===!1){let e=()=>{n.removeEventListener(`dispose`,e),a.delete(n),o.deleteForCompute(n),s.delete(n)};n.addEventListener(`dispose`,e);let t=n.onInitFunction;t!==null&&t.call(n,{renderer:this})}s.updateForCompute(n),o.updateForCompute(n);let r=o.getForCompute(n),c=a.getForCompute(n,r);i.compute(e,n,r,c,t)}i.finishCompute(e),n.renderId=r,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return be(`Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.`),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e=`render`){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw Error(`Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.`);return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){be(`Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.`),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw Error(`Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.`);this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=uV.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=uV.copy(t).floor();else{N(`Renderer.copyFramebufferToTexture: Invalid rectangle.`);return}else t=uV.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,r;n===null?(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),n=this._textures.get(r))):r=n.renderTarget,this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,n,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,n=null,r=null,i=0,a=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,r,i,a),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,n,r,i,a=0,o=0){return this.backend.copyTextureToBuffer(e.textures[a],t,n,r,i,o)}_projectObject(e,t,n,r,i){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(i=i.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){let a=t.isArrayCamera?cV:sV;if(!e.frustumCulled||a.intersectsSprite(e,t)){this.sortObjects===!0&&uV.setFromMatrixPosition(e.matrixWorld).applyMatrix4(lV);let{geometry:t,material:a}=e;a.visible&&r.push(e,t,a,n,uV.z,null,i)}}else if(e.isLineLoop)N(`Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.`);else if(e.isMesh||e.isLine||e.isPoints){let a=t.isArrayCamera?cV:sV;if(!e.frustumCulled||a.intersectsObject(e,t)){let{geometry:t,material:a}=e;if(this.sortObjects===!0&&(t.boundingSphere===null&&t.computeBoundingSphere(),uV.copy(t.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(lV)),Array.isArray(a)){let o=t.groups;for(let s=0,c=o.length;s<c;s++){let c=o[s],l=a[c.materialIndex];l&&l.visible&&r.push(e,t,l,n,uV.z,c,i)}}else a.visible&&r.push(e,t,a,n,uV.z,null,i)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){let n=r;r=this._renderLists.get(e,t),r.begin(),n.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}let a=e.children;for(let e=0,o=a.length;e<o;e++)this._projectObject(a[e],t,n,r,i)}_renderBundles(e,t,n){for(let r of e)this._renderBundle(r,t,n)}_renderTransparents(e,t,n,r,i){if(t.length>0){for(let{material:e}of t)e.side=1;this._renderObjects(t,n,r,i,`backSide`);for(let{material:e}of t)e.side=0;this._renderObjects(e,n,r,i);for(let{material:e}of t)e.side=2}else this._renderObjects(e,n,r,i)}_renderObjects(e,t,n,r,i=null){for(let a=0,o=e.length;a<o;a++){let{object:o,geometry:s,material:c,group:l,clippingContext:u}=e[a];this._currentRenderObjectFunction(o,n,t,s,c,l,r,u,i)}}_getShadowNodes(e){let t=e.version,n=this._cacheShadowNodes.get(e);if(n===void 0||n.version!==t){let r=e.map!==null,i=e.colorNode&&e.colorNode.isNode,a=e.castShadowNode&&e.castShadowNode.isNode,o=null,s=null,c=null;if(r||i||a){let t,n;a?(t=e.castShadowNode.rgb,n=e.castShadowNode.a):(t=Y(0),n=G(1)),r&&(n=n.mul(BE(`map`,`texture`,e).a)),i&&(n=n.mul(e.colorNode.a)),s=Zb(t,n)}e.depthNode&&e.depthNode.isNode&&(c=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?o=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(o=e.positionNode),n={version:t,colorNode:s,depthNode:c,positionNode:o},this._cacheShadowNodes.set(e,n)}return n}renderObject(e,t,n,r,i,a,o,s=null,c=null){let l=!1,u,d,f,p;if(e.onBeforeRender(this,t,n,r,i,a),i.allowOverride===!0&&t.overrideMaterial!==null){let e=t.overrideMaterial;if(l=!0,u=t.overrideMaterial.colorNode,d=t.overrideMaterial.depthNode,f=t.overrideMaterial.positionNode,p=t.overrideMaterial.side,i.positionNode&&i.positionNode.isNode&&(e.positionNode=i.positionNode),e.alphaTest=i.alphaTest,e.alphaMap=i.alphaMap,e.transparent=i.transparent||i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode||i.backdropNode&&i.backdropNode.isNode,e.isShadowPassMaterial){let{colorNode:t,depthNode:n,positionNode:r}=this._getShadowNodes(i);e.side=i.shadowSide===null?i.side:i.shadowSide,t!==null&&(e.colorNode=t),n!==null&&(e.depthNode=n),r!==null&&(e.positionNode=r)}i=e}i.transparent===!0&&i.side===2&&i.forceSinglePass===!1?(i.side=1,this._handleObjectFunction(e,i,t,n,o,a,s,`backSide`),i.side=0,this._handleObjectFunction(e,i,t,n,o,a,s,c),i.side=2):this._handleObjectFunction(e,i,t,n,o,a,s,c),l&&(t.overrideMaterial.colorNode=u,t.overrideMaterial.depthNode=d,t.overrideMaterial.positionNode=f,t.overrideMaterial.side=p),e.onAfterRender(this,t,n,r,i,a)}_renderObjectDirect(e,t,n,r,i,a,o,s){let c=this._objects.get(e,t,n,r,i,this._currentRenderContext,o,s);c.drawRange=e.geometry.drawRange,c.group=a;let l=this._nodes.needsRefresh(c);l&&(this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c)),this._pipelines.updateForRender(c),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(c),c.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(c,this.info),l&&this._nodes.updateAfter(c)}_createObjectPipeline(e,t,n,r,i,a,o,s){let c=this._objects.get(e,t,n,r,i,this._currentRenderContext,o,s);c.drawRange=e.geometry.drawRange,c.group=a,this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c),this._pipelines.getForRender(c,this._compilationPromises),this._nodes.updateAfter(c)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}},fV=class{constructor(e=``){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}};function pV(e){return e+(FM-e%FM)%FM}var mV=class extends fV{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return pV(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}},hV=class extends mV{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}},gV=0,_V=class extends hV{constructor(e,t){super(`UniformBuffer_`+ gV++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}},vV=class extends hV{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){let t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){let t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){let e=this.bytesPerElement,t=0;for(let n=0,r=this.uniforms.length;n<r;n++){let r=this.uniforms[n],i=r.boundary,a=r.itemSize*e,o=t%FM,s=o%i,c=o+s;t+=s,c!==0&&FM-c<a&&(t+=FM-c),r.offset=t/e,t+=a}return Math.ceil(t/FM)*FM}update(){let e=!1;for(let t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);N(`WebGPUUniformsGroup: Unsupported uniform type.`,e)}updateNumber(e){let t=!1,n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i]!==r){let e=this._getBufferForType(a);e[i]=n[i]=r,t=!0}return t}updateVector2(e){let t=!1,n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y){let e=this._getBufferForType(a);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,t=!0}return t}updateVector3(e){let t=!1,n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z){let e=this._getBufferForType(a);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,e[i+2]=n[i+2]=r.z,t=!0}return t}updateVector4(e){let t=!1,n=this.values,r=e.getValue(),i=e.offset,a=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z||n[i+4]!==r.w){let e=this._getBufferForType(a);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,e[i+2]=n[i+2]=r.z,e[i+3]=n[i+3]=r.w,t=!0}return t}updateColor(e){let t=!1,n=this.values,r=e.getValue(),i=e.offset;if(n[i+0]!==r.r||n[i+1]!==r.g||n[i+2]!==r.b){let e=this.buffer;e[i+0]=n[i+0]=r.r,e[i+1]=n[i+1]=r.g,e[i+2]=n[i+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1,n=this.values,r=e.getValue().elements,i=e.offset;if(n[i+0]!==r[0]||n[i+1]!==r[1]||n[i+2]!==r[2]||n[i+4]!==r[3]||n[i+5]!==r[4]||n[i+6]!==r[5]||n[i+8]!==r[6]||n[i+9]!==r[7]||n[i+10]!==r[8]){let e=this.buffer;e[i+0]=n[i+0]=r[0],e[i+1]=n[i+1]=r[1],e[i+2]=n[i+2]=r[2],e[i+4]=n[i+4]=r[3],e[i+5]=n[i+5]=r[4],e[i+6]=n[i+6]=r[5],e[i+8]=n[i+8]=r[6],e[i+9]=n[i+9]=r[7],e[i+10]=n[i+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1,n=this.values,r=e.getValue().elements,i=e.offset;return bV(n,r,i)===!1&&(this.buffer.set(r,i),yV(n,r,i),t=!0),t}_getBufferForType(e){return e===`int`||e===`ivec2`||e===`ivec3`||e===`ivec4`?new Int32Array(this.buffer.buffer):e===`uint`||e===`uvec2`||e===`uvec3`||e===`uvec4`?new Uint32Array(this.buffer.buffer):this.buffer}};function yV(e,t,n){for(let r=0,i=t.length;r<i;r++)e[n+r]=t[r]}function bV(e,t,n){for(let r=0,i=t.length;r<i;r++)if(e[n+r]!==t[r])return!1;return!0}var xV=0,SV=class extends vV{constructor(e,t){super(e),this.id=xV++,this.groupNode=t,this.isNodeUniformsGroup=!0}},CV=class extends fV{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey=``,this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener(`dispose`,this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener(`dispose`,this._onTextureDispose))}get texture(){return this._texture}update(){let{texture:e,version:t}=this;return t===e.version?!1:(this.version=e.version,!0)}clone(){let e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}},wV=0,TV=class extends CV{constructor(e,t){super(e,t),this.id=wV++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}},EV=class extends TV{constructor(e,t,n,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=r}update(){let{textureNode:e}=this;return this.texture===e.value?super.update():(this.texture=e.value,!0)}},DV=class extends EV{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledCubeTexture=!0}},OV=class extends EV{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledTexture3D=!0}},kV={bitcast_int_uint:new kF(`uint tsl_bitcast_uint_to_int ( int x ) { return floatBitsToInt( uintBitsToFloat( x ) ); }`),bitcast_uint_int:new kF(`uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }`)},AV={textureDimensions:`textureSize`,equals:`equal`,bitcast_float_int:`floatBitsToInt`,bitcast_int_float:`intBitsToFloat`,bitcast_uint_float:`uintBitsToFloat`,bitcast_float_uint:`floatBitsToUint`,bitcast_uint_int:`tsl_bitcast_uint_to_int`,bitcast_int_uint:`tsl_bitcast_int_to_uint`},jV={low:`lowp`,medium:`mediump`,high:`highp`},MV={swizzleAssign:!0,storageBuffer:!1},NV={perspective:`smooth`,linear:`noperspective`},PV={centroid:`centroid`},FV=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`,IV=class extends lB{constructor(e,t){super(e,t,new jB),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==``}_include(e){let t=kV[e];return t.build(this),this.addInclude(t),t}getMethod(e){return kV[e]!==void 0&&this._include(e),AV[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getTernary(e,t,n){return`${e} ? ${t} : ${n}`}getOutputStructName(){return``}buildFunctionCode(e){let t=e.layout,n=this.flowShaderNode(e),r=[];for(let e of t.inputs)r.push(this.getType(e.type)+` `+e.name);return`${this.getType(t.type)} ${t.name}( ${r.join(`, `)} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){let t=e.value;if(t.pbo===void 0){let e=t.array,n=t.count*t.itemSize,{itemSize:r}=t,i=t.array.constructor.name.toLowerCase().includes(`int`),a=i?ot:Me;r===2?a=i?Xe:Ve:r===3?a=i?C:O:r===4&&(a=i?Vn:jr);let s={Float32Array:Dn,Uint8Array:g,Uint16Array:o,Uint32Array:x,Int8Array:pt,Int16Array:tt,Int32Array:Re,Uint8ClampedArray:g},c=2**Math.ceil(Math.log2(Math.sqrt(n/r))),l=Math.ceil(n/r/c);c*l*r<n&&l++;let u=c*l*r,d=new e.constructor(u);d.set(e,0),t.array=d;let f=new ie(t.array,c,l,a,s[t.array.constructor.name]||1015);f.needsUpdate=!0,f.isPBOTexture=!0;let p=new $w(f,null,null);p.setPrecision(`high`),t.pboNode=p,t.pbo=p.value,this.getUniformFromNode(t.pboNode,`texture`,this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+`_`+e.name:super.getPropertyName(e,t)}generatePBO(e){let{node:t,indexNode:n}=e,r=t.value;if(this.renderer.backend.has(r)){let e=this.renderer.backend.get(r);e.pbo=r.pbo}let i=this.getUniformFromNode(r.pboNode,`texture`,this.shaderStage,this.context.nodeName),a=this.getPropertyName(i);this.increaseUsage(n);let o=n.build(this,`uint`),s=this.getDataFromNode(e),c=s.propertyName;if(c===void 0){let n=this.getVarFromNode(e);c=this.getPropertyName(n);let i=this.getDataFromNode(t),l=i.propertySizeName;l===void 0&&(l=c+`Size`,this.getVarFromNode(t,l,`uint`),this.addLineFlowCode(`${l} = uint( textureSize( ${a}, 0 ).x )`,e),i.propertySizeName=l);let{itemSize:u}=r,d=`.`+Iy.join(``).slice(0,u),f=`ivec2(${o} % ${l}, ${o} / ${l})`,p=this.generateTextureLoad(null,a,f,`0`,null,null),m=`vec4`;r.pbo.type===1014?m=`uvec4`:r.pbo.type===1013&&(m=`ivec4`),this.addLineFlowCode(`${c} = ${m}(${p})${d}`,e),s.propertyName=c}return c}generateTextureLoad(e,t,n,r,i,a){r===null&&(r=`0`);let o;return o=i?a?`texelFetchOffset( ${t}, ivec3( ${n}, ${i} ), ${r}, ${a} )`:`texelFetch( ${t}, ivec3( ${n}, ${i} ), ${r} )`:a?`texelFetchOffset( ${t}, ${n}, ${r}, ${a} )`:`texelFetch( ${t}, ${n}, ${r} )`,e!==null&&e.isDepthTexture&&(o+=`.x`),o}generateTexture(e,t,n,r,i){return r&&(n=`vec3( ${n}, ${r} )`),e.isDepthTexture?i?`textureOffset( ${t}, ${n}, ${i} ).x`:`texture( ${t}, ${n} ).x`:i?`textureOffset( ${t}, ${n}, ${i} )`:`texture( ${t}, ${n} )`}generateTextureLevel(e,t,n,r,i){return i?`textureLodOffset( ${t}, ${n}, ${r}, ${i} )`:`textureLod( ${t}, ${n}, ${r} )`}generateTextureBias(e,t,n,r,i){return i?`textureOffset( ${t}, ${n}, ${i}, ${r} )`:`texture( ${t}, ${n}, ${r} )`}generateTextureGrad(e,t,n,r,i){return i?`textureGradOffset( ${t}, ${n}, ${r[0]}, ${r[1]}, ${i} )`:`textureGrad( ${t}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,n,r,i,a,o=this.shaderStage){if(o===`fragment`)return i?a?`textureOffset( ${t}, vec4( ${n}, ${i}, ${r} ), ${a} )`:`texture( ${t}, vec4( ${n}, ${i}, ${r} ) )`:a?`textureOffset( ${t}, vec3( ${n}, ${r} ), ${a} )`:`texture( ${t}, vec3( ${n}, ${r} ) )`;N(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){let t=[],n=this.vars[e];if(n!==void 0)for(let e of n)t.push(`${this.getVar(e.type,e.name,e.count)};`);return t.join(`
	`)}getUniforms(e){let t=this.uniforms[e],n=[],r={};for(let i of t){let t=null,a=!1;if(i.type===`texture`||i.type===`texture3D`){let e=i.node.value,n=``;(e.isDataTexture===!0||e.isData3DTexture===!0)&&(e.type===1014?n=`u`:e.type===1013&&(n=`i`)),t=i.type===`texture3D`&&e.isArrayTexture===!1?`${n}sampler3D ${i.name};`:e.compareFunction?e.isArrayTexture===!0?`sampler2DArrayShadow ${i.name};`:`sampler2DShadow ${i.name};`:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?`${n}sampler2DArray ${i.name};`:`${n}sampler2D ${i.name};`}else if(i.type===`cubeTexture`)t=`samplerCube ${i.name};`;else if(i.type===`buffer`){let e=i.node,n=this.getType(e.bufferType),r=e.bufferCount,a=r>0?r:``;t=`${e.name} {\n\t${n} ${i.name}[${a}];\n};\n`}else t=`${this.getVectorType(i.type)} ${this.getPropertyName(i,e)};`,a=!0;let o=i.node.precision;if(o!==null&&(t=jV[o]+` `+t),a){t=`	`+t;let e=i.groupNode.name;(r[e]||(r[e]=[])).push(t)}else t=`uniform `+t,n.push(t)}let i=``;for(let t in r){let n=r[t];i+=this._getGLSLUniformStruct(e+`_`+t,n.join(`
`))+`
`}return i+=n.join(`
`),i}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==1013){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);let r=n.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t=``;if(e===`vertex`||e===`compute`){let e=this.getAttributesArray(),n=0;for(let r of e)t+=`layout( location = ${n++} ) in ${r.type} ${r.name};\n`}return t}getStructMembers(e){let t=[];for(let n of e.members)t.push(`\t${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){let t=[],n=this.structs[e],r=[];for(let e of n)if(e.output)for(let t of e.members)r.push(`layout( location = ${t.index} ) out ${t.type} ${t.name};`);else{let n=`struct `+e.name+` {
`;n+=this.getStructMembers(e),n+=`
};
`,t.push(n)}return r.length===0&&r.push(`layout( location = 0 ) out vec4 fragColor;`),`
`+r.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t=``,n=this.varyings;if(e===`vertex`||e===`compute`)for(let r of n){e===`compute`&&(r.needsInterpolation=!0);let n=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){let e=NV[r.interpolationType]||r.interpolationType,i=PV[r.interpolationSampling]||``;t+=`${e} ${i} out ${n} ${r.name};\n`}else{let e=n.includes(`int`)||n.includes(`uv`)||n.includes(`iv`)?`flat `:``;t+=`${e}out ${n} ${r.name};\n`}else t+=`${n} ${r.name};\n`}else if(e===`fragment`){for(let e of n)if(e.needsInterpolation){let n=this.getType(e.type);if(e.interpolationType){let r=NV[e.interpolationType]||e.interpolationType,i=PV[e.interpolationSampling]||``;t+=`${r} ${i} in ${n} ${e.name};\n`}else{let r=n.includes(`int`)||n.includes(`uv`)||n.includes(`iv`)?`flat `:``;t+=`${r}in ${n} ${e.name};\n`}}}for(let n of this.builtins[e])t+=`${n};\n`;return t}getVertexIndex(){return`uint( gl_VertexID )`}getInstanceIndex(){return`uint( gl_InstanceID )`}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((e,t)=>e*t,1)}u`}getSubgroupSize(){N(`GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node`)}getInvocationSubgroupIndex(){N(`GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node`)}getSubgroupIndex(){N(`GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node`)}getDrawIndex(){return this.renderer.backend.extensions.has(`WEBGL_multi_draw`)?`uint( gl_DrawID )`:null}getFrontFacing(){return`gl_FrontFacing`}getFragCoord(){return`gl_FragCoord.xy`}getFragDepth(){return`gl_FragDepth`}enableExtension(e,t,n=this.shaderStage){let r=this.extensions[n]||(this.extensions[n]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){let t=[];if(e===`vertex`){let t=this.renderer.backend.extensions;this.object.isBatchedMesh&&t.has(`WEBGL_multi_draw`)&&this.enableExtension(`GL_ANGLE_multi_draw`,`require`,e)}let n=this.extensions[e];if(n!==void 0)for(let{name:e,behavior:r}of n.values())t.push(`#extension ${e} : ${r}`);return t.join(`
`)}getClipDistance(){return`gl_ClipDistance`}isAvailable(e){let t=MV[e];if(t===void 0){let n;switch(t=!1,e){case`float32Filterable`:n=`OES_texture_float_linear`;break;case`clipDistance`:n=`WEBGL_clip_cull_distance`;break}if(n!==void 0){let e=this.renderer.backend.extensions;e.has(n)&&(e.get(n),t=!0)}MV[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension(`GL_ANGLE_clip_cull_distance`,`require`),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension(`GL_OVR_multiview2`,`require`,`fragment`),this.enableExtension(`GL_OVR_multiview2`,`require`,`vertex`),this.builtins.vertex.push(`layout(num_views = 2) in`)}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){let e=this.transforms,t=``;for(let n=0;n<e.length;n++){let r=e[n],i=this.getPropertyName(r.attributeNode);i&&(t+=`${r.varyingName} = ${i};\n\t`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${FV}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${FV}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){let e=this.material===null?{compute:{}}:{fragment:{},vertex:{}};for(let t in this.sortBindingGroups(),e){let n=`// code

`;n+=this.flowCode[t];let r=this.flowNodes[t],i=r[r.length-1];for(let e of r){let r=this.getFlowData(e),a=e.name;a&&(n.length>0&&(n+=`
`),n+=`\t// flow -> ${a}\n\t`),n+=`${r.code}\n\t`,e===i&&t!==`compute`&&(n+=`// result
	`,t===`vertex`?(n+=`gl_Position = `,n+=`${r.result};`):t===`fragment`&&(e.outputNode.isOutputStructNode||(n+=`fragColor = `,n+=`${r.result};`)))}let a=e[t];a.extensions=this.getExtensions(t),a.uniforms=this.getUniforms(t),a.attributes=this.getAttributes(t),a.varyings=this.getVaryings(t),a.vars=this.getVars(t),a.structs=this.getStructs(t),a.codes=this.getCodes(t),a.transforms=this.getTransforms(t),a.flow=n}this.material===null?this.computeShader=this._getGLSLVertexCode(e.compute):(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment))}getUniformFromNode(e,t,n,r=null){let i=super.getUniformFromNode(e,t,n,r),a=this.getDataFromNode(e,n,this.globalCache),o=a.uniformGPU;if(o===void 0){let r=e.groupNode,s=r.name,c=this.getBindGroupArray(s,n);if(t===`texture`)o=new EV(i.name,i.node,r),c.push(o);else if(t===`cubeTexture`)o=new DV(i.name,i.node,r),c.push(o);else if(t===`texture3D`)o=new OV(i.name,i.node,r),c.push(o);else if(t===`buffer`){e.name=`NodeBuffer_${e.id}`,i.name=`buffer${e.id}`;let t=new _V(e,r);t.name=e.name,c.push(t),o=t}else{let e=this.uniformGroups[n]||(this.uniformGroups[n]={}),a=e[s];a===void 0&&(a=new SV(n+`_`+s,r),e[s]=a,c.push(a)),o=this.getNodeUniform(i,t),a.addUniform(o)}a.uniformGPU=o}return i}},LV=null,RV=null,zV=class{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[ar.RENDER]:null,[ar.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){let t=this.get(e),n=this.renderer.info.frame,r;r=e.isComputeNode===!0?`c:`+this.renderer.info.compute.frameCalls:`r:`+this.renderer.info.render.frameCalls,t.timestampUID=r+`:`+e.id+`:f`+n}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){let t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){let t=e.startsWith(`c:`)?ar.COMPUTE:ar.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e=`render`){if(!this.trackTimestamp){be(`WebGPURenderer: Timestamp tracking is disabled.`);return}let t=this.timestampQueryPool[e];if(!t)return;let n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return LV||=new Fe,this.renderer.getDrawingBufferSize(LV)}setScissorTest(){}getClearColor(){let e=this.renderer;return RV||=new dN,e.getClearColor(RV),RV.getRGB(RV),RV}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas===void 0?yt():this.parameters.canvas,`setAttribute`in e&&e.setAttribute(`data-engine`,`three.js r181 webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}},BV=0,VV=class{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}},HV=class{constructor(e){this.backend=e}createAttribute(e,t){let n=this.backend,{gl:r}=n,i=e.array,a=e.usage||r.STATIC_DRAW,o=e.isInterleavedBufferAttribute?e.data:e,s=n.get(o),c=s.bufferGPU;c===void 0&&(c=this._createBuffer(r,t,i,a),s.bufferGPU=c,s.bufferType=t,s.version=o.version);let l;if(i instanceof Float32Array)l=r.FLOAT;else if(typeof Float16Array<`u`&&i instanceof Float16Array)l=r.HALF_FLOAT;else if(i instanceof Uint16Array)l=e.isFloat16BufferAttribute?r.HALF_FLOAT:r.UNSIGNED_SHORT;else if(i instanceof Int16Array)l=r.SHORT;else if(i instanceof Uint32Array)l=r.UNSIGNED_INT;else if(i instanceof Int32Array)l=r.INT;else if(i instanceof Int8Array)l=r.BYTE;else if(i instanceof Uint8Array)l=r.UNSIGNED_BYTE;else if(i instanceof Uint8ClampedArray)l=r.UNSIGNED_BYTE;else throw Error(`THREE.WebGLBackend: Unsupported buffer data format: `+i);let u={bufferGPU:c,bufferType:t,type:l,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:l===r.INT||l===r.UNSIGNED_INT||e.gpuType===1013,id:BV++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){let e=this._createBuffer(r,t,i,a);u=new VV(u,e)}n.set(e,u)}updateAttribute(e){let t=this.backend,{gl:n}=t,r=e.array,i=e.isInterleavedBufferAttribute?e.data:e,a=t.get(i),o=a.bufferType,s=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(o,a.bufferGPU),s.length===0)n.bufferSubData(o,0,r);else{for(let e=0,t=s.length;e<t;e++){let t=s[e];n.bufferSubData(o,t.start*r.BYTES_PER_ELEMENT,r,t.start,t.count)}i.clearUpdateRanges()}n.bindBuffer(o,null),a.version=i.version}destroyAttribute(e){let t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);let r=t.get(e);n.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){let t=this.backend,{gl:n}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:i}=t.get(r),a=e.array,o=a.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,i);let s=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,s),n.bufferData(n.COPY_WRITE_BUFFER,o,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,o),await t.utils._clientWaitAsync();let c=new e.array.constructor(a.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,s),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,c),n.deleteBuffer(s),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),c.buffer}_createBuffer(e,t,n,r){let i=e.createBuffer();return e.bindBuffer(t,i),e.bufferData(t,n,r),e.bindBuffer(t,null),i}},UV,WV,GV=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){let e=this.gl;UV={100:e.FUNC_ADD,101:e.FUNC_SUBTRACT,102:e.FUNC_REVERSE_SUBTRACT},WV={200:e.ZERO,201:e.ONE,202:e.SRC_COLOR,204:e.SRC_ALPHA,210:e.SRC_ALPHA_SATURATE,208:e.DST_COLOR,206:e.DST_ALPHA,203:e.ONE_MINUS_SRC_COLOR,205:e.ONE_MINUS_SRC_ALPHA,209:e.ONE_MINUS_DST_COLOR,207:e.ONE_MINUS_DST_ALPHA};let t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new Je().fromArray(t),this.currentViewport=new Je().fromArray(n),this._tempVec4=new Je}enable(e){let{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){let{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){let{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){let{gl:t}=this;e===0?this.disable(t.CULL_FACE):(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===1?t.cullFace(t.BACK):e===2?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))),this.currentCullFace=e}setLineWidth(e){let{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,r,i,a,o,s){let{gl:c}=this;if(e===0){this.currentBlendingEnabled===!0&&(this.disable(c.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(c.BLEND),this.currentBlendingEnabled=!0),e!==5){if(e!==this.currentBlending||s!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==100||this.currentBlendEquationAlpha!==100)&&(c.blendEquation(c.FUNC_ADD),this.currentBlendEquation=100,this.currentBlendEquationAlpha=100),s)switch(e){case 1:c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case 2:c.blendFunc(c.ONE,c.ONE);break;case 3:c.blendFuncSeparate(c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);break;case 4:c.blendFuncSeparate(c.DST_COLOR,c.ONE_MINUS_SRC_ALPHA,c.ZERO,c.ONE);break;default:N(`WebGLState: Invalid blending: `,e);break}else switch(e){case 1:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case 2:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE,c.ONE,c.ONE);break;case 3:N(`WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true`);break;case 4:N(`WebGLState: MultiplyBlending requires material.premultipliedAlpha = true`);break;default:N(`WebGLState: Invalid blending: `,e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=s}return}i||=t,a||=n,o||=r,(t!==this.currentBlendEquation||i!==this.currentBlendEquationAlpha)&&(c.blendEquationSeparate(UV[t],UV[i]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=i),(n!==this.currentBlendSrc||r!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||o!==this.currentBlendDstAlpha)&&(c.blendFuncSeparate(WV[n],WV[r],WV[a],WV[o]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=o),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){let{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){let{gl:t}=this;switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,r){let i=this._tempVec4.set(e,t,n,r);if(this.currentScissor.equals(i)===!1){let{gl:e}=this;e.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(e,t,n,r){let i=this._tempVec4.set(e,t,n,r);if(this.currentViewport.equals(i)===!1){let{gl:e}=this;e.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(e){let t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){let{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){let{gl:r}=this;e.side===2?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let i=e.side===1;t&&(i=!i),this.setFlipSided(i),e.blending===1&&e.transparent===!1?this.setBlending(0):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);let a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n){let e=12288;for(let t=0;t<8;t++)t<n?this.enable(e+t):this.disable(e+t)}}setPolygonOffset(e,t,n){let{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(r.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram===e?!1:(this.gl.useProgram(e),this.currentProgram=e,!0)}setVertexState(e,t=null){let n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){let e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){let{gl:n,currentBoundFramebuffers:r}=this;return r[e]===t?!1:(n.bindFramebuffer(e,t),r[e]=t,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=t),!0)}drawBuffers(e,t){let{gl:n}=this,r=[],i=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));let a=e.textures;if(r.length!==a.length||r[0]!==n.COLOR_ATTACHMENT0){for(let e=0,t=a.length;e<t;e++)r[e]=n.COLOR_ATTACHMENT0+e;r.length=a.length,i=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,i=!0);i&&n.drawBuffers(r)}activeTexture(e){let{gl:t,currentTextureSlot:n,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){let{gl:r,currentTextureSlot:i,currentBoundTextures:a,maxTextures:o}=this;n===void 0&&(n=i===null?r.TEXTURE0+o-1:i);let s=a[n];s===void 0&&(s={type:void 0,texture:void 0},a[n]=s),(s.type!==e||s.texture!==t)&&(i!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,t),s.type=e,s.texture=t)}bindBufferBase(e,t,n){let{gl:r}=this,i=`${e}-${t}`;return this.currentBoundBufferBases[i]===n?!1:(r.bindBufferBase(e,t,n),this.currentBoundBufferBases[i]=n,!0)}unbindTexture(){let{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,r=n[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}},KV=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=``){let{gl:n,extensions:r}=this,i,a=Un.getTransfer(t);if(e===1009)return n.UNSIGNED_BYTE;if(e===1017)return n.UNSIGNED_SHORT_4_4_4_4;if(e===1018)return n.UNSIGNED_SHORT_5_5_5_1;if(e===35902)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===35899)return n.UNSIGNED_INT_10F_11F_11F_REV;if(e===1010)return n.BYTE;if(e===1011)return n.SHORT;if(e===1012)return n.UNSIGNED_SHORT;if(e===1013)return n.INT;if(e===1014)return n.UNSIGNED_INT;if(e===1015)return n.FLOAT;if(e===1016)return n.HALF_FLOAT;if(e===1021)return n.ALPHA;if(e===1022)return n.RGB;if(e===1023)return n.RGBA;if(e===1026)return n.DEPTH_COMPONENT;if(e===1027)return n.DEPTH_STENCIL;if(e===1028)return n.RED;if(e===1029)return n.RED_INTEGER;if(e===1030)return n.RG;if(e===1031)return n.RG_INTEGER;if(e===1033)return n.RGBA_INTEGER;if(e===33776||e===33777||e===33778||e===33779)if(a===`srgb`)if(i=r.get(`WEBGL_compressed_texture_s3tc_srgb`),i!==null){if(e===33776)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===33777)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===33778)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===33779)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(i=r.get(`WEBGL_compressed_texture_s3tc`),i!==null){if(e===33776)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===33777)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===33778)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===33779)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===35840||e===35841||e===35842||e===35843)if(i=r.get(`WEBGL_compressed_texture_pvrtc`),i!==null){if(e===35840)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===35841)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===35842)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===35843)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===36196||e===37492||e===37496)if(i=r.get(`WEBGL_compressed_texture_etc`),i!==null){if(e===36196||e===37492)return a===`srgb`?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(e===37496)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===37808||e===37809||e===37810||e===37811||e===37812||e===37813||e===37814||e===37815||e===37816||e===37817||e===37818||e===37819||e===37820||e===37821)if(i=r.get(`WEBGL_compressed_texture_astc`),i!==null){if(e===37808)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===37809)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===37810)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===37811)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===37812)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===37813)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===37814)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===37815)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===37816)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===37817)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===37818)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===37819)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===37820)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===37821)return a===`srgb`?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===36492)if(i=r.get(`EXT_texture_compression_bptc`),i!==null){if(e===36492)return a===`srgb`?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===36283||e===36284||e===36285||e===36286)if(i=r.get(`EXT_texture_compression_rgtc`),i!==null){if(e===36283)return i.COMPRESSED_RED_RGTC1_EXT;if(e===36284)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===36285)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===36286)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===1020?n.UNSIGNED_INT_24_8:n[e]===void 0?null:n[e]}_clientWaitAsync(){let{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{function i(){let a=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED){e.deleteSync(t),r();return}if(a===e.TIMEOUT_EXPIRED){requestAnimationFrame(i);return}e.deleteSync(t),n()}i()})}},qV=!1,JV,YV,XV,ZV=class{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,qV===!1&&(this._init(),qV=!0)}_init(){let e=this.gl;JV={[Et]:e.REPEAT,[Jn]:e.CLAMP_TO_EDGE,[ci]:e.MIRRORED_REPEAT},YV={[_]:e.NEAREST,[ht]:e.NEAREST_MIPMAP_NEAREST,[Qr]:e.NEAREST_MIPMAP_LINEAR,[Vt]:e.LINEAR,[nt]:e.LINEAR_MIPMAP_NEAREST,[Kt]:e.LINEAR_MIPMAP_LINEAR},XV={512:e.NEVER,519:e.ALWAYS,513:e.LESS,515:e.LEQUAL,514:e.EQUAL,518:e.GEQUAL,516:e.GREATER,517:e.NOTEQUAL}}getGLTextureType(e){let{gl:t}=this,n;return n=e.isCubeTexture===!0?t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?t.TEXTURE_3D:t.TEXTURE_2D,n}getInternalFormat(e,t,n,r,i=!1){let{gl:a,extensions:o}=this;if(e!==null){if(a[e]!==void 0)return a[e];P(`WebGLBackend: Attempt to use non-existing WebGL internal format '`+e+`'`)}let s=t;if(t===a.RED&&(n===a.FLOAT&&(s=a.R32F),n===a.HALF_FLOAT&&(s=a.R16F),n===a.UNSIGNED_BYTE&&(s=a.R8),n===a.UNSIGNED_SHORT&&(s=a.R16),n===a.UNSIGNED_INT&&(s=a.R32UI),n===a.BYTE&&(s=a.R8I),n===a.SHORT&&(s=a.R16I),n===a.INT&&(s=a.R32I)),t===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.R8UI),n===a.UNSIGNED_SHORT&&(s=a.R16UI),n===a.UNSIGNED_INT&&(s=a.R32UI),n===a.BYTE&&(s=a.R8I),n===a.SHORT&&(s=a.R16I),n===a.INT&&(s=a.R32I)),t===a.RG&&(n===a.FLOAT&&(s=a.RG32F),n===a.HALF_FLOAT&&(s=a.RG16F),n===a.UNSIGNED_BYTE&&(s=a.RG8),n===a.UNSIGNED_SHORT&&(s=a.RG16),n===a.UNSIGNED_INT&&(s=a.RG32UI),n===a.BYTE&&(s=a.RG8I),n===a.SHORT&&(s=a.RG16I),n===a.INT&&(s=a.RG32I)),t===a.RG_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.RG8UI),n===a.UNSIGNED_SHORT&&(s=a.RG16UI),n===a.UNSIGNED_INT&&(s=a.RG32UI),n===a.BYTE&&(s=a.RG8I),n===a.SHORT&&(s=a.RG16I),n===a.INT&&(s=a.RG32I)),t===a.RGB){let e=i?zr:Un.getTransfer(r);n===a.FLOAT&&(s=a.RGB32F),n===a.HALF_FLOAT&&(s=a.RGB16F),n===a.UNSIGNED_BYTE&&(s=a.RGB8),n===a.UNSIGNED_SHORT&&(s=a.RGB16),n===a.UNSIGNED_INT&&(s=a.RGB32UI),n===a.BYTE&&(s=a.RGB8I),n===a.SHORT&&(s=a.RGB16I),n===a.INT&&(s=a.RGB32I),n===a.UNSIGNED_BYTE&&(s=e===`srgb`?a.SRGB8:a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(s=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(s=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(s=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(s=a.RGB9_E5),n===a.UNSIGNED_INT_10F_11F_11F_REV&&(s=a.R11F_G11F_B10F)}if(t===a.RGB_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.RGB8UI),n===a.UNSIGNED_SHORT&&(s=a.RGB16UI),n===a.UNSIGNED_INT&&(s=a.RGB32UI),n===a.BYTE&&(s=a.RGB8I),n===a.SHORT&&(s=a.RGB16I),n===a.INT&&(s=a.RGB32I)),t===a.RGBA){let e=i?zr:Un.getTransfer(r);n===a.FLOAT&&(s=a.RGBA32F),n===a.HALF_FLOAT&&(s=a.RGBA16F),n===a.UNSIGNED_BYTE&&(s=a.RGBA8),n===a.UNSIGNED_SHORT&&(s=a.RGBA16),n===a.UNSIGNED_INT&&(s=a.RGBA32UI),n===a.BYTE&&(s=a.RGBA8I),n===a.SHORT&&(s=a.RGBA16I),n===a.INT&&(s=a.RGBA32I),n===a.UNSIGNED_BYTE&&(s=e===`srgb`?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(s=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(s=a.RGB5_A1)}return t===a.RGBA_INTEGER&&(n===a.UNSIGNED_BYTE&&(s=a.RGBA8UI),n===a.UNSIGNED_SHORT&&(s=a.RGBA16UI),n===a.UNSIGNED_INT&&(s=a.RGBA32UI),n===a.BYTE&&(s=a.RGBA8I),n===a.SHORT&&(s=a.RGBA16I),n===a.INT&&(s=a.RGBA32I)),t===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_SHORT&&(s=a.DEPTH_COMPONENT16),n===a.UNSIGNED_INT&&(s=a.DEPTH_COMPONENT24),n===a.FLOAT&&(s=a.DEPTH_COMPONENT32F)),t===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(s=a.DEPTH24_STENCIL8),(s===a.R16F||s===a.R32F||s===a.RG16F||s===a.RG32F||s===a.RGBA16F||s===a.RGBA32F)&&o.get(`EXT_color_buffer_float`),s}setTextureParameters(e,t){let{gl:n,extensions:r,backend:i}=this,a=Un.getPrimaries(Un.workingColorSpace),o=t.colorSpace===``?null:Un.getPrimaries(t.colorSpace),s=t.colorSpace===``||a===o?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,s),n.texParameteri(e,n.TEXTURE_WRAP_S,JV[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,JV[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,JV[t.wrapR])),n.texParameteri(e,n.TEXTURE_MAG_FILTER,YV[t.magFilter]);let c=t.mipmaps!==void 0&&t.mipmaps.length>0,l=t.minFilter===1006&&c?Kt:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,YV[l]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,XV[t.compareFunction])),r.has(`EXT_texture_filter_anisotropic`)===!0){if(t.magFilter===1003||t.minFilter!==1005&&t.minFilter!==1008||t.type===1015&&r.has(`OES_texture_float_linear`)===!1)return;if(t.anisotropy>1){let a=r.get(`EXT_texture_filter_anisotropic`);n.texParameterf(e,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(e){let{gl:t,backend:n,defaultTextures:r}=this,i=this.getGLTextureType(e),a=r[i];a===void 0&&(a=t.createTexture(),n.state.bindTexture(i,a),t.texParameteri(i,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(i,t.TEXTURE_MAG_FILTER,t.NEAREST),r[i]=a),n.set(e,{textureGPU:a,glTextureType:i})}createTexture(e,t){let{gl:n,backend:r}=this,{levels:i,width:a,height:o,depth:s}=t,c=r.utils.convert(e.format,e.colorSpace),l=r.utils.convert(e.type),u=this.getInternalFormat(e.internalFormat,c,l,e.colorSpace,e.isVideoTexture),d=n.createTexture(),f=this.getGLTextureType(e);r.state.bindTexture(f,d),this.setTextureParameters(f,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,i,u,a,o,s):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,i,u,a,o,s):e.isVideoTexture||n.texStorage2D(f,i,u,a,o),r.set(e,{textureGPU:d,glTextureType:f,glFormat:c,glType:l,glInternalFormat:u})}copyBufferToTexture(e,t){let{gl:n,backend:r}=this,{textureGPU:i,glTextureType:a,glFormat:o,glType:s}=r.get(t),{width:c,height:l}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(a,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,c,l,o,s,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){let{gl:n}=this,{width:r,height:i}=t,{textureGPU:a,glTextureType:o,glFormat:s,glType:c,glInternalFormat:l}=this.backend.get(e);if(!(e.isRenderTargetTexture||a===void 0))if(this.backend.state.bindTexture(o,a),this.setTextureParameters(o,e),e.isCompressedTexture){let r=e.mipmaps,i=t.image;for(let t=0;t<r.length;t++){let a=r[t];e.isCompressedArrayTexture?e.format===n.RGBA?n.texSubImage3D(n.TEXTURE_2D_ARRAY,t,0,0,0,a.width,a.height,i.depth,s,c,a.data):s===null?P(`WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()`):n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,t,0,0,0,a.width,a.height,i.depth,s,a.data):s===null?P(`WebGLBackend: Unsupported compressed texture format`):n.compressedTexSubImage2D(n.TEXTURE_2D,t,0,0,a.width,a.height,s,a.data)}}else if(e.isCubeTexture){let a=t.images,o=e.mipmaps;for(let e=0;e<6;e++){let t=QV(a[e]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,r,i,s,c,t);for(let t=0;t<o.length;t++){let r=o[t],i=QV(r.images[e]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+e,t+1,0,0,i.width,i.height,s,c,i)}}}else if(e.isDataArrayTexture||e.isArrayTexture){let r=t.image;if(e.layerUpdates.size>0){let t=ae(r.width,r.height,e.format,e.type);for(let i of e.layerUpdates){let e=r.data.subarray(i*t/r.data.BYTES_PER_ELEMENT,(i+1)*t/r.data.BYTES_PER_ELEMENT);n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,i,r.width,r.height,1,s,c,e)}e.clearLayerUpdates()}else n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,r.width,r.height,r.depth,s,c,r.data)}else if(e.isData3DTexture){let e=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,e.width,e.height,e.depth,s,c,e.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(o,0,l,s,c,t.image);else{let a=e.mipmaps;if(a.length>0)for(let e=0,t=a.length;e<t;e++){let t=a[e],r=QV(t);n.texSubImage2D(o,e,0,0,t.width,t.height,s,c,r)}else{let e=QV(t.image);n.texSubImage2D(o,0,0,0,r,i,s,c,e)}}}generateMipmaps(e){let{gl:t,backend:n}=this,{textureGPU:r,glTextureType:i}=n.get(e);n.state.bindTexture(i,r),t.generateMipmap(i)}deallocateRenderBuffers(e){let{gl:t,backend:n}=this;if(e){let r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(let e in r.framebuffers)t.deleteFramebuffer(r.framebuffers[e]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let e=0;e<r.msaaRenderbuffers.length;e++)t.deleteRenderbuffer(r.msaaRenderbuffers[e]);delete r.msaaRenderbuffers}}}destroyTexture(e,t=!1){let{gl:n,backend:r}=this,{textureGPU:i,renderTarget:a}=r.get(e);this.deallocateRenderBuffers(a),t===!1&&n.deleteTexture(i),r.delete(e)}copyTextureToTexture(e,t,n=null,r=null,i=0,a=0){let{gl:o,backend:s}=this,{state:c}=this.backend,{textureGPU:l,glTextureType:u,glType:d,glFormat:f}=s.get(t);c.bindTexture(u,l);let p,m,h,g,_,v,y,b,x,S=e.isCompressedTexture?e.mipmaps[a]:e.image;if(n!==null)p=n.max.x-n.min.x,m=n.max.y-n.min.y,h=n.isBox3?n.max.z-n.min.z:1,g=n.min.x,_=n.min.y,v=n.isBox3?n.min.z:0;else{let t=2**-i;p=Math.floor(S.width*t),m=Math.floor(S.height*t),h=e.isDataArrayTexture||e.isArrayTexture?S.depth:e.isData3DTexture?Math.floor(S.depth*t):1,g=0,_=0,v=0}r===null?(y=0,b=0,x=0):(y=r.x,b=r.y,x=r.z),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);let C=o.getParameter(o.UNPACK_ROW_LENGTH),w=o.getParameter(o.UNPACK_IMAGE_HEIGHT),T=o.getParameter(o.UNPACK_SKIP_PIXELS),E=o.getParameter(o.UNPACK_SKIP_ROWS),D=o.getParameter(o.UNPACK_SKIP_IMAGES);o.pixelStorei(o.UNPACK_ROW_LENGTH,S.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,S.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,g),o.pixelStorei(o.UNPACK_SKIP_ROWS,_),o.pixelStorei(o.UNPACK_SKIP_IMAGES,v);let O=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,ee=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){let n=s.get(e),r=s.get(t),u=s.get(n.renderTarget),d=s.get(r.renderTarget),f=u.framebuffers[n.cacheKey],S=d.framebuffers[r.cacheKey];c.bindFramebuffer(o.READ_FRAMEBUFFER,f),c.bindFramebuffer(o.DRAW_FRAMEBUFFER,S);for(let e=0;e<h;e++)O&&(o.framebufferTextureLayer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,n.textureGPU,i,v+e),o.framebufferTextureLayer(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,l,a,x+e)),o.blitFramebuffer(g,_,p,m,y,b,p,m,o.DEPTH_BUFFER_BIT,o.NEAREST);c.bindFramebuffer(o.READ_FRAMEBUFFER,null),c.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else if(i!==0||e.isRenderTargetTexture||s.has(e)){let t=s.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=o.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=o.createFramebuffer()),c.bindFramebuffer(o.READ_FRAMEBUFFER,this._srcFramebuffer),c.bindFramebuffer(o.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let e=0;e<h;e++)O?o.framebufferTextureLayer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,t.textureGPU,i,v+e):o.framebufferTexture2D(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t.textureGPU,i),ee?o.framebufferTextureLayer(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,l,a,x+e):o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,l,a),i===0?ee?o.copyTexSubImage3D(u,a,y,b,x+e,g,_,p,m):o.copyTexSubImage2D(u,a,y,b,g,_,p,m):o.blitFramebuffer(g,_,p,m,y,b,p,m,o.COLOR_BUFFER_BIT,o.NEAREST);c.bindFramebuffer(o.READ_FRAMEBUFFER,null),c.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else ee?e.isDataTexture||e.isData3DTexture?o.texSubImage3D(u,a,y,b,x,p,m,h,f,d,S.data):t.isCompressedArrayTexture?o.compressedTexSubImage3D(u,a,y,b,x,p,m,h,f,S.data):o.texSubImage3D(u,a,y,b,x,p,m,h,f,d,S):e.isDataTexture?o.texSubImage2D(o.TEXTURE_2D,a,y,b,p,m,f,d,S.data):e.isCompressedTexture?o.compressedTexSubImage2D(o.TEXTURE_2D,a,y,b,S.width,S.height,f,S.data):o.texSubImage2D(o.TEXTURE_2D,a,y,b,p,m,f,d,S);o.pixelStorei(o.UNPACK_ROW_LENGTH,C),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,w),o.pixelStorei(o.UNPACK_SKIP_PIXELS,T),o.pixelStorei(o.UNPACK_SKIP_ROWS,E),o.pixelStorei(o.UNPACK_SKIP_IMAGES,D),a===0&&t.generateMipmaps&&o.generateMipmap(u),c.unbindTexture()}copyFramebufferToTexture(e,t,n){let{gl:r}=this,{state:i}=this.backend,{textureGPU:a}=this.backend.get(e),{x:o,y:s,z:c,w:l}=n,u=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,d=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(u){let n=o!==0||s!==0,u,f;if(e.isDepthTexture===!0?(u=r.DEPTH_BUFFER_BIT,f=r.DEPTH_ATTACHMENT,t.stencil&&(u|=r.STENCIL_BUFFER_BIT)):(u=r.COLOR_BUFFER_BIT,f=r.COLOR_ATTACHMENT0),n){let e=this.backend.get(t.renderTarget),n=e.framebuffers[t.getCacheKey()],f=e.msaaFrameBuffer;i.bindFramebuffer(r.DRAW_FRAMEBUFFER,n),i.bindFramebuffer(r.READ_FRAMEBUFFER,f);let p=d-s-l;r.blitFramebuffer(o,p,o+c,p+l,o,p,o+c,p+l,u,r.NEAREST),i.bindFramebuffer(r.READ_FRAMEBUFFER,n),i.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,p,c,l),i.unbindTexture()}else{let e=r.createFramebuffer();i.bindFramebuffer(r.DRAW_FRAMEBUFFER,e),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,f,r.TEXTURE_2D,a,0),r.blitFramebuffer(0,0,c,l,0,0,c,l,u,r.NEAREST),r.deleteFramebuffer(e)}}else i.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,d-l-s,c,l),i.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,r=!1){let{gl:i}=this,a=t.renderTarget,{depthTexture:o,depthBuffer:s,stencilBuffer:c,width:l,height:u}=a;if(i.bindRenderbuffer(i.RENDERBUFFER,e),s&&!c){let t=i.DEPTH_COMPONENT24;r===!0?this.extensions.get(`WEBGL_multisampled_render_to_texture`).renderbufferStorageMultisampleEXT(i.RENDERBUFFER,a.samples,t,l,u):n>0?(o&&o.isDepthTexture&&o.type===i.FLOAT&&(t=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,n,t,l,u)):i.renderbufferStorage(i.RENDERBUFFER,t,l,u),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)}else s&&c&&(n>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,n,i.DEPTH24_STENCIL8,l,u):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,l,u),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e));i.bindRenderbuffer(i.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,n,r,i,a){let{backend:o,gl:s}=this,{textureGPU:c,glFormat:l,glType:u}=this.backend.get(e),d=s.createFramebuffer();s.bindFramebuffer(s.READ_FRAMEBUFFER,d);let f=e.isCubeTexture?s.TEXTURE_CUBE_MAP_POSITIVE_X+a:s.TEXTURE_2D;s.framebufferTexture2D(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,f,c,0);let p=this._getTypedArrayType(u),m=this._getBytesPerTexel(u,l),h=r*i*m,g=s.createBuffer();s.bindBuffer(s.PIXEL_PACK_BUFFER,g),s.bufferData(s.PIXEL_PACK_BUFFER,h,s.STREAM_READ),s.readPixels(t,n,r,i,l,u,0),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();let _=new p(h/p.BYTES_PER_ELEMENT);return s.bindBuffer(s.PIXEL_PACK_BUFFER,g),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,_),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),s.deleteFramebuffer(d),_}_getTypedArrayType(e){let{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){let{gl:n}=this,r=0;if(e===n.UNSIGNED_BYTE&&(r=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(r=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(r=4),t===n.RGBA)return r*4;if(t===n.RGB)return r*3;if(t===n.ALPHA)return r}dispose(){let{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}};function QV(e){return e.isDataTexture?e.image.data:typeof HTMLImageElement<`u`&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<`u`&&e instanceof HTMLCanvasElement||typeof ImageBitmap<`u`&&e instanceof ImageBitmap||typeof OffscreenCanvas<`u`&&e instanceof OffscreenCanvas?e:e.data}var $V=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}},eH=class{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;let e=this.backend.gl,t=this.backend.extensions;if(t.has(`EXT_texture_filter_anisotropic`)===!0){let n=t.get(`EXT_texture_filter_anisotropic`);this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}},tH={WEBGL_multi_draw:`WEBGL_multi_draw`,WEBGL_compressed_texture_astc:`texture-compression-astc`,WEBGL_compressed_texture_etc:`texture-compression-etc2`,WEBGL_compressed_texture_etc1:`texture-compression-etc1`,WEBGL_compressed_texture_pvrtc:`texture-compression-pvrtc`,WEBGL_compressed_texture_s3tc:`texture-compression-s3tc`,EXT_texture_compression_bptc:`texture-compression-bc`,EXT_disjoint_timer_query_webgl2:`timestamp-query`,OVR_multiview2:`OVR_multiview2`},nH=class{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){let{gl:n,mode:r,object:i,type:a,info:o,index:s}=this;s===0?n.drawArrays(r,e,t):n.drawElements(r,t,a,e),o.update(i,t,1)}renderInstances(e,t,n){let{gl:r,mode:i,type:a,index:o,object:s,info:c}=this;n!==0&&(o===0?r.drawArraysInstanced(i,e,t,n):r.drawElementsInstanced(i,t,a,e,n),c.update(s,t,n))}renderMultiDraw(e,t,n){let{extensions:r,mode:i,object:a,info:o}=this;if(n===0)return;let s=r.get(`WEBGL_multi_draw`);if(s===null)for(let r=0;r<n;r++)this.render(e[r],t[r]);else{this.index===0?s.multiDrawArraysWEBGL(i,e,0,t,0,n):s.multiDrawElementsWEBGL(i,t,0,this.type,e,0,n);let r=0;for(let e=0;e<n;e++)r+=t[e];o.update(a,r,1)}}renderMultiDrawInstances(e,t,n,r){let{extensions:i,mode:a,object:o,info:s}=this;if(n===0)return;let c=i.get(`WEBGL_multi_draw`);if(c===null)for(let i=0;i<n;i++)this.renderInstances(e[i],t[i],r[i]);else{this.index===0?c.multiDrawArraysInstancedWEBGL(a,e,0,t,0,r,0,n):c.multiDrawElementsInstancedWEBGL(a,t,0,this.type,e,0,r,0,n);let i=0;for(let e=0;e<n;e++)i+=t[e]*r[e];s.update(o,i,1)}}},rH=class{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(P(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}},iH=class extends rH{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension(`EXT_disjoint_timer_query_webgl2`)||e.getExtension(`EXT_disjoint_timer_query`),!this.ext){P(`EXT_disjoint_timer_query not supported; timestamps will be disabled.`),this.trackTimestamp=!1;return}this.queries=[];for(let t=0;t<this.maxQueries;t++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return be(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;let t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,`inactive`),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;let t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;let n=this.queries[t];if(n)try{this.queryStates.get(t)===`inactive`&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,`started`))}catch(e){e(`Error in beginQuery:`,e),this.activeQuery=null,this.queryStates.set(t,`inactive`)}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;let t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,`ended`),this.activeQuery=null}catch(e){e(`Error in endQuery:`,e),this.queryStates.set(t,`inactive`),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{let e=new Map;for(let[t,n]of this.queryOffsets)if(this.queryStates.get(n)===`ended`){let r=this.queries[n];e.set(t,this.resolveQuery(r))}if(e.size===0)return this.lastValue;let t={},n=[];for(let[r,i]of e){let e=r.match(/^(.*):f(\d+)$/),a=parseInt(e[2]);n.includes(a)===!1&&n.push(a),t[a]===void 0&&(t[a]=0);let o=await i;this.timestamps.set(r,o),t[a]+=o}let r=t[n[n.length-1]];return this.lastValue=r,this.frames=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,r}catch(e){return e(`Error resolving queries:`,e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,r=!1,i=()=>{n&&=(clearTimeout(n),null)},a=e=>{r||(r=!0,i(),t(e))},o=()=>{if(this.isDisposed){a(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){a(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(o,1);return}let r=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(r)/1e6)}catch(e){e(`Error checking query:`,e),t(this.lastValue)}};o()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,this.trackTimestamp)){for(let e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}},aH=class extends zV{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>`u`?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);let t=this.parameters,n={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=t.context===void 0?e.domElement.getContext(`webgl2`,n):t.context;function i(t){t.preventDefault();let n={api:`WebGL`,message:t.statusMessage||`Unknown reason`,reason:null,originalEvent:t};e.onDeviceLost(n)}this._onContextLost=i,e.domElement.addEventListener(`webglcontextlost`,i,!1),this.gl=r,this.extensions=new $V(this),this.capabilities=new eH(this),this.attributeUtils=new HV(this),this.textureUtils=new ZV(this),this.bufferRenderer=new nH(this),this.state=new GV(this),this.utils=new KV(this),this.extensions.get(`EXT_color_buffer_float`),this.extensions.get(`WEBGL_clip_cull_distance`),this.extensions.get(`OES_texture_float_linear`),this.extensions.get(`EXT_color_buffer_half_float`),this.extensions.get(`WEBGL_multisampled_render_to_texture`),this.extensions.get(`WEBGL_render_shared_exponent`),this.extensions.get(`WEBGL_multi_draw`),this.extensions.get(`OVR_multiview2`),this.disjoint=this.extensions.get(`EXT_disjoint_timer_query_webgl2`),this.parallel=this.extensions.get(`KHR_parallel_shader_compile`)}get coordinateSystem(){return te}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){let r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),n!==null){let t=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:t}),this.extensions.has(`WEBGL_multisampled_render_to_texture`)===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&P(`WebGLBackend: Render-to-texture extension was disabled because an external texture was provided`),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new iH(this.gl,e,2048));let n=this.timestampQueryPool[e];n.allocateQueriesForContext(t)!==null&&n.beginQuery(t)}prepareTimestampBuffer(e,t){!this.disjoint||!this.trackTimestamp||this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){let{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{let{width:e,height:n}=this.getDrawingBufferSize();t.viewport(0,0,e,n)}if(e.scissor){let{x:n,y:r,width:i,height:a}=e.scissorValue;t.scissor(n,e.height-a-r,i,a)}this.initTimestampQuery(ar.RENDER,this.getTimestampUID(e)),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);let r=e.occlusionQueryCount;r>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=Array(r),n.occlusionQueryObjects=Array(r),n.occlusionQueryIndex=0)}finishRender(e){let{gl:t,state:n}=this,r=this.get(e),i=r.previousContext;n.resetVertexState();let a=e.occlusionQueryCount;a>0&&(a>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));let o=e.textures;if(o!==null)for(let e=0;e<o.length;e++){let t=o[e];t.generateMipmaps&&this.generateMipmaps(t)}if(this._currentContext=i,this._resolveRenderTarget(e),i!==null)if(this._setFramebuffer(i),i.viewport)this.updateViewport(i);else{let{width:e,height:t}=this.getDrawingBufferSize();n.viewport(0,0,e,t)}this.prepareTimestampBuffer(ar.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){let t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=t;if(n&&r){let e=new WeakSet,{gl:i}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;let a=()=>{let o=0;for(let t=0;t<n.length;t++){let a=n[t];a!==null&&i.getQueryParameter(a,i.QUERY_RESULT_AVAILABLE)&&(i.getQueryParameter(a,i.QUERY_RESULT)===0&&e.add(r[t]),n[t]=null,i.deleteQuery(a),o++)}o<n.length?requestAnimationFrame(a):t.occluded=e};a()}}isOccluded(e,t){let n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){let{state:t}=this,{x:n,y:r,width:i,height:a}=e.viewportValue;t.viewport(n,e.height-a-r,i,a)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){let e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,r=null,i=!0,a=!0){let{gl:o,renderer:s}=this;r===null&&(r={textures:null,clearColorValue:this.getClearColor()});let c=0;if(e&&(c|=o.COLOR_BUFFER_BIT),t&&(c|=o.DEPTH_BUFFER_BIT),n&&(c|=o.STENCIL_BUFFER_BIT),c!==0){let l;l=r.clearColorValue?r.clearColorValue:this.getClearColor();let u=s.getClearDepth(),d=s.getClearStencil();if(t&&this.state.setDepthMask(!0),r.textures===null)o.clearColor(l.r,l.g,l.b,l.a),o.clear(c);else{if(i&&this._setFramebuffer(r),e)for(let e=0;e<r.textures.length;e++)e===0?o.clearBufferfv(o.COLOR,e,[l.r,l.g,l.b,l.a]):o.clearBufferfv(o.COLOR,e,[0,0,0,1]);t&&n?o.clearBufferfi(o.DEPTH_STENCIL,0,u,d):t?o.clearBufferfv(o.DEPTH,0,[u]):n&&o.clearBufferiv(o.STENCIL,0,[d]),i&&a&&this._resolveRenderTarget(r)}}}beginCompute(e){let{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(ar.COMPUTE,this.getTimestampUID(e))}compute(e,t,n,r,i=null){let{state:a,gl:o}=this;this.discard===!1&&(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);let{programGPU:s,transformBuffers:c,attributes:l}=this.get(r),u=this._getVaoKey(l),d=this.vaoCache[u];d===void 0?this.vaoCache[u]=this._createVao(l):a.setVertexState(d),a.useProgram(s),this._bindUniforms(n);let f=this._getTransformFeedback(c);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,f),o.beginTransformFeedback(o.POINTS),i=i===null?t.count:i,Array.isArray(i)?(be(`WebGLBackend.compute(): The count parameter must be a single number, not an array.`),i=i[0]):i&&typeof i==`object`&&i.isIndirectStorageBufferAttribute&&(be(`WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute`),i=t.count),l[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,i):o.drawArrays(o.POINTS,0,i),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let e=0;e<c.length;e++){let t=c[e];t.pbo&&this.has(t.pbo)&&this.textureUtils.copyBufferToTexture(t.transformBuffer,t.pbo),t.switchBuffers()}}finishCompute(e){let t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(ar.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){let{object:t,pipeline:n,material:r,context:i,hardwareClippingPlanes:a}=e,{programGPU:o}=this.get(n),{gl:s,state:c}=this,l=this.get(i),u=e.getDrawParameters();if(u===null)return;this._bindUniforms(e.getBindings());let d=t.isMesh&&t.matrixWorld.determinant()<0;c.setMaterial(r,d,a),c.useProgram(o);let f=e.getAttributes(),p=this.get(f),m=p.vaoGPU;if(m===void 0){let e=this._getVaoKey(f);m=this.vaoCache[e],m===void 0&&(m=this._createVao(f),this.vaoCache[e]=m,p.vaoGPU=m)}let h=e.getIndex(),g=h===null?null:this.get(h).bufferGPU;c.setVertexState(m,g);let _=l.lastOcclusionObject;if(_!==t&&_!==void 0){if(_!==null&&_.occlusionTest===!0&&(s.endQuery(s.ANY_SAMPLES_PASSED),l.occlusionQueryIndex++),t.occlusionTest===!0){let e=s.createQuery();s.beginQuery(s.ANY_SAMPLES_PASSED,e),l.occlusionQueries[l.occlusionQueryIndex]=e,l.occlusionQueryObjects[l.occlusionQueryIndex]=t}l.lastOcclusionObject=t}let v=this.bufferRenderer;t.isPoints?v.mode=s.POINTS:t.isLineSegments?v.mode=s.LINES:t.isLine?v.mode=s.LINE_STRIP:t.isLineLoop?v.mode=s.LINE_LOOP:r.wireframe===!0?(c.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),v.mode=s.LINES):v.mode=s.TRIANGLES;let{vertexCount:y,instanceCount:b}=u,{firstVertex:x}=u;if(v.object=t,h!==null){x*=h.array.BYTES_PER_ELEMENT;let e=this.get(h);v.index=h.count,v.type=e.type}else v.index=0;let S=()=>{t.isBatchedMesh?t._multiDrawInstances===null?this.hasFeature(`WEBGL_multi_draw`)?v.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):be(`WebGLBackend: WEBGL_multi_draw not supported.`):(be(`WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.`),v.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):b>1?v.renderInstances(x,y,b):v.render(x,y)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){let n=this.get(e.camera),r=e.camera.cameras,i=e.getBindingGroup(`cameraIndex`).bindings[0];if(n.indexesGPU===void 0||n.indexesGPU.length!==r.length){let e=new Uint32Array([0,0,0,0]),t=[];for(let n=0,i=r.length;n<i;n++){let r=s.createBuffer();e[0]=n,s.bindBuffer(s.UNIFORM_BUFFER,r),s.bufferData(s.UNIFORM_BUFFER,e,s.STATIC_DRAW),t.push(r)}n.indexesGPU=t}let a=this.get(i),o=this.renderer.getPixelRatio(),l=this._currentContext.renderTarget,u=this._isRenderCameraDepthArray(this._currentContext),d=this._currentContext.activeCubeFace;if(u){let e=this.get(l.depthTexture);if(e.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){e.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;let{stencilBuffer:t}=l;for(let e=0,n=r.length;e<n;e++)this.renderer._activeCubeFace=e,this._currentContext.activeCubeFace=e,this._setFramebuffer(this._currentContext),this.clear(!1,!0,t,this._currentContext,!1,!1);this.renderer._activeCubeFace=d,this._currentContext.activeCubeFace=d}}for(let i=0,l=r.length;i<l;i++){let l=r[i];if(t.layers.test(l.layers)){u&&(this.renderer._activeCubeFace=i,this._currentContext.activeCubeFace=i,this._setFramebuffer(this._currentContext));let t=l.viewport;if(t!==void 0){let n=t.x*o,r=t.y*o,i=t.width*o,a=t.height*o;c.viewport(Math.floor(n),Math.floor(e.context.height-a-r),Math.floor(i),Math.floor(a))}c.bindBufferBase(s.UNIFORM_BUFFER,a.index,n.indexesGPU[i]),S()}this._currentContext.activeCubeFace=d,this.renderer._activeCubeFace=d}}else S()}needsRenderUpdate(){return!1}getRenderCacheKey(){return``}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,r,i,a){return this.textureUtils.copyTextureToBuffer(e,t,n,r,i,a)}updateSampler(){return``}createNodeBuilder(e,t){return new IV(e,t)}createProgram(e){let t=this.gl,{stage:n,code:r}=e,i=n===`fragment`?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(i,r),t.compileShader(i),this.set(e,{shaderGPU:i})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){let n=this.gl,r=e.pipeline,{fragmentProgram:i,vertexProgram:a}=r,o=n.createProgram(),s=this.get(i).shaderGPU,c=this.get(a).shaderGPU;if(n.attachShader(o,s),n.attachShader(o,c),n.linkProgram(o),this.set(r,{programGPU:o,fragmentShader:s,vertexShader:c}),t!==null&&this.parallel){let i=new Promise(t=>{let i=this.parallel,a=()=>{n.getProgramParameter(o,i.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),t()):requestAnimationFrame(a)};a()});t.push(i);return}this._completeCompile(e,r)}_handleSource(e,t){let n=e.split(`
`),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let e=i;e<a;e++){let i=e+1;r.push(`${i===t?`>`:` `} ${i}: ${n[e]}`)}return r.join(`
`)}_getShaderErrors(e,t,n){let r=e.getShaderParameter(t,e.COMPILE_STATUS),i=(e.getShaderInfoLog(t)||``).trim();if(r&&i===``)return``;let a=/ERROR: 0:(\d+)/.exec(i);if(a){let r=parseInt(a[1]);return n.toUpperCase()+`

`+i+`

`+this._handleSource(e.getShaderSource(t),r)}else return i}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){let r=this.gl,i=(r.getProgramInfoLog(e)||``).trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError==`function`)this.renderer.debug.onShaderError(r,e,n,t);else{let a=this._getShaderErrors(r,n,`vertex`),o=this._getShaderErrors(r,t,`fragment`);N(`THREE.WebGLProgram: Shader Error `+r.getError()+` - VALIDATE_STATUS `+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+i+`
`+a+`
`+o)}else i!==``&&P(`WebGLProgram: Program Info Log:`,i)}}_completeCompile(e,t){let{state:n,gl:r}=this,{programGPU:i,fragmentShader:a,vertexShader:o}=this.get(t);r.getProgramParameter(i,r.LINK_STATUS)===!1&&this._logProgramError(i,a,o),n.useProgram(i);let s=e.getBindings();this._setupBindings(s,i),this.set(t,{programGPU:i})}createComputePipeline(e,t){let{state:n,gl:r}=this,i={stage:`fragment`,code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(i);let{computeProgram:a}=e,o=r.createProgram(),s=this.get(i).shaderGPU,c=this.get(a).shaderGPU,l=a.transforms,u=[],d=[];for(let e=0;e<l.length;e++){let t=l[e];u.push(t.varyingName),d.push(t.attributeNode)}r.attachShader(o,s),r.attachShader(o,c),r.transformFeedbackVaryings(o,u,r.SEPARATE_ATTRIBS),r.linkProgram(o),r.getProgramParameter(o,r.LINK_STATUS)===!1&&this._logProgramError(o,s,c),n.useProgram(o),this._setupBindings(t,o);let f=a.attributes,p=[],m=[];for(let e=0;e<f.length;e++){let t=f[e].node.attribute;p.push(t),this.has(t)||this.attributeUtils.createAttribute(t,r.ARRAY_BUFFER)}for(let e=0;e<d.length;e++){let t=d[e].attribute;this.has(t)||this.attributeUtils.createAttribute(t,r.ARRAY_BUFFER);let n=this.get(t);m.push(n)}this.set(e,{programGPU:o,transformBuffers:m,attributes:p})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let e=0,n=0;for(let r of t){this.set(r,{textures:n,uniformBuffers:e});for(let t of r.bindings)t.isUniformBuffer&&e++,t.isSampledTexture&&n++}}this.updateBindings(e,t)}updateBindings(e){let{gl:t}=this,n=this.get(e),r=n.uniformBuffers,i=n.textures;for(let n of e.bindings){let e=this.get(n);if(n.isUniformsGroup||n.isUniformBuffer){let i=n.buffer,{bufferGPU:a}=this.get(i);a===void 0?(a=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,a),t.bufferData(t.UNIFORM_BUFFER,i,t.DYNAMIC_DRAW),this.set(i,{bufferGPU:a})):(t.bindBuffer(t.UNIFORM_BUFFER,a),t.bufferSubData(t.UNIFORM_BUFFER,0,i)),e.index=r++,e.bufferGPU=a,this.set(n,e)}else if(n.isSampledTexture){let{textureGPU:t,glTextureType:r}=this.get(n.texture);e.index=i++,e.textureGPU=t,e.glTextureType=r,this.set(n,e)}}}updateBinding(e){let t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){let n=this.get(e).bufferGPU,r=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,r,t.DYNAMIC_DRAW)}}createIndexAttribute(e){let t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;let t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;let t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){let t=Object.keys(tH).filter(t=>tH[t]===e),n=this.extensions;for(let e=0;e<t.length;e++)if(n.has(t[e]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,r=null,i=0,a=0){this.textureUtils.copyTextureToTexture(e,t,n,r,i,a)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){let{gl:t,state:n}=this,r=null;if(e.textures!==null){let i=e.renderTarget,a=this.get(i),{samples:o,depthBuffer:s,stencilBuffer:c}=i,l=i.isWebGLCubeRenderTarget===!0,u=i.isRenderTarget3D===!0,d=i.depth>1,f=i.isXRRenderTarget===!0,p=f===!0&&i._hasExternalTextures===!0,m=a.msaaFrameBuffer,h=a.depthRenderbuffer,g=this.extensions.get(`WEBGL_multisampled_render_to_texture`),_=this.extensions.get(`OVR_multiview2`),v=this._useMultisampledExtension(i),y=iN(e),b;if(l?(a.cubeFramebuffers||={},b=a.cubeFramebuffers[y]):f&&p===!1?b=this._xrFramebuffer:(a.framebuffers||={},b=a.framebuffers[y]),b===void 0){b=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,b);let r=e.textures,s=[];if(l){a.cubeFramebuffers[y]=b;let{textureGPU:e}=this.get(r[0]),n=this.renderer._activeCubeFace,i=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,e,i)}else{a.framebuffers[y]=b;for(let n=0;n<r.length;n++){let a=r[n],s=this.get(a);s.renderTarget=e.renderTarget,s.cacheKey=y;let c=t.COLOR_ATTACHMENT0+n;if(i.multiview)_.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,c,s.textureGPU,0,o,0,2);else if(u||d){let e=this.renderer._activeCubeFace,n=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,c,s.textureGPU,n,e)}else if(v)g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,c,t.TEXTURE_2D,s.textureGPU,0,o);else{let e=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,c,t.TEXTURE_2D,s.textureGPU,e)}}}let f=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){let n=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(n,e,0,v),a.xrDepthRenderbuffer=n,s.push(c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,n),t.framebufferRenderbuffer(t.FRAMEBUFFER,f,t.RENDERBUFFER,n)}else if(e.depthTexture!==null){s.push(c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);let n=this.get(e.depthTexture);if(n.renderTarget=e.renderTarget,n.cacheKey=y,i.multiview)_.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,f,n.textureGPU,0,o,0,2);else if(p&&v)g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,f,t.TEXTURE_2D,n.textureGPU,0,o);else if(e.depthTexture.isArrayTexture){let e=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,f,n.textureGPU,0,e)}else t.framebufferTexture2D(t.FRAMEBUFFER,f,t.TEXTURE_2D,n.textureGPU,0)}a.depthInvalidationArray=s}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,b);let r=this.renderer._activeCubeFace,i=this.get(e.depthTexture),a=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,a,i.textureGPU,0,r)}if((f||v||i.multiview)&&i._isOpaqueFramebuffer!==!0){n.bindFramebuffer(t.FRAMEBUFFER,b);let r=this.get(e.textures[0]);i.multiview?_.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,r.textureGPU,0,o,0,2):v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r.textureGPU,0);let s=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){let e=a.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,s,t.RENDERBUFFER,e)}else{let n=this.get(e.depthTexture);i.multiview?_.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,s,n.textureGPU,0,o,0,2):v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,s,t.TEXTURE_2D,n.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,s,t.TEXTURE_2D,n.textureGPU,0)}}}if(o>0&&v===!1&&!i.multiview){if(m===void 0){let r=[];m=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,m);let i=[],l=e.textures;for(let n=0;n<l.length;n++){i[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,i[n]),r.push(t.COLOR_ATTACHMENT0+n);let a=e.textures[n],s=this.get(a);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,s.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,i[n])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),a.msaaFrameBuffer=m,a.msaaRenderbuffers=i,s&&h===void 0){h=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(h,e,o),a.depthRenderbuffer=h;let n=c?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;r.push(n)}a.invalidationArray=r}r=a.msaaFrameBuffer}else r=b;n.drawBuffers(e,b)}n.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t=``;for(let n=0;n<e.length;n++){let r=this.get(e[n]);t+=`:`+r.id}return t}_createVao(e){let{gl:t}=this,n=t.createVertexArray();t.bindVertexArray(n);for(let n=0;n<e.length;n++){let r=e[n],i=this.get(r);t.bindBuffer(t.ARRAY_BUFFER,i.bufferGPU),t.enableVertexAttribArray(n);let a,o;r.isInterleavedBufferAttribute===!0?(a=r.data.stride*i.bytesPerElement,o=r.offset*i.bytesPerElement):(a=0,o=0),i.isInteger?t.vertexAttribIPointer(n,r.itemSize,i.type,a,o):t.vertexAttribPointer(n,r.itemSize,i.type,r.normalized,a,o),r.isInstancedBufferAttribute&&!r.isInterleavedBufferAttribute?t.vertexAttribDivisor(n,r.meshPerAttribute):r.isInterleavedBufferAttribute&&r.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(n,r.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),n}_getTransformFeedback(e){let t=``;for(let n=0;n<e.length;n++)t+=`:`+e[n].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;let{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let t=0;t<e.length;t++){let n=e[t];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,t,n.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){let n=this.gl;for(let r of e)for(let e of r.bindings){let r=this.get(e).index;if(e.isUniformsGroup||e.isUniformBuffer){let i=n.getUniformBlockIndex(t,e.name);n.uniformBlockBinding(t,i,r)}else if(e.isSampledTexture){let i=n.getUniformLocation(t,e.name);n.uniform1i(i,r)}}}_bindUniforms(e){let{gl:t,state:n}=this;for(let r of e)for(let e of r.bindings){let r=this.get(e),i=r.index;e.isUniformsGroup||e.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,i,r.bufferGPU):e.isSampledTexture&&n.bindTexture(r.glTextureType,r.textureGPU,t.TEXTURE0+i)}}_resolveRenderTarget(e){let{gl:t,state:n}=this,r=e.renderTarget;if(e.textures!==null&&r){let i=this.get(r);if(r.samples>0&&this._useMultisampledExtension(r)===!1){let a=i.framebuffers[e.getCacheKey()],o=t.COLOR_BUFFER_BIT;r.resolveDepthBuffer&&(r.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),r.stencilBuffer&&r.resolveStencilBuffer&&(o|=t.STENCIL_BUFFER_BIT));let s=i.msaaFrameBuffer,c=i.msaaRenderbuffers,l=e.textures,u=l.length>1;if(n.bindFramebuffer(t.READ_FRAMEBUFFER,s),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,a),u)for(let e=0;e<l.length;e++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);for(let n=0;n<l.length;n++){if(u){let{textureGPU:e}=this.get(l[n]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,c[n]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}if(e.scissor){let{x:n,y:r,width:i,height:a}=e.scissorValue,s=e.height-a-r;t.blitFramebuffer(n,s,n+i,s+a,n,s,n+i,s+a,o,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o,t.NEAREST)}if(u)for(let e=0;e<l.length;e++){let{textureGPU:n}=this.get(l[e]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,c[e]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,n,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,i.invalidationArray)}else if(r.resolveDepthBuffer===!1&&i.framebuffers){let r=i.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,r),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,i.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has(`WEBGL_multisampled_render_to_texture`)===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();let e=this.extensions.get(`WEBGL_lose_context`);e&&e.loseContext(),this.renderer.domElement.removeEventListener(`webglcontextlost`,this._onContextLost)}},oH={PointList:`point-list`,LineList:`line-list`,LineStrip:`line-strip`,TriangleList:`triangle-list`,TriangleStrip:`triangle-strip`},sH={Never:`never`,Less:`less`,Equal:`equal`,LessEqual:`less-equal`,Greater:`greater`,NotEqual:`not-equal`,GreaterEqual:`greater-equal`,Always:`always`},cH={Store:`store`},lH={Load:`load`,Clear:`clear`},uH={CCW:`ccw`,CW:`cw`},dH={None:`none`,Back:`back`},fH={Uint16:`uint16`,Uint32:`uint32`},$={R8Unorm:`r8unorm`,R8Snorm:`r8snorm`,R8Uint:`r8uint`,R8Sint:`r8sint`,R16Uint:`r16uint`,R16Sint:`r16sint`,R16Float:`r16float`,RG8Unorm:`rg8unorm`,RG8Snorm:`rg8snorm`,RG8Uint:`rg8uint`,RG8Sint:`rg8sint`,R32Uint:`r32uint`,R32Sint:`r32sint`,R32Float:`r32float`,RG16Uint:`rg16uint`,RG16Sint:`rg16sint`,RG16Float:`rg16float`,RGBA8Unorm:`rgba8unorm`,RGBA8UnormSRGB:`rgba8unorm-srgb`,RGBA8Snorm:`rgba8snorm`,RGBA8Uint:`rgba8uint`,RGBA8Sint:`rgba8sint`,BGRA8Unorm:`bgra8unorm`,BGRA8UnormSRGB:`bgra8unorm-srgb`,RGB9E5UFloat:`rgb9e5ufloat`,RGB10A2Unorm:`rgb10a2unorm`,RG11B10UFloat:`rg11b10ufloat`,RG32Uint:`rg32uint`,RG32Sint:`rg32sint`,RG32Float:`rg32float`,RGBA16Uint:`rgba16uint`,RGBA16Sint:`rgba16sint`,RGBA16Float:`rgba16float`,RGBA32Uint:`rgba32uint`,RGBA32Sint:`rgba32sint`,RGBA32Float:`rgba32float`,Depth16Unorm:`depth16unorm`,Depth24Plus:`depth24plus`,Depth24PlusStencil8:`depth24plus-stencil8`,Depth32Float:`depth32float`,Depth32FloatStencil8:`depth32float-stencil8`,BC1RGBAUnorm:`bc1-rgba-unorm`,BC1RGBAUnormSRGB:`bc1-rgba-unorm-srgb`,BC2RGBAUnorm:`bc2-rgba-unorm`,BC2RGBAUnormSRGB:`bc2-rgba-unorm-srgb`,BC3RGBAUnorm:`bc3-rgba-unorm`,BC3RGBAUnormSRGB:`bc3-rgba-unorm-srgb`,BC4RUnorm:`bc4-r-unorm`,BC4RSnorm:`bc4-r-snorm`,BC5RGUnorm:`bc5-rg-unorm`,BC5RGSnorm:`bc5-rg-snorm`,BC6HRGBUFloat:`bc6h-rgb-ufloat`,BC6HRGBFloat:`bc6h-rgb-float`,BC7RGBAUnorm:`bc7-rgba-unorm`,BC7RGBAUnormSRGB:`bc7-rgba-unorm-srgb`,ETC2RGB8Unorm:`etc2-rgb8unorm`,ETC2RGB8UnormSRGB:`etc2-rgb8unorm-srgb`,ETC2RGB8A1Unorm:`etc2-rgb8a1unorm`,ETC2RGB8A1UnormSRGB:`etc2-rgb8a1unorm-srgb`,ETC2RGBA8Unorm:`etc2-rgba8unorm`,ETC2RGBA8UnormSRGB:`etc2-rgba8unorm-srgb`,EACR11Unorm:`eac-r11unorm`,EACR11Snorm:`eac-r11snorm`,EACRG11Unorm:`eac-rg11unorm`,EACRG11Snorm:`eac-rg11snorm`,ASTC4x4Unorm:`astc-4x4-unorm`,ASTC4x4UnormSRGB:`astc-4x4-unorm-srgb`,ASTC5x4Unorm:`astc-5x4-unorm`,ASTC5x4UnormSRGB:`astc-5x4-unorm-srgb`,ASTC5x5Unorm:`astc-5x5-unorm`,ASTC5x5UnormSRGB:`astc-5x5-unorm-srgb`,ASTC6x5Unorm:`astc-6x5-unorm`,ASTC6x5UnormSRGB:`astc-6x5-unorm-srgb`,ASTC6x6Unorm:`astc-6x6-unorm`,ASTC6x6UnormSRGB:`astc-6x6-unorm-srgb`,ASTC8x5Unorm:`astc-8x5-unorm`,ASTC8x5UnormSRGB:`astc-8x5-unorm-srgb`,ASTC8x6Unorm:`astc-8x6-unorm`,ASTC8x6UnormSRGB:`astc-8x6-unorm-srgb`,ASTC8x8Unorm:`astc-8x8-unorm`,ASTC8x8UnormSRGB:`astc-8x8-unorm-srgb`,ASTC10x5Unorm:`astc-10x5-unorm`,ASTC10x5UnormSRGB:`astc-10x5-unorm-srgb`,ASTC10x6Unorm:`astc-10x6-unorm`,ASTC10x6UnormSRGB:`astc-10x6-unorm-srgb`,ASTC10x8Unorm:`astc-10x8-unorm`,ASTC10x8UnormSRGB:`astc-10x8-unorm-srgb`,ASTC10x10Unorm:`astc-10x10-unorm`,ASTC10x10UnormSRGB:`astc-10x10-unorm-srgb`,ASTC12x10Unorm:`astc-12x10-unorm`,ASTC12x10UnormSRGB:`astc-12x10-unorm-srgb`,ASTC12x12Unorm:`astc-12x12-unorm`,ASTC12x12UnormSRGB:`astc-12x12-unorm-srgb`},pH={ClampToEdge:`clamp-to-edge`,Repeat:`repeat`,MirrorRepeat:`mirror-repeat`},mH={Linear:`linear`,Nearest:`nearest`},hH={Zero:`zero`,One:`one`,Src:`src`,OneMinusSrc:`one-minus-src`,SrcAlpha:`src-alpha`,OneMinusSrcAlpha:`one-minus-src-alpha`,Dst:`dst`,OneMinusDst:`one-minus-dst`,DstAlpha:`dst-alpha`,OneMinusDstAlpha:`one-minus-dst-alpha`,SrcAlphaSaturated:`src-alpha-saturated`,Constant:`constant`,OneMinusConstant:`one-minus-constant`},gH={Add:`add`,Subtract:`subtract`,ReverseSubtract:`reverse-subtract`,Min:`min`,Max:`max`},_H={None:0,All:15},vH={Keep:`keep`,Zero:`zero`,Replace:`replace`,Invert:`invert`,IncrementClamp:`increment-clamp`,DecrementClamp:`decrement-clamp`,IncrementWrap:`increment-wrap`,DecrementWrap:`decrement-wrap`},yH={Storage:`storage`,ReadOnlyStorage:`read-only-storage`},bH={WriteOnly:`write-only`,ReadOnly:`read-only`,ReadWrite:`read-write`},xH={NonFiltering:`non-filtering`,Comparison:`comparison`},SH={Float:`float`,UnfilterableFloat:`unfilterable-float`,Depth:`depth`,SInt:`sint`,UInt:`uint`},CH={TwoD:`2d`,ThreeD:`3d`},wH={TwoD:`2d`,TwoDArray:`2d-array`,Cube:`cube`,ThreeD:`3d`},TH={All:`all`},EH={Vertex:`vertex`,Instance:`instance`},DH={CoreFeaturesAndLimits:`core-features-and-limits`,DepthClipControl:`depth-clip-control`,Depth32FloatStencil8:`depth32float-stencil8`,TextureCompressionBC:`texture-compression-bc`,TextureCompressionBCSliced3D:`texture-compression-bc-sliced-3d`,TextureCompressionETC2:`texture-compression-etc2`,TextureCompressionASTC:`texture-compression-astc`,TextureCompressionASTCSliced3D:`texture-compression-astc-sliced-3d`,TimestampQuery:`timestamp-query`,IndirectFirstInstance:`indirect-first-instance`,ShaderF16:`shader-f16`,RG11B10UFloat:`rg11b10ufloat-renderable`,BGRA8UNormStorage:`bgra8unorm-storage`,Float32Filterable:`float32-filterable`,Float32Blendable:`float32-blendable`,ClipDistances:`clip-distances`,DualSourceBlending:`dual-source-blending`,Subgroups:`subgroups`,TextureFormatsTier1:`texture-formats-tier1`,TextureFormatsTier2:`texture-formats-tier2`},OH={"texture-compression-s3tc":`texture-compression-bc`,"texture-compression-etc1":`texture-compression-etc2`},kH=class extends CV{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){let{textureNode:e}=this;return this.texture===e.value?super.update():(this.texture=e.value,!0)}},AH=class extends mV{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}},jH=0,MH=class extends AH{constructor(e,t){super(`StorageBuffer_`+ jH++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:My.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}},NH=class extends NM{constructor(e){super(),this.device=e,this.mipmapSampler=e.createSampler({minFilter:mH.Linear}),this.flipYSampler=e.createSampler({minFilter:mH.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:`mipmapVertex`,code:`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`}),this.mipmapFragmentShaderModule=e.createShaderModule({label:`mipmapFragment`,code:`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`}),this.flipYFragmentShaderModule=e.createShaderModule({label:`flipYFragment`,code:`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:`main`},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:`main`,targets:[{format:e}]},primitive:{topology:oH.TriangleStrip,stripIndexFormat:fH.Uint32},layout:`auto`}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:`main`},fragment:{module:this.flipYFragmentShaderModule,entryPoint:`main`,targets:[{format:e}]},primitive:{topology:oH.TriangleStrip,stripIndexFormat:fH.Uint32},layout:`auto`}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){let r=t.format,{width:i,height:a}=t.size,o=this.getTransferPipeline(r),s=this.getFlipYPipeline(r),c=this.device.createTexture({size:{width:i,height:a,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),l=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:wH.TwoD,baseArrayLayer:n}),u=c.createView({baseMipLevel:0,mipLevelCount:1,dimension:wH.TwoD,baseArrayLayer:0}),d=this.device.createCommandEncoder({}),f=(e,t,n)=>{let r=e.getBindGroupLayout(0),i=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:t}]}),a=d.beginRenderPass({colorAttachments:[{view:n,loadOp:lH.Clear,storeOp:cH.Store,clearValue:[0,0,0,0]}]});a.setPipeline(e),a.setBindGroup(0,i),a.draw(4,1,0,0),a.end()};f(o,l,u),f(s,u,l),this.device.queue.submit([d.finish()]),c.destroy()}generateMipmaps(e,t,n=0,r=null){let i=this.get(e);i.layers===void 0&&(i.layers=[]);let a=i.layers[n]||this._mipmapCreateBundles(e,t,n),o=r||this.device.createCommandEncoder({label:`mipmapEncoder`});this._mipmapRunBundles(o,a),r===null&&this.device.queue.submit([o.finish()]),i.layers[n]=a}_mipmapCreateBundles(e,t,n){let r=this.getTransferPipeline(t.format),i=r.getBindGroupLayout(0),a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:wH.TwoD,baseArrayLayer:n}),o=[];for(let s=1;s<t.mipLevelCount;s++){let c=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),l=e.createView({baseMipLevel:s,mipLevelCount:1,dimension:wH.TwoD,baseArrayLayer:n}),u={colorAttachments:[{view:l,loadOp:lH.Clear,storeOp:cH.Store,clearValue:[0,0,0,0]}]},d=this.device.createRenderBundleEncoder({colorFormats:[t.format]});d.setPipeline(r),d.setBindGroup(0,c),d.draw(4,1,0,0),o.push({renderBundles:[d.finish()],passDescriptor:u}),a=l}return o}_mipmapRunBundles(e,t){let n=t.length;for(let r=0;r<n;r++){let n=t[r],i=e.beginRenderPass(n.passDescriptor);i.executeBundles(n.renderBundles),i.end()}}},PH={512:`never`,513:`less`,514:`equal`,515:`less-equal`,516:`greater`,518:`greater-equal`,519:`always`,517:`not-equal`},FH=[0,1,3,2,4,5],IH=class{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){let t=this.backend,n=e.minFilter+`-`+e.magFilter+`-`+e.wrapS+`-`+e.wrapT+`-`+(e.wrapR||`0`)+`-`+e.anisotropy+`-`+(e.compareFunction||0),r=this._samplerCache.get(n);if(r===void 0){let i={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};i.magFilter===mH.Linear&&i.minFilter===mH.Linear&&i.mipmapFilter===mH.Linear&&(i.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(i.compare=PH[e.compareFunction]),r={sampler:t.device.createSampler(i),usedTimes:0},this._samplerCache.set(n,r)}let i=t.get(e);if(i.sampler!==r.sampler){if(i.sampler!==void 0){let e=this._samplerCache.get(i.samplerKey);e.usedTimes--,e.usedTimes===0&&this._samplerCache.delete(i.samplerKey)}i.samplerKey=n,i.sampler=r.sampler,r.usedTimes++}return n}createDefaultTexture(e){let t,n=LH(e);t=e.isCubeTexture?this._getDefaultCubeTextureGPU(n):this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){let n=this.backend,r=n.get(e);if(r.initialized)throw Error(`WebGPUTextureUtils: Texture already initialized.`);if(e.isExternalTexture){r.texture=e.sourceTexture,r.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);let{width:i,height:a,depth:o,levels:s}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());let c=this._getDimension(e),l=e.internalFormat||t.format||LH(e,n.device);r.format=l;let{samples:u,primarySamples:d,isMSAA:f}=n.utils.getTextureSampleData(e),p=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(p|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&l!==$.RGB9E5UFloat&&(p|=GPUTextureUsage.RENDER_ATTACHMENT);let m={label:e.name,size:{width:i,height:a,depthOrArrayLayers:o},mipLevelCount:s,sampleCount:d,dimension:c,format:l,usage:p};if(l===void 0){P(`WebGPURenderer: Texture format not supported.`),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(m.textureBindingViewDimension=wH.Cube),r.texture=n.device.createTexture(m),f){let e=Object.assign({},m);e.label+=`-msaa`,e.sampleCount=u,e.mipLevelCount=1,r.msaaTexture=n.device.createTexture(e)}r.initialized=!0,r.textureDescriptorGPU=m}destroyTexture(e,t=!1){let n=this.backend,r=n.get(e);r.texture!==void 0&&t===!1&&r.texture.destroy(),r.msaaTexture!==void 0&&r.msaaTexture.destroy(),n.delete(e)}generateMipmaps(e,t=null){let n=this.backend.get(e);if(e.isCubeTexture)for(let e=0;e<6;e++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,e,t);else{let r=e.image.depth||1;for(let e=0;e<r;e++)this._generateMipmaps(n.texture,n.textureDescriptorGPU,e,t)}}getColorBuffer(){let e=this.backend,t=e.renderer.getCanvasTarget(),{width:n,height:r}=e.getDrawingBufferSize(),i=e.renderer.currentSamples,a=t.colorTexture,o=e.get(a);if(a.width===n&&a.height===r&&a.samples===i)return o.texture;let s=o.texture;return s&&s.destroy(),s=e.device.createTexture({label:`colorBuffer`,size:{width:n,height:r,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),a.source.width=n,a.source.height=r,a.samples=i,o.texture=s,s}getDepthBuffer(e=!0,t=!1){let n=this.backend,r=n.renderer.getCanvasTarget(),{width:i,height:a}=n.getDrawingBufferSize(),o=n.renderer.currentSamples,s=r.depthTexture;if(s.width===i&&s.height===a&&s.samples===o&&s.depth===e&&s.stencil===t)return n.get(s).texture;let c=n.get(s).texture,l,u;if(t?(l=Lt,u=mt):e&&(l=ye,u=x),c!==void 0){if(s.image.width===i&&s.image.height===a&&s.format===l&&s.type===u&&s.samples===o)return c;this.destroyTexture(s)}return s.name=`depthBuffer`,s.format=l,s.type=u,s.image.width=i,s.image.height=a,s.samples=o,this.createTexture(s,{width:i,height:a}),n.get(s).texture}updateTexture(e,t){let n=this.backend.get(e),r=e.mipmaps,{textureDescriptorGPU:i}=n;if(!(e.isRenderTargetTexture||i===void 0)){if(e.isDataTexture)if(r.length>0)for(let t=0,a=r.length;t<a;t++){let a=r[t];this._copyBufferToTexture(a,n.texture,i,0,e.flipY,0,t)}else this._copyBufferToTexture(t.image,n.texture,i,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let r=0;r<t.image.depth;r++)this._copyBufferToTexture(t.image,n.texture,i,r,e.flipY,r);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,i);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,n.texture,i);else if(r.length>0)for(let t=0,a=r.length;t<a;t++){let a=r[t];this._copyImageToTexture(a,n.texture,i,0,e.flipY,e.premultiplyAlpha,t)}else this._copyImageToTexture(t.image,n.texture,i,0,e.flipY,e.premultiplyAlpha);n.version=e.version}}async copyTextureToBuffer(e,t,n,r,i,a){let o=this.backend.device,s=this.backend.get(e),c=s.texture,l=s.textureDescriptorGPU.format,u=this._getBytesPerTexel(l),d=r*u;d=Math.ceil(d/256)*256;let f=o.createBuffer({size:(i-1)*d+r*u,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),p=o.createCommandEncoder();p.copyTextureToBuffer({texture:c,origin:{x:t,y:n,z:a}},{buffer:f,bytesPerRow:d},{width:r,height:i});let m=this._getTypedArrayType(l);return o.queue.submit([p.finish()]),await f.mapAsync(GPUMapMode.READ),new m(f.getMappedRange())}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){let n=new wn;n.minFilter=_,n.magFilter=_,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){let n=new k;n.minFilter=_,n.magFilter=_,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,n){let r=e.images,i=e.mipmaps;for(let a=0;a<6;a++){let o=r[a],s=e.flipY===!0?FH[a]:a;o.isDataTexture?this._copyBufferToTexture(o.image,t,n,s,e.flipY):this._copyImageToTexture(o,t,n,s,e.flipY,e.premultiplyAlpha);for(let r=0;r<i.length;r++){let o=i[r].images[a];o.isDataTexture?this._copyBufferToTexture(o.image,t,n,s,e.flipY,0,r+1):this._copyImageToTexture(o,t,n,s,e.flipY,e.premultiplyAlpha,r+1)}}}_copyImageToTexture(e,t,n,r,i,a,o=0){let s=this.backend.device,c=o>0?e.width:n.size.width,l=o>0?e.height:n.size.height;s.queue.copyExternalImageToTexture({source:e,flipY:i},{texture:t,mipLevel:o,origin:{x:0,y:0,z:r},premultipliedAlpha:a},{width:c,height:l,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new NH(this.backend.device)),e}_generateMipmaps(e,t,n=0,r=null){this._getPassUtils().generateMipmaps(e,t,n,r)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,r,i,a=0,o=0){let s=this.backend.device,c=e.data,l=this._getBytesPerTexel(n.format),u=e.width*l;s.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:r}},c,{offset:e.width*e.height*l*a,bytesPerRow:u},{width:e.width,height:e.height,depthOrArrayLayers:1}),i===!0&&this._flipY(t,n,r)}_copyCompressedBufferToTexture(e,t,n){let r=this.backend.device,i=this._getBlockData(n.format),a=n.size.depthOrArrayLayers>1;for(let o=0;o<e.length;o++){let s=e[o],c=s.width,l=s.height,u=a?n.size.depthOrArrayLayers:1,d=Math.ceil(c/i.width)*i.byteLength,f=d*Math.ceil(l/i.height);for(let e=0;e<u;e++)r.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:e}},s.data,{offset:e*f,bytesPerRow:d,rowsPerImage:Math.ceil(l/i.height)},{width:Math.ceil(c/i.width)*i.width,height:Math.ceil(l/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===$.BC1RGBAUnorm||e===$.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===$.BC2RGBAUnorm||e===$.BC2RGBAUnormSRGB||e===$.BC3RGBAUnorm||e===$.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===$.BC4RUnorm||e===$.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===$.BC5RGUnorm||e===$.BC5RGSnorm||e===$.BC6HRGBUFloat||e===$.BC6HRGBFloat||e===$.BC7RGBAUnorm||e===$.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===$.ETC2RGB8Unorm||e===$.ETC2RGB8UnormSRGB||e===$.ETC2RGB8A1Unorm||e===$.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===$.ETC2RGBA8Unorm||e===$.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===$.EACR11Unorm||e===$.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===$.EACRG11Unorm||e===$.EACRG11Snorm||e===$.ASTC4x4Unorm||e===$.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===$.ASTC5x4Unorm||e===$.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===$.ASTC5x5Unorm||e===$.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===$.ASTC6x5Unorm||e===$.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===$.ASTC6x6Unorm||e===$.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===$.ASTC8x5Unorm||e===$.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===$.ASTC8x6Unorm||e===$.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===$.ASTC8x8Unorm||e===$.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===$.ASTC10x5Unorm||e===$.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===$.ASTC10x6Unorm||e===$.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===$.ASTC10x8Unorm||e===$.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===$.ASTC10x10Unorm||e===$.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===$.ASTC12x10Unorm||e===$.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===$.ASTC12x12Unorm||e===$.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=pH.ClampToEdge;return e===1e3?t=pH.Repeat:e===1002&&(t=pH.MirrorRepeat),t}_convertFilterMode(e){let t=mH.Linear;return(e===1003||e===1004||e===1005)&&(t=mH.Nearest),t}_getBytesPerTexel(e){if(e===$.R8Unorm||e===$.R8Snorm||e===$.R8Uint||e===$.R8Sint)return 1;if(e===$.R16Uint||e===$.R16Sint||e===$.R16Float||e===$.RG8Unorm||e===$.RG8Snorm||e===$.RG8Uint||e===$.RG8Sint)return 2;if(e===$.R32Uint||e===$.R32Sint||e===$.R32Float||e===$.RG16Uint||e===$.RG16Sint||e===$.RG16Float||e===$.RGBA8Unorm||e===$.RGBA8UnormSRGB||e===$.RGBA8Snorm||e===$.RGBA8Uint||e===$.RGBA8Sint||e===$.BGRA8Unorm||e===$.BGRA8UnormSRGB||e===$.RGB9E5UFloat||e===$.RGB10A2Unorm||e===$.RG11B10UFloat||e===$.Depth32Float||e===$.Depth24Plus||e===$.Depth24PlusStencil8||e===$.Depth32FloatStencil8)return 4;if(e===$.RG32Uint||e===$.RG32Sint||e===$.RG32Float||e===$.RGBA16Uint||e===$.RGBA16Sint||e===$.RGBA16Float)return 8;if(e===$.RGBA32Uint||e===$.RGBA32Sint||e===$.RGBA32Float)return 16}_getTypedArrayType(e){if(e===$.R8Uint)return Uint8Array;if(e===$.R8Sint)return Int8Array;if(e===$.R8Unorm)return Uint8Array;if(e===$.R8Snorm)return Int8Array;if(e===$.RG8Uint)return Uint8Array;if(e===$.RG8Sint)return Int8Array;if(e===$.RG8Unorm)return Uint8Array;if(e===$.RG8Snorm)return Int8Array;if(e===$.RGBA8Uint)return Uint8Array;if(e===$.RGBA8Sint)return Int8Array;if(e===$.RGBA8Unorm||e===$.RGBA8UnormSRGB)return Uint8Array;if(e===$.RGBA8Snorm)return Int8Array;if(e===$.R16Uint)return Uint16Array;if(e===$.R16Sint)return Int16Array;if(e===$.RG16Uint)return Uint16Array;if(e===$.RG16Sint)return Int16Array;if(e===$.RGBA16Uint)return Uint16Array;if(e===$.RGBA16Sint)return Int16Array;if(e===$.R16Float||e===$.RG16Float||e===$.RGBA16Float)return Uint16Array;if(e===$.R32Uint)return Uint32Array;if(e===$.R32Sint)return Int32Array;if(e===$.R32Float)return Float32Array;if(e===$.RG32Uint)return Uint32Array;if(e===$.RG32Sint)return Int32Array;if(e===$.RG32Float)return Float32Array;if(e===$.RGBA32Uint)return Uint32Array;if(e===$.RGBA32Sint)return Int32Array;if(e===$.RGBA32Float)return Float32Array;if(e===$.BGRA8Unorm||e===$.BGRA8UnormSRGB)return Uint8Array;if(e===$.RGB10A2Unorm||e===$.RGB9E5UFloat||e===$.RG11B10UFloat)return Uint32Array;if(e===$.Depth32Float)return Float32Array;if(e===$.Depth24Plus||e===$.Depth24PlusStencil8)return Uint32Array;if(e===$.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return t=e.is3DTexture||e.isData3DTexture?CH.ThreeD:CH.TwoD,t}};function LH(e,t=null){let n=e.format,r=e.type,i=e.colorSpace,a=Un.getTransfer(i),s;if(e.isCompressedTexture===!0||e.isCompressedArrayTexture===!0)switch(n){case Le:case v:s=a===`srgb`?$.BC1RGBAUnormSRGB:$.BC1RGBAUnorm;break;case $r:s=a===`srgb`?$.BC2RGBAUnormSRGB:$.BC2RGBAUnorm;break;case gt:s=a===`srgb`?$.BC3RGBAUnormSRGB:$.BC3RGBAUnorm;break;case Br:s=$.BC4RUnorm;break;case se:s=$.BC4RSnorm;break;case xn:s=$.BC5RGUnorm;break;case At:s=$.BC5RGSnorm;break;case li:s=a===`srgb`?$.BC7RGBAUnormSRGB:$.BC7RGBAUnorm;break;case Zn:case Ke:s=a===`srgb`?$.ETC2RGB8UnormSRGB:$.ETC2RGB8Unorm;break;case sn:s=a===`srgb`?$.ETC2RGBA8UnormSRGB:$.ETC2RGBA8Unorm;break;case _n:s=a===`srgb`?$.ASTC4x4UnormSRGB:$.ASTC4x4Unorm;break;case En:s=a===`srgb`?$.ASTC5x4UnormSRGB:$.ASTC5x4Unorm;break;case Sr:s=a===`srgb`?$.ASTC5x5UnormSRGB:$.ASTC5x5Unorm;break;case sr:s=a===`srgb`?$.ASTC6x5UnormSRGB:$.ASTC6x5Unorm;break;case In:s=a===`srgb`?$.ASTC6x6UnormSRGB:$.ASTC6x6Unorm;break;case jn:s=a===`srgb`?$.ASTC8x5UnormSRGB:$.ASTC8x5Unorm;break;case Xt:s=a===`srgb`?$.ASTC8x6UnormSRGB:$.ASTC8x6Unorm;break;case Jr:s=a===`srgb`?$.ASTC8x8UnormSRGB:$.ASTC8x8Unorm;break;case _r:s=a===`srgb`?$.ASTC10x5UnormSRGB:$.ASTC10x5Unorm;break;case Fr:s=a===`srgb`?$.ASTC10x6UnormSRGB:$.ASTC10x6Unorm;break;case fn:s=a===`srgb`?$.ASTC10x8UnormSRGB:$.ASTC10x8Unorm;break;case tn:s=a===`srgb`?$.ASTC10x10UnormSRGB:$.ASTC10x10Unorm;break;case nr:s=a===`srgb`?$.ASTC12x10UnormSRGB:$.ASTC12x10Unorm;break;case Gr:s=a===`srgb`?$.ASTC12x12UnormSRGB:$.ASTC12x12Unorm;break;case jr:s=a===`srgb`?$.RGBA8UnormSRGB:$.RGBA8Unorm;break;default:N(`WebGPURenderer: Unsupported texture format.`,n)}else switch(n){case jr:switch(r){case pt:s=$.RGBA8Snorm;break;case tt:s=$.RGBA16Sint;break;case o:s=$.RGBA16Uint;break;case x:s=$.RGBA32Uint;break;case Re:s=$.RGBA32Sint;break;case g:s=a===`srgb`?$.RGBA8UnormSRGB:$.RGBA8Unorm;break;case _t:s=$.RGBA16Float;break;case Dn:s=$.RGBA32Float;break;default:N(`WebGPURenderer: Unsupported texture type with RGBAFormat.`,r)}break;case O:switch(r){case E:s=$.RGB9E5UFloat;break;case Zr:s=$.RG11B10UFloat;break;default:N(`WebGPURenderer: Unsupported texture type with RGBFormat.`,r)}break;case Me:switch(r){case pt:s=$.R8Snorm;break;case tt:s=$.R16Sint;break;case o:s=$.R16Uint;break;case x:s=$.R32Uint;break;case Re:s=$.R32Sint;break;case g:s=$.R8Unorm;break;case _t:s=$.R16Float;break;case Dn:s=$.R32Float;break;default:N(`WebGPURenderer: Unsupported texture type with RedFormat.`,r)}break;case Ve:switch(r){case pt:s=$.RG8Snorm;break;case tt:s=$.RG16Sint;break;case o:s=$.RG16Uint;break;case x:s=$.RG32Uint;break;case Re:s=$.RG32Sint;break;case g:s=$.RG8Unorm;break;case _t:s=$.RG16Float;break;case Dn:s=$.RG32Float;break;default:N(`WebGPURenderer: Unsupported texture type with RGFormat.`,r)}break;case ye:switch(r){case o:s=$.Depth16Unorm;break;case x:s=$.Depth24Plus;break;case Dn:s=$.Depth32Float;break;default:N(`WebGPURenderer: Unsupported texture type with DepthFormat.`,r)}break;case Lt:switch(r){case mt:s=$.Depth24PlusStencil8;break;case Dn:t&&t.features.has(DH.Depth32FloatStencil8)===!1&&N(`WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.`),s=$.Depth32FloatStencil8;break;default:N(`WebGPURenderer: Unsupported texture type with DepthStencilFormat.`,r)}break;case ot:switch(r){case Re:s=$.R32Sint;break;case x:s=$.R32Uint;break;default:N(`WebGPURenderer: Unsupported texture type with RedIntegerFormat.`,r)}break;case Xe:switch(r){case Re:s=$.RG32Sint;break;case x:s=$.RG32Uint;break;default:N(`WebGPURenderer: Unsupported texture type with RGIntegerFormat.`,r)}break;case Vn:switch(r){case Re:s=$.RGBA32Sint;break;case x:s=$.RGBA32Uint;break;default:N(`WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.`,r)}break;default:N(`WebGPURenderer: Unsupported texture format.`,n)}return s}var RH=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,zH=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/gi,BH={f32:`float`,i32:`int`,u32:`uint`,bool:`bool`,"vec2<f32>":`vec2`,"vec2<i32>":`ivec2`,"vec2<u32>":`uvec2`,"vec2<bool>":`bvec2`,vec2f:`vec2`,vec2i:`ivec2`,vec2u:`uvec2`,vec2b:`bvec2`,"vec3<f32>":`vec3`,"vec3<i32>":`ivec3`,"vec3<u32>":`uvec3`,"vec3<bool>":`bvec3`,vec3f:`vec3`,vec3i:`ivec3`,vec3u:`uvec3`,vec3b:`bvec3`,"vec4<f32>":`vec4`,"vec4<i32>":`ivec4`,"vec4<u32>":`uvec4`,"vec4<bool>":`bvec4`,vec4f:`vec4`,vec4i:`ivec4`,vec4u:`uvec4`,vec4b:`bvec4`,"mat2x2<f32>":`mat2`,mat2x2f:`mat2`,"mat3x3<f32>":`mat3`,mat3x3f:`mat3`,"mat4x4<f32>":`mat4`,mat4x4f:`mat4`,sampler:`sampler`,texture_1d:`texture`,texture_2d:`texture`,texture_2d_array:`texture`,texture_multisampled_2d:`cubeTexture`,texture_depth_2d:`depthTexture`,texture_depth_2d_array:`depthTexture`,texture_depth_multisampled_2d:`depthTexture`,texture_depth_cube:`depthTexture`,texture_depth_cube_array:`depthTexture`,texture_3d:`texture3D`,texture_cube:`cubeTexture`,texture_cube_array:`cubeTexture`,texture_storage_1d:`storageTexture`,texture_storage_2d:`storageTexture`,texture_storage_2d_array:`storageTexture`,texture_storage_3d:`storageTexture`},VH=e=>{e=e.trim();let t=e.match(RH);if(t!==null&&t.length===4){let n=t[2],r=[],i=null;for(;(i=zH.exec(n))!==null;)r.push({name:i[1],type:i[2]});let a=[];for(let e=0;e<r.length;e++){let{name:t,type:n}=r[e],i=n;i.startsWith(`ptr`)?i=`pointer`:(i.startsWith(`texture`)&&(i=n.split(`<`)[0]),i=BH[i]),a.push(new dB(i,t))}let o=e.substring(t[0].length),s=t[3]||`void`,c=t[1]===void 0?``:t[1];return{type:BH[s]||s,inputs:a,name:c,inputsCode:n,blockCode:o,outputType:s}}else throw Error(`FunctionNode: Function is not a WGSL code.`)},HH=class extends TB{constructor(e){let{type:t,inputs:n,name:r,inputsCode:i,blockCode:a,outputType:o}=VH(e);super(t,n,r),this.inputsCode=i,this.blockCode=a,this.outputType=o}getCode(e=this.name){let t=this.outputType===`void`?``:`-> `+this.outputType;return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}},UH=class extends wB{parseFunction(e){return new HH(e)}},WH=typeof self<`u`?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},GH={[My.READ_ONLY]:`read`,[My.WRITE_ONLY]:`write`,[My.READ_WRITE]:`read_write`},KH={[Et]:`repeat`,[Jn]:`clamp`,[ci]:`mirror`},qH={vertex:WH?WH.VERTEX:1,fragment:WH?WH.FRAGMENT:2,compute:WH?WH.COMPUTE:4},JH={instance:!0,swizzleAssign:!1,storageBuffer:!0},YH={"^^":`tsl_xor`},XH={float:`f32`,int:`i32`,uint:`u32`,bool:`bool`,color:`vec3<f32>`,vec2:`vec2<f32>`,ivec2:`vec2<i32>`,uvec2:`vec2<u32>`,bvec2:`vec2<bool>`,vec3:`vec3<f32>`,ivec3:`vec3<i32>`,uvec3:`vec3<u32>`,bvec3:`vec3<bool>`,vec4:`vec4<f32>`,ivec4:`vec4<i32>`,uvec4:`vec4<u32>`,bvec4:`vec4<bool>`,mat2:`mat2x2<f32>`,mat3:`mat3x3<f32>`,mat4:`mat4x4<f32>`},ZH={},QH={tsl_xor:new kF(`fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }`),mod_float:new kF(`fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }`),mod_vec2:new kF(`fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }`),mod_vec3:new kF(`fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }`),mod_vec4:new kF(`fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }`),equals_bool:new kF(`fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }`),equals_bvec2:new kF(`fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }`),equals_bvec3:new kF(`fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }`),equals_bvec4:new kF(`fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }`),repeatWrapping_float:new kF(`fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }`),mirrorWrapping_float:new kF(`fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }`),clampWrapping_float:new kF(`fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }`),biquadraticTexture:new kF(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},$H={dFdx:`dpdx`,dFdy:`- dpdy`,mod_float:`tsl_mod_float`,mod_vec2:`tsl_mod_vec2`,mod_vec3:`tsl_mod_vec3`,mod_vec4:`tsl_mod_vec4`,equals_bool:`tsl_equals_bool`,equals_bvec2:`tsl_equals_bvec2`,equals_bvec3:`tsl_equals_bvec3`,equals_bvec4:`tsl_equals_bvec4`,inversesqrt:`inverseSqrt`,bitcast:`bitcast<f32>`},eU=``;(typeof navigator<`u`&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(eU+=`diagnostic( off, derivative_uniformity );
`);var tU=class extends lB{constructor(e,t){super(e,t,new UH),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,n,r,i,a=this.shaderStage){return a===`fragment`?r?i?`textureSample( ${t}, ${t}_sampler, ${n}, ${r}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:i?`textureSample( ${t}, ${t}_sampler, ${n}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.generateTextureSampleLevel(e,t,n,`0`,r)}generateTextureSampleLevel(e,t,n,r,i,a){return this.isUnfilterable(e)===!1?a?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,a,r):this.generateTextureLod(e,t,n,i,a,r)}generateWrapFunction(e){let t=`tsl_coord_${KH[e.wrapS]}S_${KH[e.wrapT]}_${e.isData3DTexture?`3d`:`2d`}T`,n=ZH[t];if(n===void 0){let r=[],i=e.isData3DTexture?`vec3f`:`vec2f`,a=`fn ${t}( coord : ${i} ) -> ${i} {\n\n\treturn ${i}(\n`,o=(e,t)=>{e===1e3?(r.push(QH.repeatWrapping_float),a+=`\t\ttsl_repeatWrapping_float( coord.${t} )`):e===1001?(r.push(QH.clampWrapping_float),a+=`\t\ttsl_clampWrapping_float( coord.${t} )`):e===1002?(r.push(QH.mirrorWrapping_float),a+=`\t\ttsl_mirrorWrapping_float( coord.${t} )`):(a+=`\t\tcoord.${t}`,P(`WebGPURenderer: Unsupported texture wrap type "${e}" for vertex shader.`))};o(e.wrapS,`x`),a+=`,
`,o(e.wrapT,`y`),e.isData3DTexture&&(a+=`,
`,o(e.wrapR,`z`)),a+=`
	);

}
`,ZH[t]=n=new kF(a,r)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){let r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let i=r.dimensionsSnippet[n];if(r.dimensionsSnippet[n]===void 0){let a,o,{primarySamples:s}=this.renderer.backend.utils.getTextureSampleData(e),c=s>1;o=e.isData3DTexture?`vec3<u32>`:`vec2<u32>`,a=c||e.isStorageTexture?t:`${t}${n?`, u32( ${n} )`:``}`,i=new YC(new Fw(`textureDimensions( ${a} )`,o)),r.dimensionsSnippet[n]=i,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new YC(new Fw(`textureNumLayers(${t})`,`u32`))),e.isTextureCube&&(r.cubeFaceCount=new YC(new Fw(`6u`,`u32`)))}return i.build(this)}generateFilteredTexture(e,t,n,r,i=`0u`){this._include(`biquadraticTexture`);let a=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,i);return r&&(n=`${n} + vec2<f32>(${r}) / ${o}`),`tsl_biquadraticTexture( ${t}, ${a}( ${n} ), ${o}, u32( ${i} ) )`}generateTextureLod(e,t,n,r,i,a=`0u`){let o=this.generateWrapFunction(e),s=this.generateTextureDimension(e,t,a),c=e.isData3DTexture?`vec3`:`vec2`;i&&(n=`${n} + ${c}<f32>(${i}) / ${c}<f32>( ${s} )`);let l=`${c}<u32>( ${o}( ${n} ) * ${c}<f32>( ${s} ) )`;return this.generateTextureLoad(e,t,l,a,r,null)}generateTextureLoad(e,t,n,r,i,a){r===null&&(r=`0u`),a&&(n=`${n} + ${a}`);let o;return i?o=`textureLoad( ${t}, ${n}, ${i}, u32( ${r} ) )`:(o=`textureLoad( ${t}, ${n}, u32( ${r} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(o+=`.x`)),o}generateTextureStore(e,t,n,r,i){let a;return a=r?`textureStore( ${t}, ${n}, ${r}, ${i} )`:`textureStore( ${t}, ${n}, ${i} )`,a}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!==`float`||!this.isAvailable(`float32Filterable`)&&e.isDataTexture===!0&&e.type===1015||this.isSampleCompare(e)===!1&&e.minFilter===1003&&e.magFilter===1003||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,r,i,a=this.shaderStage){let o=null;return o=this.isUnfilterable(e)?this.generateTextureLod(e,t,n,r,i,`0`,a):this._generateTextureSample(e,t,n,r,i,a),o}generateTextureGrad(e,t,n,r,i,a,o=this.shaderStage){if(o===`fragment`)return a?`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]}, ${a} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]} )`;N(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,n,r,i,a,o=this.shaderStage){if(o===`fragment`)return e.isDepthTexture===!0&&e.isArrayTexture===!0?a?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i}, ${r}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i}, ${r} )`:a?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r}, ${a} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r} )`;N(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,n,r,i,a){return this.isUnfilterable(e)===!1?a?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r}, ${a} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,a,r):this.generateTextureLod(e,t,n,i,a,r)}generateTextureBias(e,t,n,r,i,a,o=this.shaderStage){if(o===`fragment`)return a?`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r}, ${a} )`:`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r} )`;N(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t===`vertex`)return`varyings.${e.name}`}else if(e.isNodeUniform===!0){let t=e.name,n=e.type;return n===`texture`||n===`cubeTexture`||n===`storageTexture`||n===`texture3D`?t:n===`buffer`||n===`storageBuffer`||n===`indirectStorageBuffer`?this.isCustomStruct(e)?t:t+`.value`:e.groupNode.name+`.`+t}return super.getPropertyName(e)}getOutputStructName(){return`output`}getFunctionOperator(e){let t=YH[e];return t===void 0?null:(this._include(t),t)}getNodeAccess(e,t){return t===`compute`?e.access:e.isAtomic===!0?(P(`WebGPURenderer: Atomic operations are only supported in compute shaders.`),My.READ_WRITE):My.READ_ONLY}getStorageAccess(e,t){return GH[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,r=null){let i=super.getUniformFromNode(e,t,n,r),a=this.getDataFromNode(e,n,this.globalCache);if(a.uniformGPU===void 0){let o,s=e.groupNode,c=s.name,l=this.getBindGroupArray(c,n);if(t===`texture`||t===`cubeTexture`||t===`storageTexture`||t===`texture3D`){let r=null,a=this.getNodeAccess(e,n);if(t===`texture`||t===`storageTexture`?r=e.value.is3DTexture===!0?new OV(i.name,i.node,s,a):new EV(i.name,i.node,s,a):t===`cubeTexture`?r=new DV(i.name,i.node,s,a):t===`texture3D`&&(r=new OV(i.name,i.node,s,a)),r.store=e.isStorageTextureNode===!0,r.mipLevel=r.store?e.mipLevel:0,r.setVisibility(qH[n]),this.isUnfilterable(e.value)===!1&&r.store===!1){let e=new kH(`${i.name}_sampler`,i.node,s);e.setVisibility(qH[n]),l.push(e,r),o=[e,r]}else l.push(r),o=[r]}else if(t===`buffer`||t===`storageBuffer`||t===`indirectStorageBuffer`){let a=new(t===`buffer`?_V:MH)(e,s);a.setVisibility(qH[n]),l.push(a),o=a,i.name=r||`NodeBuffer_`+i.id}else{let e=this.uniformGroups[n]||(this.uniformGroups[n]={}),r=e[c];r===void 0&&(r=new SV(c,s),r.setVisibility(qH[n]),e[c]=r,l.push(r)),o=this.getNodeUniform(i,t),r.addUniform(o)}a.uniformGPU=o}return i}getBuiltin(e,t,n,r=this.shaderStage){let i=this.builtins[r]||(this.builtins[r]=new Map);return i.has(e)===!1&&i.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage===`vertex`?this.getBuiltin(`vertex_index`,`vertexIndex`,`u32`,`attribute`):`vertexIndex`}buildFunctionCode(e){let t=e.layout,n=this.flowShaderNode(e),r=[];for(let e of t.inputs)r.push(e.name+` : `+this.getType(e.type));let i=`fn ${t.name}( ${r.join(`, `)} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(i+=`\treturn ${n.result};\n`),i+=`
}
`,i}getInstanceIndex(){return this.shaderStage===`vertex`?this.getBuiltin(`instance_index`,`instanceIndex`,`u32`,`attribute`):`instanceIndex`}getInvocationLocalIndex(){return this.getBuiltin(`local_invocation_index`,`invocationLocalIndex`,`u32`,`attribute`)}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin(`subgroup_size`,`subgroupSize`,`u32`,`attribute`)}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin(`subgroup_invocation_id`,`invocationSubgroupIndex`,`u32`,`attribute`)}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin(`subgroup_id`,`subgroupIndex`,`u32`,`attribute`)}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin(`front_facing`,`isFront`,`bool`)}getFragCoord(){return this.getBuiltin(`position`,`fragCoord`,`vec4<f32>`)+`.xy`}getFragDepth(){return`output.`+this.getBuiltin(`frag_depth`,`depth`,`f32`,`output`)}getClipDistance(){return`varyings.hw_clip_distances`}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){let t=[],n=this.directives[e];if(n!==void 0)for(let e of n)t.push(`enable ${e};`);return t.join(`
`)}enableSubGroups(){this.enableDirective(`subgroups`)}enableSubgroupsF16(){this.enableDirective(`subgroups-f16`)}enableClipDistances(){this.enableDirective(`clip_distances`)}enableShaderF16(){this.enableDirective(`f16`)}enableDualSourceBlending(){this.enableDirective(`dual_source_blending`)}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin(`clip_distances`,`hw_clip_distances`,`array<f32, ${e} >`,`vertex`)}getBuiltins(e){let t=[],n=this.builtins[e];if(n!==void 0)for(let{name:e,property:r,type:i}of n.values())t.push(`@builtin( ${e} ) ${r} : ${i}`);return t.join(`,
	`)}getScopedArray(e,t,n,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if(e!==`compute`)return;let t=[];for(let{name:e,scope:n,bufferType:r,bufferCount:i}of this.scopedArrays.values()){let a=this.getType(r);t.push(`var<${n}> ${e}: array< ${a}, ${i} >;`)}return t.join(`
`)}getAttributes(e){let t=[];if(e===`compute`&&(this.getBuiltin(`global_invocation_id`,`globalId`,`vec3<u32>`,`attribute`),this.getBuiltin(`workgroup_id`,`workgroupId`,`vec3<u32>`,`attribute`),this.getBuiltin(`local_invocation_id`,`localId`,`vec3<u32>`,`attribute`),this.getBuiltin(`num_workgroups`,`numWorkgroups`,`vec3<u32>`,`attribute`),this.renderer.hasFeature(`subgroups`)&&(this.enableDirective(`subgroups`,e),this.getBuiltin(`subgroup_size`,`subgroupSize`,`u32`,`attribute`))),e===`vertex`||e===`compute`){let e=this.getBuiltins(`attribute`);e&&t.push(e);let n=this.getAttributesArray();for(let e=0,r=n.length;e<r;e++){let r=n[e],i=r.name,a=this.getType(r.type);t.push(`@location( ${e} ) ${i} : ${a}`)}}return t.join(`,
	`)}getStructMembers(e){let t=[];for(let n of e.members){let r=e.output?`@location( `+n.index+` ) `:``,i=this.getType(n.type);n.atomic&&(i=`atomic< `+i+` >`),t.push(`\t${r+n.name} : ${i}`)}return e.output&&t.push(`\t${this.getBuiltins(`output`)}`),t.join(`,
`)}getStructs(e){let t=``,n=this.structs[e];if(n.length>0){let e=[];for(let t of n){let n=`struct ${t.name} {\n`;n+=this.getStructMembers(t),n+=`
};`,e.push(n)}t=`
`+e.join(`

`)+`
`}return t}getVar(e,t,n=null){let r=`var ${t} : `;return n===null?r+=this.getType(e):r+=this.generateArrayDeclaration(e,n),r}getVars(e){let t=[],n=this.vars[e];if(n!==void 0)for(let e of n)t.push(`\t${this.getVar(e.type,e.name,e.count)};`);return`\n${t.join(`
`)}\n`}getVaryings(e){let t=[];if(e===`vertex`&&this.getBuiltin(`position`,`Vertex`,`vec4<f32>`,`vertex`),e===`vertex`||e===`fragment`){let n=this.varyings,r=this.vars[e];for(let i=0;i<n.length;i++){let a=n[i];if(a.needsInterpolation){let e=`@location( ${i} )`;if(a.interpolationType){let t=a.interpolationSampling===null?` )`:`, ${a.interpolationSampling} )`;e+=` @interpolate( ${a.interpolationType}${t}`}else /^(int|uint|ivec|uvec)/.test(a.type)&&(e+=` @interpolate( ${this.renderer.backend.compatibilityMode?`flat, either`:`flat`} )`);t.push(`${e} ${a.name} : ${this.getType(a.type)}`)}else e===`vertex`&&r.includes(a)===!1&&r.push(a)}}let n=this.getBuiltins(e);n&&t.push(n);let r=t.join(`,
	`);return e===`vertex`?this._getWGSLStruct(`VaryingsStruct`,`	`+r):r}isCustomStruct(e){let t=e.value,n=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&n.structTypeNode!==null,i=n.value&&n.value.array&&typeof n.value.itemSize==`number`&&n.value.array.length>n.value.itemSize;return r&&!i}getUniforms(e){let t=this.uniforms[e],n=[],r=[],i=[],a={};for(let i of t){let t=i.groupNode.name,o=this.bindingsIndexes[t];if(i.type===`texture`||i.type===`cubeTexture`||i.type===`storageTexture`||i.type===`texture3D`){let t=i.node.value;this.isUnfilterable(t)===!1&&i.node.isStorageTextureNode!==!0&&(this.isSampleCompare(t)?n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${i.name}_sampler : sampler_comparison;`):n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${i.name}_sampler : sampler;`));let r,a=``,{primarySamples:s}=this.renderer.backend.utils.getTextureSampleData(t);if(s>1&&(a=`_multisampled`),t.isCubeTexture===!0)r=`texture_cube<f32>`;else if(t.isDepthTexture===!0)r=this.renderer.backend.compatibilityMode&&t.compareFunction===null?`texture${a}_2d<f32>`:`texture_depth${a}_2d${t.isArrayTexture===!0?`_array`:``}`;else if(i.node.isStorageTextureNode===!0){let n=LH(t),a=this.getStorageAccess(i.node,e),o=i.node.value.is3DTexture,s=i.node.value.isArrayTexture;r=`texture_storage_${o?`3d`:`2d${s?`_array`:``}`}<${n}, ${a}>`}else if(t.isArrayTexture===!0||t.isDataArrayTexture===!0||t.isCompressedArrayTexture===!0)r=`texture_2d_array<f32>`;else if(t.is3DTexture===!0||t.isData3DTexture===!0)r=`texture_3d<f32>`;else{let e=this.getComponentTypeFromTexture(t).charAt(0);r=`texture${a}_2d<${e}32>`}n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${i.name} : ${r};`)}else if(i.type===`buffer`||i.type===`storageBuffer`||i.type===`indirectStorageBuffer`){let t=i.node,n=this.getType(t.getNodeType(this)),a=t.bufferCount,s=a>0&&i.type===`buffer`?`, `+a:``,c=t.isStorageBufferNode?`storage, ${this.getStorageAccess(t,e)}`:`uniform`;if(this.isCustomStruct(i))r.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var<${c}> ${i.name} : ${n};`);else{let e=`\tvalue : array< ${t.isAtomic?`atomic<${n}>`:`${n}`}${s} >`;r.push(this._getWGSLStructBinding(i.name,e,c,o.binding++,o.group))}}else{let e=this.getType(this.getVectorType(i.type)),t=i.groupNode.name;(a[t]||(a[t]={index:o.binding++,id:o.group,snippets:[]})).snippets.push(`\t${i.name} : ${e}`)}}for(let e in a){let t=a[e];i.push(this._getWGSLStructBinding(e,t.snippets.join(`,
`),`uniform`,t.index,t.id))}let o=n.join(`
`);return o+=r.join(`
`),o+=i.join(`
`),o}buildCode(){let e=this.material===null?{compute:{}}:{fragment:{},vertex:{}};for(let t in this.sortBindingGroups(),e){this.shaderStage=t;let n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];let i=this.flowNodes[t],a=i[i.length-1],o=a.outputNode,s=o!==void 0&&o.isOutputStructNode===!0;for(let e of i){let i=this.getFlowData(e),c=e.name;if(c&&(r.length>0&&(r+=`
`),r+=`\t// flow -> ${c}\n`),r+=`${i.code}\n\t`,e===a&&t!==`compute`){if(r+=`// result

	`,t===`vertex`)r+=`varyings.Vertex = ${i.result};`;else if(t===`fragment`)if(s)n.returnType=o.getNodeType(this),n.structs+=`var<private> output : `+n.returnType+`;`,r+=`return ${i.result};`;else{let e=`	@location(0) color: vec4<f32>`,t=this.getBuiltins(`output`);t&&(e+=`,
	`+t),n.returnType=`OutputStruct`,n.structs+=this._getWGSLStruct(`OutputStruct`,e),n.structs+=`
var<private> output : OutputStruct;`,r+=`output.color = ${i.result};\n\n\treturn output;`}}}n.flow=r}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{let t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+`_`+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getTernary(e,t,n){return`select( ${n}, ${t}, ${e} )`}getType(e){return XH[e]||e}isAvailable(e){let t=JH[e];return t===void 0&&(e===`float32Filterable`?t=this.renderer.hasFeature(`float32-filterable`):e===`clipDistance`&&(t=this.renderer.hasFeature(`clip-distances`)),JH[e]=t),t}_getWGSLMethod(e){return QH[e]!==void 0&&this._include(e),$H[e]}_include(e){let t=QH[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${eU}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){let[n,r,i]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${n}, ${r}, ${i} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${n} * numWorkgroups.x )
		+ globalId.z * ( ${n} * numWorkgroups.x ) * ( ${r} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,r=0,i=0){let a=e+`Struct`;return`${this._getWGSLStruct(a,t)}
@binding( ${r} ) @group( ${i} )
var<${n}> ${e} : ${a};`}},nU=class{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture===null?e.depth&&e.stencil?t=$.Depth24PlusStencil8:e.depth&&(t=$.Depth24Plus):t=this.getTextureFormatGPU(e.depthTexture),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){let e=this.backend.renderer,n=e.getRenderTarget();t=n?n.samples:e.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t||=1;let n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return t=e.textures===null?this.getPreferredCanvasFormat():this.getTextureFormatGPU(e.textures[0]),t}getCurrentColorFormats(e){return e.textures===null?[this.getPreferredCanvasFormat()]:e.textures.map(e=>this.getTextureFormatGPU(e))}getCurrentColorSpace(e){return e.textures===null?this.backend.renderer.outputColorSpace:e.textures[0].colorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return oH.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return oH.LineList;if(e.isLine)return oH.LineStrip;if(e.isMesh)return oH.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures===null?this.getSampleCount(this.backend.renderer.currentSamples):this.getSampleCount(e.sampleCount)}getPreferredCanvasFormat(){let e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===1009)return $.BGRA8Unorm;if(e===1016)return $.RGBA16Float;throw Error(`Unsupported outputType`)}},rU=new Map([[Int8Array,[`sint8`,`snorm8`]],[Uint8Array,[`uint8`,`unorm8`]],[Int16Array,[`sint16`,`snorm16`]],[Uint16Array,[`uint16`,`unorm16`]],[Int32Array,[`sint32`,`snorm32`]],[Uint32Array,[`uint32`,`unorm32`]],[Float32Array,[`float32`]]]);typeof Float16Array<`u`&&rU.set(Float16Array,[`float16`]);var iU=new Map([[I,[`float16`]]]),aU=new Map([[Int32Array,`sint32`],[Int16Array,`sint32`],[Uint32Array,`uint32`],[Uint16Array,`uint32`],[Float32Array,`float32`]]),oU=class{constructor(e){this.backend=e}createAttribute(e,t){let n=this._getBufferAttribute(e),r=this.backend,i=r.get(n),a=i.buffer;if(a===void 0){let o=r.device,s=n.array;if(e.normalized===!1){if(s.constructor===Int16Array||s.constructor===Int8Array)s=new Int32Array(s);else if((s.constructor===Uint16Array||s.constructor===Uint8Array)&&(s=new Uint32Array(s),t&GPUBufferUsage.INDEX))for(let e=0;e<s.length;e++)s[e]===65535&&(s[e]=4294967295)}if(n.array=s,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){s=new s.constructor(n.count*4);for(let e=0;e<n.count;e++)s.set(n.array.subarray(e*3,e*3+3),e*4);n.itemSize=4,n.array=s,i._force3to4BytesAlignment=!0}let c=s.byteLength,l=c+(4-c%4)%4;a=o.createBuffer({label:n.name,size:l,usage:t,mappedAtCreation:!0}),new s.constructor(a.getMappedRange()).set(s),a.unmap(),i.buffer=a}}updateAttribute(e){let t=this._getBufferAttribute(e),n=this.backend,r=n.device,i=n.get(t),a=n.get(t).buffer,o=t.array;if(i._force3to4BytesAlignment===!0){o=new o.constructor(t.count*4);for(let e=0;e<t.count;e++)o.set(t.array.subarray(e*3,e*3+3),e*4);t.array=o}let s=this._isTypedArray(o),c=t.updateRanges;if(c.length===0)r.queue.writeBuffer(a,0,o,0);else{let e=s?1:o.BYTES_PER_ELEMENT;for(let t=0,n=c.length;t<n;t++){let n=c[t],l,u;if(i._force3to4BytesAlignment===!0){let t=Math.floor(n.start/3),r=Math.ceil(n.count/3);l=t*4*e,u=r*4*e}else l=n.start*e,u=n.count*e;let d=l*(s?o.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(a,d,o,l,u)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){let t=e.getAttributes(),n=new Map;for(let e=0;e<t.length;e++){let r=t[e],i=r.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(r),o=n.get(a);if(o===void 0){let e,t;r.isInterleavedBufferAttribute===!0?(e=r.data.stride*i,t=r.data.isInstancedInterleavedBuffer?EH.Instance:EH.Vertex):(e=r.itemSize*i,t=r.isInstancedBufferAttribute?EH.Instance:EH.Vertex),r.normalized===!1&&(r.array.constructor===Int16Array||r.array.constructor===Uint16Array)&&(e=4),o={arrayStride:e,attributes:[],stepMode:t},n.set(a,o)}let s=this._getVertexFormat(r),c=r.isInterleavedBufferAttribute===!0?r.offset*i:0;o.attributes.push({shaderLocation:e,offset:c,format:s})}return Array.from(n.values())}destroyAttribute(e){let t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){let t=this.backend,n=t.device,r=t.get(this._getBufferAttribute(e)).buffer,i=r.size,a=n.createBuffer({label:`${e.name}_readback`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o=n.createCommandEncoder({label:`readback_encoder_${e.name}`});o.copyBufferToBuffer(r,0,a,0,i);let s=o.finish();n.queue.submit([s]),await a.mapAsync(GPUMapMode.READ);let c=a.getMappedRange(),l=new e.array.constructor(c.slice(0));return a.unmap(),l.buffer}_getVertexFormat(e){let{itemSize:t,normalized:n}=e,r=e.array.constructor,i=e.constructor,a;if(t===1)a=aU.get(r);else{let e=(iU.get(i)||rU.get(r))[n?1:0];if(e){let n=r.BYTES_PER_ELEMENT*t,i=Math.floor((n+3)/4)*4/r.BYTES_PER_ELEMENT;if(i%1)throw Error(`THREE.WebGPUAttributeUtils: Bad vertex format item size.`);a=`${e}x${i}`}}return a||N(`WebGPUAttributeUtils: Vertex format not supported yet.`),a}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}},sU=class{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){let t=this.backend,n=t.device,r=[],i=0;for(let n of e.bindings){let e={binding:i++,visibility:n.visibility};if(n.isUniformBuffer||n.isStorageBuffer){let t={};n.isStorageBuffer&&(n.visibility&4&&(n.access===My.READ_WRITE||n.access===My.WRITE_ONLY)?t.type=yH.Storage:t.type=yH.ReadOnlyStorage),e.buffer=t}else if(n.isSampledTexture&&n.store){let t={};t.format=this.backend.get(n.texture).texture.format;let r=n.access;r===My.READ_WRITE?t.access=bH.ReadWrite:r===My.WRITE_ONLY?t.access=bH.WriteOnly:t.access=bH.ReadOnly,n.texture.isArrayTexture?t.viewDimension=wH.TwoDArray:n.texture.is3DTexture&&(t.viewDimension=wH.ThreeD),e.storageTexture=t}else if(n.isSampledTexture){let r={},{primarySamples:i}=t.utils.getTextureSampleData(n.texture);if(i>1&&(r.multisampled=!0,n.texture.isDepthTexture||(r.sampleType=SH.UnfilterableFloat)),n.texture.isDepthTexture)t.compatibilityMode&&n.texture.compareFunction===null?r.sampleType=SH.UnfilterableFloat:r.sampleType=SH.Depth;else if(n.texture.isDataTexture||n.texture.isDataArrayTexture||n.texture.isData3DTexture){let e=n.texture.type;e===1013?r.sampleType=SH.SInt:e===1014?r.sampleType=SH.UInt:e===1015&&(this.backend.hasFeature(`float32-filterable`)?r.sampleType=SH.Float:r.sampleType=SH.UnfilterableFloat)}n.isSampledCubeTexture?r.viewDimension=wH.Cube:n.texture.isArrayTexture||n.texture.isDataArrayTexture||n.texture.isCompressedArrayTexture?r.viewDimension=wH.TwoDArray:n.isSampledTexture3D&&(r.viewDimension=wH.ThreeD),e.texture=r}else if(n.isSampler){let r={};n.texture.isDepthTexture&&(n.texture.compareFunction===null?t.compatibilityMode&&(r.type=xH.NonFiltering):r.type=xH.Comparison),e.sampler=r}else N(`WebGPUBindingUtils: Unsupported binding "${n}".`);r.push(e)}return n.createBindGroupLayout({entries:r})}createBindings(e,t,n,r=0){let{backend:i,bindGroupLayoutCache:a}=this,o=i.get(e),s=a.get(e.bindingsReference);s===void 0&&(s=this.createBindingsLayout(e),a.set(e.bindingsReference,s));let c;n>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[n]===r&&(c=o.groups[n])),c===void 0&&(c=this.createBindGroup(e,s),n>0&&(o.groups[n]=c,o.versions[n]=r)),o.group=c,o.layout=s}updateBinding(e){let t=this.backend,n=t.device,r=e.buffer,i=t.get(e).buffer;n.queue.writeBuffer(i,0,r,0)}createBindGroupIndex(e,t){let n=this.backend.device,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i=e[0],a=n.createBuffer({label:`bindingCameraIndex_`+i,size:16,usage:r});n.queue.writeBuffer(a,0,e,0);let o=[{binding:0,resource:{buffer:a}}];return n.createBindGroup({label:`bindGroupCameraIndex_`+i,layout:t,entries:o})}createBindGroup(e,t){let n=this.backend,r=n.device,i=0,a=[];for(let t of e.bindings){if(t.isUniformBuffer){let e=n.get(t);if(e.buffer===void 0){let n=t.byteLength,i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST;e.buffer=r.createBuffer({label:`bindingBuffer_`+t.name,size:n,usage:i})}a.push({binding:i,resource:{buffer:e.buffer}})}else if(t.isStorageBuffer){let e=n.get(t);if(e.buffer===void 0){let r=t.attribute;e.buffer=n.get(r).buffer}a.push({binding:i,resource:{buffer:e.buffer}})}else if(t.isSampledTexture){let e=n.get(t.texture),o;if(e.externalTexture!==void 0)o=r.importExternalTexture({source:e.externalTexture});else{let n=t.store?1:e.texture.mipLevelCount,r=t.store?t.mipLevel:0,i=`view-${e.texture.width}-${e.texture.height}`;if(e.texture.depthOrArrayLayers>1&&(i+=`-${e.texture.depthOrArrayLayers}`),i+=`-${n}-${r}`,o=e[i],o===void 0){let a=TH.All,s;s=t.isSampledCubeTexture?wH.Cube:t.isSampledTexture3D?wH.ThreeD:t.texture.isArrayTexture||t.texture.isDataArrayTexture||t.texture.isCompressedArrayTexture?wH.TwoDArray:wH.TwoD,o=e[i]=e.texture.createView({aspect:a,dimension:s,mipLevelCount:n,baseMipLevel:r})}}a.push({binding:i,resource:o})}else if(t.isSampler){let e=n.get(t.texture);a.push({binding:i,resource:e.sampler})}i++}return r.createBindGroup({label:`bindGroup_`+e.name,layout:t,entries:a})}},cU=class{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){let{object:n,material:r,geometry:i,pipeline:a}=e,{vertexProgram:o,fragmentProgram:s}=a,c=this.backend,l=c.device,u=c.utils,d=c.get(a),f=[];for(let t of e.getBindings()){let e=c.get(t);f.push(e.layout)}let p=c.attributeUtils.createShaderVertexBuffers(e),m;r.blending!==0&&(r.blending!==1||r.transparent!==!1)&&(m=this._getBlending(r));let h={};r.stencilWrite===!0&&(h={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});let g=this._getColorWriteMask(r),_=[];if(e.context.textures!==null){let t=e.context.textures;for(let e=0;e<t.length;e++){let n=u.getTextureFormatGPU(t[e]);_.push({format:n,blend:m,writeMask:g})}}else{let t=u.getCurrentColorFormat(e.context);_.push({format:t,blend:m,writeMask:g})}let v=c.get(o).module,y=c.get(s).module,b=this._getPrimitiveState(n,i,r),x=this._getDepthCompare(r),S=u.getCurrentDepthStencilFormat(e.context),C=this._getSampleCount(e.context),w={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},v,{buffers:p}),fragment:Object.assign({},y,{targets:_}),primitive:b,multisample:{count:C,alphaToCoverageEnabled:r.alphaToCoverage&&C>1},layout:l.createPipelineLayout({bindGroupLayouts:f})},T={},E=e.context.depth,D=e.context.stencil;if((E===!0||D===!0)&&(E===!0&&(T.format=S,T.depthWriteEnabled=r.depthWrite,T.depthCompare=x),D===!0&&(T.stencilFront=h,T.stencilBack={},T.stencilReadMask=r.stencilFuncMask,T.stencilWriteMask=r.stencilWriteMask),r.polygonOffset===!0&&(T.depthBias=r.polygonOffsetUnits,T.depthBiasSlopeScale=r.polygonOffsetFactor,T.depthBiasClamp=0),w.depthStencil=T),l.pushErrorScope(`validation`),t===null)d.pipeline=l.createRenderPipeline(w),l.popErrorScope().then(e=>{e!==null&&(d.error=!0,N(e.message))});else{let e=new Promise(async e=>{try{d.pipeline=await l.createRenderPipelineAsync(w)}catch{}let t=await l.popErrorScope();t!==null&&(d.error=!0,N(t.message)),e()});t.push(e)}}createBundleEncoder(e,t=`renderBundleEncoder`){let{utils:n,device:r}=this.backend,i=n.getCurrentDepthStencilFormat(e),a={label:t,colorFormats:n.getCurrentColorFormats(e),depthStencilFormat:i,sampleCount:this._getSampleCount(e)};return r.createRenderBundleEncoder(a)}createComputePipeline(e,t){let n=this.backend,r=n.device,i=n.get(e.computeProgram).module,a=n.get(e),o=[];for(let e of t){let t=n.get(e);o.push(t.layout)}a.pipeline=r.createComputePipeline({compute:i,layout:r.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(e){let t,n,r=e.blending,i=e.blendSrc,a=e.blendDst,o=e.blendEquation;if(r===5){let r=e.blendSrcAlpha===null?i:e.blendSrcAlpha,s=e.blendDstAlpha===null?a:e.blendDstAlpha,c=e.blendEquationAlpha===null?o:e.blendEquationAlpha;t={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(o)},n={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(s),operation:this._getBlendOperation(c)}}else{let i=e.premultipliedAlpha,a=(e,r,i,a)=>{t={srcFactor:e,dstFactor:r,operation:gH.Add},n={srcFactor:i,dstFactor:a,operation:gH.Add}};if(i)switch(r){case 1:a(hH.One,hH.OneMinusSrcAlpha,hH.One,hH.OneMinusSrcAlpha);break;case 2:a(hH.One,hH.One,hH.One,hH.One);break;case 3:a(hH.Zero,hH.OneMinusSrc,hH.Zero,hH.One);break;case 4:a(hH.Dst,hH.OneMinusSrcAlpha,hH.Zero,hH.One);break}else switch(r){case 1:a(hH.SrcAlpha,hH.OneMinusSrcAlpha,hH.One,hH.OneMinusSrcAlpha);break;case 2:a(hH.SrcAlpha,hH.One,hH.One,hH.One);break;case 3:N(`WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true`);break;case 4:N(`WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true`);break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};N(`WebGPURenderer: Invalid blending: `,r)}_getBlendFactor(e){let t;switch(e){case 200:t=hH.Zero;break;case 201:t=hH.One;break;case 202:t=hH.Src;break;case 203:t=hH.OneMinusSrc;break;case 204:t=hH.SrcAlpha;break;case 205:t=hH.OneMinusSrcAlpha;break;case 208:t=hH.Dst;break;case 209:t=hH.OneMinusDst;break;case 206:t=hH.DstAlpha;break;case 207:t=hH.OneMinusDstAlpha;break;case 210:t=hH.SrcAlphaSaturated;break;case IM:t=hH.Constant;break;case LM:t=hH.OneMinusConstant;break;default:N(`WebGPURenderer: Blend factor not supported.`,e)}return t}_getStencilCompare(e){let t,n=e.stencilFunc;switch(n){case 512:t=sH.Never;break;case 519:t=sH.Always;break;case 513:t=sH.Less;break;case 515:t=sH.LessEqual;break;case 514:t=sH.Equal;break;case 518:t=sH.GreaterEqual;break;case 516:t=sH.Greater;break;case 517:t=sH.NotEqual;break;default:N(`WebGPURenderer: Invalid stencil function.`,n)}return t}_getStencilOperation(e){let t;switch(e){case ve:t=vH.Keep;break;case 0:t=vH.Zero;break;case fe:t=vH.Replace;break;case re:t=vH.Invert;break;case w:t=vH.IncrementClamp;break;case we:t=vH.DecrementClamp;break;case M:t=vH.IncrementWrap;break;case wr:t=vH.DecrementWrap;break;default:N(`WebGPURenderer: Invalid stencil operation.`,t)}return t}_getBlendOperation(e){let t;switch(e){case 100:t=gH.Add;break;case 101:t=gH.Subtract;break;case 102:t=gH.ReverseSubtract;break;case 103:t=gH.Min;break;case 104:t=gH.Max;break;default:N(`WebGPUPipelineUtils: Blend equation not supported.`,e)}return t}_getPrimitiveState(e,t,n){let r={};r.topology=this.backend.utils.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?fH.Uint16:fH.Uint32);let i=n.side===1;return e.isMesh&&e.matrixWorld.determinant()<0&&(i=!i),r.frontFace=i===!0?uH.CW:uH.CCW,r.cullMode=n.side===2?dH.None:dH.Back,r}_getColorWriteMask(e){return e.colorWrite===!0?_H.All:_H.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=sH.Always;else{let n=e.depthFunc;switch(n){case 0:t=sH.Never;break;case 1:t=sH.Always;break;case 2:t=sH.Less;break;case 3:t=sH.LessEqual;break;case 4:t=sH.Equal;break;case 5:t=sH.GreaterEqual;break;case 6:t=sH.Greater;break;case 7:t=sH.NotEqual;break;default:N(`WebGPUPipelineUtils: Invalid depth function.`,n)}}return t}},lU=class extends rH{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:`timestamp`,count:this.maxQueries,label:`queryset_global_timestamp_${t}`});let r=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return be(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;let t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!==`unmapped`)return this.lastValue;let e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();let r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);let i=r.finish();if(this.device.queue.submit([i]),this.resultBuffer.mapState!==`unmapped`)return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState===`mapped`&&this.resultBuffer.unmap(),this.lastValue;let a=new BigUint64Array(this.resultBuffer.getMappedRange(0,n)),o={},s=[];for(let[t,n]of e){let e=t.match(/^(.*):f(\d+)$/),r=parseInt(e[2]);s.includes(r)===!1&&s.push(r),o[r]===void 0&&(o[r]=0);let i=a[n],c=a[n+1],l=Number(c-i)/1e6;this.timestamps.set(t,l),o[r]+=l}let c=o[s[s.length-1]];return this.resultBuffer.unmap(),this.lastValue=c,this.frames=s,c}catch(e){return e(`Error resolving queries:`,e),this.resultBuffer.mapState===`mapped`&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){e(`Error waiting for pending resolve:`,e)}if(this.resultBuffer&&this.resultBuffer.mapState===`mapped`)try{this.resultBuffer.unmap()}catch(e){e(`Error unmapping buffer:`,e)}this.querySet&&=(this.querySet.destroy(),null),this.resolveBuffer&&=(this.resolveBuffer.destroy(),null),this.resultBuffer&&=(this.resultBuffer.destroy(),null),this.queryOffsets.clear(),this.pendingResolve=null}}},uU=class extends zV{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new nU(this),this.attributeUtils=new oU(this),this.bindingUtils=new sU(this),this.pipelineUtils=new cU(this),this.textureUtils=new IH(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);let t=this.parameters,n;if(t.device===void 0){let e={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?`compatibility`:void 0},r=typeof navigator<`u`?await navigator.gpu.requestAdapter(e):null;if(r===null)throw Error(`WebGPUBackend: Unable to create WebGPU adapter.`);let i=Object.values(DH),a=[];for(let e of i)r.features.has(e)&&a.push(e);let o={requiredFeatures:a,requiredLimits:t.requiredLimits};n=await r.requestDevice(o)}else n=t.device;n.lost.then(t=>{let n={api:`WebGPU`,message:t.message||`Unknown reason`,reason:t.reason||null,originalEvent:t};e.onDeviceLost(n)}),this.device=n,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(DH.TimestampQuery),this.updateSize()}get context(){let e=this.renderer.getCanvasTarget(),t=this.get(e),n=t.context;if(n===void 0){let r=this.parameters;n=e.isDefaultCanvasTarget===!0&&r.context!==void 0?r.context:e.domElement.getContext(`webgpu`),`setAttribute`in e.domElement&&e.domElement.setAttribute(`data-engine`,`three.js r181 webgpu`);let i=r.alpha?`premultiplied`:`opaque`,a=r.outputType===1016?`extended`:`standard`;n.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i,toneMapping:{mode:a}}),t.context=n}return n}get coordinateSystem(){return Ae}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.renderer,t=e.getCanvasTarget(),n=this.get(t),r=e.currentSamples,i=n.descriptor;if(i===void 0||n.samples!==r){i={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(i.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});let t=i.colorAttachments[0];r>0?t.view=this.textureUtils.getColorBuffer().createView():t.resolveTarget=void 0,n.descriptor=i,n.samples=r}let a=i.colorAttachments[0];return r>0?a.resolveTarget=this.context.getCurrentTexture().createView():a.view=this.context.getCurrentTexture().createView(),i}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){let n=e.renderTarget,r=this.get(n),i=r.descriptors;(i===void 0||r.width!==n.width||r.height!==n.height||r.samples!==n.samples)&&(i={},r.descriptors=i);let a=e.getCacheKey(),o=i[a];if(o===void 0){let t=e.textures,s=[],c,l=this._isRenderCameraDepthArray(e);for(let r=0;r<t.length;r++){let i=this.get(t[r]),a={label:`colorAttachment_${r}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:wH.TwoD};if(n.isRenderTarget3D)c=e.activeCubeFace,a.baseArrayLayer=0,a.dimension=wH.ThreeD,a.depthOrArrayLayers=t[r].image.depth;else if(n.isRenderTarget&&t[r].image.depth>1)if(l===!0){let t=e.camera.cameras;for(let e=0;e<t.length;e++){let t={...a,baseArrayLayer:e,arrayLayerCount:1,dimension:wH.TwoD},n=i.texture.createView(t);s.push({view:n,resolveTarget:void 0,depthSlice:void 0})}}else a.dimension=wH.TwoDArray,a.depthOrArrayLayers=t[r].image.depth;if(l!==!0){let e=i.texture.createView(a),t,n;i.msaaTexture===void 0?(t=e,n=void 0):(t=i.msaaTexture.createView(),n=e),s.push({view:t,resolveTarget:n,depthSlice:c})}}if(o={textureViews:s},e.depth){let t=this.get(e.depthTexture),n={};e.depthTexture.isArrayTexture&&(n.dimension=wH.TwoD,n.arrayLayerCount=1,n.baseArrayLayer=e.activeCubeFace),o.depthStencilView=t.texture.createView(n)}i[a]=o,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace}let s={colorAttachments:[]};for(let e=0;e<o.textureViews.length;e++){let n=o.textureViews[e],r={r:0,g:0,b:0,a:1};e===0&&t.clearValue&&(r=t.clearValue),s.colorAttachments.push({view:n.view,depthSlice:n.depthSlice,resolveTarget:n.resolveTarget,loadOp:t.loadOp||lH.Load,storeOp:t.storeOp||cH.Store,clearValue:r})}return o.depthStencilView&&(s.depthStencilAttachment={view:o.depthStencilView}),s}beginRender(e){let t=this.get(e),n=this.device,r=e.occlusionQueryCount,i;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,i=n.createQuerySet({type:`occlusion`,count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=i,t.occlusionQueryIndex=0,t.occlusionQueryObjects=Array(r),t.lastOcclusionObject=null);let a;a=e.textures===null?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(e,{loadOp:lH.Load}),this.initTimestampQuery(ar.RENDER,this.getTimestampUID(e),a),a.occlusionQuerySet=i;let o=a.depthStencilAttachment;if(e.textures!==null){let t=a.colorAttachments;for(let n=0;n<t.length;n++){let r=t[n];e.clearColor?(r.clearValue=n===0?e.clearColorValue:{r:0,g:0,b:0,a:1},r.loadOp=lH.Clear):r.loadOp=lH.Load,r.storeOp=cH.Store}}else{let t=a.colorAttachments[0];e.clearColor?(t.clearValue=e.clearColorValue,t.loadOp=lH.Clear):t.loadOp=lH.Load,t.storeOp=cH.Store}e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=lH.Clear):o.depthLoadOp=lH.Load,o.depthStoreOp=cH.Store),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=lH.Clear):o.stencilLoadOp=lH.Load,o.stencilStoreOp=cH.Store);let s=n.createCommandEncoder({label:`renderContext_`+e.id});if(this._isRenderCameraDepthArray(e)===!0){let n=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==n.length?this._createDepthLayerDescriptors(e,t,a,n):this._updateDepthLayerDescriptors(e,t,n),t.bundleEncoders=[],t.bundleSets=[];for(let r=0;r<n.length;r++){let n=this.pipelineUtils.createBundleEncoder(e,`renderBundleArrayCamera_`+r);t.bundleEncoders.push(n),t.bundleSets.push({attributes:{},bindingGroups:[],pipeline:null,index:null})}t.currentPass=null}else t.currentPass=s.beginRenderPass(a),e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e);t.descriptor=a,t.encoder=s,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,r){let i=n.depthStencilAttachment;t.layerDescriptors=[];let a=this.get(e.depthTexture);a.viewCache||=[];for(let o=0;o<r.length;o++){let r={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[o].view}]};if(n.depthStencilAttachment){let t=o;a.viewCache[t]||(a.viewCache[t]=a.texture.createView({dimension:wH.TwoD,baseArrayLayer:o,arrayLayerCount:1})),r.depthStencilAttachment={view:a.viewCache[t],depthLoadOp:i.depthLoadOp||lH.Clear,depthStoreOp:i.depthStoreOp||cH.Store,depthClearValue:i.depthClearValue||1},e.stencil&&(r.depthStencilAttachment.stencilLoadOp=i.stencilLoadOp,r.depthStencilAttachment.stencilStoreOp=i.stencilStoreOp,r.depthStencilAttachment.stencilClearValue=i.stencilClearValue)}else r.depthStencilAttachment={...i};t.layerDescriptors.push(r)}}_updateDepthLayerDescriptors(e,t,n){for(let r=0;r<n.length;r++){let n=t.layerDescriptors[r];if(n.depthStencilAttachment){let t=n.depthStencilAttachment;e.depth&&(e.clearDepth?(t.depthClearValue=e.clearDepthValue,t.depthLoadOp=lH.Clear):t.depthLoadOp=lH.Load),e.stencil&&(e.clearStencil?(t.stencilClearValue=e.clearStencilValue,t.stencilLoadOp=lH.Clear):t.stencilLoadOp=lH.Load)}}}finishRender(e){let t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();let r=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){let n=[];for(let e=0;e<t.bundleEncoders.length;e++){let r=t.bundleEncoders[e];n.push(r.finish())}for(let i=0;i<t.layerDescriptors.length;i++)if(i<n.length){let a=t.layerDescriptors[i],o=r.beginRenderPass(a);if(e.viewport){let{x:t,y:n,width:r,height:i,minDepth:a,maxDepth:s}=e.viewportValue;o.setViewport(t,n,r,i,a,s)}if(e.scissor){let{x:t,y:n,width:r,height:i}=e.scissorValue;o.setScissorRect(t,n,r,i)}o.executeBundles([n[i]]),o.end()}}else t.currentPass&&t.currentPass.end();if(n>0){let r=n*8,i=this.occludedResolveCache.get(r);i===void 0&&(i=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,i));let a=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,i,0),t.encoder.copyBufferToBuffer(i,0,a,0,r),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){let t=e.textures;for(let e=0;e<t.length;e++){let n=t[e];n.generateMipmaps===!0&&this.textureUtils.generateMipmaps(n)}}}isOccluded(e,t){let n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){let t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=t;if(n&&r){let e=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);let i=n.getMappedRange(),a=new BigUint64Array(i);for(let t=0;t<r.length;t++)a[t]===BigInt(0)&&e.add(r[t]);n.destroy(),t.occluded=e}}updateViewport(e){let{currentPass:t}=this.get(e),{x:n,y:r,width:i,height:a,minDepth:o,maxDepth:s}=e.viewportValue;t.setViewport(n,r,i,a,o,s)}updateScissor(e){let{currentPass:t}=this.get(e),{x:n,y:r,width:i,height:a}=e.scissorValue;t.setScissorRect(n,r,i,a)}getClearColor(){let e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,r=null){let i=this.device,a=this.renderer,o=[],s,c,l,u;if(e){let e=this.getClearColor();c={r:e.r,g:e.g,b:e.b,a:e.a}}if(r===null){l=a.depth,u=a.stencil;let t=this._getDefaultRenderPassDescriptor();if(e){o=t.colorAttachments;let e=o[0];e.clearValue=c,e.loadOp=lH.Clear,e.storeOp=cH.Store}(l||u)&&(s=t.depthStencilAttachment)}else{l=r.depth,u=r.stencil;let i={loadOp:e?lH.Clear:lH.Load,clearValue:e?c:void 0};l&&(i.depthLoadOp=t?lH.Clear:lH.Load,i.depthClearValue=t?a.getClearDepth():void 0,i.depthStoreOp=cH.Store),u&&(i.stencilLoadOp=n?lH.Clear:lH.Load,i.stencilClearValue=n?a.getClearStencil():void 0,i.stencilStoreOp=cH.Store);let d=this._getRenderPassDescriptor(r,i);o=d.colorAttachments,s=d.depthStencilAttachment}l&&s&&(t?(s.depthLoadOp=lH.Clear,s.depthClearValue=a.getClearDepth(),s.depthStoreOp=cH.Store):(s.depthLoadOp=lH.Load,s.depthStoreOp=cH.Store)),u&&s&&(n?(s.stencilLoadOp=lH.Clear,s.stencilClearValue=a.getClearStencil(),s.stencilStoreOp=cH.Store):(s.stencilLoadOp=lH.Load,s.stencilStoreOp=cH.Store));let d=i.createCommandEncoder({label:`clear`});d.beginRenderPass({colorAttachments:o,depthStencilAttachment:s}).end(),i.queue.submit([d.finish()])}beginCompute(e){let t=this.get(e),n={label:`computeGroup_`+e.id};this.initTimestampQuery(ar.COMPUTE,this.getTimestampUID(e),n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:`computeGroup_`+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,r,i=null){let a=this.get(t),{passEncoderGPU:o}=this.get(e),s=this.get(r).pipeline;this.pipelineUtils.setPipeline(o,s);for(let e=0,t=n.length;e<t;e++){let t=n[e],r=this.get(t);o.setBindGroup(e,r.group)}if(i===null&&(i=t.count),i&&typeof i==`object`&&i.isIndirectStorageBufferAttribute){let e=this.get(i).buffer;o.dispatchWorkgroupsIndirect(e,0);return}if(typeof i==`number`){let e=i;if(a.dispatchSize===void 0||a.count!==e){a.dispatchSize=[0,1,1],a.count=e;let n=t.workgroupSize,r=n[0];for(let e=1;e<n.length;e++)r*=n[e];let o=Math.ceil(e/r),s=this.device.limits.maxComputeWorkgroupsPerDimension;i=[o,1,1],o>s&&(i[0]=Math.min(o,s),i[1]=Math.ceil(o/s)),a.dispatchSize=i}i=a.dispatchSize}o.dispatchWorkgroups(i[0],i[1]||1,i[2]||1)}finishCompute(e){let t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){let{object:n,material:r,context:i,pipeline:a}=e,o=e.getBindings(),s=this.get(i),c=this.get(a),l=c.pipeline;if(c.error===!0)return;let u=e.getIndex(),d=u!==null,f=e.getDrawParameters();if(f===null)return;let p=(t,n)=>{this.pipelineUtils.setPipeline(t,l),n.pipeline=l;let a=n.bindingGroups;for(let e=0,n=o.length;e<n;e++){let n=o[e],r=this.get(n);a[n.index]!==n.id&&(t.setBindGroup(n.index,r.group),a[n.index]=n.id)}if(d===!0&&n.index!==u){let e=this.get(u).buffer,r=u.array instanceof Uint16Array?fH.Uint16:fH.Uint32;t.setIndexBuffer(e,r),n.index=u}let c=e.getVertexBuffers();for(let e=0,r=c.length;e<r;e++){let r=c[e];if(n.attributes[e]!==r){let i=this.get(r).buffer;t.setVertexBuffer(e,i),n.attributes[e]=r}}i.stencil===!0&&r.stencilWrite===!0&&s.currentStencilRef!==r.stencilRef&&(t.setStencilReference(r.stencilRef),s.currentStencilRef=r.stencilRef)},m=(r,i)=>{if(p(r,i),n.isBatchedMesh===!0){let e=n._multiDrawStarts,i=n._multiDrawCounts,a=n._multiDrawCount,o=n._multiDrawInstances;o!==null&&be(`WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.`);for(let s=0;s<a;s++){let a=o?o[s]:1,c=a>1?0:s;d===!0?r.drawIndexed(i[s],a,e[s]/u.array.BYTES_PER_ELEMENT,0,c):r.draw(i[s],a,e[s],c),t.update(n,i[s],a)}}else if(d===!0){let{vertexCount:i,instanceCount:a,firstVertex:o}=f,s=e.getIndirect();if(s!==null){let e=this.get(s).buffer;r.drawIndexedIndirect(e,0)}else r.drawIndexed(i,a,o,0,0);t.update(n,i,a)}else{let{vertexCount:i,instanceCount:a,firstVertex:o}=f,s=e.getIndirect();if(s!==null){let e=this.get(s).buffer;r.drawIndirect(e,0)}else r.draw(i,a,o,0);t.update(n,i,a)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){let t=this.get(e.camera),r=e.camera.cameras,a=e.getBindingGroup(`cameraIndex`);if(t.indexesGPU===void 0||t.indexesGPU.length!==r.length){let e=this.get(a),n=[],i=new Uint32Array([0,0,0,0]);for(let t=0,a=r.length;t<a;t++){i[0]=t;let r=this.bindingUtils.createBindGroupIndex(i,e.layout);n.push(r)}t.indexesGPU=n}let o=this.renderer.getPixelRatio();for(let e=0,c=r.length;e<c;e++){let c=r[e];if(n.layers.test(c.layers)){let n=c.viewport,r=s.currentPass,l=s.currentSets;if(s.bundleEncoders){let t=s.bundleEncoders[e],n=s.bundleSets[e];r=t,l=n}n&&r.setViewport(Math.floor(n.x*o),Math.floor(n.y*o),Math.floor(n.width*o),Math.floor(n.height*o),i.viewportValue.minDepth,i.viewportValue.maxDepth),a&&t.indexesGPU&&(r.setBindGroup(a.index,t.indexesGPU[e]),l.bindingGroups[a.index]=a.id),m(r,l)}}}else if(s.currentPass){if(s.occlusionQuerySet!==void 0){let e=s.lastOcclusionObject;e!==n&&(e!==null&&e.occlusionTest===!0&&(s.currentPass.endOcclusionQuery(),s.occlusionQueryIndex++),n.occlusionTest===!0&&(s.currentPass.beginOcclusionQuery(s.occlusionQueryIndex),s.occlusionQueryObjects[s.occlusionQueryIndex]=n),s.lastOcclusionObject=n)}m(s.currentPass,s.currentSets)}}needsRenderUpdate(e){let t=this.get(e),{object:n,material:r}=e,i=this.utils,a=i.getSampleCountRenderContext(e.context),o=i.getCurrentColorSpace(e.context),s=i.getCurrentColorFormat(e.context),c=i.getCurrentDepthStencilFormat(e.context),l=i.getPrimitiveTopology(n,r),u=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==a||t.colorSpace!==o||t.colorFormat!==s||t.depthStencilFormat!==c||t.primitiveTopology!==l||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=a,t.colorSpace=o,t.colorFormat=s,t.depthStencilFormat=c,t.primitiveTopology=l,t.clippingContextCacheKey=e.clippingContextCacheKey,u=!0),u}getRenderCacheKey(e){let{object:t,material:n}=e,r=this.utils,i=e.context,a=t.isMesh&&t.matrixWorld.determinant()<0;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,a,r.getSampleCountRenderContext(i),r.getCurrentColorSpace(i),r.getCurrentColorFormat(i),r.getCurrentDepthStencilFormat(i),r.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,n,r,i,a){return this.textureUtils.copyTextureToBuffer(e,t,n,r,i,a)}initTimestampQuery(e,t,n){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new lU(this.device,e,2048));let r=this.timestampQueryPool[e],i=r.allocateQueriesForContext(t);n.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(e,t){return new tU(e,t)}createProgram(e){let t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name===``?``:`_${e.name}`)}),entryPoint:`main`}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){let t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){let n=this.get(e),r=n.currentPass.finish();this.get(t).bundleGPU=r,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return OH[e]!==void 0&&(e=OH[e]),this.device.features.has(e)}copyTextureToTexture(e,t,n=null,r=null,i=0,a=0){let o=0,s=0,c=0,l=0,u=0,d=0,f=e.image.width,p=e.image.height,m=1;n!==null&&(n.isBox3===!0?(l=n.min.x,u=n.min.y,d=n.min.z,f=n.max.x-n.min.x,p=n.max.y-n.min.y,m=n.max.z-n.min.z):(l=n.min.x,u=n.min.y,f=n.max.x-n.min.x,p=n.max.y-n.min.y,m=1)),r!==null&&(o=r.x,s=r.y,c=r.z||0);let h=this.device.createCommandEncoder({label:`copyTextureToTexture_`+e.id+`_`+t.id}),g=this.get(e).texture,_=this.get(t).texture;h.copyTextureToTexture({texture:g,mipLevel:i,origin:{x:l,y:u,z:d}},{texture:_,mipLevel:a,origin:{x:o,y:s,z:c}},[f,p,m]),this.device.queue.submit([h.finish()]),a===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){let r=this.get(t),i=null;i=t.renderTarget?e.isDepthTexture?this.get(t.depthTexture).texture:this.get(t.textures[0]).texture:e.isDepthTexture?this.textureUtils.getDepthBuffer(t.depth,t.stencil):this.context.getCurrentTexture();let a=this.get(e).texture;if(i.format!==a.format){N(`WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.`,i.format,a.format);return}let o;if(r.currentPass?(r.currentPass.end(),o=r.encoder):o=this.device.createCommandEncoder({label:`copyFramebufferToTexture_`+e.id}),o.copyTextureToTexture({texture:i,origin:[n.x,n.y,0]},{texture:a},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,o),r.currentPass){let{descriptor:e}=r;for(let t=0;t<e.colorAttachments.length;t++)e.colorAttachments[t].loadOp=lH.Load;t.depth&&(e.depthStencilAttachment.depthLoadOp=lH.Load),t.stencil&&(e.depthStencilAttachment.stencilLoadOp=lH.Load),r.currentPass=o.beginRenderPass(e),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([o.finish()])}dispose(){this.textureUtils.dispose()}},dU=class extends ur{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}},fU=class extends ur{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}},pU=class extends VB{constructor(){super(),this.addMaterial(rA,`MeshPhongMaterial`),this.addMaterial(oM,`MeshStandardMaterial`),this.addMaterial(cM,`MeshPhysicalMaterial`),this.addMaterial(fM,`MeshToonMaterial`),this.addMaterial(qk,`MeshBasicMaterial`),this.addMaterial(tA,`MeshLambertMaterial`),this.addMaterial(Nk,`MeshNormalMaterial`),this.addMaterial(hM,`MeshMatcapMaterial`),this.addMaterial(Tk,`LineBasicMaterial`),this.addMaterial(Dk,`LineDashedMaterial`),this.addMaterial(xM,`PointsMaterial`),this.addMaterial(vM,`SpriteMaterial`),this.addMaterial(TM,`ShadowMaterial`),this.addLight(ZL,zt),this.addLight(fB,Ht),this.addLight(gB,_e),this.addLight(_B,ur),this.addLight(xB,qt),this.addLight(SB,ee),this.addLight(CB,St),this.addLight(vB,dU),this.addLight(bB,fU),this.addToneMapping(yF,1),this.addToneMapping(bF,2),this.addToneMapping(xF,3),this.addToneMapping(CF,4),this.addToneMapping(DF,6),this.addToneMapping(OF,7)}},mU=class extends dV{constructor(e={}){let t;e.forceWebGL?t=aH:(t=uU,e.getFallback=()=>(P(`WebGPURenderer: WebGPU is not available, running under WebGL2 backend.`),new aH(e)));let n=new t(e);super(n,e),this.library=new pU,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<`u`&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent(`observe`,{detail:this}))}};Q.BRDF_GGX,Q.BRDF_Lambert,Q.BasicPointShadowFilter,Q.BasicShadowFilter,Q.Break,Q.Const,Q.Continue,Q.DFGApprox,Q.D_GGX,Q.Discard,Q.EPSILON,Q.F_Schlick;var hU=Q.Fn;Q.INFINITY;var gU=Q.If,_U=Q.Loop;Q.NodeAccess,Q.NodeShaderStage,Q.NodeType,Q.NodeUpdateType,Q.PCFShadowFilter,Q.PCFSoftShadowFilter,Q.PI,Q.PI2,Q.TWO_PI,Q.HALF_PI,Q.PointShadowFilter,Q.Return,Q.Schlick_to_F0,Q.ScriptableNodeResources,Q.ShaderNode,Q.Stack,Q.Switch,Q.TBNViewMatrix,Q.VSMShadowFilter,Q.V_GGX_SmithCorrelated,Q.Var,Q.VarIntent,Q.abs,Q.acesFilmicToneMapping,Q.acos,Q.add,Q.addMethodChaining,Q.addNodeElement,Q.agxToneMapping,Q.all,Q.alphaT,Q.and,Q.anisotropy,Q.anisotropyB,Q.anisotropyT,Q.any,Q.append,Q.array,Q.arrayBuffer;var vU=Q.asin;Q.assign,Q.atan,Q.atan2,Q.atomicAdd,Q.atomicAnd,Q.atomicFunc,Q.atomicLoad,Q.atomicMax,Q.atomicMin,Q.atomicOr,Q.atomicStore,Q.atomicSub,Q.atomicXor,Q.attenuationColor,Q.attenuationDistance,Q.attribute,Q.attributeArray,Q.backgroundBlurriness,Q.backgroundIntensity,Q.backgroundRotation,Q.batch,Q.bentNormalView,Q.billboarding,Q.bitAnd,Q.bitNot,Q.bitOr,Q.bitXor,Q.bitangentGeometry,Q.bitangentLocal,Q.bitangentView,Q.bitangentWorld,Q.bitcast,Q.blendBurn,Q.blendColor,Q.blendDodge,Q.blendOverlay,Q.blendScreen,Q.blur,Q.bool,Q.buffer,Q.bufferAttribute,Q.bumpMap,Q.burn,Q.builtin,Q.bvec2,Q.bvec3,Q.bvec4,Q.bypass,Q.cache,Q.call,Q.cameraFar,Q.cameraIndex,Q.cameraNear,Q.cameraNormalMatrix,Q.cameraPosition,Q.cameraProjectionMatrix,Q.cameraProjectionMatrixInverse,Q.cameraViewMatrix,Q.cameraViewport,Q.cameraWorldMatrix,Q.cbrt,Q.cdl,Q.ceil,Q.checker,Q.cineonToneMapping,Q.clamp,Q.clearcoat,Q.clearcoatNormalView,Q.clearcoatRoughness,Q.code,Q.color,Q.colorSpaceToWorking,Q.colorToDirection,Q.compute,Q.computeKernel,Q.computeSkinning,Q.context,Q.convert,Q.convertColorSpace,Q.convertToTexture;var yU=Q.cos;Q.cross,Q.cubeTexture,Q.cubeTextureBase,Q.cubeToUV,Q.dFdx,Q.dFdy,Q.dashSize,Q.debug,Q.decrement,Q.decrementBefore,Q.defaultBuildStages,Q.defaultShaderStages,Q.defined,Q.degrees,Q.deltaTime,Q.densityFog,Q.densityFogFactor,Q.depth,Q.depthPass,Q.determinant,Q.difference,Q.diffuseColor,Q.directPointLight,Q.directionToColor,Q.directionToFaceDirection,Q.dispersion,Q.distance,Q.div,Q.dodge,Q.dot,Q.drawIndex,Q.dynamicBufferAttribute,Q.element,Q.emissive,Q.equal,Q.equals,Q.equirectUV;var bU=Q.exp;Q.exp2,Q.expression,Q.faceDirection,Q.faceForward,Q.faceforward;var xU=Q.float;Q.floatBitsToInt,Q.floatBitsToUint,Q.floor,Q.fog,Q.fract,Q.frameGroup,Q.frameId,Q.frontFacing,Q.fwidth,Q.gain,Q.gapSize,Q.getConstNodeType,Q.getCurrentStack,Q.getDirection,Q.getDistanceAttenuation,Q.getGeometryRoughness,Q.getNormalFromDepth,Q.interleavedGradientNoise,Q.getParallaxCorrectNormal,Q.getRoughness,Q.getScreenPosition,Q.getShIrradianceAt,Q.getShadowMaterial,Q.getShadowRenderObjectFunction,Q.getTextureIndex,Q.getViewPosition,Q.globalId,Q.glsl,Q.glslFn,Q.grayscale,Q.greaterThan,Q.greaterThanEqual,Q.hash,Q.highpModelNormalViewMatrix,Q.highpModelViewMatrix,Q.hue,Q.increment,Q.incrementBefore,Q.instance;var SU=Q.instanceIndex;Q.instancedArray,Q.instancedBufferAttribute,Q.instancedDynamicBufferAttribute,Q.instancedMesh,Q.int,Q.intBitsToFloat,Q.inverse,Q.inverseSqrt,Q.inversesqrt,Q.invocationLocalIndex,Q.invocationSubgroupIndex,Q.ior,Q.iridescence,Q.iridescenceIOR,Q.iridescenceThickness,Q.ivec2,Q.ivec3,Q.ivec4,Q.js,Q.label,Q.length,Q.lengthSq,Q.lessThan,Q.lessThanEqual,Q.lightPosition,Q.lightProjectionUV,Q.lightShadowMatrix,Q.lightTargetDirection,Q.lightTargetPosition,Q.lightViewPosition,Q.lightingContext,Q.lights,Q.linearDepth,Q.linearToneMapping,Q.localId,Q.log,Q.log2,Q.logarithmicDepthToViewZ,Q.luminance,Q.mat2,Q.mat3,Q.mat4,Q.matcapUV,Q.materialAO,Q.materialAlphaTest,Q.materialAnisotropy,Q.materialAnisotropyVector,Q.materialAttenuationColor,Q.materialAttenuationDistance,Q.materialClearcoat,Q.materialClearcoatNormal,Q.materialClearcoatRoughness,Q.materialColor,Q.materialDispersion,Q.materialEmissive,Q.materialEnvIntensity,Q.materialEnvRotation,Q.materialIOR,Q.materialIridescence,Q.materialIridescenceIOR,Q.materialIridescenceThickness,Q.materialLightMap,Q.materialLineDashOffset,Q.materialLineDashSize,Q.materialLineGapSize,Q.materialLineScale,Q.materialLineWidth,Q.materialMetalness,Q.materialNormal,Q.materialOpacity,Q.materialPointSize,Q.materialReference,Q.materialReflectivity,Q.materialRefractionRatio,Q.materialRotation,Q.materialRoughness,Q.materialSheen,Q.materialSheenRoughness,Q.materialShininess,Q.materialSpecular,Q.materialSpecularColor,Q.materialSpecularIntensity,Q.materialSpecularStrength,Q.materialThickness,Q.materialTransmission,Q.max,Q.maxMipLevel,Q.mediumpModelViewMatrix,Q.metalness,Q.min,Q.mix,Q.mixElement,Q.mod,Q.modInt,Q.modelDirection,Q.modelNormalMatrix,Q.modelPosition,Q.modelRadius,Q.modelScale,Q.modelViewMatrix,Q.modelViewPosition,Q.modelViewProjection,Q.modelWorldMatrix,Q.modelWorldMatrixInverse,Q.morphReference,Q.mrt,Q.mul,Q.mx_aastep,Q.mx_add,Q.mx_atan2,Q.mx_cell_noise_float,Q.mx_contrast,Q.mx_divide,Q.mx_fractal_noise_float,Q.mx_fractal_noise_vec2,Q.mx_fractal_noise_vec3,Q.mx_fractal_noise_vec4,Q.mx_frame,Q.mx_heighttonormal,Q.mx_hsvtorgb,Q.mx_ifequal,Q.mx_ifgreater,Q.mx_ifgreatereq,Q.mx_invert,Q.mx_modulo,Q.mx_multiply,Q.mx_noise_float,Q.mx_noise_vec3,Q.mx_noise_vec4,Q.mx_place2d,Q.mx_power,Q.mx_ramp4,Q.mx_ramplr,Q.mx_ramptb,Q.mx_rgbtohsv,Q.mx_rotate2d,Q.mx_rotate3d,Q.mx_safepower,Q.mx_separate,Q.mx_splitlr,Q.mx_splittb,Q.mx_srgb_texture_to_lin_rec709,Q.mx_subtract,Q.mx_timer,Q.mx_transform_uv,Q.mx_unifiednoise2d,Q.mx_unifiednoise3d,Q.mx_worley_noise_float,Q.mx_worley_noise_vec2,Q.mx_worley_noise_vec3;var CU=Q.negate;Q.neutralToneMapping,Q.nodeArray,Q.nodeImmutable,Q.nodeObject,Q.nodeObjectIntent,Q.nodeObjects,Q.nodeProxy,Q.nodeProxyIntent,Q.normalFlat,Q.normalGeometry,Q.normalLocal,Q.normalMap,Q.normalView,Q.normalViewGeometry,Q.normalWorld,Q.normalWorldGeometry,Q.normalize,Q.not,Q.notEqual,Q.numWorkgroups,Q.objectDirection,Q.objectGroup,Q.objectPosition,Q.objectRadius,Q.objectScale,Q.objectViewPosition,Q.objectWorldMatrix,Q.OnBeforeObjectUpdate,Q.OnBeforeMaterialUpdate,Q.OnObjectUpdate,Q.OnMaterialUpdate,Q.oneMinus,Q.or,Q.orthographicDepthToViewZ,Q.oscSawtooth,Q.oscSine,Q.oscSquare,Q.oscTriangle,Q.output,Q.outputStruct,Q.overlay,Q.overloadingFn,Q.parabola,Q.parallaxDirection,Q.parallaxUV,Q.parameter,Q.pass,Q.passTexture,Q.pcurve,Q.perspectiveDepthToViewZ,Q.pmremTexture,Q.pointShadow,Q.pointUV,Q.pointWidth,Q.positionGeometry,Q.positionLocal,Q.positionPrevious,Q.positionView,Q.positionViewDirection,Q.positionWorld,Q.positionWorldDirection,Q.posterize,Q.pow,Q.pow2,Q.pow3,Q.pow4,Q.premultiplyAlpha,Q.property,Q.radians,Q.rand,Q.range,Q.rangeFog,Q.rangeFogFactor,Q.reciprocal,Q.reference,Q.referenceBuffer,Q.reflect,Q.reflectVector,Q.reflectView,Q.reflector,Q.refract,Q.refractVector,Q.refractView,Q.reinhardToneMapping,Q.remap,Q.remapClamp,Q.renderGroup,Q.renderOutput,Q.rendererReference,Q.rotate,Q.rotateUV,Q.roughness,Q.round,Q.rtt,Q.sRGBTransferEOTF,Q.sRGBTransferOETF,Q.sample,Q.sampler,Q.samplerComparison,Q.saturate,Q.saturation,Q.screen,Q.screenCoordinate,Q.screenDPR,Q.screenSize,Q.screenUV,Q.scriptable,Q.scriptableValue,Q.select,Q.setCurrentStack,Q.setName,Q.shaderStages,Q.shadow,Q.shadowPositionWorld,Q.shapeCircle,Q.sharedUniformGroup,Q.sheen,Q.sheenRoughness,Q.shiftLeft,Q.shiftRight,Q.shininess,Q.sign;var wU=Q.sin;Q.sinc,Q.skinning,Q.smoothstep,Q.smoothstepElement,Q.specularColor,Q.specularF90,Q.spherizeUV,Q.split,Q.spritesheetUV;var TU=Q.sqrt;Q.stack,Q.step,Q.stepElement;var EU=Q.storage;Q.storageBarrier,Q.storageObject,Q.storageTexture,Q.string,Q.struct,Q.sub,Q.subgroupAdd,Q.subgroupAll,Q.subgroupAnd,Q.subgroupAny,Q.subgroupBallot,Q.subgroupBroadcast,Q.subgroupBroadcastFirst,Q.subBuild,Q.subgroupElect,Q.subgroupExclusiveAdd,Q.subgroupExclusiveMul,Q.subgroupInclusiveAdd,Q.subgroupInclusiveMul,Q.subgroupIndex,Q.subgroupMax,Q.subgroupMin,Q.subgroupMul,Q.subgroupOr,Q.subgroupShuffle,Q.subgroupShuffleDown,Q.subgroupShuffleUp,Q.subgroupShuffleXor,Q.subgroupSize,Q.subgroupXor,Q.tan,Q.tangentGeometry,Q.tangentLocal,Q.tangentView,Q.tangentWorld,Q.texture,Q.texture3D,Q.textureBarrier,Q.textureBicubic,Q.textureBicubicLevel,Q.textureCubeUV,Q.textureLoad,Q.textureSize,Q.textureLevel,Q.textureStore,Q.thickness,Q.time,Q.toneMapping,Q.toneMappingExposure,Q.toonOutlinePass,Q.transformDirection,Q.transformNormal,Q.transformNormalToView,Q.transformedClearcoatNormalView,Q.transformedNormalView,Q.transformedNormalWorld,Q.transmission,Q.transpose,Q.triNoise3D,Q.triplanarTexture,Q.triplanarTextures,Q.trunc,Q.uint,Q.uintBitsToFloat;var DU=Q.uniform;Q.uniformArray,Q.uniformCubeTexture,Q.uniformGroup,Q.uniformFlow,Q.uniformTexture,Q.unpremultiplyAlpha,Q.userData,Q.uv,Q.uvec2,Q.uvec3,Q.uvec4,Q.varying,Q.varyingProperty,Q.vec2,Q.vec3,Q.vec4,Q.vectorComponents,Q.velocity,Q.vertexColor,Q.vertexIndex,Q.vertexStage,Q.vibrance,Q.viewZToLogarithmicDepth,Q.viewZToOrthographicDepth,Q.viewZToPerspectiveDepth,Q.viewport,Q.viewportCoordinate,Q.viewportDepthTexture,Q.viewportLinearDepth,Q.viewportMipTexture,Q.viewportResolution,Q.viewportSafeUV,Q.viewportSharedTexture,Q.viewportSize,Q.viewportTexture,Q.viewportUV,Q.wgsl,Q.wgslFn,Q.workgroupArray,Q.workgroupBarrier,Q.workgroupId,Q.workingToColorSpace,Q.xor;var OU=new ti,kU=new j,AU=class extends l{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type=`LineSegmentsGeometry`,this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute(`position`,new vn([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute(`uv`,new vn([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){let t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let n=new qn(t,6,1);return this.setAttribute(`instanceStart`,new Ze(n,3,0)),this.setAttribute(`instanceEnd`,new Ze(n,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let n=new qn(t,6,1);return this.setAttribute(`instanceColorStart`,new Ze(n,3,0)),this.setAttribute(`instanceColorEnd`,new Ze(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new fi(e.geometry)),this}fromLineSegments(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ti);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),OU.setFromBufferAttribute(t),this.boundingBox.union(OU))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new r),this.boundingBox===null&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){let n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let i=0,a=e.count;i<a;i++)kU.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(kU)),kU.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(kU));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error(`THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.`,this)}}toJSON(){}};Nr.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Fe(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},mr.line={uniforms:lt.merge([Nr.common,Nr.fog,Nr.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			float alpha = opacity;
			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var jU=class extends Bt{constructor(e){super({type:`LineMaterial`,uniforms:lt.clone(mr.line.uniforms),vertexShader:mr.line.vertexShader,fragmentShader:mr.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return`WORLD_UNITS`in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS=``:delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return`USE_DASH`in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH=``:delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return`USE_ALPHA_TO_COVERAGE`in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE=``:delete this.defines.USE_ALPHA_TO_COVERAGE)}},MU=new Je,NU=new j,PU=new j,FU=new Je,IU=new Je,LU=new Je,RU=new j,zU=new F,BU=new ce,VU=new j,HU=new ti,UU=new r,WU=new Je,GU,KU;function qU(e,t,n){return WU.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),WU.multiplyScalar(1/WU.w),WU.x=KU/n.width,WU.y=KU/n.height,WU.applyMatrix4(e.projectionMatrixInverse),WU.multiplyScalar(1/WU.w),Math.abs(Math.max(WU.x,WU.y))}function JU(e,t){let n=e.matrixWorld,r=e.geometry,i=r.attributes.instanceStart,a=r.attributes.instanceEnd,o=Math.min(r.instanceCount,i.count);for(let r=0,s=o;r<s;r++){BU.start.fromBufferAttribute(i,r),BU.end.fromBufferAttribute(a,r),BU.applyMatrix4(n);let o=new j,s=new j;GU.distanceSqToSegment(BU.start,BU.end,s,o),s.distanceTo(o)<KU*.5&&t.push({point:s,pointOnLine:o,distance:GU.origin.distanceTo(s),object:e,face:null,faceIndex:r,uv:null,uv1:null})}}function YU(e,t,n){let r=t.projectionMatrix,i=e.material.resolution,a=e.matrixWorld,o=e.geometry,s=o.attributes.instanceStart,c=o.attributes.instanceEnd,l=Math.min(o.instanceCount,s.count),u=-t.near;GU.at(1,LU),LU.w=1,LU.applyMatrix4(t.matrixWorldInverse),LU.applyMatrix4(r),LU.multiplyScalar(1/LU.w),LU.x*=i.x/2,LU.y*=i.y/2,LU.z=0,RU.copy(LU),zU.multiplyMatrices(t.matrixWorldInverse,a);for(let t=0,o=l;t<o;t++){if(FU.fromBufferAttribute(s,t),IU.fromBufferAttribute(c,t),FU.w=1,IU.w=1,FU.applyMatrix4(zU),IU.applyMatrix4(zU),FU.z>u&&IU.z>u)continue;if(FU.z>u){let e=FU.z-IU.z,t=(FU.z-u)/e;FU.lerp(IU,t)}else if(IU.z>u){let e=IU.z-FU.z,t=(IU.z-u)/e;IU.lerp(FU,t)}FU.applyMatrix4(r),IU.applyMatrix4(r),FU.multiplyScalar(1/FU.w),IU.multiplyScalar(1/IU.w),FU.x*=i.x/2,FU.y*=i.y/2,IU.x*=i.x/2,IU.y*=i.y/2,BU.start.copy(FU),BU.start.z=0,BU.end.copy(IU),BU.end.z=0;let o=BU.closestPointToPointParameter(RU,!0);BU.at(o,VU);let l=Bn.lerp(FU.z,IU.z,o),d=l>=-1&&l<=1,f=RU.distanceTo(VU)<KU*.5;if(d&&f){BU.start.fromBufferAttribute(s,t),BU.end.fromBufferAttribute(c,t),BU.start.applyMatrix4(a),BU.end.applyMatrix4(a);let r=new j,i=new j;GU.distanceSqToSegment(BU.start,BU.end,i,r),n.push({point:i,pointOnLine:r,distance:GU.origin.distanceTo(i),object:e,face:null,faceIndex:t,uv:null,uv1:null})}}}var XU=class extends tr{constructor(e=new AU,t=new jU({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type=`LineSegments2`}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let e=0,i=0,a=t.count;e<a;e++,i+=2)NU.fromBufferAttribute(t,e),PU.fromBufferAttribute(n,e),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+NU.distanceTo(PU);let i=new qn(r,2,1);return e.setAttribute(`instanceDistanceStart`,new Ze(i,1,0)),e.setAttribute(`instanceDistanceEnd`,new Ze(i,1,1)),this}raycast(e,t){let n=this.material.worldUnits,r=e.camera;r===null&&!n&&console.error(`LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.`);let i=e.params.Line2===void 0?0:e.params.Line2.threshold||0;GU=e.ray;let a=this.matrixWorld,o=this.geometry,s=this.material;KU=s.linewidth+i,o.boundingSphere===null&&o.computeBoundingSphere(),UU.copy(o.boundingSphere).applyMatrix4(a);let c;if(c=n?KU*.5:qU(r,Math.max(r.near,UU.distanceToPoint(GU.origin)),s.resolution),UU.radius+=c,GU.intersectsSphere(UU)===!1)return;o.boundingBox===null&&o.computeBoundingBox(),HU.copy(o.boundingBox).applyMatrix4(a);let l;l=n?KU*.5:qU(r,Math.max(r.near,HU.distanceToPoint(GU.origin)),s.resolution),HU.expandByScalar(l),GU.intersectsBox(HU)!==!1&&(n?JU(this,t):YU(this,r,t))}onBeforeRender(e){let t=this.material.uniforms;t&&t.resolution&&(e.getViewport(MU),this.material.uniforms.resolution.value.set(MU.z,MU.w))}},ZU=class extends AU{constructor(){super(),this.isLineGeometry=!0,this.type=`LineGeometry`}setPositions(e){let t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e){let t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setColors(n),this}setFromPoints(e){let t=e.length-1,n=new Float32Array(6*t);for(let r=0;r<t;r++)n[6*r]=e[r].x,n[6*r+1]=e[r].y,n[6*r+2]=e[r].z||0,n[6*r+3]=e[r+1].x,n[6*r+4]=e[r+1].y,n[6*r+5]=e[r+1].z||0;return super.setPositions(n),this}fromLine(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}},QU=class extends XU{constructor(e=new ZU,t=new jU({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type=`Line2`}},$U=class extends rr{constructor(e,t={}){let n=t.font;if(n===void 0)super();else{let r=n.generateShapes(e,t.size,t.direction);t.depth===void 0&&(t.depth=50),t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(r,t)}this.type=`TextGeometry`}},eW=class{constructor(e){this.isFont=!0,this.type=`Font`,this.data=e}generateShapes(e,t=100,n=`ltr`){let r=[],i=tW(e,t,this.data,n);for(let e=0,t=i.length;e<t;e++)r.push(...i[e].toShapes());return r}};function tW(e,t,n,r){let i=Array.from(e),a=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*a,s=[],c=0,l=0;(r==`rtl`||r==`tb`)&&i.reverse();for(let e=0;e<i.length;e++){let t=i[e];if(t===`
`)c=0,l-=o;else{let e=nW(t,a,c,l,n);r==`tb`?(c=0,l+=n.ascender*a):c+=e.offsetX,s.push(e.path)}}return s}function nW(e,t,n,r,i){let a=i.glyphs[e]||i.glyphs[`?`];if(!a){console.error(`THREE.Font: character "`+e+`" does not exists in font family `+i.familyName+`.`);return}let o=new Gt,s,c,l,u,d,f,p,m;if(a.o){let e=a._cachedOutline||=a.o.split(` `);for(let i=0,a=e.length;i<a;)switch(e[i++]){case`m`:s=e[i++]*t+n,c=e[i++]*t+r,o.moveTo(s,c);break;case`l`:s=e[i++]*t+n,c=e[i++]*t+r,o.lineTo(s,c);break;case`q`:l=e[i++]*t+n,u=e[i++]*t+r,d=e[i++]*t+n,f=e[i++]*t+r,o.quadraticCurveTo(d,f,l,u);break;case`b`:l=e[i++]*t+n,u=e[i++]*t+r,d=e[i++]*t+n,f=e[i++]*t+r,p=e[i++]*t+n,m=e[i++]*t+r,o.bezierCurveTo(d,f,p,m,l,u);break}}return{offsetX:a.ha*t,path:o}}var rW=class extends je{constructor(e=document.createElement(`div`)){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position=`absolute`,this.element.style.userSelect=`none`,this.element.setAttribute(`draggable`,!1),this.center=new Fe(.5,.5),this.addEventListener(`removed`,function(){this.traverse(function(e){e.element&&e.element instanceof e.element.ownerDocument.defaultView.Element&&e.element.parentNode!==null&&e.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}};new j,new F,new F,new j,new j;function iW(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function aW(e){if(Array.isArray(e))return e}function oW(e){if(Array.isArray(e))return iW(e)}function sW(e,t,n){if(typeof e==`function`?e===t:e.has(t))return arguments.length<3?t:n;throw TypeError(`Private element is not present on this object`)}function cW(e){if(e===void 0)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return e}function lW(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){n(e);return}s.done?t(c):Promise.resolve(c).then(r,i)}function uW(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){lW(a,r,i,o,s,`next`,e)}function s(e){lW(a,r,i,o,s,`throw`,e)}o(void 0)})}}function dW(e,t,n){return t=SW(t),NW(e,wW()?Reflect.construct(t,n||[],SW(e).constructor):t.apply(e,n))}function fW(e,t){if(t.has(e))throw TypeError(`Cannot initialize the same private elements twice on an object`)}function pW(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function mW(e,t){return e.get(sW(e,t))}function hW(e,t,n){fW(e,t),t.set(e,n)}function gW(e,t,n){return e.set(sW(e,t),n),n}function _W(e,t,n){if(wW())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,t),new(e.bind.apply(e,r))}function vW(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,HW(r.key),r)}}function yW(e,t,n){return t&&vW(e.prototype,t),Object.defineProperty(e,`prototype`,{writable:!1}),e}function bW(e,t,n){return(t=HW(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xW(){return xW=typeof Reflect<`u`&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=RW(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},xW.apply(null,arguments)}function SW(e){return SW=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},SW(e)}function CW(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function`);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,`prototype`,{writable:!1}),t&&IW(e,t)}function wW(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wW=function(){return!!e})()}function TW(e){if(typeof Symbol<`u`&&e[Symbol.iterator]!=null||e[`@@iterator`]!=null)return Array.from(e)}function EW(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function DW(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OW(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function AW(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?kW(Object(n),!0).forEach(function(t){bW(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kW(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function jW(e,t){if(e==null)return{};var n,r,i=MW(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function MW(e,t){if(e==null)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;n[r]=e[r]}return n}function NW(e,t){if(t&&(typeof t==`object`||typeof t==`function`))return t;if(t!==void 0)throw TypeError(`Derived constructors may only return object or undefined`);return cW(e)}function PW(){var e,t,n=typeof Symbol==`function`?Symbol:{},r=n.iterator||`@@iterator`,i=n.toStringTag||`@@toStringTag`;function a(n,r,i,a){var c=r&&r.prototype instanceof s?r:s,l=Object.create(c.prototype);return FW(l,`_invoke`,function(n,r,i){var a,s,c,l=0,u=i||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,o}};function p(n,r){for(s=n,c=r,t=0;!d&&l&&!i&&t<u.length;t++){var i,a=u[t],p=f.p,m=a[2];n>3?(i=m===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,f.n=m,s=0))}if(i||n>1)return o;throw d=!0,r}return function(i,u,m){if(l>1)throw TypeError(`Generator is already running`);for(d&&u===1&&p(u,m),s=u,c=m;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(l=2,a){if(s||(i=`next`),t=a[i]){if(!(t=t.call(a,c)))throw TypeError(`iterator result is not an object`);if(!t.done)return t;c=t.value,s<2&&(s=0)}else s===1&&(t=a.return)&&t.call(a),s<2&&(c=TypeError(`The iterator does not provide a '`+i+`' method`),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==o)break}catch(t){a=e,s=1,c=t}finally{l=1}}return{value:t,done:d}}}(n,i,a),!0),l}var o={};function s(){}function c(){}function l(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(FW(t={},r,function(){return this}),t),d=l.prototype=s.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,FW(e,i,`GeneratorFunction`)),e.prototype=Object.create(d),e}return c.prototype=l,FW(d,`constructor`,l),FW(l,`constructor`,c),c.displayName=`GeneratorFunction`,FW(l,i,`GeneratorFunction`),FW(d),FW(d,i,`Generator`),FW(d,r,function(){return this}),FW(d,`toString`,function(){return`[object Generator]`}),(PW=function(){return{w:a,m:f}})()}function FW(e,t,n,r){var i=Object.defineProperty;try{i({},``,{})}catch{i=0}FW=function(e,t,n,r){function a(t,n){FW(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a(`next`,0),a(`throw`,1),a(`return`,2))},FW(e,t,n,r)}function IW(e,t){return IW=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},IW(e,t)}function LW(e,t){return aW(e)||EW(e,t)||UW(e,t)||DW()}function RW(e,t){for(;!{}.hasOwnProperty.call(e,t)&&(e=SW(e))!==null;);return e}function zW(e,t,n,r){var i=xW(SW(e.prototype),t,n);return typeof i==`function`?function(e){return i.apply(n,e)}:i}function BW(e){return oW(e)||TW(e)||UW(e)||OW()}function VW(e,t){if(typeof e!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}function HW(e){var t=VW(e,`string`);return typeof t==`symbol`?t:t+``}function UW(e,t){if(e){if(typeof e==`string`)return iW(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?iW(e,t):void 0}}var WW=function(e){e instanceof Array?e.forEach(WW):(e.map&&e.map.dispose(),e.dispose())},GW=function(e){e.geometry&&e.geometry.dispose(),e.material&&WW(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(GW)},KW=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),GW(t)}};function qW(e,t){var n=new t;return{linkProp:function(t){return{default:n[t](),onChange:function(n,r){r[e][t](n)},triggerUpdate:!1}},linkMethod:function(t){return function(n){var r=n[e],i=[...arguments].slice(1),a=r[t].apply(r,i);return a===r?this:a}}}}var JW=100;function YW(){return JW}function XW(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180,a=JW*(1+n),o=Math.sin(r);return{x:a*o*Math.cos(i),y:a*Math.cos(r),z:a*o*Math.sin(i)}}function ZW(e){var t=e.x,n=e.y,r=e.z,i=Math.sqrt(t*t+n*n+r*r),a=Math.acos(n/i),o=Math.atan2(r,t);return{lat:90-a*180/Math.PI,lng:90-o*180/Math.PI-(o<-Math.PI/2?360:0),altitude:i/JW-1}}function QW(e){return e*Math.PI/180}var $W=window.THREE?window.THREE:{BackSide:1,BufferAttribute:h,Color:a,Mesh:tr,ShaderMaterial:Bt},eG=`
uniform float hollowRadius;

varying vec3 vVertexWorldPosition;
varying vec3 vVertexNormal;
varying float vCameraDistanceToObjCenter;
varying float vVertexAngularDistanceToHollowRadius;

void main() {    
  vVertexNormal	= normalize(normalMatrix * normal);
  vVertexWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;
  
  vec4 objCenterViewPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);
  vCameraDistanceToObjCenter = length(objCenterViewPosition);
  
  float edgeAngle = atan(hollowRadius / vCameraDistanceToObjCenter);
  float vertexAngle = acos(dot(normalize(modelViewMatrix * vec4(position, 1.0)), normalize(objCenterViewPosition)));
  vVertexAngularDistanceToHollowRadius = vertexAngle - edgeAngle;

  gl_Position	= projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,tG=`
uniform vec3 color;
uniform float coefficient;
uniform float power;
uniform float hollowRadius;

varying vec3 vVertexNormal;
varying vec3 vVertexWorldPosition;
varying float vCameraDistanceToObjCenter;
varying float vVertexAngularDistanceToHollowRadius;

void main() {
  if (vCameraDistanceToObjCenter < hollowRadius) discard; // inside the hollowRadius
  if (vVertexAngularDistanceToHollowRadius < 0.0) discard; // frag position is within the hollow radius

  vec3 worldCameraToVertex = vVertexWorldPosition - cameraPosition;
  vec3 viewCameraToVertex	= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;
  viewCameraToVertex = normalize(viewCameraToVertex);
  float intensity	= pow(
    coefficient + dot(vVertexNormal, viewCameraToVertex),
    power
  );
  gl_FragColor = vec4(color, intensity);
}`;function nG(e,t,n,r){return new $W.ShaderMaterial({depthWrite:!1,transparent:!0,vertexShader:eG,fragmentShader:tG,uniforms:{coefficient:{value:e},color:{value:new $W.Color(t)},power:{value:n},hollowRadius:{value:r}}})}function rG(e,t){for(var n=e.clone(),r=new Float32Array(e.attributes.position.count*3),i=0,a=r.length;i<a;i++){var o=e.attributes.normal.array[i];r[i]=e.attributes.position.array[i]+o*t}return n.setAttribute(`position`,new $W.BufferAttribute(r,3)),n}var iG=function(e){function t(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.color,a=i===void 0?`gold`:i,o=r.size,s=o===void 0?2:o,c=r.coefficient,l=c===void 0?.5:c,u=r.power,d=u===void 0?1:u,f=r.hollowRadius,p=f===void 0?0:f,m=r.backside,h=m===void 0?!0:m;pW(this,t),n=dW(this,t);var g=rG(e,s),_=nG(l,a,d,p);return h&&(_.side=$W.BackSide),n.geometry=g,n.material=_,n}return CW(t,e),yW(t)}($W.Mesh),aG=window.THREE?window.THREE:{Color:a,Group:ei,LineBasicMaterial:Oe,LineSegments:Ce,Mesh:tr,MeshPhongMaterial:or,SphereGeometry:yn,SRGBColorSpace:De,TextureLoader:br},oG=Aa({props:{globeImageUrl:{},bumpImageUrl:{},showGlobe:{default:!0,onChange:function(e,t){t.globeGroup.visible=!!e},triggerUpdate:!1},showGraticules:{default:!1,onChange:function(e,t){t.graticulesObj.visible=!!e},triggerUpdate:!1},showAtmosphere:{default:!0,onChange:function(e,t){t.atmosphereObj&&(t.atmosphereObj.visible=!!e)},triggerUpdate:!1},atmosphereColor:{default:`lightskyblue`},atmosphereAltitude:{default:.15},globeCurvatureResolution:{default:4},globeTileEngineUrl:{onChange:function(e,t){t.tileEngine.tileUrl=e}},globeTileEngineMaxLevel:{default:17,onChange:function(e,t){t.tileEngine.maxLevel=e},triggerUpdate:!1},updatePov:{onChange:function(e,t){t.tileEngine.updatePov(e)},triggerUpdate:!1},onReady:{default:function(){},triggerUpdate:!1}},methods:{globeMaterial:function(e,t){return t===void 0?e.globeObj.material:(e.globeObj.material=t||e.defaultGlobeMaterial,this)},globeTileEngineClearCache:function(e){e.tileEngine.clearTiles()},_destructor:function(e){KW(e.globeObj),KW(e.tileEngine),KW(e.graticulesObj)}},stateInit:function(){var e=new aG.MeshPhongMaterial({color:0}),t=new aG.Mesh(void 0,e);t.rotation.y=-Math.PI/2;var n=new Yf(JW),r=new aG.Group;return r.__globeObjType=`globe`,r.add(t),r.add(n),{globeGroup:r,globeObj:t,graticulesObj:new aG.LineSegments(new tm(gd(),JW,2),new aG.LineBasicMaterial({color:`lightgrey`,transparent:!0,opacity:.1})),defaultGlobeMaterial:e,tileEngine:n}},init:function(e,t){KW(e),t.scene=e,t.scene.add(t.globeGroup),t.scene.add(t.graticulesObj),t.ready=!1},update:function(e,t){var n=e.globeObj.material;if(e.tileEngine.visible=!(e.globeObj.visible=!e.globeTileEngineUrl),t.hasOwnProperty(`globeCurvatureResolution`)){var r;(r=e.globeObj.geometry)==null||r.dispose();var i=Math.max(4,Math.round(360/e.globeCurvatureResolution));e.globeObj.geometry=new aG.SphereGeometry(JW,i,i/2),e.tileEngine.curvatureResolution=e.globeCurvatureResolution}if(t.hasOwnProperty(`globeImageUrl`)&&(e.globeImageUrl?new aG.TextureLoader().load(e.globeImageUrl,function(t){t.colorSpace=aG.SRGBColorSpace,n.map=t,n.color=null,n.needsUpdate=!0,!e.ready&&(e.ready=!0)&&setTimeout(e.onReady)}):!n.color&&(n.color=new aG.Color(0))),t.hasOwnProperty(`bumpImageUrl`)&&(e.bumpImageUrl?e.bumpImageUrl&&new aG.TextureLoader().load(e.bumpImageUrl,function(e){n.bumpMap=e,n.needsUpdate=!0}):(n.bumpMap=null,n.needsUpdate=!0)),(t.hasOwnProperty(`atmosphereColor`)||t.hasOwnProperty(`atmosphereAltitude`))&&(e.atmosphereObj&&(e.scene.remove(e.atmosphereObj),KW(e.atmosphereObj)),e.atmosphereColor&&e.atmosphereAltitude)){var a=e.atmosphereObj=new iG(e.globeObj.geometry,{color:e.atmosphereColor,size:JW*e.atmosphereAltitude,hollowRadius:JW,coefficient:.1,power:3.5});a.visible=!!e.showAtmosphere,a.__globeObjType=`atmosphere`,e.scene.add(a)}!e.ready&&(!e.globeImageUrl||e.globeTileEngineUrl)&&(e.ready=!0,e.onReady())}}),sG=function(e){return isNaN(e)?parseInt(Sm(e).toHex(),16):e},cG=function(e){return e&&isNaN(e)?ns(e).opacity:1},lG=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r,i=1,o=/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.eE+-]+)\s*\)$/.exec(e.trim().toLowerCase());if(o){var s=LW(o.slice(1),4),c=s[0],l=s[1],u=s[2],d=s[3];r=new a(`rgb(${+c},${+l},${+u})`),i=Math.min(+d,1)}else r=new a(e);n&&r.convertLinearToSRGB();var f=r.toArray();return t?[].concat(BW(f),[i]):f};function uG(e,t,n){return e.opacity=t,e.transparent=t<1,e.depthWrite=t>=1,e}var dG=window.THREE?window.THREE:{BufferAttribute:h};function fG(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float32Array;if(t===1)return new dG.BufferAttribute(new n(e),t);for(var r=new dG.BufferAttribute(new n(e.length*t),t),i=0,a=e.length;i<a;i++)r.set(e[i],i*t);return r}function pG(e){for(var t=e.itemSize,n=[],r=0;r<e.count;r++)n.push(e.array.slice(r*t,(r+1)*t));return n}var mG=new WeakMap,hG=new WeakMap,gG=new WeakMap,_G=function(e){function t(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.dataBindAttr,a=i===void 0?`__data`:i,o=r.objBindAttr,s=o===void 0?`__threeObj`:o,c=r.removeDelay,l=c===void 0?0:c;return pW(this,t),n=dW(this,t),bW(n,`scene`,void 0),hW(n,mG,void 0),hW(n,hG,void 0),hW(n,gG,void 0),n.scene=e,gW(mG,n,a),gW(hG,n,s),gW(gG,n,l),n.onRemoveObj(function(){}),n}return CW(t,e),yW(t,[{key:`onCreateObj`,value:function(e){var n=this;return zW(t,`onCreateObj`,this)([function(t){var r=e(t);return t[mW(hG,n)]=r,r[mW(mG,n)]=t,n.scene.add(r),r}]),this}},{key:`onRemoveObj`,value:function(e){var n=this;return zW(t,`onRemoveObj`,this)([function(r,i){var a=zW(t,`getData`,n)([r]);e(r,i);var o=function(){n.scene.remove(r),KW(r),delete a[mW(hG,n)]};mW(gG,n)?setTimeout(o,mW(gG,n)):o()}]),this}}])}(Nh),vG=window.THREE?window.THREE:{BufferGeometry:Xr,CylinderGeometry:vt,Matrix4:F,Mesh:tr,MeshLambertMaterial:gn,Object3D:je,Vector3:j},yG=Object.assign({},am),bG=yG.BufferGeometryUtils||yG,xG=Aa({props:{pointsData:{default:[]},pointLat:{default:`lat`},pointLng:{default:`lng`},pointColor:{default:function(){return`#ffffaa`}},pointAltitude:{default:.1},pointRadius:{default:.25},pointResolution:{default:12,triggerUpdate:!1},pointsMerge:{default:!1},pointsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;KW(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new _G(e,{objBindAttr:`__threeObjPoint`})},update:function(e,t){var n=R(e.pointLat),r=R(e.pointLng),i=R(e.pointAltitude),a=R(e.pointRadius),o=R(e.pointColor),s=new vG.CylinderGeometry(1,1,1,e.pointResolution);s.applyMatrix4(new vG.Matrix4().makeRotationX(Math.PI/2)),s.applyMatrix4(new vG.Matrix4().makeTranslation(0,0,-.5));var c=2*Math.PI*JW/360,l={};if(!e.pointsMerge&&t.hasOwnProperty(`pointsMerge`)&&KW(e.scene),e.dataMapper.scene=e.pointsMerge?new vG.Object3D:e.scene,e.dataMapper.onCreateObj(f).onUpdateObj(p).digest(e.pointsData),e.pointsMerge){var u=e.pointsData.length?(bG.mergeGeometries||bG.mergeBufferGeometries)(e.pointsData.map(function(t){var n=e.dataMapper.getObj(t),r=n.geometry.clone();n.updateMatrix(),r.applyMatrix4(n.matrix);var i=lG(o(t));return r.setAttribute(`color`,fG(Array(r.getAttribute(`position`).count).fill(i),4)),r})):new vG.BufferGeometry,d=new vG.Mesh(u,new vG.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0}));d.__globeObjType=`points`,d.__data=e.pointsData,e.dataMapper.clear(),KW(e.scene),e.scene.add(d)}function f(){var e=new vG.Mesh(s);return e.__globeObjType=`point`,e}function p(t,s){var u=function(n){var r=t.__currentTargetD=n,i=r.r,a=r.alt,o=r.lat,s=r.lng;Object.assign(t.position,XW(o,s));var l=e.pointsMerge?new vG.Vector3(0,0,0):e.scene.localToWorld(new vG.Vector3(0,0,0));t.lookAt(l),t.scale.x=t.scale.y=Math.min(30,i)*c,t.scale.z=Math.max(a*JW,.1)},d={alt:+i(s),r:+a(s),lat:+n(s),lng:+r(s)},f=t.__currentTargetD||Object.assign({},d,{alt:-.001});if(Object.keys(d).some(function(e){return f[e]!==d[e]})&&(e.pointsMerge||!e.pointsTransitionDuration||e.pointsTransitionDuration<0?u(d):e.tweenGroup.add(new La(f).to(d,e.pointsTransitionDuration).easing(ja.Quadratic.InOut).onUpdate(u).start())),!e.pointsMerge){var p=o(s),m=p?cG(p):0,h=!!m;t.visible=h,h&&(l.hasOwnProperty(p)||(l[p]=new vG.MeshLambertMaterial({color:sG(p),transparent:m<1,opacity:m})),t.material=l[p])}}}}),SG=function(){return{uniforms:{dashOffset:{value:0},dashSize:{value:1},gapSize:{value:0},dashTranslate:{value:0}},vertexShader:`
    ${Qt.common}
    ${Qt.logdepthbuf_pars_vertex}
  
    uniform float dashTranslate; 

    attribute vec4 color;
    varying vec4 vColor;
    
    attribute float relDistance;
    varying float vRelDistance;

    void main() {
      // pass through colors and distances
      vColor = color;
      vRelDistance = relDistance + dashTranslate;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  
      ${Qt.logdepthbuf_vertex}
    }
  `,fragmentShader:`
    ${Qt.logdepthbuf_pars_fragment}

    uniform float dashOffset; 
    uniform float dashSize;
    uniform float gapSize; 
    
    varying vec4 vColor;
    varying float vRelDistance;
    
    void main() {
      // ignore pixels in the gap
      if (vRelDistance < dashOffset) discard;
      if (mod(vRelDistance - dashOffset, dashSize + gapSize) > dashSize) discard;
    
      // set px color: [r, g, b, a], interpolated between vertices 
      gl_FragColor = vColor; 
  
      ${Qt.logdepthbuf_fragment}
    }
  `}},CG=function(e){return e.uniforms.uSurfaceRadius={type:`float`,value:0},e.vertexShader=(`attribute float surfaceRadius;
varying float vSurfaceRadius;
varying vec3 vPos;
`+e.vertexShader).replace(`void main() {`,[`void main() {`,`vSurfaceRadius = surfaceRadius;`,`vPos = position;`].join(`
`)),e.fragmentShader=(`uniform float uSurfaceRadius;
varying float vSurfaceRadius;
varying vec3 vPos;
`+e.fragmentShader).replace(`void main() {`,[`void main() {`,`if (length(vPos) < max(uSurfaceRadius, vSurfaceRadius)) discard;`].join(`
`)),e},wG=function(e){return e.vertexShader=`
    attribute float r;
    
    const float PI = 3.1415926535897932384626433832795;
    float toRad(in float a) {
      return a * PI / 180.0;
    }
    
    vec3 Polar2Cartesian(in vec3 c) { // [lat, lng, r]
      float phi = toRad(90.0 - c.x);
      float theta = toRad(90.0 - c.y);
      float r = c.z;
      return vec3( // x,y,z
        r * sin(phi) * cos(theta),
        r * cos(phi),
        r * sin(phi) * sin(theta)
      );
    }
    
    vec2 Cartesian2Polar(in vec3 p) {
      float r = sqrt(p.x * p.x + p.y * p.y + p.z * p.z);
      float phi = acos(p.y / r);
      float theta = atan(p.z, p.x);
      return vec2( // lat,lng
        90.0 - phi * 180.0 / PI,
        90.0 - theta * 180.0 / PI - (theta < -PI / 2.0 ? 360.0 : 0.0)
      );
    }
    ${e.vertexShader.replace(`}`,`                  
        vec3 pos = Polar2Cartesian(vec3(Cartesian2Polar(position), r));
        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
      }
    `)}
  `,e},TG=function(e,t){return e.onBeforeCompile=function(n){e.userData.shader=t(n)},e},EG=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(e){return e};if(e.userData.shader)t(e.userData.shader.uniforms);else{var n=e.onBeforeCompile;e.onBeforeCompile=function(e){n(e),t(e.uniforms)}}},DG=[`stroke`],OG=window.THREE?window.THREE:{BufferGeometry:Xr,CubicBezierCurve3:ke,Curve:Ct,Group:ei,Line:jt,Mesh:tr,NormalBlending:1,ShaderMaterial:Bt,TubeGeometry:Kr,Vector3:j},kG=Ph.default.default||Ph.default,AG=Aa({props:{arcsData:{default:[]},arcStartLat:{default:`startLat`},arcStartLng:{default:`startLng`},arcStartAltitude:{default:0},arcEndLat:{default:`endLat`},arcEndLng:{default:`endLng`},arcEndAltitude:{default:0},arcColor:{default:function(){return`#ffffaa`}},arcAltitude:{},arcAltitudeAutoScale:{default:.5},arcStroke:{},arcCurveResolution:{default:64,triggerUpdate:!1},arcCircularResolution:{default:6,triggerUpdate:!1},arcDashLength:{default:1},arcDashGap:{default:0},arcDashInitialGap:{default:0},arcDashAnimateTime:{default:0},arcsTransitionDuration:{default:1e3,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)==null||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)==null||t.resume()},_destructor:function(e){var t;e.sharedMaterial.dispose(),(t=e.ticker)==null||t.dispose()}},stateInit:function(e){return{tweenGroup:e.tweenGroup,ticker:new kG,sharedMaterial:new OG.ShaderMaterial(AW(AW({},SG()),{},{transparent:!0,blending:OG.NormalBlending}))}},init:function(e,t){KW(e),t.scene=e,t.dataMapper=new _G(e,{objBindAttr:`__threeObjArc`}).onCreateObj(function(){var e=new OG.Group;return e.__globeObjType=`arc`,e}),t.ticker.onTick.add(function(e,n){t.dataMapper.entries().map(function(e){return LW(e,2)[1]}).filter(function(e){return e.children.length&&e.children[0].material&&e.children[0].__dashAnimateStep}).forEach(function(e){var t=e.children[0],r=t.__dashAnimateStep*n,i=t.material.uniforms.dashTranslate.value%1e9;t.material.uniforms.dashTranslate.value=i+r})})},update:function(e){var t=R(e.arcStartLat),n=R(e.arcStartLng),r=R(e.arcStartAltitude),i=R(e.arcEndLat),a=R(e.arcEndLng),o=R(e.arcEndAltitude),s=R(e.arcAltitude),c=R(e.arcAltitudeAutoScale),l=R(e.arcStroke),u=R(e.arcColor),d=R(e.arcDashLength),f=R(e.arcDashGap),p=R(e.arcDashInitialGap),m=R(e.arcDashAnimateTime);e.dataMapper.onUpdateObj(function(v,y){var b=l(y),x=b!=null;if(!v.children.length||x!==(v.children[0].type===`Mesh`)){KW(v);var S=x?new OG.Mesh:new OG.Line(new OG.BufferGeometry);S.material=e.sharedMaterial.clone(),v.add(S)}var C=v.children[0];Object.assign(C.material.uniforms,{dashSize:{value:d(y)},gapSize:{value:f(y)},dashOffset:{value:p(y)}});var w=m(y);C.__dashAnimateStep=w>0?1e3/w:0;var T=g(u(y),e.arcCurveResolution,x?e.arcCircularResolution+1:1),E=_(e.arcCurveResolution,x?e.arcCircularResolution+1:1,!0);C.geometry.setAttribute(`color`,T),C.geometry.setAttribute(`relDistance`,E);var D=function(t){var n=v.__currentTargetD=t,r=n.stroke,i=h(jW(n,DG));x?(C.geometry&&C.geometry.dispose(),C.geometry=new OG.TubeGeometry(i,e.arcCurveResolution,r/2,e.arcCircularResolution),C.geometry.setAttribute(`color`,T),C.geometry.setAttribute(`relDistance`,E)):C.geometry.setFromPoints(i.getPoints(e.arcCurveResolution))},O={stroke:b,alt:s(y),altAutoScale:+c(y),startLat:+t(y),startLng:+n(y),startAlt:+r(y),endLat:+i(y),endLng:+a(y),endAlt:+o(y)},ee=v.__currentTargetD||Object.assign({},O,{altAutoScale:-.001});Object.keys(O).some(function(e){return ee[e]!==O[e]})&&(!e.arcsTransitionDuration||e.arcsTransitionDuration<0?D(O):e.tweenGroup.add(new La(ee).to(O,e.arcsTransitionDuration).easing(ja.Quadratic.InOut).onUpdate(D).start()))}).digest(e.arcsData);function h(e){var t=e.alt,n=e.altAutoScale,r=e.startLat,i=e.startLng,a=e.startAlt,o=e.endLat,s=e.endLng,c=e.endAlt,l=function(e){var t=LW(e,3),n=t[0],r=t[1],i=t[2],a=XW(r,n,i),o=a.x,s=a.y,c=a.z;return new OG.Vector3(o,s,c)},u=[i,r],d=[s,o],f=t;if(f??=rd(u,d)/2*n+Math.max(a,c),f||a||c){var p=_d(u,d),m=function(e,t){return t+(t-e)*(e<t?.5:.25)},h=LW([.25,.75].map(function(e){return[].concat(BW(p(e)),[m(e<.5?a:c,f)])}),2),g=h[0],_=h[1];return _W(OG.CubicBezierCurve3,BW([[].concat(u,[a]),g,_,[].concat(d,[c])].map(l)))}else{var v=.001;return y.apply(void 0,BW([[].concat(u,[v]),[].concat(d,[v])].map(l)))}function y(e,t){var n=e.angleTo(t),r=n===0?function(){return e.clone()}:function(r){return new OG.Vector3().addVectors(e.clone().multiplyScalar(Math.sin((1-r)*n)),t.clone().multiplyScalar(Math.sin(r*n))).divideScalar(Math.sin(n))},i=new OG.Curve;return i.getPoint=r,i}}function g(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=t+1,i;if(e instanceof Array||e instanceof Function){var a=e instanceof Array?wc().domain(e.map(function(t,n){return n/(e.length-1)})).range(e):e;i=function(e){return lG(a(e),!0,!0)}}else{var o=lG(e,!0,!0);i=function(){return o}}for(var s=[],c=0,l=r;c<l;c++)for(var u=i(c/(l-1)),d=0;d<n;d++)s.push(u);return fG(s,4)}function _(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=e+1,i=[],a=0,o=r;a<o;a++)for(var s=a/(o-1),c=0;c<t;c++)i.push(s);return n&&i.reverse(),fG(i,1)}}}),jG=window.THREE?window.THREE:{BufferGeometry:Xr,DoubleSide:2,Mesh:tr,MeshLambertMaterial:gn,Object3D:je},MG=Object.assign({},am),NG=MG.BufferGeometryUtils||MG,PG=Aa({props:{hexBinPointsData:{default:[]},hexBinPointLat:{default:`lat`},hexBinPointLng:{default:`lng`},hexBinPointWeight:{default:1},hexBinResolution:{default:4},hexMargin:{default:.2},hexTopCurvatureResolution:{default:5},hexTopColor:{default:function(){return`#ffffaa`}},hexSideColor:{default:function(){return`#ffffaa`}},hexAltitude:{default:function(e){return e.sumWeight*.01}},hexBinMerge:{default:!1},hexTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;KW(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new _G(e,{objBindAttr:`__threeObjHexbin`})},update:function(e,t){var n=R(e.hexBinPointLat),r=R(e.hexBinPointLng),i=R(e.hexBinPointWeight),a=R(e.hexAltitude),o=R(e.hexTopColor),s=R(e.hexSideColor),c=R(e.hexMargin),l=K_(e.hexBinPointsData.map(function(t){return AW(AW({},t),{},{h3Idx:ry(n(t),r(t),e.hexBinResolution)})}),`h3Idx`),u=Object.entries(l).map(function(e){var t=LW(e,2),n=t[0],r=t[1];return{h3Idx:n,points:r,sumWeight:r.reduce(function(e,t){return e+ +i(t)},0)}}),d={};if(!e.hexBinMerge&&t.hasOwnProperty(`hexBinMerge`)&&KW(e.scene),e.dataMapper.scene=e.hexBinMerge?new jG.Object3D:e.scene,e.dataMapper.id(function(e){return e.h3Idx}).onCreateObj(h).onUpdateObj(g).digest(u),e.hexBinMerge){var f=u.length?(NG.mergeGeometries||NG.mergeBufferGeometries)(u.map(function(t){var n=e.dataMapper.getObj(t),r=n.geometry.toNonIndexed();n.updateMatrix(),r.applyMatrix4(n.matrix);var i=lG(o(t)),a=lG(s(t)),c=r.getAttribute(`position`).count,l=r.groups[0].count;return r.setAttribute(`color`,fG(BW(Array(c)).map(function(e,t){return t>=l?i:a}),4)),r})):new jG.BufferGeometry,p=new jG.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0,side:jG.DoubleSide});p.onBeforeCompile=function(e){p.userData.shader=CG(e)};var m=new jG.Mesh(f,p);m.__globeObjType=`hexBinPoints`,m.__data=u,e.dataMapper.clear(),KW(e.scene),e.scene.add(m)}function h(e){var t=new jG.Mesh;t.__hexCenter=iy(e.h3Idx),t.__hexGeoJson=ay(e.h3Idx,!0).reverse();var n=t.__hexCenter[1];return t.__hexGeoJson.forEach(function(e){var t=e[0];Math.abs(n-t)>170&&(e[0]+=n>t?360:-360)}),t.__globeObjType=`hexbin`,t}function g(t,n){var r=function(e,t,n){return e-(e-t)*n},i=Math.max(0,Math.min(1,+c(n))),l=LW(t.__hexCenter,2),u=l[0],f=l[1],p=i===0?t.__hexGeoJson:t.__hexGeoJson.map(function(e){var t=LW(e,2),n=t[0],a=t[1];return[[n,f],[a,u]].map(function(e){var t=LW(e,2),n=t[0],a=t[1];return r(n,a,i)})}),m=e.hexTopCurvatureResolution;t.geometry&&t.geometry.dispose(),t.geometry=new A_([p],0,JW,!1,!0,!0,m);var h={alt:+a(n)},g=function(e){var n=(t.__currentTargetD=e).alt;t.scale.x=t.scale.y=t.scale.z=1+n;var r=JW/(n+1);t.geometry.setAttribute(`surfaceRadius`,fG(Array(t.geometry.getAttribute(`position`).count).fill(r),1))},_=t.__currentTargetD||Object.assign({},h,{alt:-.001});if(Object.keys(h).some(function(e){return _[e]!==h[e]})&&(e.hexBinMerge||!e.hexTransitionDuration||e.hexTransitionDuration<0?g(h):e.tweenGroup.add(new La(_).to(h,e.hexTransitionDuration).easing(ja.Quadratic.InOut).onUpdate(g).start())),!e.hexBinMerge){var v=s(n),y=o(n);[v,y].forEach(function(e){if(!d.hasOwnProperty(e)){var t=cG(e);d[e]=TG(new jG.MeshLambertMaterial({color:sG(e),transparent:t<1,opacity:t,side:jG.DoubleSide}),CG)}}),t.material=[v,y].map(function(e){return d[e]})}}}}),FG=function(e){return e*e},IG=function(e){return e*Math.PI/180};function LG(e,t){var n=Math.sqrt,r=Math.cos,i=function(e){return FG(Math.sin(e/2))},a=IG(e[1]),o=IG(t[1]),s=IG(e[0]),c=IG(t[0]);return 2*Math.asin(n(i(o-a)+r(a)*r(o)*i(c-s)))}var RG=Math.sqrt(2*Math.PI);function zG(e,t){return Math.exp(-FG(e/t)/2)/(t*RG)}var BG=function(e){var t=LW(e,2),n=t[0],r=t[1],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=a.lngAccessor,s=o===void 0?function(e){return e[0]}:o,c=a.latAccessor,l=c===void 0?function(e){return e[1]}:c,u=a.weightAccessor,d=u===void 0?function(){return 1}:u,f=a.bandwidth,p=[n,r],m=f*Math.PI/180;return Po(i.map(function(e){var t=d(e);return t?zG(LG(p,[s(e),l(e)]),m)*t:0}))},VG=function(){var e=uW(PW().m(function e(t){var n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,T,E,D,O,ee,k,te,A,ne,re,ie,ae,oe,se,ce,le,ue,de=arguments,fe,pe,me;return PW().w(function(e){for(;;)switch(e.n){case 0:if(r=de.length>1&&de[1]!==void 0?de[1]:[],i=de.length>2&&de[2]!==void 0?de[2]:{},a=i.lngAccessor,o=a===void 0?function(e){return e[0]}:a,s=i.latAccessor,c=s===void 0?function(e){return e[1]}:s,l=i.weightAccessor,u=l===void 0?function(){return 1}:l,d=i.bandwidth,(n=navigator)!=null&&n.gpu){e.n=1;break}return console.warn(`WebGPU not enabled in browser. Please consider enabling it to improve performance.`),e.a(2,t.map(function(e){return BG(e,r,{lngAccessor:o,latAccessor:c,weightAccessor:u,bandwidth:d})}));case 1:return f=4,p=hU,m=gU,h=DU,g=EU,_=xU,v=SU,y=_U,b=TU,x=wU,S=yU,C=vU,w=bU,T=CU,E=g(new FP(new Float32Array(t.flat().map(IG)),2),`vec2`,t.length),D=g(new FP(new Float32Array(r.map(function(e){return[IG(o(e)),IG(c(e)),u(e)]}).flat()),3),`vec3`,r.length),O=new FP(t.length,1),ee=g(O,`float`,t.length),k=_(Math.PI),te=b(k.mul(2)),A=function(e){return e.mul(e)},ne=function(e){return A(x(e.div(2)))},re=function(e,t){var n=_(e[1]),r=_(t[1]),i=_(e[0]),a=_(t[0]);return _(2).mul(C(b(ne(r.sub(n)).add(S(n).mul(S(r)).mul(ne(a.sub(i)))))))},ie=function(e,t){return w(T(A(e.div(t)).div(2))).div(t.mul(te))},ae=h(IG(d)),oe=h(IG(d*f)),se=h(r.length),ce=p(function(){var e=E.element(v),t=ee.element(v);t.assign(0),y(se,function(n){var r=n.i,i=D.element(r),a=i.z;m(a,function(){var n=re(i.xy,e.xy);m(n&&n.lessThan(oe),function(){t.addAssign(ie(n,ae).mul(a))})})})}),le=ce().compute(t.length),ue=new mU,e.n=2,ue.computeAsync(le);case 2:return fe=Array,pe=Float32Array,e.n=3,ue.getArrayBufferAsync(O);case 3:return me=e.v,e.a(2,fe.from.call(fe,new pe(me)))}},e)}));return function(t){return e.apply(this,arguments)}}(),HG=window.THREE?window.THREE:{Mesh:tr,MeshLambertMaterial:gn,SphereGeometry:yn},UG=3.5,WG=.1,GG=100,KG=function(e){var t=ns(ly(e));return t.opacity=Math.cbrt(e),t.formatRgb()},qG=Aa({props:{heatmapsData:{default:[]},heatmapPoints:{default:function(e){return e}},heatmapPointLat:{default:function(e){return e[0]}},heatmapPointLng:{default:function(e){return e[1]}},heatmapPointWeight:{default:1},heatmapBandwidth:{default:2.5},heatmapColorFn:{default:function(){return KG}},heatmapColorSaturation:{default:1.5},heatmapBaseAltitude:{default:.01},heatmapTopAltitude:{},heatmapsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;KW(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new _G(e,{objBindAttr:`__threeObjHeatmap`}).onCreateObj(function(){var e=new HG.Mesh(new HG.SphereGeometry(JW),TG(new HG.MeshLambertMaterial({vertexColors:!0,transparent:!0}),wG));return e.__globeObjType=`heatmap`,e})},update:function(e){var t=R(e.heatmapPoints),n=R(e.heatmapPointLat),r=R(e.heatmapPointLng),i=R(e.heatmapPointWeight),a=R(e.heatmapBandwidth),o=R(e.heatmapColorFn),s=R(e.heatmapColorSaturation),c=R(e.heatmapBaseAltitude),l=R(e.heatmapTopAltitude);e.dataMapper.onUpdateObj(function(u,d){var f=a(d),p=o(d),m=s(d),h=c(d),g=l(d),_=t(d).map(function(e){var t=n(e),a=r(e),o=XW(t,a);return{x:o.x,y:o.y,z:o.z,lat:t,lng:a,weight:i(e)}}),v=Math.max(WG,f/UG),y=Math.ceil(360/(v||-1));u.geometry.parameters.widthSegments!==y&&(u.geometry.dispose(),u.geometry=new HG.SphereGeometry(JW,y,y/2)),VG(pG(u.geometry.getAttribute(`position`)).map(function(e){var t=LW(e,3),n=t[0],r=t[1],i=t[2],a=ZW({x:n,y:r,z:i});return[a.lng,a.lat]}),_,{latAccessor:function(e){return e.lat},lngAccessor:function(e){return e.lng},weightAccessor:function(e){return e.weight},bandwidth:f}).then(function(t){var n=BW(Array(GG)).map(function(e,t){return lG(p(t/(GG-1)))}),r=function(e){var t=u.__currentTargetD=e,r=t.kdeVals,i=t.topAlt,a=t.saturation,o=ko(r.map(Math.abs))||1e-15,s=Tc([0,o/a],n);u.geometry.setAttribute(`color`,fG(r.map(function(e){return s(Math.abs(e))}),4));var c=wc([0,o],[JW*(1+h),JW*(1+(i||h))]);u.geometry.setAttribute(`r`,fG(r.map(c)))},i={kdeVals:t,topAlt:g,saturation:m},a=u.__currentTargetD||Object.assign({},i,{kdeVals:t.map(function(){return 0}),topAlt:g&&h,saturation:.5});a.kdeVals.length!==t.length&&(a.kdeVals=t.slice()),Object.keys(i).some(function(e){return a[e]!==i[e]})&&(!e.heatmapsTransitionDuration||e.heatmapsTransitionDuration<0?r(i):e.tweenGroup.add(new La(a).to(i,e.heatmapsTransitionDuration).easing(ja.Quadratic.InOut).onUpdate(r).start()))})}).digest(e.heatmapsData)}}),JG=window.THREE?window.THREE:{DoubleSide:2,Group:ei,LineBasicMaterial:Oe,LineSegments:Ce,Mesh:tr,MeshBasicMaterial:Wr},YG=Aa({props:{polygonsData:{default:[]},polygonGeoJsonGeometry:{default:`geometry`},polygonSideColor:{default:function(){return`#ffffaa`}},polygonSideMaterial:{},polygonCapColor:{default:function(){return`#ffffaa`}},polygonCapMaterial:{},polygonStrokeColor:{},polygonAltitude:{default:.01},polygonCapCurvatureResolution:{default:5},polygonsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;KW(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new _G(e,{objBindAttr:`__threeObjPolygon`}).id(function(e){return e.id}).onCreateObj(function(){var e=new JG.Group;return e.__defaultSideMaterial=TG(new JG.MeshBasicMaterial({side:JG.DoubleSide,depthWrite:!0}),CG),e.__defaultCapMaterial=new JG.MeshBasicMaterial({side:JG.DoubleSide,depthWrite:!0}),e.add(new JG.Mesh(void 0,[e.__defaultSideMaterial,e.__defaultCapMaterial])),e.add(new JG.LineSegments(void 0,new JG.LineBasicMaterial)),e.__globeObjType=`polygon`,e})},update:function(e){var t=R(e.polygonGeoJsonGeometry),n=R(e.polygonAltitude),r=R(e.polygonCapCurvatureResolution),i=R(e.polygonCapColor),a=R(e.polygonCapMaterial),o=R(e.polygonSideColor),s=R(e.polygonSideMaterial),c=R(e.polygonStrokeColor),l=[];e.polygonsData.forEach(function(e){var u={data:e,capColor:i(e),capMaterial:a(e),sideColor:o(e),sideMaterial:s(e),strokeColor:c(e),altitude:+n(e),capCurvatureResolution:+r(e)},d=t(e),f=e.__id||`${Math.round(Math.random()*1e9)}`;e.__id=f,d.type===`Polygon`?l.push(AW({id:`${f}_0`,coords:d.coordinates},u)):d.type===`MultiPolygon`?l.push.apply(l,BW(d.coordinates.map(function(e,t){return AW({id:`${f}_${t}`,coords:e},u)}))):console.warn(`Unsupported GeoJson geometry type: ${d.type}. Skipping geometry...`)}),e.dataMapper.onUpdateObj(function(t,n){var r=n.coords,i=n.capColor,a=n.capMaterial,o=n.sideColor,s=n.sideMaterial,c=n.strokeColor,l=n.altitude,u=n.capCurvatureResolution,d=LW(t.children,2),f=d[0],p=d[1],m=!!c;p.visible=m;var h=!!(i||a),g=!!(o||s);XG(f.geometry.parameters||{},{polygonGeoJson:r,curvatureResolution:u,closedTop:h,includeSides:g})||(f.geometry&&f.geometry.dispose(),f.geometry=new A_(r,0,JW,!1,h,g,u)),m&&(!p.geometry.parameters||p.geometry.parameters.geoJson.coordinates!==r||p.geometry.parameters.resolution!==u)&&(p.geometry&&p.geometry.dispose(),p.geometry=new tm({type:`Polygon`,coordinates:r},JW,u));var _=g?0:-1,v=h?g?1:0:-1;if(_>=0&&(f.material[_]=s||t.__defaultSideMaterial),v>=0&&(f.material[v]=a||t.__defaultCapMaterial),[[!s&&o,_],[!a&&i,v]].forEach(function(e){var t=LW(e,2),n=t[0],r=t[1];if(!(!n||r<0)){var i=f.material[r],a=cG(n);i.color.set(sG(n)),i.transparent=a<1,i.opacity=a}}),m){var y=p.material,b=cG(c);y.color.set(sG(c)),y.transparent=b<1,y.opacity=b}var x={alt:l},S=function(e){var n=(t.__currentTargetD=e).alt;f.scale.x=f.scale.y=f.scale.z=1+n,m&&(p.scale.x=p.scale.y=p.scale.z=1+n+1e-4),EG(t.__defaultSideMaterial,function(e){return e.uSurfaceRadius.value=JW/(n+1)})},C=t.__currentTargetD||Object.assign({},x,{alt:-.001});Object.keys(x).some(function(e){return C[e]!==x[e]})&&(!e.polygonsTransitionDuration||e.polygonsTransitionDuration<0||C.alt===x.alt?S(x):e.tweenGroup.add(new La(C).to(x,e.polygonsTransitionDuration).easing(ja.Quadratic.InOut).onUpdate(S).start()))}).digest(l)}});function XG(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){return function(e,t){return e===t}};return Object.entries(t).every(function(t){var r=LW(t,2),i=r[0],a=r[1];return e.hasOwnProperty(i)&&n(i)(e[i],a)})}var ZG=window.THREE?window.THREE:{BufferGeometry:Xr,DoubleSide:2,Mesh:tr,MeshLambertMaterial:gn,Vector3:j},QG=Object.assign({},am),$G=QG.BufferGeometryUtils||QG,eK=Aa({props:{hexPolygonsData:{default:[]},hexPolygonGeoJsonGeometry:{default:`geometry`},hexPolygonColor:{default:function(){return`#ffffaa`}},hexPolygonAltitude:{default:.001},hexPolygonResolution:{default:3},hexPolygonMargin:{default:.2},hexPolygonUseDots:{default:!1},hexPolygonCurvatureResolution:{default:5},hexPolygonDotResolution:{default:12},hexPolygonsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;KW(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new _G(e,{objBindAttr:`__threeObjHexPolygon`}).onCreateObj(function(){var e=new ZG.Mesh(void 0,new ZG.MeshLambertMaterial({side:ZG.DoubleSide}));return e.__globeObjType=`hexPolygon`,e})},update:function(e){var t=R(e.hexPolygonGeoJsonGeometry),n=R(e.hexPolygonColor),r=R(e.hexPolygonAltitude),i=R(e.hexPolygonResolution),a=R(e.hexPolygonMargin),o=R(e.hexPolygonUseDots),s=R(e.hexPolygonCurvatureResolution),c=R(e.hexPolygonDotResolution);e.dataMapper.onUpdateObj(function(l,u){var d=t(u),f=i(u),p=r(u),m=Math.max(0,Math.min(1,+a(u))),h=o(u),g=s(u),_=c(u),v=n(u),y=cG(v);l.material.color.set(sG(v)),l.material.transparent=y<1,l.material.opacity=y;var b={alt:p,margin:m,curvatureResolution:g},x={geoJson:d,h3Res:f},S=l.__currentTargetD||Object.assign({},b,{alt:-.001}),C=l.__currentMemD||x;if(Object.keys(b).some(function(e){return S[e]!==b[e]})||Object.keys(x).some(function(e){return C[e]!==x[e]})){l.__currentMemD=x;var w=[];d.type===`Polygon`?oy(d.coordinates,f,!0).forEach(function(e){return w.push(e)}):d.type===`MultiPolygon`?d.coordinates.forEach(function(e){return oy(e,f,!0).forEach(function(e){return w.push(e)})}):console.warn(`Unsupported GeoJson geometry type: ${d.type}. Skipping geometry...`);var T=w.map(function(e){var t=iy(e),n=ay(e,!0).reverse(),r=t[1];return n.forEach(function(e){var t=e[0];Math.abs(r-t)>170&&(e[0]+=r>t?360:-360)}),{h3Idx:e,hexCenter:t,hexGeoJson:n}}),E=function(e){var t=l.__currentTargetD=e,n=t.alt,r=t.margin,i=t.curvatureResolution;l.geometry&&l.geometry.dispose(),l.geometry=T.length?($G.mergeGeometries||$G.mergeBufferGeometries)(T.map(function(e){var t=LW(e.hexCenter,2),a=t[0],o=t[1];if(h){var s=XW(a,o,n),c=XW(e.hexGeoJson[0][1],e.hexGeoJson[0][0],n),l=new Ue(.85*(1-r)*new ZG.Vector3(s.x,s.y,s.z).distanceTo(new ZG.Vector3(c.x,c.y,c.z)),_);return l.rotateX(QW(-a)),l.rotateY(QW(o)),l.translate(s.x,s.y,s.z),l}else{var u=function(e,t,n){return e-(e-t)*n};return new A_([r===0?e.hexGeoJson:e.hexGeoJson.map(function(e){var t=LW(e,2),n=t[0],i=t[1];return[[n,o],[i,a]].map(function(e){var t=LW(e,2),n=t[0],i=t[1];return u(n,i,r)})})],JW,JW*(1+n),!1,!0,!1,i)}})):new ZG.BufferGeometry};!e.hexPolygonsTransitionDuration||e.hexPolygonsTransitionDuration<0?E(b):e.tweenGroup.add(new La(S).to(b,e.hexPolygonsTransitionDuration).easing(ja.Quadratic.InOut).onUpdate(E).start())}}).digest(e.hexPolygonsData)}}),tK=window.THREE?window.THREE:{Vector3:j};function nK(e,t){var n=function(e,t){var n=e[e.length-1];return[].concat(BW(e),BW(Array(t-e.length).fill(n)))},r=Math.max(e.length,t.length),i=ks.apply(void 0,BW([e,t].map(function(e){return e.map(function(e){return[e.x,e.y,e.z]})}).map(function(e){return n(e,r)})));return function(n){return n===0?e:n===1?t:i(n).map(function(e){var t=LW(e,3),n=t[0],r=t[1],i=t[2];return new tK.Vector3(n,r,i)})}}var rK=window.THREE?window.THREE:{BufferGeometry:Xr,Color:a,Group:ei,Line:jt,NormalBlending:1,ShaderMaterial:Bt,Vector3:j},iK=Ph.default.default||Ph.default,aK=Aa({props:{pathsData:{default:[]},pathPoints:{default:function(e){return e}},pathPointLat:{default:function(e){return e[0]}},pathPointLng:{default:function(e){return e[1]}},pathPointAlt:{default:.001},pathResolution:{default:2},pathColor:{default:function(){return`#ffffaa`}},pathStroke:{},pathDashLength:{default:1},pathDashGap:{default:0},pathDashInitialGap:{default:0},pathDashAnimateTime:{default:0},pathTransitionDuration:{default:1e3,triggerUpdate:!1},rendererSize:{}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)==null||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)==null||t.resume()},_destructor:function(e){var t;(t=e.ticker)==null||t.dispose()}},stateInit:function(e){return{tweenGroup:e.tweenGroup,ticker:new iK,sharedMaterial:new rK.ShaderMaterial(AW(AW({},SG()),{},{transparent:!0,blending:rK.NormalBlending}))}},init:function(e,t){KW(e),t.scene=e,t.dataMapper=new _G(e,{objBindAttr:`__threeObjPath`}).onCreateObj(function(){var e=new rK.Group;return e.__globeObjType=`path`,e}),t.ticker.onTick.add(function(e,n){t.dataMapper.entries().map(function(e){return LW(e,2)[1]}).filter(function(e){return e.children.length&&e.children[0].material&&e.children[0].__dashAnimateStep}).forEach(function(e){var t=e.children[0],r=t.__dashAnimateStep*n;if(t.type===`Line`){var i=t.material.uniforms.dashTranslate.value%1e9;t.material.uniforms.dashTranslate.value=i+r}else if(t.type===`Line2`){for(var a=t.material.dashOffset-r,o=t.material.dashSize+t.material.gapSize;a<=-o;)a+=o;t.material.dashOffset=a}})})},update:function(e){var t=R(e.pathPoints),n=R(e.pathPointLat),r=R(e.pathPointLng),i=R(e.pathPointAlt),a=R(e.pathStroke),o=R(e.pathColor),s=R(e.pathDashLength),c=R(e.pathDashGap),l=R(e.pathDashInitialGap),u=R(e.pathDashAnimateTime);e.dataMapper.onUpdateObj(function(h,g){var _=a(g),v=_!=null;if(!h.children.length||v===(h.children[0].type===`Line`)){KW(h);var y=v?new QU(new ZU,new jU):new rK.Line(new rK.BufferGeometry,e.sharedMaterial.clone());h.add(y)}var b=h.children[0],x=f(t(g),n,r,i,e.pathResolution),S=u(g);if(b.__dashAnimateStep=S>0?1e3/S:0,v){b.material.resolution=e.rendererSize;var C=s(g),w=c(g),T=l(g);b.material.dashed=w>0,b.material.dashed?b.material.defines.USE_DASH=``:delete b.material.defines.USE_DASH,b.material.dashed&&(b.material.dashScale=1/d(x),b.material.dashSize=C,b.material.gapSize=w,b.material.dashOffset=-T);var E=o(g);if(E instanceof Array){var D=p(o(g),x.length-1,1,!1);b.geometry.setColors(D.array),b.material.vertexColors=!0}else{var O=E,ee=cG(O);b.material.color=new rK.Color(sG(O)),b.material.transparent=ee<1,b.material.opacity=ee,b.material.vertexColors=!1}b.material.needsUpdate=!0}else{Object.assign(b.material.uniforms,{dashSize:{value:s(g)},gapSize:{value:c(g)},dashOffset:{value:l(g)}});var k=p(o(g),x.length),te=m(x.length,1,!0);b.geometry.setAttribute(`color`,k),b.geometry.setAttribute(`relDistance`,te)}var A=nK(h.__currentTargetD&&h.__currentTargetD.points||[x[0]],x),ne=function(e){var t=h.__currentTargetD=e,n=t.stroke,r=t.interpolK,i=h.__currentTargetD.points=A(r);if(v){var a;b.geometry.setPositions((a=[]).concat.apply(a,BW(i.map(function(e){return[e.x,e.y,e.z]})))),b.material.linewidth=n,b.material.dashed&&b.computeLineDistances()}else b.geometry.setFromPoints(i),b.geometry.computeBoundingSphere()},re={stroke:_,interpolK:1},ie=Object.assign({},h.__currentTargetD||re,{interpolK:0});Object.keys(re).some(function(e){return ie[e]!==re[e]})&&(!e.pathTransitionDuration||e.pathTransitionDuration<0?ne(re):e.tweenGroup.add(new La(ie).to(re,e.pathTransitionDuration).easing(ja.Quadratic.InOut).onUpdate(ne).start()))}).digest(e.pathsData);function d(e){var t=0,n;return e.forEach(function(e){n&&(t+=n.distanceTo(e)),n=e}),t}function f(e,t,n,r,i){var a=function(e,t,n){for(var r=[],i=1;i<=n;i++)r.push(e+(t-e)*i/(n+1));return r};return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=[],r=null;return e.forEach(function(e){if(r){for(;Math.abs(r[1]-e[1])>180;)r[1]+=360*(r[1]<e[1]?1:-1);var i=Math.sqrt((e[0]-r[0])**2+(e[1]-r[1])**2);if(i>t)for(var o=Math.floor(i/t),s=a(r[0],e[0],o),c=a(r[1],e[1],o),l=a(r[2],e[2],o),u=0,d=s.length;u<d;u++)n.push([s[u],c[u],l[u]])}n.push(r=e)}),n}(e.map(function(e){return[t(e),n(e),r(e)]}),i).map(function(e){var t=LW(e,3),n=t[0],r=t[1],i=t[2],a=XW(n,r,i),o=a.x,s=a.y,c=a.z;return new rK.Vector3(o,s,c)})}function p(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=t+1,a;if(e instanceof Array||e instanceof Function){var o=e instanceof Array?wc().domain(e.map(function(t,n){return n/(e.length-1)})).range(e):e;a=function(e){return lG(o(e),r,!0)}}else{var s=lG(e,r,!0);a=function(){return s}}for(var c=[],l=0,u=i;l<u;l++)for(var d=a(l/(u-1)),f=0;f<n;f++)c.push(d);return fG(c,r?4:3)}function m(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=e+1,i=[],a=0,o=r;a<o;a++)for(var s=a/(o-1),c=0;c<t;c++)i.push(s);return n&&i.reverse(),fG(i,1)}}}),oK=window.THREE?window.THREE:{Euler:Ir,Mesh:tr,MeshLambertMaterial:gn,SphereGeometry:yn},sK=Aa({props:{tilesData:{default:[]},tileLat:{default:`lat`},tileLng:{default:`lng`},tileAltitude:{default:.01},tileWidth:{default:1},tileHeight:{default:1},tileUseGlobeProjection:{default:!0},tileMaterial:{default:function(){return new oK.MeshLambertMaterial({color:`#ffbb88`,opacity:.4,transparent:!0})}},tileCurvatureResolution:{default:5},tilesTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;KW(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new _G(e,{objBindAttr:`__threeObjTile`}).onCreateObj(function(){var e=new oK.Mesh;return e.__globeObjType=`tile`,e})},update:function(e){var t=R(e.tileLat),n=R(e.tileLng),r=R(e.tileAltitude),i=R(e.tileWidth),a=R(e.tileHeight),o=R(e.tileUseGlobeProjection),s=R(e.tileMaterial),c=R(e.tileCurvatureResolution);e.dataMapper.onUpdateObj(function(l,u){l.material=s(u);var d=o(u),f=c(u),p=function(e){var t=l.__currentTargetD=e,n=t.lat,r=t.lng,i=t.alt,a=t.width,o=t.height,s=cK(r),c=cK(-n);l.geometry&&l.geometry.dispose(),l.geometry=new oK.SphereGeometry(JW*(1+i),Math.ceil(a/(f||-1)),Math.ceil(o/(f||-1)),cK(90-a/2)+(d?s:0),cK(a),cK(90-o/2)+(d?c:0),cK(o)),d||l.setRotationFromEuler(new oK.Euler(c,s,0,`YXZ`))},m={lat:+t(u),lng:+n(u),alt:+r(u),width:+i(u),height:+a(u)},h=l.__currentTargetD||Object.assign({},m,{width:0,height:0});Object.keys(m).some(function(e){return h[e]!==m[e]})&&(!e.tilesTransitionDuration||e.tilesTransitionDuration<0?p(m):e.tweenGroup.add(new La(h).to(m,e.tilesTransitionDuration).easing(ja.Quadratic.InOut).onUpdate(p).start()))}).digest(e.tilesData)}}),cK=function(e){return e*Math.PI/180},lK=window.THREE?window.THREE:{BufferGeometry:Xr,Color:a,Points:Pt,PointsMaterial:Wt},uK=Aa({props:{particlesData:{default:[]},particlesList:{default:function(e){return e}},particleLat:{default:`lat`},particleLng:{default:`lng`},particleAltitude:{default:.01},particlesSize:{default:.5},particlesSizeAttenuation:{default:!0},particlesColor:{default:function(){return`white`}},particlesTexture:{}},init:function(e,t){KW(e),t.scene=e,t.dataMapper=new _G(e,{objBindAttr:`__threeObjParticles`}).onCreateObj(function(){var e=new lK.Points(new lK.BufferGeometry,new lK.PointsMaterial);return e.__globeObjType=`particles`,e}).onUpdateObj(function(e,n){var r=R(t.particlesList),i=R(t.particleLat),a=R(t.particleLng),o=R(t.particleAltitude);e.geometry.setAttribute(`position`,fG(r(n).map(function(e){return Object.values(XW(i(e),a(e),o(e)))}),3))})},update:function(e,t){[`particlesData`,`particlesList`,`particleLat`,`particleLng`,`particleAltitude`].some(function(e){return t.hasOwnProperty(e)})&&e.dataMapper.digest(e.particlesData);var n=R(e.particlesColor),r=R(e.particlesSize),i=R(e.particlesSizeAttenuation),a=R(e.particlesTexture);e.dataMapper.entries().forEach(function(t){var o=LW(t,2),s=o[0],c=o[1];if(c.material.size=r(s),c.material.sizeAttenuation=i(s),e.particlesTexture)c.material.color=new lK.Color(16777215),c.material.transparent=!1,c.material.alphaTest=.5,c.material.map=a(s);else{var l=n(s),u=cG(l);c.material.color=new lK.Color(sG(l)),c.material.transparent=u<1,c.material.opacity=u,c.material.alphaTest=0}})}}),dK=function(e){function t(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:32;pW(this,t),e=dW(this,t),e.type=`CircleLineGeometry`,e.parameters={radius:n,segmentCount:r};for(var i=[],a=0;a<=r;a++){var o=(a/r-.25)*Math.PI*2;i.push({x:Math.cos(o)*n,y:Math.sin(o)*n,z:0})}return e.setFromPoints(i),e}return CW(t,e),yW(t)}((window.THREE?window.THREE:{BufferGeometry:Xr}).BufferGeometry),fK=window.THREE?window.THREE:{Color:a,Group:ei,Line:jt,LineBasicMaterial:Oe,Vector3:j},pK=Ph.default.default||Ph.default,mK=Aa({props:{ringsData:{default:[]},ringLat:{default:`lat`},ringLng:{default:`lng`},ringAltitude:{default:.0015},ringColor:{default:function(){return`#ffffaa`},triggerUpdate:!1},ringResolution:{default:64,triggerUpdate:!1},ringMaxRadius:{default:2,triggerUpdate:!1},ringPropagationSpeed:{default:1,triggerUpdate:!1},ringRepeatPeriod:{default:700,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)==null||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)==null||t.resume()},_destructor:function(e){var t;(t=e.ticker)==null||t.dispose()}},init:function(e,t,n){var r=n.tweenGroup;KW(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new _G(e,{objBindAttr:`__threeObjRing`,removeDelay:3e4}).onCreateObj(function(){var e=new fK.Group;return e.__globeObjType=`ring`,e}),t.ticker=new pK,t.ticker.onTick.add(function(e){if(t.ringsData.length){var n=R(t.ringColor),r=R(t.ringAltitude),i=R(t.ringMaxRadius),a=R(t.ringPropagationSpeed),o=R(t.ringRepeatPeriod);t.dataMapper.entries().filter(function(e){return LW(e,2)[1]}).forEach(function(s){var c=LW(s,2),l=c[0],u=c[1];if((u.__nextRingTime||0)<=e){var d=o(l)/1e3;u.__nextRingTime=e+(d<=0?1/0:d);var f=new fK.Line(new dK(1,t.ringResolution),new fK.LineBasicMaterial),p=n(l),m=p instanceof Array||p instanceof Function,h;m?p instanceof Array?(h=wc().domain(p.map(function(e,t){return t/(p.length-1)})).range(p),f.material.transparent=p.some(function(e){return cG(e)<1})):(h=p,f.material.transparent=!0):(f.material.color=new fK.Color(sG(p)),uG(f.material,cG(p)));var g=JW*(1+r(l)),_=i(l),v=_*Math.PI/180,y=a(l),b=y<=0,x=function(e){var t=e.t,n=(b?1-t:t)*v;if(f.scale.x=f.scale.y=g*Math.sin(n),f.position.z=g*(1-Math.cos(n)),m){var r=h(t);f.material.color=new fK.Color(sG(r)),f.material.transparent&&(f.material.opacity=cG(r))}};if(y===0)x({t:0}),u.add(f);else{var S=Math.abs(_/y)*1e3;t.tweenGroup.add(new La({t:0}).to({t:1},S).onUpdate(x).onStart(function(){return u.add(f)}).onComplete(function(){u.remove(f),GW(f)}).start())}}})}})},update:function(e){var t=R(e.ringLat),n=R(e.ringLng),r=R(e.ringAltitude),i=e.scene.localToWorld(new fK.Vector3(0,0,0));e.dataMapper.onUpdateObj(function(e,a){var o=t(a),s=n(a),c=r(a);Object.assign(e.position,XW(o,s,c)),e.lookAt(i)}).digest(e.ringsData)}}),hK={glyphs:{0:{x_min:73,x_max:715,ha:792,o:`m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 `},1:{x_min:215.671875,x_max:574,ha:792,o:`m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 `},2:{x_min:59,x_max:731,ha:792,o:`m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 `},3:{x_min:54,x_max:737,ha:792,o:`m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 `},4:{x_min:48,x_max:742.453125,ha:792,o:`m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 `},5:{x_min:54.171875,x_max:738,ha:792,o:`m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 `},6:{x_min:53,x_max:739,ha:792,o:`m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 `},7:{x_min:58.71875,x_max:730.953125,ha:792,o:`m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 `},8:{x_min:55,x_max:736,ha:792,o:`m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 `},9:{x_min:53,x_max:739,ha:792,o:`m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 `},:{x_min:0,x_max:712,ha:815,o:`m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 `},S:{x_min:0,x_max:788,ha:890,o:`m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 `},"":{x_min:343,x_max:449,ha:792,o:`m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 `},"/":{x_min:183.25,x_max:608.328125,ha:792,o:`m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 `},:{x_min:-.4375,x_max:777.453125,ha:839,o:`m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 `},y:{x_min:0,x_max:684.78125,ha:771,o:`m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 `},:{x_min:0,x_max:803,ha:917,o:`m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 `},:{x_min:-111,x_max:339,ha:361,o:`m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 `},g:{x_min:0,x_max:686,ha:838,o:`m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 `},"":{x_min:0,x_max:442,ha:539,o:`m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 `},"":{x_min:0,x_max:705.5625,ha:803,o:`m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 `},:{x_min:0,x_max:819.5625,ha:893,o:`m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 `},:{x_min:-46.265625,x_max:392,ha:513,o:`m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 `},e:{x_min:0,x_max:714,ha:813,o:`m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 `},:{x_min:0,x_max:712,ha:815,o:`m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 `},J:{x_min:0,x_max:588,ha:699,o:`m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 `},"":{x_min:-1,x_max:503,ha:601,o:`m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 `},"":{x_min:-3,x_max:1008,ha:1106,o:`m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 `},:{x_min:0,x_max:922,ha:1030,o:`m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 `},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:`m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 `},"":{x_min:0,x_max:507.203125,ha:604,o:`m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 `},D:{x_min:0,x_max:828,ha:935,o:`m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 `},"":{x_min:0,x_max:142,ha:239,o:`m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 `},:{x_min:0,x_max:47,ha:125,o:`m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 `},w:{x_min:0,x_max:1009.71875,ha:1100,o:`m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 `},$:{x_min:0,x_max:700,ha:793,o:`m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 `},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:`m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 `},:{x_min:0,x_max:697.21875,ha:747,o:`m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 `},:{x_min:42,x_max:181,ha:297,o:`m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 `},:{x_min:0,x_max:1144.5,ha:1214,o:`m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 `},"":{x_min:0,x_max:139,ha:236,o:`m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 `},:{x_min:0,x_max:801,ha:915,o:`m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 `},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:`m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 `},Q:{x_min:0,x_max:968,ha:1072,o:`m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 `},:{x_min:1,x_max:676.28125,ha:740,o:`m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 `},M:{x_min:0,x_max:954,ha:1067,o:`m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 `},:{x_min:0,x_max:1006,ha:1094,o:`m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 `},C:{x_min:0,x_max:886,ha:944,o:`m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 `},"!":{x_min:0,x_max:138,ha:236,o:`m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 `},"{":{x_min:0,x_max:480.5625,ha:578,o:`m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 `},X:{x_min:-.015625,x_max:854.15625,ha:940,o:`m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 `},"#":{x_min:0,x_max:963.890625,ha:1061,o:`m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 `},:{x_min:42,x_max:284,ha:361,o:`m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 `},:{x_min:0,x_max:906.953125,ha:982,o:`m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 `},")":{x_min:0,x_max:318,ha:415,o:`m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 `},:{x_min:0,x_max:634.71875,ha:714,o:`m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 `},:{x_min:0,x_max:952.78125,ha:1028,o:`m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 `},"}":{x_min:0,x_max:481,ha:578,o:`m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 `},"":{x_min:-3,x_max:1672,ha:1821,o:`m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 `},a:{x_min:0,x_max:698.609375,ha:794,o:`m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 `},"":{x_min:0,x_max:941.671875,ha:1039,o:`m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 `},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:`m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 `},N:{x_min:0,x_max:801,ha:914,o:`m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 `},:{x_min:0,x_max:712,ha:797,o:`m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 `},"":{x_min:0,x_max:941.671875,ha:938,o:`m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 `},Z:{x_min:0,x_max:779,ha:849,o:`m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 `},u:{x_min:0,x_max:617,ha:729,o:`m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 `},k:{x_min:0,x_max:612.484375,ha:697,o:`m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 `},:{x_min:0,x_max:803,ha:917,o:`m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 `},:{x_min:0,x_max:906.953125,ha:985,o:`m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 `},s:{x_min:0,x_max:604,ha:697,o:`m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 `},B:{x_min:0,x_max:778,ha:876,o:`m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 `},"":{x_min:0,x_max:614,ha:708,o:`m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 `},"?":{x_min:0,x_max:607,ha:704,o:`m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 `},H:{x_min:0,x_max:803,ha:915,o:`m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 `},:{x_min:0,x_max:675,ha:761,o:`m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 `},c:{x_min:1,x_max:701.390625,ha:775,o:`m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 `},"":{x_min:0,x_max:566.671875,ha:678,o:`m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 `},:{x_min:0,x_max:660,ha:745,o:`m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 `},:{x_min:0,x_max:954,ha:1068,o:`m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 `},:{x_min:.109375,x_max:1120,ha:1217,o:`m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 `},:{x_min:0,x_max:1158,ha:1275,o:`m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 `},"":{x_min:0,x_max:663.890625,ha:775,o:`m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 `},"":{x_min:.1875,x_max:819.546875,ha:886,o:`m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 `},"(":{x_min:0,x_max:318.0625,ha:415,o:`m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 `},U:{x_min:0,x_max:796,ha:904,o:`m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 `},:{x_min:.5,x_max:744.953125,ha:822,o:`m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 `},:{x_min:0,x_max:765.5625,ha:809,o:`m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 `},F:{x_min:0,x_max:683.328125,ha:717,o:`m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 `},"":{x_min:0,x_max:705.5625,ha:803,o:`m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 `},":":{x_min:0,x_max:142,ha:239,o:`m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 `},:{x_min:0,x_max:854.171875,ha:935,o:`m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 `},"*":{x_min:116,x_max:674,ha:792,o:`m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 `},"":{x_min:0,x_max:777,ha:835,o:`m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 `},"":{x_min:0,x_max:347,ha:444,o:`m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 `},V:{x_min:0,x_max:862.71875,ha:940,o:`m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 `},:{x_min:0,x_max:734.71875,ha:763,o:`m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 `},"\xA0":{x_min:0,x_max:0,ha:853},:{x_min:.328125,x_max:819.515625,ha:889,o:`m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 `},"":{x_min:0,x_max:347,ha:454,o:`m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 `},"@":{x_min:0,x_max:1260,ha:1357,o:`m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 `},:{x_min:0,x_max:499,ha:613,o:`m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 `},i:{x_min:14,x_max:136,ha:275,o:`m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 `},:{x_min:0,x_max:778,ha:877,o:`m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 `},:{x_min:0,x_max:617,ha:725,o:`m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 `},"]":{x_min:0,x_max:275,ha:372,o:`m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 `},m:{x_min:0,x_max:1019,ha:1128,o:`m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 `},:{x_min:8.328125,x_max:780.5625,ha:815,o:`m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 `},:{x_min:42,x_max:326.71875,ha:361,o:`m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 `},:{x_min:0,x_max:779.171875,ha:850,o:`m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 `},R:{x_min:0,x_max:781.953125,ha:907,o:`m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 `},o:{x_min:0,x_max:713,ha:821,o:`m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 `},K:{x_min:0,x_max:819.46875,ha:906,o:`m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 `},",":{x_min:0,x_max:142,ha:239,o:`m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 `},d:{x_min:0,x_max:683,ha:796,o:`m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 `},"":{x_min:-109,x_max:247,ha:232,o:`m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 `},E:{x_min:0,x_max:736.109375,ha:789,o:`m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 `},Y:{x_min:0,x_max:820,ha:886,o:`m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 `},'"':{x_min:0,x_max:299,ha:396,o:`m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 `},"":{x_min:17.984375,x_max:773.609375,ha:792,o:`m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 `},"":{x_min:0,x_max:364,ha:467,o:`m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 `},:{x_min:1,x_max:710,ha:810,o:`m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 `},:{x_min:0,x_max:634.71875,ha:714,o:`m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 `},:{x_min:0,x_max:922,ha:1031,o:`m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 `},"":{x_min:0,x_max:96,ha:251,o:`m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 `},"":{x_min:11,x_max:781,ha:792,o:`m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 `},"|":{x_min:343,x_max:449,ha:792,o:`m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 `},:{x_min:0,x_max:617,ha:725,o:`m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 `},"":{x_min:0,x_max:593,ha:690,o:`m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 `},b:{x_min:0,x_max:685,ha:783,o:`m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 `},q:{x_min:0,x_max:683,ha:876,o:`m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 `},:{x_min:-.171875,x_max:969.5625,ha:1068,o:`m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 `},:{x_min:0,x_max:617,ha:725,o:`m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 `},z:{x_min:-.015625,x_max:613.890625,ha:697,o:`m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 `},"":{x_min:0,x_max:894,ha:1e3,o:`m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 `},:{x_min:.78125,x_max:697,ha:810,o:`m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 `},:{x_min:0,x_max:960,ha:1056,o:`m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 `},"":{x_min:-3,x_max:1008,ha:1106,o:`m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 `},"~":{x_min:0,x_max:833,ha:931,o:`m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 `},:{x_min:0,x_max:736.21875,ha:778,o:`m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 `},"":{x_min:0,x_max:450,ha:547,o:`m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 `},"[":{x_min:0,x_max:273.609375,ha:371,o:`m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 `},L:{x_min:0,x_max:645.828125,ha:696,o:`m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 `},:{x_min:0,x_max:803.390625,ha:894,o:`m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 `},:{x_min:0,x_max:573,ha:642,o:`m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 `},:{x_min:0,x_max:674,ha:778,o:`m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 `},:{x_min:0,x_max:958,ha:1054,o:`m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 `},:{x_min:0,x_max:705.28125,ha:749,o:`m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 `}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:`m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 `},P:{x_min:0,x_max:726,ha:806,o:`m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 `},:{x_min:0,x_max:1078.21875,ha:1118,o:`m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 `},:{x_min:.125,x_max:1136.546875,ha:1235,o:`m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 `},_:{x_min:0,x_max:705.5625,ha:803,o:`m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 `},:{x_min:-110,x_max:246,ha:275,o:`m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 `},"+":{x_min:23,x_max:768,ha:792,o:`m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 `},"":{x_min:0,x_max:1050,ha:1149,o:`m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 `},:{x_min:0,x_max:720,ha:783,o:`m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 `},"'":{x_min:0,x_max:139,ha:236,o:`m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 `},:{x_min:0,x_max:350,ha:397,o:`m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 `},"":{x_min:0,x_max:450,ha:553,o:`m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 `},T:{x_min:0,x_max:777,ha:835,o:`m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 `},:{x_min:0,x_max:915,ha:997,o:`m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 `},"":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:`m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 `},:{x_min:0,x_max:756.953125,ha:819,o:`m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 `},"":{x_min:18.0625,x_max:774,ha:792,o:`m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 `},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:`m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 `},"":{x_min:0,x_max:704.484375,ha:801,o:`m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 `},t:{x_min:0,x_max:367,ha:458,o:`m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 `},"":{x_min:0,x_max:706,ha:803,o:`m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 `},:{x_min:0,x_max:750,ha:803,o:`m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 `},W:{x_min:0,x_max:1263.890625,ha:1351,o:`m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 `},">":{x_min:18.0625,x_max:774,ha:792,o:`m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 `},v:{x_min:0,x_max:675.15625,ha:761,o:`m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 `},:{x_min:.28125,x_max:644.5,ha:703,o:`m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 `},:{x_min:0,x_max:624.9375,ha:699,o:`m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 `},"&":{x_min:-3,x_max:894.25,ha:992,o:`m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 `},:{x_min:0,x_max:862.5,ha:942,o:`m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 `},I:{x_min:41,x_max:180,ha:293,o:`m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 `},G:{x_min:0,x_max:921,ha:1011,o:`m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 `},:{x_min:0,x_max:617,ha:725,o:`m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 `},"`":{x_min:0,x_max:138.890625,ha:236,o:`m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 `},"":{x_min:0,x_max:142,ha:239,o:`m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 `},:{x_min:.328125,x_max:819.515625,ha:889,o:`m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 `},r:{x_min:0,x_max:355.5625,ha:432,o:`m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 `},x:{x_min:0,x_max:675,ha:764,o:`m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 `},:{x_min:0,x_max:696.609375,ha:747,o:`m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 `},h:{x_min:0,x_max:615,ha:724,o:`m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 `},".":{x_min:0,x_max:142,ha:239,o:`m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 `},:{x_min:-2,x_max:878,ha:974,o:`m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 `},";":{x_min:0,x_max:142,ha:239,o:`m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 `},f:{x_min:0,x_max:378,ha:472,o:`m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 `},"":{x_min:1,x_max:348.21875,ha:454,o:`m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 `},A:{x_min:.03125,x_max:906.953125,ha:1008,o:`m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 `},"":{x_min:1,x_max:139.890625,ha:236,o:`m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 `},:{x_min:-70,x_max:283,ha:361,o:`m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 `},:{x_min:-.21875,x_max:773.21875,ha:857,o:`m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 `},:{x_min:0,x_max:765.5625,ha:809,o:`m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 `},O:{x_min:0,x_max:958,ha:1057,o:`m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 `},n:{x_min:0,x_max:615,ha:724,o:`m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 `},l:{x_min:41,x_max:166,ha:279,o:`m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 `},"":{x_min:40.09375,x_max:728.796875,ha:825,o:`m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 `},:{x_min:0,x_max:632.328125,ha:679,o:`m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 `},p:{x_min:0,x_max:685,ha:786,o:`m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 `},"":{x_min:0,x_max:777,ha:835,o:`m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 `},:{x_min:0,x_max:808,ha:907,o:`m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 `},:{x_min:.78125,x_max:697,ha:810,o:`m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 `}},cssFontWeight:`normal`,ascender:1189,underlinePosition:-100,cssFontStyle:`normal`,boundingBox:{yMin:-334,xMin:-111,yMax:1189,xMax:1672},resolution:1e3,original_font_information:{postscript_name:`Helvetiker-Regular`,version_string:`Version 1.00 2004 initial release`,vendor_url:`http://www.magenta.gr/`,full_font_name:`Helvetiker`,font_family_name:`Helvetiker`,copyright:`Copyright (c) agenta ltd, 2004`,description:``,trademark:``,designer:``,designer_url:``,unique_font_identifier:`agenta ltd:Helvetiker:22-10-104`,license_url:`http://www.ellak.gr/fonts/MgOpen/license.html`,license_description:`Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r
\r
Permission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r
\r
The above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r
\r
The Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r
\r
This License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r
\r
The Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r
\r
THE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.`,manufacturer_name:`agenta ltd`,font_sub_family_name:`Regular`},descender:-334,familyName:`Helvetiker`,lineHeight:1522,underlineThickness:50},gK=AW(AW({},window.THREE?window.THREE:{BoxGeometry:ct,CircleGeometry:Ue,DoubleSide:2,Group:ei,Mesh:tr,MeshLambertMaterial:gn,TextGeometry:$U,Vector3:j}),{},{Font:eW,TextGeometry:$U}),_K=Aa({props:{labelsData:{default:[]},labelLat:{default:`lat`},labelLng:{default:`lng`},labelAltitude:{default:.002},labelText:{default:`text`},labelSize:{default:.5},labelTypeFace:{default:hK,onChange:function(e,t){t.font=new gK.Font(e)}},labelColor:{default:function(){return`lightgrey`}},labelRotation:{default:0},labelResolution:{default:3},labelIncludeDot:{default:!0},labelDotRadius:{default:.1},labelDotOrientation:{default:function(){return`bottom`}},labelsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,n){var r=n.tweenGroup;KW(e),t.scene=e,t.tweenGroup=r;var i=new gK.CircleGeometry(1,32);t.dataMapper=new _G(e,{objBindAttr:`__threeObjLabel`}).onCreateObj(function(){var e=new gK.MeshLambertMaterial;e.side=2;var t=new gK.Group;t.add(new gK.Mesh(i,e));var n=new gK.Mesh(void 0,e);t.add(n);var r=new gK.Mesh;return r.visible=!1,n.add(r),t.__globeObjType=`label`,t})},update:function(e){var t=R(e.labelLat),n=R(e.labelLng),r=R(e.labelAltitude),i=R(e.labelText),a=R(e.labelSize),o=R(e.labelRotation),s=R(e.labelColor),c=R(e.labelIncludeDot),l=R(e.labelDotRadius),u=R(e.labelDotOrientation),d=new Set([`right`,`top`,`bottom`]),f=2*Math.PI*JW/360;e.dataMapper.onUpdateObj(function(p,m){var h=LW(p.children,2),g=h[0],_=h[1],v=LW(_.children,1)[0],y=s(m),b=cG(y);_.material.color.set(sG(y)),_.material.transparent=b<1,_.material.opacity=b;var x=c(m),S=u(m);!x||!d.has(S)&&(S=`bottom`);var C=x?+l(m)*f:1e-12;g.scale.x=g.scale.y=C;var w=+a(m)*f;if(_.geometry&&_.geometry.dispose(),_.geometry=new gK.TextGeometry(i(m),{font:e.font,size:w,depth:0,bevelEnabled:!0,bevelThickness:0,bevelSize:0,curveSegments:e.labelResolution}),v.geometry&&v.geometry.dispose(),_.geometry.computeBoundingBox(),v.geometry=_W(gK.BoxGeometry,BW(new gK.Vector3().subVectors(_.geometry.boundingBox.max,_.geometry.boundingBox.min).clampScalar(0,1/0).toArray())),S!==`right`&&_.geometry.center(),x){var T=C+w/2;S===`right`&&(_.position.x=T),_.position.y={right:-w/2,top:T+w/2,bottom:-T-w/2}[S]}var E=function(t){var n=p.__currentTargetD=t,r=n.lat,i=n.lng,a=n.alt,o=n.rot,s=n.scale;Object.assign(p.position,XW(r,i,a)),p.lookAt(e.scene.localToWorld(new gK.Vector3(0,0,0))),p.rotateY(Math.PI),p.rotateZ(-o*Math.PI/180),p.scale.x=p.scale.y=p.scale.z=s},D={lat:+t(m),lng:+n(m),alt:+r(m),rot:+o(m),scale:1},O=p.__currentTargetD||Object.assign({},D,{scale:1e-12});Object.keys(D).some(function(e){return O[e]!==D[e]})&&(!e.labelsTransitionDuration||e.labelsTransitionDuration<0?E(D):e.tweenGroup.add(new La(O).to(D,e.labelsTransitionDuration).easing(ja.Quadratic.InOut).onUpdate(E).start()))}).digest(e.labelsData)}}),vK=AW(AW({},window.THREE?window.THREE:{}),{},{CSS2DObject:rW}),yK=Aa({props:{htmlElementsData:{default:[]},htmlLat:{default:`lat`},htmlLng:{default:`lng`},htmlAltitude:{default:0},htmlElement:{},htmlElementVisibilityModifier:{triggerUpdate:!1},htmlTransitionDuration:{default:1e3,triggerUpdate:!1},isBehindGlobe:{onChange:function(){this.updateObjVisibility()},triggerUpdate:!1}},methods:{updateObjVisibility:function(e,t){e.dataMapper&&(t?[t]:e.dataMapper.entries().map(function(e){return LW(e,2)[1]}).filter(function(e){return e})).forEach(function(t){var n=!e.isBehindGlobe||!e.isBehindGlobe(t.position);e.htmlElementVisibilityModifier?(t.visible=!0,e.htmlElementVisibilityModifier(t.element,n)):t.visible=n})}},init:function(e,t,n){var r=n.tweenGroup;KW(e),t.scene=e,t.tweenGroup=r,t.dataMapper=new _G(e,{objBindAttr:`__threeObjHtml`}).onCreateObj(function(e){var n=R(t.htmlElement)(e),r=new vK.CSS2DObject(n);return r.__globeObjType=`html`,r})},update:function(e,t){var n=this,r=R(e.htmlLat),i=R(e.htmlLng),a=R(e.htmlAltitude);t.hasOwnProperty(`htmlElement`)&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(t,o){var s=function(e){var r=t.__currentTargetD=e,i=r.alt,a=r.lat,o=r.lng;Object.assign(t.position,XW(a,o,i)),n.updateObjVisibility(t)},c={lat:+r(o),lng:+i(o),alt:+a(o)};!e.htmlTransitionDuration||e.htmlTransitionDuration<0||!t.__currentTargetD?s(c):e.tweenGroup.add(new La(t.__currentTargetD).to(c,e.htmlTransitionDuration).easing(ja.Quadratic.InOut).onUpdate(s).start())}).digest(e.htmlElementsData)}}),bK=window.THREE?window.THREE:{Group:ei,Mesh:tr,MeshLambertMaterial:gn,SphereGeometry:yn},xK=Aa({props:{objectsData:{default:[]},objectLat:{default:`lat`},objectLng:{default:`lng`},objectAltitude:{default:.01},objectFacesSurface:{default:!0},objectRotation:{},objectThreeObject:{default:new bK.Mesh(new bK.SphereGeometry(1,16,8),new bK.MeshLambertMaterial({color:`#ffffaa`,transparent:!0,opacity:.7}))}},init:function(e,t){KW(e),t.scene=e,t.dataMapper=new _G(e,{objBindAttr:`__threeObjObject`}).onCreateObj(function(e){var n=R(t.objectThreeObject)(e);t.objectThreeObject===n&&(n=n.clone());var r=new bK.Group;return r.add(n),r.__globeObjType=`object`,r})},update:function(e,t){var n=R(e.objectLat),r=R(e.objectLng),i=R(e.objectAltitude),a=R(e.objectFacesSurface),o=R(e.objectRotation);t.hasOwnProperty(`objectThreeObject`)&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(e,t){var s=+n(t),c=+r(t),l=+i(t);Object.assign(e.position,XW(s,c,l)),a(t)?e.setRotationFromEuler(new Ir(QW(-s),QW(c),0,`YXZ`)):e.rotation.set(0,0,0);var u=e.children[0],d=o(t);d&&u.setRotationFromEuler(new Ir(QW(d.x||0),QW(d.y||0),QW(d.z||0)))}).digest(e.objectsData)}}),SK=Aa({props:{customLayerData:{default:[]},customThreeObject:{},customThreeObjectUpdate:{triggerUpdate:!1}},init:function(e,t){KW(e),t.scene=e,t.dataMapper=new _G(e,{objBindAttr:`__threeObjCustom`}).onCreateObj(function(e){var n=R(t.customThreeObject)(e,JW);return n&&(t.customThreeObject===n&&(n=n.clone()),n.__globeObjType=`custom`),n})},update:function(e,t){e.customThreeObjectUpdate||KW(e.scene);var n=R(e.customThreeObjectUpdate);t.hasOwnProperty(`customThreeObject`)&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(e,t){return n(e,t,JW)}).digest(e.customLayerData)}}),CK=window.THREE?window.THREE:{Camera:T,Group:ei,Vector2:Fe,Vector3:j},wK=[`globeLayer`,`pointsLayer`,`arcsLayer`,`hexBinLayer`,`heatmapsLayer`,`polygonsLayer`,`hexedPolygonsLayer`,`pathsLayer`,`tilesLayer`,`particlesLayer`,`ringsLayer`,`labelsLayer`,`htmlElementsLayer`,`objectsLayer`,`customLayer`],TK=qW(`globeLayer`,oG),EK=Object.assign.apply(Object,BW([`globeImageUrl`,`bumpImageUrl`,`globeCurvatureResolution`,`globeTileEngineUrl`,`globeTileEngineMaxLevel`,`showGlobe`,`showGraticules`,`showAtmosphere`,`atmosphereColor`,`atmosphereAltitude`].map(function(e){return bW({},e,TK.linkProp(e))}))),DK=Object.assign.apply(Object,BW([`globeMaterial`,`globeTileEngineClearCache`].map(function(e){return bW({},e,TK.linkMethod(e))}))),OK=qW(`pointsLayer`,xG),kK=Object.assign.apply(Object,BW([`pointsData`,`pointLat`,`pointLng`,`pointColor`,`pointAltitude`,`pointRadius`,`pointResolution`,`pointsMerge`,`pointsTransitionDuration`].map(function(e){return bW({},e,OK.linkProp(e))}))),AK=qW(`arcsLayer`,AG),jK=Object.assign.apply(Object,BW([`arcsData`,`arcStartLat`,`arcStartLng`,`arcStartAltitude`,`arcEndLat`,`arcEndLng`,`arcEndAltitude`,`arcColor`,`arcAltitude`,`arcAltitudeAutoScale`,`arcStroke`,`arcCurveResolution`,`arcCircularResolution`,`arcDashLength`,`arcDashGap`,`arcDashInitialGap`,`arcDashAnimateTime`,`arcsTransitionDuration`].map(function(e){return bW({},e,AK.linkProp(e))}))),MK=qW(`hexBinLayer`,PG),NK=Object.assign.apply(Object,BW([`hexBinPointsData`,`hexBinPointLat`,`hexBinPointLng`,`hexBinPointWeight`,`hexBinResolution`,`hexMargin`,`hexTopCurvatureResolution`,`hexTopColor`,`hexSideColor`,`hexAltitude`,`hexBinMerge`,`hexTransitionDuration`].map(function(e){return bW({},e,MK.linkProp(e))}))),PK=qW(`heatmapsLayer`,qG),FK=Object.assign.apply(Object,BW([`heatmapsData`,`heatmapPoints`,`heatmapPointLat`,`heatmapPointLng`,`heatmapPointWeight`,`heatmapBandwidth`,`heatmapColorFn`,`heatmapColorSaturation`,`heatmapBaseAltitude`,`heatmapTopAltitude`,`heatmapsTransitionDuration`].map(function(e){return bW({},e,PK.linkProp(e))}))),IK=qW(`hexedPolygonsLayer`,eK),LK=Object.assign.apply(Object,BW([`hexPolygonsData`,`hexPolygonGeoJsonGeometry`,`hexPolygonColor`,`hexPolygonAltitude`,`hexPolygonResolution`,`hexPolygonMargin`,`hexPolygonUseDots`,`hexPolygonCurvatureResolution`,`hexPolygonDotResolution`,`hexPolygonsTransitionDuration`].map(function(e){return bW({},e,IK.linkProp(e))}))),RK=qW(`polygonsLayer`,YG),zK=Object.assign.apply(Object,BW([`polygonsData`,`polygonGeoJsonGeometry`,`polygonCapColor`,`polygonCapMaterial`,`polygonSideColor`,`polygonSideMaterial`,`polygonStrokeColor`,`polygonAltitude`,`polygonCapCurvatureResolution`,`polygonsTransitionDuration`].map(function(e){return bW({},e,RK.linkProp(e))}))),BK=qW(`pathsLayer`,aK),VK=Object.assign.apply(Object,BW([`pathsData`,`pathPoints`,`pathPointLat`,`pathPointLng`,`pathPointAlt`,`pathResolution`,`pathColor`,`pathStroke`,`pathDashLength`,`pathDashGap`,`pathDashInitialGap`,`pathDashAnimateTime`,`pathTransitionDuration`].map(function(e){return bW({},e,BK.linkProp(e))}))),HK=qW(`tilesLayer`,sK),UK=Object.assign.apply(Object,BW([`tilesData`,`tileLat`,`tileLng`,`tileAltitude`,`tileWidth`,`tileHeight`,`tileUseGlobeProjection`,`tileMaterial`,`tileCurvatureResolution`,`tilesTransitionDuration`].map(function(e){return bW({},e,HK.linkProp(e))}))),WK=qW(`particlesLayer`,uK),GK=Object.assign.apply(Object,BW([`particlesData`,`particlesList`,`particleLat`,`particleLng`,`particleAltitude`,`particlesSize`,`particlesSizeAttenuation`,`particlesColor`,`particlesTexture`].map(function(e){return bW({},e,WK.linkProp(e))}))),KK=qW(`ringsLayer`,mK),qK=Object.assign.apply(Object,BW([`ringsData`,`ringLat`,`ringLng`,`ringAltitude`,`ringColor`,`ringResolution`,`ringMaxRadius`,`ringPropagationSpeed`,`ringRepeatPeriod`].map(function(e){return bW({},e,KK.linkProp(e))}))),JK=qW(`labelsLayer`,_K),YK=Object.assign.apply(Object,BW([`labelsData`,`labelLat`,`labelLng`,`labelAltitude`,`labelRotation`,`labelText`,`labelSize`,`labelTypeFace`,`labelColor`,`labelResolution`,`labelIncludeDot`,`labelDotRadius`,`labelDotOrientation`,`labelsTransitionDuration`].map(function(e){return bW({},e,JK.linkProp(e))}))),XK=qW(`htmlElementsLayer`,yK),ZK=Object.assign.apply(Object,BW([`htmlElementsData`,`htmlLat`,`htmlLng`,`htmlAltitude`,`htmlElement`,`htmlElementVisibilityModifier`,`htmlTransitionDuration`].map(function(e){return bW({},e,XK.linkProp(e))}))),QK=qW(`objectsLayer`,xK),$K=Object.assign.apply(Object,BW([`objectsData`,`objectLat`,`objectLng`,`objectAltitude`,`objectRotation`,`objectFacesSurface`,`objectThreeObject`].map(function(e){return bW({},e,QK.linkProp(e))}))),eq=qW(`customLayer`,SK),tq=Object.assign.apply(Object,BW([`customLayerData`,`customThreeObject`,`customThreeObjectUpdate`].map(function(e){return bW({},e,eq.linkProp(e))}))),nq=Aa({props:AW(AW(AW(AW(AW(AW(AW(AW(AW(AW(AW(AW(AW(AW(AW({onGlobeReady:{triggerUpdate:!1},rendererSize:{default:new CK.Vector2(window.innerWidth,window.innerHeight),onChange:function(e,t){t.pathsLayer.rendererSize(e)},triggerUpdate:!1}},EK),kK),jK),NK),FK),zK),LK),VK),UK),GK),qK),YK),ZK),$K),tq),methods:AW({getGlobeRadius:YW,getCoords:function(e){var t=[...arguments].slice(1);return XW.apply(void 0,t)},toGeoCoords:function(e){var t=[...arguments].slice(1);return ZW.apply(void 0,t)},setPointOfView:function(e,t){var n=t instanceof CK.Camera?t.position:t,r=YW(),i=void 0;if(e.scene&&n){var a,o,s,c;i=function(t){a===void 0&&(a=n.clone().applyMatrix4(e.scene.matrixWorld.clone().invert())),o===void 0&&(o=a.length()),s===void 0&&(s=Math.sqrt(o**2-r**2)),c===void 0&&(c=Math.acos(s/o));var i=a.distanceTo(t);if(i<s)return!1;var l=t.length();return Math.acos((o**2+i**2-l**2)/(2*o*i))<c}}e.layersThatNeedUpdatePov.forEach(function(e){return e.updatePov(t)}),e.layersThatNeedBehindGlobeChecker.forEach(function(e){return e.isBehindGlobe(i)})},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),e.pausableLayers.forEach(function(e){return e.pauseAnimation?.call(e)}),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),e.pausableLayers.forEach(function(e){return e.resumeAnimation?.call(e)}),this},_animationCycle:function(e){e.animationFrameRequestId=requestAnimationFrame(this._animationCycle),e.tweenGroup.update()},_destructor:function(e){this.pauseAnimation(),e.destructableLayers.forEach(function(e){return e._destructor()})}},DK),stateInit:function(){var e=new Na,t={tweenGroup:e},n={globeLayer:oG(t),pointsLayer:xG(t),arcsLayer:AG(t),hexBinLayer:PG(t),heatmapsLayer:qG(t),polygonsLayer:YG(t),hexedPolygonsLayer:eK(t),pathsLayer:aK(t),tilesLayer:sK(t),particlesLayer:uK(t),ringsLayer:mK(t),labelsLayer:_K(t),htmlElementsLayer:yK(t),objectsLayer:xK(t),customLayer:SK(t)};return AW(AW({tweenGroup:e},n),{},{layersThatNeedUpdatePov:Object.values(n).filter(function(e){return e.hasOwnProperty(`updatePov`)}),layersThatNeedBehindGlobeChecker:Object.values(n).filter(function(e){return e.hasOwnProperty(`isBehindGlobe`)}),destructableLayers:Object.values(n).filter(function(e){return e.hasOwnProperty(`_destructor`)}),pausableLayers:Object.values(n).filter(function(e){return e.hasOwnProperty(`pauseAnimation`)})})},init:function(e,t,n){var r=n.animateIn,i=r===void 0?!0:r,a=n.waitForGlobeReady,o=a===void 0?!0:a;KW(e),t.scene=e,t.scene.visible=!1,wK.forEach(function(e){var n=new CK.Group;t.scene.add(n),t[e](n)});var s=function(){if(i){t.scene.scale.set(1e-6,1e-6,1e-6),t.tweenGroup.add(new La({k:1e-6}).to({k:1},600).easing(ja.Quadratic.Out).onUpdate(function(e){var n=e.k;return t.scene.scale.set(n,n,n)}).start());var e=new CK.Vector3(0,1,0);t.tweenGroup.add(new La({rot:Math.PI*2}).to({rot:0},1200).easing(ja.Quintic.Out).onUpdate(function(n){var r=n.rot;return t.scene.setRotationFromAxisAngle(e,r)}).start())}t.scene.visible=!0,t.onGlobeReady&&t.onGlobeReady()};o?t.globeLayer.onReady(s):s(),this._animationCycle()},update:function(e){}});function rq(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=function(t){function r(){var t;pW(this,r);var i=[...arguments];return t=dW(this,r,[].concat(i)),t.__kapsuleInstance=_W(e,[].concat(BW(n?[t]:[]),i)),t}return CW(r,t),yW(r)}(t);return Object.keys(e()).forEach(function(e){return r.prototype[e]=function(){var t,n=(t=this.__kapsuleInstance)[e].apply(t,arguments);return n===this.__kapsuleInstance?this:n}}),r}var iq=rq(nq,(window.THREE?window.THREE:{Group:ei}).Group,!0),aq={type:`FeatureCollection`,features:[{type:`Feature`,properties:{name:`Afghanistan`,iso_a2:`AF`,iso_a3:`AFG`,iso_n3:`004`},geometry:{type:`Polygon`,coordinates:[[[61.210817,35.650072],[62.230651,35.270664],[62.984662,35.404041],[63.193538,35.857166],[63.982896,36.007957],[64.546479,36.312073],[64.746105,37.111818],[65.588948,37.305217],[65.745631,37.661164],[66.217385,37.39379],[66.518607,37.362784],[67.075782,37.356144],[67.83,37.144994],[68.135562,37.023115],[68.859446,37.344336],[69.196273,37.151144],[69.518785,37.608997],[70.116578,37.588223],[70.270574,37.735165],[70.376304,38.138396],[70.806821,38.486282],[70.781318,38.472093],[71.348131,38.258905],[71.239404,37.953265],[71.541918,37.905774],[71.448693,37.065645],[71.844638,36.738171],[72.193041,36.948288],[72.63689,37.047558],[72.964154,37.260566],[73.948696,37.421566],[74.980002,37.41999],[75.158028,37.133031],[74.575893,37.020841],[74.067552,36.836176],[72.920025,36.720007],[71.846292,36.509942],[71.262348,36.074388],[71.498768,35.650563],[71.613076,35.153203],[71.115019,34.733126],[71.156773,34.348911],[70.881803,33.988856],[69.930543,34.02012],[70.323594,33.358533],[69.687147,33.105499],[69.262522,31.901371],[69.147114,31.901852],[68.926677,31.620189],[68.556932,31.71331],[67.792689,31.58293],[67.683394,31.303154],[66.938891,31.304911],[66.381458,30.738899],[66.346473,29.887943],[65.046862,29.472181],[64.350419,29.560031],[64.148002,29.340819],[63.550261,29.468331],[62.549857,29.318572],[60.874248,29.829239],[61.781222,30.73585],[61.699314,31.379506],[60.941945,31.548075],[60.863655,32.18292],[60.536078,32.981269],[60.9637,33.528832],[60.52843,33.676446],[60.803193,34.404102],[61.210817,35.650072]]]}}]},oq=Rt();lr({ThreeGlobe:iq});var sq=3,cq=1.2,lq=300;function uq({globeConfig:e,data:t,scale:n=[1,1,1]}){let r=(0,ki.useRef)(null),i=(0,ki.useRef)(),[o,s]=(0,ki.useState)(!1),c={pointSize:1,atmosphereColor:`#ffffff`,showAtmosphere:!0,atmosphereAltitude:.1,polygonColor:`rgba(255,255,255,0.7)`,globeColor:`#1d072e`,emissive:`#000000`,emissiveIntensity:.1,shininess:.9,arcTime:2e3,arcLength:.9,rings:1,maxRings:3,...e};return(0,ki.useEffect)(()=>{!r.current&&i.current&&(r.current=new iq,i.current.add(r.current),s(!0))},[]),(0,ki.useEffect)(()=>{if(!r.current||!o)return;let t=r.current.globeMaterial();t.color=new a(e.globeColor),t.emissive=new a(e.emissive),t.emissiveIntensity=e.emissiveIntensity||.1,t.shininess=e.shininess||.9},[o,e.globeColor,e.emissive,e.emissiveIntensity,e.shininess]),(0,ki.useEffect)(()=>{if(!r.current||!o||!t)return;let e=[];for(let n=0;n<t.length;n++){let r=t[n];e.push({size:c.pointSize,order:r.order,color:r.color,lat:r.startLat,lng:r.startLng}),e.push({size:c.pointSize,order:r.order,color:r.color,lat:r.endLat,lng:r.endLng})}let n=e.filter((e,t,n)=>n.findIndex(t=>[`lat`,`lng`].every(n=>t[n]===e[n]))===t);r.current.hexPolygonsData(aq.features).hexPolygonResolution(3).hexPolygonMargin(.7).showAtmosphere(c.showAtmosphere).atmosphereColor(c.atmosphereColor).atmosphereAltitude(c.atmosphereAltitude).hexPolygonColor(()=>c.polygonColor),r.current.arcsData(t).arcStartLat(e=>e.startLat).arcStartLng(e=>e.startLng).arcEndLat(e=>e.endLat).arcEndLng(e=>e.endLng).arcColor(e=>e.color).arcAltitude(e=>e.arcAlt).arcStroke(()=>[.32,.28,.3][Math.floor(Math.random()*3)]).arcDashLength(c.arcLength).arcDashInitialGap(e=>e.order).arcDashGap(15).arcDashAnimateTime(()=>c.arcTime),r.current.pointsData(n).pointColor(e=>e.color).pointsMerge(!0).pointAltitude(0).pointRadius(2),r.current.ringsData([]).ringColor(()=>c.polygonColor).ringMaxRadius(c.maxRings).ringPropagationSpeed(sq).ringRepeatPeriod(c.arcTime*c.arcLength/c.rings)},[o,t,c.pointSize,c.showAtmosphere,c.atmosphereColor,c.atmosphereAltitude,c.polygonColor,c.arcLength,c.arcTime,c.rings,c.maxRings]),(0,ki.useEffect)(()=>{if(!r.current||!o||!t)return;let e=setInterval(()=>{let e=pq(0,t.length,Math.floor(t.length*4/5)),n=t.filter((t,n)=>e.includes(n)).map(e=>({lat:e.startLat,lng:e.startLng,color:e.color}));r.current.ringsData(n)},2e3);return()=>clearInterval(e)},[o,t]),(0,oq.jsx)(`group`,{ref:i,scale:n})}function dq(){let{gl:e,size:t}=Rn();return(0,ki.useEffect)(()=>{e.setPixelRatio(window.devicePixelRatio),e.setSize(t.width,t.height),e.setClearColor(16755455,0)},[]),null}function fq(e){let{globeConfig:t,scale:n}=e,r=new Se;return r.fog=new Cr(16777215,400,2e3),(0,oq.jsxs)(Lr,{scene:r,camera:new Ee(50,cq,180,1800),children:[(0,oq.jsx)(dq,{}),(0,oq.jsx)(`ambientLight`,{color:t.ambientLight,intensity:.6}),(0,oq.jsx)(`directionalLight`,{color:t.directionalLeftLight,position:new j(-400,100,400)}),(0,oq.jsx)(`directionalLight`,{color:t.directionalTopLight,position:new j(-200,500,200)}),(0,oq.jsx)(`pointLight`,{color:t.pointLight,position:new j(-200,500,200),intensity:.8}),(0,oq.jsx)(uq,{...e,scale:n}),`// In your Globe.jsx file, update the OrbitControls component:`,(0,oq.jsx)(Ai,{enablePan:!1,enableZoom:!1,enableRotate:!0,autoRotate:!0,minDistance:lq,maxDistance:lq,minPolarAngle:Math.PI/3.5,maxPolarAngle:Math.PI-Math.PI/3})]})}function pq(e,t,n){let r=[];for(;r.length<n;){let n=Math.floor(Math.random()*(t-e))+e;r.includes(n)||r.push(n)}return r}export{uq as Globe,dq as WebGLRendererConfig,fq as World,pq as genRandomNumbers};